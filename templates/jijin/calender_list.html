{% extends "calender_base.html" %}



{% block head_2 %}
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
{% endblock %}


{% block content %}
    <div style="margin-bottom: 5px;">

        <ins class="adsbygoogle" style="display:inline-block;" data-ad-client="ca-pub-6111334333458862"
             data-ad-slot="3820120620"></ins>

    </div>

    <div class="layui-btn-group demoTable">
        <button class="layui-btn" data-type="getCheckData">获取选中行数据</button>
        <button class="layui-btn" data-type="getCheckLength">获取选中数目</button>
        <button class="layui-btn" data-type="isAll">验证是否全选</button>
    </div>

    <table class="layui-table" lay-data="{ url:'/jijin/calender/list_handle/', page:true, id:'idTest'}"
           lay-filter="demo">
        <thead>
        <tr>
            <th lay-data="{type:'checkbox', fixed: 'left'}"></th>
            <th lay-data="{field:'schedule_id', width:100, sort: true, fixed: true}">ID</th>
            <th lay-data="{field:'schedule_name', width:100, edit:'text'}">日程名</th>
            <th lay-data="{field:'person_name', width:120, sort: true,edit:'text'}">参与人员</th>
            <th lay-data="{field:'association_name', width:120, edit:'text'}">关联</th>
            <th lay-data="{field:'start_time', width:200}">开始时间</th>
            <th lay-data="{field:'end_time', width:200, sort: true}">结束时间</th>
            <th lay-data="{fixed: 'right', width:180, align:'center', toolbar: '#barDemo'}"></th>
        </tr>
        </thead>
    </table>

    <div class="layui-row" id="popUpdateTest" style="display:none;">
        <div class="layui-col-md10">
            <form class="layui-form" method="post" action="" style="width: 800px">

                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 0;">
                    <legend>修改日程</legend>
                </fieldset>

                <div class="layui-form-item">
                    <label class="layui-form-label">日程名</label>
                    <div class="layui-input-block">
                        <input id="schedule_name_2" type="text" name="title" autocomplete="off" placeholder="请输入日程名" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">参与人员</label>
                    <div class="layui-input-inline">
                        <select id="participant_2"  name="participants" lay-filter="aihao">
                            <option value=""></option>
                            <option value="0" selected>陈桥</option>
                            <option value="1">徐菲菲</option>
                            <option value="2">赵云澜</option>
                            <option value="3">沈巍</option>
                            <option value="4">Nancy</option>
                        </select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">关联</label>
                        <div class="layui-input-block">
                            <select id="association_name_2" name="interest1" lay-filter="aihao">
                                <option value="" selected=""></option>
                                <option value="0">股权直投</option>
                                <option value="1">二级市场</option>
                                <option value="2">地产</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">对方参与</label>
                        <div class="layui-input-inline">
                            <input id="participation_2" type="text" name="participation" lay-verify="required" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">公开</label>
                        <div class="layui-input-block">
                            <input id="is_public_2" type="checkbox" checked="" name="open" lay-skin="switch" lay-filter="switchTest"
                                   title="开关">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">地点</label>
                    <div class="layui-input-block">
                        <input id="address_2" type="text" name="address" autocomplete="off" placeholder="请输入地点" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">全天事件</label>
                        <div class="layui-input-block">
                            <input id="is_all_day_event_2" type="checkbox" checked="" name="open2" lay-skin="switch" lay-filter="switchTest"
                                   title="开关">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">开始时间</label>
                        <div class="layui-input-block">
                            <input type="text" name="date1" id="start_time_2" autocomplete="on" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">结束时间</label>
                        <div class="layui-input-block">
                            <input type="text" name="date2" id="end_time_2" autocomplete="on" class="layui-input">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">重复</label>
                    <div class="layui-input-inline">
                        <select id="time_select_2" name="interest2" lay-filter="aihao">
                            <option value=""></option>
                            <option value="0">不重复</option>
                            <option value="1">每日</option>
                            <option value="2">每周</option>
                            <option value="3">每月</option>
                            <option value="4">每年</option>
                        </select>
                    </div>
                    <label class="layui-form-label">提醒</label>
                    <div class="layui-input-inline">
                        <select id="remind_name_2" name="interest3" lay-filter="aihao">
                            <option value=""></option>
                            <option value="0">不提醒</option>
                            <option value="1">提前一小时</option>
                            <option value="2">提前一天</option>
                            <option value="3">提前一周</option>
                        </select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">直到</label>
                        <div class="layui-input-inline">
                            <input  type="text" name="date" id="util_time_2" lay-verify="date" placeholder="yyyy-MM-dd"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">会议摘要</label>
                    <div class="layui-input-block">
                        <textarea id="meeting_summary_2" placeholder="请输入内容" class="layui-textarea" name="abstract"></textarea>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button type="button" class="layui-btn" id="test3"><i class="layui-icon"></i>上传文件</button>
                        <button class="layui-btn layui-btn-submit" lay-submit="" lay-filter="demo2">提交</button>
                        <button class="layui-btn layui-btn-primary" lay-filter type="submit" action="cache">暂存</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>

            </form>

        </div>
    </div>

    <div class="layui-row" id="viewData" style="display:none;">
        <div class="layui-col-md10">
            <form class="layui-form" method="post" action="" style="width: 800px">

                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 0;">
                    <legend>查看日程</legend>
                </fieldset>

                <div class="layui-form-item">
                    <label class="layui-form-label">日程名</label>
                    <div class="layui-input-block">
                        <input id="schedule_name" type="text" name="title" autocomplete="off" placeholder="请输入日程名" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">参与人员</label>
                    <div class="layui-input-inline">
                        <input id="person_name" type="text" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">关联</label>
                        <div class="layui-input-block">
                            <input id="association_name" type="text" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">对方参与</label>
                        <div class="layui-input-inline">
                            <input id="participation" type="text" name="participation" lay-verify="required" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">公开</label>
                        <div class="layui-input-block">
                            <input id="is_public" type="checkbox" checked="" name="open" lay-skin="switch" lay-filter="switchTest"
                                   title="开关">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">地点</label>
                    <div class="layui-input-block">
                        <input id="address" type="text" name="address" autocomplete="off" placeholder="请输入地点" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">全天事件</label>
                        <div class="layui-input-block">
                            <input id="is_all_day_event" type="checkbox" checked="" name="open2" lay-skin="switch" lay-filter="switchTest"
                                   title="开关">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">开始时间</label>
                        <div class="layui-input-block">
                            <input type="text" name="date1" id="start_time" autocomplete="on" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">结束时间</label>
                        <div class="layui-input-block">
                            <input type="text" name="date2" id="end_time" autocomplete="on" class="layui-input">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">重复</label>
                    <div class="layui-input-inline">
                        <input id="time_select" type="text" class="layui-input">
                    </div>
                    <label class="layui-form-label">提醒</label>
                    <div class="layui-input-inline">
                        <input id="remind_name" type="text" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">直到</label>
                        <div class="layui-input-inline">
                            <input type="text" name="date" id="util_time" lay-verify="date" placeholder="yyyy-MM-dd"
                                   autocomplete="on" class="layui-input">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">会议摘要</label>
                    <div class="layui-input-block">
                        <textarea id="meeting_summary" placeholder="请输入内容" class="layui-textarea" name="abstract"></textarea>
                    </div>
                </div>


            </form>

        </div>
    </div>
{% endblock %}


{% block script %}
    <script type="text/html" id="barDemo">
        {#	 <a class="layui-btn layui-btn-xs" lay-event="add">添加</a>#}
        <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </script>

    <script src="/static/layui.js"></script>

    <script>
        layui.use(['table', "form", "laydate"], function () {
            var table = layui.table
                , form = layui.form
                , laydate = layui.laydate;
            {#var  popForm=layui.form;#}
            //监听表格复选框选择
            table.on('checkbox(demo)', function (obj) {
                console.log(obj); //选中行的相关数据
            });
            //监听工具条
            table.on('tool(demo)', function (obj) {
                var data = obj.data;
                if (obj.event === 'detail') {
                    {#layer.msg('ID：'+ data.id + ' 的查看操作');#}
                    layer.open({
                    		//layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                    		type: 1,
                    		{#title: "查看日程",#}
                    		area: ['800px','500px'],
                    		content: $("#viewData"),//引用的弹出层的页面层的方式加载修改界面表单
                    		shade:0,
                            success:function(x,y)
                            {

                                for(var key in data) {
                                    var idName='#'+key;
                                    if(idName=="#is_all_day_event"){

                                    }else{
                                        $(idName).val(data[key]);
                                    }

                            }
                            {#$("#fund").val("二股");#}
                            {#$("#fund").find("option[value='股权直投']").prop("selected",true);#}
                            {#form.render('select','aihao'); //刷新select选择框渲染#}

                            {#x.find("input")[0].value=data.person;#}
                            {#x.find("input")[1].value=data.title;#}
                             {#x.find("input[name=xxx]").value=data.xxx;#}

                        }
                    	});
                } else if (obj.event === 'del') {
                    layer.confirm('真的删除行么', function (index) {
                        obj.del();
                        var schedule_id = obj.data.schedule_id;
                        {#alert(index)#}
                        $.ajax({
                            url: "/jijin/calender/calender_delete/",
                            type: "post",
                            async: false,
                            data: {'schedule_id': schedule_id},
                            dataType: "json",
                            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',//防止乱码
                            success: function (data) {
                                if (data == '2') {
                                    {#alert('成功');#}
                                }
                            }

                        });
                        layer.close(index);
                    });
                } else if (obj.event === 'edit') {
                    layer.open({
                        //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                        type: 1,
                        {#title: "修改日程",#}
                        area: ['800px', '500px'],
                        content: $("#popUpdateTest"),//引用的弹出层的页面层的方式加载修改界面表单
                        shade: 0,
                        success:function(x,y)
                        {

                            for(var key in data) {
                                var idName='#'+key + "_2";
                                $(idName).val(data[key]);
                            }
                            {#$("#fund").val("二股");#}
                            {#$("#fund").find("option[value='股权直投']").prop("selected",true);#}
                            {#form.render('select','aihao'); //刷新select选择框渲染#}

                            {#x.find("input")[0].value=data.person;#}
                            {#x.find("input")[1].value=data.title;#}
                             {#x.find("input[name=xxx]").value=data.xxx;#}

                        }
                    });
                    //动态向表传递赋值可以参看文章进行修改界面的更新前数据的显示，当然也是异步请求的要数据的修改数据的获取
                    //getFormValue(obj, data);
                }


            });
            function getFormValue(obj,data)
            {
                popForm.val("data",{"title":data.title});
                popForm.render(null,"data");
            }
            function setFormValue(obj, data) {
                form.on("submit(demo2)", function () {
                    alert("ok");
                    alert(data);
                    $.ajax({
                        url: "/jijin/calender/calender_edit/",
                        type: "POST",
                        data: {
                            "schdule_id": data.id, "schedule_name": data.name, "person_name": data.person_name,
                            "association_name": data.fund, "start_time": data.start_time, "end_time": data.end_time,
                            dataAll:data
                        },
                        success: function (msg) {
                            console.log(msg);
                            layer.closeAll()
                        }
                    });
                    return false;
                })

            }



              //日期
              laydate.render({
                elem: '#start_time'
              });
              laydate.render({
                elem: '#end_time'
              });
              laydate.render({
                elem: '#util_time'
              });

            var $ = layui.$, active = {
                getCheckData: function () { //获取选中数据
                    var checkStatus = table.checkStatus('idTest')
                        , data = checkStatus.data;
                    layer.alert(JSON.stringify(data));
                }
                , getCheckLength: function () { //获取选中数目
                    var checkStatus = table.checkStatus('idTest')
                        , data = checkStatus.data;
                    layer.msg('选中了：' + data.length + ' 个');
                }
                , isAll: function () { //验证是否全选
                    var checkStatus = table.checkStatus('idTest');
                    layer.msg(checkStatus.isAll ? '全选' : '未全选')
                }
            };

            $('.demoTable .layui-btn').on('click', function () {
                var type = $(this).data('type');
                active[type] ? active[type].call(this) : '';
            });
        });


    </script>
{% endblock %}
 

