function push_state(t,e){if(window.history&&window.history.pushState){var i={title:e=e||document.title,url:t};window.history.pushState(i,e,"?/"+t)}}function weixin_title(t,e){isMobile.wx()&&t&&e&&e[t]&&e[t].title&&(document.title=e[t].title)}String.prototype.padRight=function(t,e){var i=new String(this);if(this.length<e&&0<t.toString().length)for(var n=0;n<e-this.length;n++)i=i.concat(t.toString().charAt(0));return i};var number_format=function(t,e,i,n,r){t=(t+"").replace(/[^0-9+\-Ee.]/g,"");var o,a,c,u=isFinite(+t)?+t:0,s=isFinite(+e)?Math.abs(e):2,f=void 0===n?",":n,d=void 0===i?".":i,l=(r=r||!1,"");return 3<(l=(s?(o=u,a=s,c=Math.pow(10,a),""+Math.round(o*c)/c):""+Math.round(u)).split("."))[0].length&&(l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,f)),r?(l[1]=(l[1]||"").padRight("0",e),l.join(d)):l[1]||"0"!==l[0]?l.join(d):"0"},isMobile={ua:function(t){return!!navigator.userAgent.match(new RegExp(t,"i"))},Android:function(){return isMobile.ua("Android")},BlackBerry:function(){return isMobile.ua("BlackBerry")},iOS:function(){return isMobile.ua("iPhone|iPad|iPod")},iPad:function(){return isMobile.ua("iPad")},Windows:function(){return isMobile.ua("IEMobile")},wx:function(){return isMobile.ua("micromessenger")},wxWork:function(){return isMobile.ua("wxwork")},APP:function(){return isMobile.ua("html5plus")},huawei:function(){return isMobile.ua("HUAWEI|HONOR")},iPhoneX:function(){return this.iOS()&&812===screen.height&&375===screen.width},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Windows()}};function parse_json(t,e){"object"!=typeof e&&(e={});try{e=JSON.parse(t)||e}catch(t){}return e}function parse_comma_data(t,e){var i=[];if(!t)return i;e||(e=-1!=t.indexOf(",")?",":"锛�"),str_a=(t+"").split(e);for(var n=0;n<str_a.length;n++)i.push($.trim(str_a[n]));return i}function guid(t){return t+Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function seg(t,e){var i=(e=e||window.location.search.replace("?/","")).indexOf("&");return 0<i&&(e=e.slice(0,i)),"number"!=typeof t?e:(url_p=e.split("/"),url_p[t-1]||"")}function load_js(t){"object"==typeof t&&setTimeout(function(){t.forEach(function(t,e){$("head").append($("<script>").attr({async:!0,charset:"utf-8",src:"/static/"+t}))})})}function debounce(e,i){var n;return i=i||200,function(){var t=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(this,t)}.bind(this),i)}}function valid_uuid(t){return"string"==typeof t&&!!t.match(/[0-9a-z]+/)}function strip_tags(t){if("string"!=typeof t)return"";var e=$("<div>");return e.append(t),e.text()}function trim_form_data(t){if("string"!=typeof t||!t)return"";var e="((\\+|(\\%09)|(\\%0A)|(\\%0D)|(\\%E3\\%80\\%80))*)";return t=(t=(t=t.replace(new RegExp("="+e,"g"),"=")).replace(new RegExp(e+"&","g"),"&")).replace(new RegExp("(^"+e+")|("+e+"$)","g"),"")}function in_array(t,e){return 0<=e.indexOf(t)}function daycount(t,e){var i={startDate:t,endDate:e},n=0;return $.ajax({url:"?/api/daycount",data:JSON.stringify(i),async:!1,type:"POST",success:function(t){n=t.count}}),n}function isJSONStr(t){if("string"==typeof t)try{var e=JSON.parse(t);return!("object"!=typeof e||!e)}catch(t){return!1}return!0}function scrollToBottom(t,e,i,n){if(t&&"function"==typeof t){e||(e=0),i||(i=0),n||(n=200);var r=$(document),o=$(window),a=debounce(function(){t()},n);r.scroll(function(){var t=r.height();t<i||o.scrollTop()+o.height()>=t-e&&o.scrollTop()+o.height()<=t&&a()})}}function isIE(){return!!window.ActiveXObject||"ActiveXObject"in window}!function(win){"use strict";var B2=function(){};B2.prototype.t=function(t,e,i){for(var n in e)t=t.replace(new RegExp("{"+n+"}","g"),e[n]);return i&&(t=t.replace(new RegExp("{.*}","g"),"")),t},B2.prototype.arrayt=function(t,i,n){return t=t.map(function(t,e){return B2.prototype.t(t,i,n)})},B2.prototype.mobilecheck=function(){return!!b2conf.mobile},B2.prototype.isValidSelector=function(t){if("string"!=typeof t)return!1;try{$(t)}catch(t){return!1}return!0},B2.prototype.lang=function(t,e){e=e||!1;var i=lang[t];return e&&i&&(i=this.t(i,e)),i||t||"I18n Err!"},B2.prototype.rteAdjustIframe=function(t){try{var e=document.getElementById(t),i=e.contentWindow.document.body.scrollHeight;e.style.height=i+"px"}catch(t){}},B2.prototype.adjustIframe=function(iframeId,minHeight){var browserVersion=window.navigator.userAgent.toUpperCase(),isOpera=-1<browserVersion.indexOf("OPERA"),isFireFox=-1<browserVersion.indexOf("FIREFOX"),isChrome=-1<browserVersion.indexOf("CHROME"),isSafari=-1<browserVersion.indexOf("SAFARI"),isIE=!!window.ActiveXObject||"ActiveXObject"in window,isIE9More=0==!-[1];try{var iframe=document.getElementById(iframeId),bHeight=0;if(!1===isChrome&&!1===isSafari)try{bHeight=iframe.contentWindow.document.body.scrollHeight}catch(t){}var dHeight=0;if(!0===isFireFox)dHeight=iframe.contentWindow.document.documentElement.offsetHeight+2;else if(!1===isIE&&!1===isOpera&&iframe.contentWindow)try{dHeight=iframe.contentWindow.document.documentElement.scrollHeight}catch(t){}else if(!0===isIE&&isIE9More){var heightDeviation=bHeight-eval("window.IE9MoreRealHeight"+iframeId);0===heightDeviation?bHeight+=3:3!=heightDeviation&&(eval("window.IE9MoreRealHeight"+iframeId+"="+bHeight),bHeight+=3)}else bHeight+=3;var height=Math.max(bHeight,dHeight);height<minHeight&&(height=minHeight),iframe.style.height=height+"px"}catch(t){}},B2.prototype.arrayDefined=function(t,e){if("object"!=typeof t||"object"!=typeof e)return!1;for(var i=t,n=0;n<e.length;n++)try{if(void 0===i[e[n]])return!1;i=i[e[n]]}catch(t){return!1}return!0},B2.prototype.link_type=function(t){switch(t){case"modal":return"modal";case"side":return"#canvas-side";default:return"#canvas"}},B2.prototype.form_val=function(t,e){var i=parse_comma_data(t),n={},r=(e="object"==typeof e?e:$("body")).find(".list-header-wrap");if(r.length)for(var o in i){var a=$.trim(i[o]),c=r.find("#"+a);c.length?"INPUT"==c[0].tagName?n[a]=c.val()||"":"SELECT"==c[0].tagName&&(n[a]=c.find("option:selected").val()||""):n[a]=""}else for(var o in i){a=$.trim(i[o]);var u=e.find("[kid="+a+"]");0<u.find(".data-wrap").length?n[a]=u.find(".data-wrap").data("val"):-1!==$.inArray(u.attr("ftype"),["select","select_mu","select_new"])?n[a]=u.find("select").val()||"":n[a]=u.find("input").val()||""}return n},win.b2=new B2}(window);
Vue.component("table-col",{template:'<div v-html="rowData[field]"></div>',props:{rowData:{type:Object},field:{type:String},index:{type:Number}},methods:{}}),Vue.component("table-ops",{template:'<span><span class="layui-icon ion-edit" style="margin:0 2px;" @click.stop.prevent="edit(rowData, index)"></span><span class="layui-icon ion-trash-a" style="margin:0 2px;" @click.stop.prevent="del(rowData, index)"></span></span>',props:{rowData:{type:Object},index:{type:Number}},methods:{edit:function(){var e=this.$root.props,t=b2.link_type(e.link_type),i=e.seg1,a=this.rowData.uuid,o={},n="";e.divid&&(o.divid=e.divid),n=e.open&&e.editable?i+"/edit/"+a:i+"/view/about/"+a+"/edit/",v(n,t,o)},del:function(){var i=this,a=i.$root,o=a.props,e=(b2.link_type(o.link_type),"?/"+o.seg1+"/del/"+i.rowData.uuid);layer.confirm("纭鍒犻櫎? ",function(t){$.post(e,{},function(e){e.ok?(layer.msg("鍒犻櫎鎴愬姛",{time:1e3}),a.$delete(a.tableData,i.index),layer.close(t),$("[ext]").each(function(){var e=parse_json($(this).attr("ext"));(e.mod==o.mod||o.rel_mod&&e.mod==o.rel_mod)&&$(this).b2data()})):layer.msg("瀵逛笉璧�,鎮ㄦ病鏈夊垹闄よ鏁版嵁鐨勬潈闄�",{closeBtn:0})})})}}});
function menu_init(){if(0==$(".menu-mobile").length&&$(".mobile-menu").show(),!b2.mobilecheck()&&$(".layui-side").length){var u,d="",r=0,m=!1,c=!!$(".layui-side.fashion").length;"tradition"==style_menu&&0<$("#menuh .sys-nav").length&&(u=["account","msg","logout","usr_nav"]),$.each(menu,function(e,t){if(!u||-1==$.inArray(e,u))if("ule"==t.type&&m)m=!1;else if(t.hidden)"ul"==t.type&&(m=!0);else{var i=t.divide?" divide ":"";switch(t.type){case"ul":r++;var n=c?"arrow-right-b transition":t.icon;""!=n&&(n=" ion-"+n),d+='<li id="menu-'+e+'" class="layui-nav-item '+i+'"><a href="javascript:;"><span class="ion'+n+'">'+t.icon_word+"</span> <span>"+t.title+'</span></a><ul class="layui-nav-child">';break;case"ule":r--,d+="</ul></li>";break;default:if(m)break;var a=t.badge?'<span class="layui-badge'+(c?"-dot":"")+' badge" id="badge-'+e+'" style="display:none;"></span>':"",s="",o="";if("logout"==e?(s+='<a href="',s+="/?/logout/",o+='">'):"newwin"==t.type?(s+='<a target="_blank" href="',t.url?s+=t.url:s+="?/"+e,o+='">'):(s+="<a href=\"javascript:v('",s+=e,o+="/');\" >"),t.children){var l=Object.keys(t.children)[0];"index"!=l&&(s+="/"+l)}""!=t.icon&&(t.icon=" ion-"+t.icon),s+=o+'<span class="ion'+t.icon+'">'+t.icon_word+"</span> <span>"+t.title+"</span>"+a+"</a>",d+=r?'<dd id="menu-'+e+'" class="'+i+'">'+s+"</dd>":'<li id="menu-'+e+'" class="layui-nav-item '+i+'" >'+s+"</li>"}}}),$("#menu1m").append(d),$("body").on("mouseenter",".fashion #menu1m, #toolfold-menu1",function(){$("#toolfold-menu1").show()}).on("mouseleave",".fashion #menu1m, #toolfold-menu1",function(){$("#toolfold-menu1").hide()}).on("click","#toolfold-menu1",function(){void 0===$(".fashion").attr("fold-menu1")?($(".fashion").attr("fold-menu1",!0),$("[fold][fold-menu1] #toolfold-menu1").attr("data-b2tips","灞曞紑涓€绾ц彍鍗�"),$("[fold][fold-menu1] #toolfold").attr("data-b2tips","灞曞紑浜岀骇鑿滃崟")):($("#layui-layer"+$("[fold][fold-menu1] #toolfold").attr("data-tipsI")).remove(),$("#layui-layer"+$("[fold][fold-menu1] #toolfold-menu1").attr("data-tipsI")).remove(),$("#toolfold-menu1").removeAttr("data-b2tips").removeAttr("data-tipsI"),$("#toolfold").removeAttr("data-b2tips").removeAttr("data-tipsI"),$(".fashion").removeAttr("fold-menu1"))}),c&&$("#layout").on("mouseenter",".fashion #menu1 li a",function(){var e=0;$(this).parents(".layui-nav-child").map(function(){e+=$(this).parent().position().top+$(this).prev().outerHeight()}),e+=$(this).parent().position().top-$("#menu1")[0].scrollTop+2,$("#tooltip").text($(this).text()).addClass("show").css("top",e+"px")}).on("mouseleave",".fashion #menu1 li a",function(){$("#tooltip").removeClass("show")}).on("click",".fashion #menu1 li.layui-nav-item>a",function(){$(this).next().is(":visible")?$(this).children().eq(0).addClass("open"):$(this).children().eq(0).removeClass("open")}).on("click","#toolfold .collapse",function(){void 0===$(".fashion").attr("fold")?($(".fashion").attr("fold",!0),$("[fold][fold-menu1] #toolfold-menu1").attr("data-b2tips","灞曞紑涓€绾ц彍鍗�"),$("[fold][fold-menu1] #toolfold").attr("data-b2tips","灞曞紑浜岀骇鑿滃崟")):($("#layui-layer"+$("[fold][fold-menu1] #toolfold").attr("data-tipsI")).remove(),$("#layui-layer"+$("[fold][fold-menu1] #toolfold-menu1").attr("data-tipsI")).remove(),$("#toolfold-menu1").removeAttr("data-b2tips").removeAttr("data-tipsI"),$("#toolfold").removeAttr("data-b2tips").removeAttr("data-tipsI"),$(".fashion").removeAttr("fold"))}),$(document).trigger("onMenuInit")}}function render_mobile_menu(){document.title=lang.menu;var l=0,u="",e=$("#canvas"),a="default",d={default:{title:"",data:[],parents:[]}},s=[a],o=[a];if($.each(menu,function(e,t){var i=t.k=e;switch(t.type){case"ul":d[i]={title:t.title,data:[],parents:[]},1<s.length&&$.each(s,function(e,t){if(t===a)return!0;d[i].parents.push(t)}),s.push(i),o.push(i);break;case"ule":s.pop();break;default:var n=s[s.length-1];d[n].data.push(t)}}),$.each(o,function(e,t){var i=d[t],n=i.title,a=i.data,s="";if($.each(i.parents,function(e,t){s+=d[t].title+"-"}),u+='<table class="menu-mobile" no-even style="margin-top:auto;background:#fff;"><colgroup><col width="25%"><col width="25%"><col width="25%"><col width="25%"></colgroup><tbody>',n&&(u+='<tr class="menu-mobile__tab"><td colspan="4" class="menubar">'+(s+n)+"</td></tr>"),$.each(a,function(e,t){if(t.hidden)return!0;if(l%4==0&&(u+="<tr>"),u+='<td class="menu-mobile-item align-center">',"newwin"===t.type){var i=t.url?t.url:"?/"+t.k+"/";u+='<a target="_blank" href="'+i+'">'}else u+="<a href=\"javascript:v('"+t.k+"/')\">";""!==t.icon_word?u+='<span class="ion">'+t.icon_word+"</span>":(""!==t.icon&&(t.icon=" ion-"+t.icon),u+='<span class="ion'+t.icon+'"></span>'),u+='<div class="menu-mobile-title">'+t.title+"</div>",u+="</a>",u+="</td>",4===++l&&(l=0,u+="</tr>")}),0<l){for(var o=0;o<4-l;o++)u+="<td></td>";u+="</tr>"}u+="</tbody></table>",l=0}),!isMobile.wx()&&!isMobile.wxWork()){u="<div class='menu-header'><div class='header-btn__back'></div>鑿滃崟</div>"+u}e.html(u),isMobile.iOS()&&e.find(".menu-mobile:last-child").after("<div id='ios-bottom-padding'></div>"),$(".menu-header .header-btn__back").off("click").on("click",function(){history.go(-1)}),toggle_mobile_menu(["menu"]),push_state("menu/","鑿滃崟")}function render_submenu(e,s){s=s||"",-1!==e.indexOf("#")&&(e=e.split("#")[0]),hist_positon=hist_positon||2,current_url=e||hist[hist_positon-1]||window.location.search.replace("?/","");var t=current_url.indexOf("&");0<t&&(current_url=current_url.slice(0,t)),segs=current_url.split("/"),seg1=segs[0]?segs[0]:"home",seg2=segs[1]?segs[1]:"index",seg3=segs[2]?segs[2]:null,seg4=segs[3]?segs[3]:null,seg5=segs[4]?segs[4]:null,$("#menu1m .layui-nav-item,#menu1m dd").removeClass("layui-this"),$("#menu-"+seg1).addClass("layui-this"),$("#menu1").attr("data-id",$("#menu-"+seg1).attr("id")),"fashion"==style_menu&&$("#menu-"+seg1).parents(".layui-nav-child").length&&$("#menu-"+seg1).parents(".layui-nav-child").map(function(){$(this).prev().children().eq(0).addClass("open")}),0<$("dd#menu-"+seg1).length&&$("dd#menu-"+seg1).parents(".layui-nav-item").addClass("layui-nav-itemed");var i=menu[seg1]?menu[seg1].children:"";if(null==seg3&&menu[seg1])$("#menu2wrap").animate({left:"0px"},600),$("#menu2-0").empty(),$("#menuh-0").empty().show(),$("#menuh-1").hide(),$("#menutags").empty(),void 0!==menu[seg1].title&&$("#menu2-0").append('<li class="title"><a>'+menu[seg1].title+"</a></li>"),toggle_submenu(i,menu[seg1]),$.each(i,function(e,t){var i='<li id="{id}" class="layui-nav-item '+(t.divide?" divide ":"")+'" onclick="return false" ><a href="javascript:;" onclick="javascript:v(\'{url}\', \'{target}\');"><span class="ion-{icon}"></span> <span>{title}</span></a></li>';if(!t.hidden){var n=seg1+"/"+e,a=seg1+"-"+e;$("#menu2-0").append(b2.t(i,{id:"menu-"+a,url:n,target:s,icon:t.icon,title:t.title})),$("#menuh-0").append(b2.t(i,{id:"menuh-"+a,url:n,target:s,icon:t.icon,title:t.title})),$("#menutags").append(b2.t("<li id=\"{id}\"><a href=\"javascript:v('{url}', '{target}');\" >{title}</a></li>",{id:"menut-"+a,url:n,target:s,title:t.title}))}});else{$("#menu2-1").empty();var n=$("#menu2wrap").outerWidth()/2;if($("#menu2wrap").animate({left:"-"+n+"px"},600),$("#menuh-1").empty().show(),$("#menuh-0").hide(),$("#menutags").empty(),menu[seg1]){var a='<li class="back {css}" ><a href="javascript:v(\'{up_url}\', \'{target}\');" >&#8195;<span class="ion-chevron-left" ></span>&#8195;</a></li>',o='<li id="{id}" class="layui-nav-item {css}" ><a href="javascript:v(\'{url}\', \'{target}\');" > {title}</a></li>';if(void 0!==i&&void 0!==i[seg2]&&void 0!==i[seg2].children){var l=i[seg2].children,u=void 0===i[seg2].backto?seg1+"/"+("view"!=seg2?seg2:"index"):i[seg2].backto,d=b2.arrayDefined(menu,[seg1,"sub_priv"])&&menu[seg1].sub_priv,r=d?"hide":"",m=s;"view"==seg2&&"#canvas-side"==s&&(m=""),toggle_submenu(l,menu[seg1]),$("#menu2-1").append(b2.t(a,{up_url:u,target:m,css:"title"})),$("#menuh-1").append(b2.t(a,{up_url:u,target:m,css:"layui-nav-item"})),$.each(l,function(e,t){if(!t.hidden){var i=seg1+"/"+seg2+"/"+e+"/"+seg4,n=seg1+"-"+seg2+"-"+e;$("#menu2-1").append(b2.t(o,{id:"menu-"+n,url:i,target:s,title:t.title,css:r})),$("#menuh-1").append(b2.t(o,{id:"menuh-"+n,url:i,target:s,title:t.title,css:r})),$("#menutags").append(b2.t('<li id="{id}" class="{css}"><a href="javascript:v(\'{url}\', \'{target}\');" >{title}</a></li>',{id:"menut-"+n,url:i,target:s,title:t.title,css:r}))}}),d&&toggle_sub_priv(segs)}else{var c=c||"index";u=seg1+"/"+c;"index"==c&&"#canvas-side"==s&&(s=""),"flowindex"==menu[seg1].type&&(u=window.lppHistory.history.slice(-2)[0],"browse"==segs.slice(-3)[0]&&(u=seg1+"/"+c),u==current_url&&(u=seg1+"/"+c)),$("#menu2-1").append(b2.t(a,{up_url:u,target:s,css:"title"})),$("#menuh-1").append(b2.t(a,{up_url:u,target:s,css:"layui-nav-item"}))}}else{var h="",g=function(e,i){i===seg1&&(h=i),_.each(e,function(e,t){if(t===seg1)return h=i,!1;e.children&&g(e.children,t)})};if(g(menu,null),h){var f='<li class="back {css}" ><a href="javascript:v(\'{up_url}\');" >&#8195;<span class="ion-chevron-left" ></span>&#8195;</a></li>';$("#menu2-1").append(b2.t(f,{up_url:h+"/"+seg1,css:"title"})),$("#menuh-1").append(b2.t(f,{up_url:h+"/"+seg1,css:"layui-nav-item"}))}}}if(toggle_menu_tags(),toggle_mobile_menu(segs),$("#menu-"+seg1+"-"+seg2+",#menu-"+seg1+"-"+seg2+"-"+seg3+",#menuh-"+seg1+"-"+seg2+",#menuh-"+seg1+"-"+seg2+"-"+seg3).addClass("layui-this"),$("#menu1").attr("data-id","menu-"+seg1),$("#menu2").attr("data-id","menu-"+seg1+"-"+seg2),$("#menuh-0").attr("data-id","menuh-"+seg1+"-"+seg2),$("#menuh-1").attr("data-id","menuh-"+seg1+"-"+seg2+"-"+seg3),$(".logo").length){var p=$(".logo").outerHeight(!0);p<44&&(p=44,$(".logo").height(p),p=$(".logo").outerHeight(!0));var v=(p-30)/2;$("#menu2 .title").css("padding",v+"px 0")}}function toggle_menu_tags(){var e=function(){$("#menutags li").removeClass("this"),$("#menut-"+seg1+"-"+seg2+",#menut-"+seg1+"-"+seg2+"-"+seg3).addClass("this")},t=function(){$("#menu_tags_box").hide(),$("#menuh-0,#menuh-1").removeClass("showtags"),$("#menu_tags_tip").data("show",0).find("span").removeClass("ion-android-arrow-dropup").addClass("ion-android-arrow-dropdown")};t(),setTimeout(function(){!$("#menuh").length||$("#menuh").is(":hidden")||$("#menuh .layui-tab")[0].scrollWidth<=$(window).width()?$("#menu_tags_tip").hide():($("#menu_tags_tip").show(),e(),$("#menu_tags_tip").off("click").on("click",function(){$(this).data("show")?t():($("#menu_tags_box").show(),$("#menuh-0,#menuh-1").addClass("showtags"),$("#menu_tags_tip").data("show",1).find("span").removeClass("ion-android-arrow-dropdown").addClass("ion-android-arrow-dropup")),e()}),$("#menutags li").off("click").on("click",function(){t(),e()}))})}function toggle_submenu(i,e){if(void 0!==e.nosub_count){var n=0;if("object"==typeof i){var t=Object.keys(i);$.each(t,function(e,t){!0!==i[t].hidden&&n++})}n<=e.nosub_count?$(".layui-side").addClass("nosubmenu"):$(".layui-side").removeClass("nosubmenu")}else $(".layui-side").removeClass("nosubmenu")}function toggle_mobile_menu(e){if(b2.mobilecheck()){var t=$("#menuh"),i=$("#canvas");e="object"==typeof e?e:[];t.show(),"menu"!=e[0]&&$("#menuh .layui-nav-item:visible").length?(t.show(),i.css("margin-top","50px")):(t.hide(),i.css("margin-top","0"));var n=$(".mobile-menu .layui-this"),a=e[0]||"home",s="layui-this",o="menu_mobile_";n.attr("id")!=o+a&&(n.removeClass(s),$("#"+o+a).addClass(s))}}function toggle_sub_priv(e){if((e="object"==typeof e?e:[])[3]){var t="?/"+e[0]+"/sub_priv/"+e[3],i=e[0]+"-"+e[1]+"-";$.post(t,function(e){$.each(e,function(e,t){$("#menu-"+i+t+",#menuh-"+i+t+",#menut-"+i+t).removeClass("hide")})})}}function render_layer_menu(e){var t="object"==typeof menu[seg_1]&&null!=menu[seg_1].mod?menu[seg_1].mod:seg_1,i="object"==typeof space_conf&&space_conf.layer_menu&&-1!==space_conf.layer_menu.indexOf(t)&&"edit"!=seg_5;if($(e).children(".layer_mobile_menu").remove(),i){var n=Math.round(1e3*Math.random()),a="layer_canvas"+n,s="#"+a,o=[];if(seg_3&&menu[seg_1]){var l=menu[seg_1].children;void 0!==l&&void 0!==l[seg_2]&&void 0!==l[seg_2].children&&(o=l[seg_2].children)}if(!(Object.keys(o).length<=1)){var u,d="layer_menu"+n,r="",m="";tagsbox='<div class="menu_tags_box"><div class="tags_select">閫夋嫨瑕佸垏鎹㈢殑椤甸潰</div><div class="tagsbox"><ul class="menutags">{menutags}</ul></div></div><div class="menu_tags_tip" data-show="0"><div class="vline"></div><span class="ion ion-android-arrow-dropdown"></span></div>',$.each(o,function(e,t){if(!t.hidden){var i=seg_1+"/"+seg_2+"/"+e+"/"+seg_4,n=seg_1+"-"+seg_2+"-"+e;r+=b2.t('<li id="{id}" class="layui-nav-item" ><a href="javascript:v(\'{url}\',\'{target}\');" >{title}</a></li>',{id:"menul-"+n,url:i,target:s,title:t.title}),m+=b2.t("<li id=\"{id}\"><a href=\"javascript:v('{url}', '{target}');\" >{title}</a></li>",{id:"menult-"+n,url:i,target:s,title:t.title})}}),tagsbox=b2.t(tagsbox,{menutags:m}),u='<ul id="menu3-0" class="menu3-mobile layui-nav">'+r+"</ul>"+tagsbox;var c=$('<div id="'+d+'" class="layer_mobile_menu">'+u+"</div>");$(e).children(".layui-layer-content").attr("id",a).before(c),b2.mobilecheck()||($(e).find(".layer_mobile_menu>.menu3-mobile").css({"border-bottom":"1px solid #eaeaea","padding-left":"30px","text-align":"left"}),$(e).find(".layer_mobile_menu>.menu3-mobile>li>a").css({height:"50px","line-height":"50px","border-bottom":"none"}),$(e).find("#menul-"+seg_1+"-"+seg_2+",#menul-"+seg_1+"-"+seg_2+"-"+seg_3).addClass("layui-this")),toggle_layer_menu_tags(c)}}}function toggle_layer_menu_tags(t){var e=t.find(".menu_tags_box"),i=t.find(".menu_tags_tip"),n=t.find(".menu3-mobile");if(n.is(":hidden")||n[0].scrollWidth<=$(window).width())i.hide();else{var a=function(){n.find("li").removeClass("layui-this").removeClass("this"),$("#menul-"+seg_1+"-"+seg_2+",#menul-"+seg_1+"-"+seg_2+"-"+seg_3).addClass("layui-this"),$("#menult-"+seg_1+"-"+seg_2+",#menult-"+seg_1+"-"+seg_2+"-"+seg_3).addClass("this")},s=function(){e.hide(),n.removeClass("showtags"),i.data("show",0).find("span").removeClass("ion-android-arrow-dropup").addClass("ion-android-arrow-dropdown")};i.show(),a(),i.off("click").on("click",function(){$(this).data("show")?s():(e.show(),n.addClass("showtags"),i.data("show",1).find("span").removeClass("ion-android-arrow-dropdown").addClass("ion-android-arrow-dropup")),a()}),e.find(".menutags li").off("click").on("click",function(){s(),t.find("li").removeClass("layui-this").removeClass("this"),$(this).addClass("this");var e=$(this).attr("id").replace("menult","menul");$("#"+e).addClass("layui-this")})}}function record_menu_id(){$("#menu1,#menu2,#menuh-0,#menuh-1").each(function(){var e=$(this).length?$(this).find(".layui-this"):[];0<e.length&&$(this).attr("data-id",e.attr("id"))})}function reset_menu(){$("#menu1,#menu2,#menuh-0,#menuh-1").each(function(){var e=$(this).attr("data-id"),t=e?$(this).find("#"+e):[];$(this).find(".layui-this").removeClass("layui-this"),e&&t.length&&t.addClass("layui-this")})}function scrollMenuh(){}FixedMenu={init:function(){if(!b2.mobilecheck()){var n,a,e=this,s=$("#fixedmenu"),o=function(e,t){var i=$(window).width()-s.width(),n=$(window).height()-s.height();e=i<(e=e<0?0:e)?i:e,t=n<(t=0<t?t:0)?n:t;s.css({right:e+"px",bottom:t+"px"})};s.length&&($("body").append(s),s.prop("draggable",!0),s[0].addEventListener("dragstart",function(e){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text",""),n=e.offsetX||e.layerX,a=e.offsetY||e.layerY}),document.addEventListener("dragover",function(e){e.preventDefault()||e.stopPropagation();var t=$(window).width()-e.x-s.width()+n,i=$(window).height()-e.y-s.height()+a+($("#fixedmenu").height()-150+100);o(t,i)}),$("#fixedmenu div").on("click",function(){switch($(this).attr("action")){case"top":e.go_top()}}),e.render(),e.scrollListen())}},scrollListen:function(){},render:function(e){"hide"==e?$("#fixedmenu").hide():$("#fixedmenu").show();var t=$(".layui-layer-modal"),i=function(e){100<(e=e||$(window)).scrollTop()?$("#gotop").show():$("#gotop").hide()};if(t.length){var n=t.last();i(n),n.off("scroll").on("scroll",function(){i(n)})}else i(),$(window).off("scroll").on("scroll",function(e){i()})},go_top:function(){var e=$(".layui-layer-modal");e.length?e.last().animate({scrollTop:0},"fast"):$("body,html").animate({scrollTop:0},"fast")}},$(function(){$("#usr_nav_search_box").on("keydown",function(e){if(13==e.keyCode){e.preventDefault();var t={key:$("#usr_nav_search_box").val()};v("search/index","",t)}})}),$(function(){$(document).on("onMenuInit",function(){$(document).on("mouseover","#menu1m li.divide, menu1m li.divide dd",function(){var e=$(this).closest(".divide").css("border-top-width");$(this).closest(".layui-nav-tree").find(".layui-nav-bar").css("margin-top",e)}),$(document).on("mouseout","#menu1m li.divide, menu1m li.divide dd",function(){$(this).closest(".layui-nav-tree").find(".layui-nav-bar").css("margin-top","0")})})});
$(function(){var s={language:"zh-CN",placeholder:lang.please_select,allowClear:!0,minimumResultsForSearch:11,closeOnSelect:!1,scrollAfterSelect:!1},f="span.select2",u="select2-selection__choice",h="select2-choice_count",v="select2-search--inline",o=function(e,i){var d=this;this.el=$(e),this.props=this.el.data("props")||{},this.val=this.el.data("val"),0<this.el.closest(".filter-wrap").length&&(this.props.tags=!1);this.el.attr("readonly");var t=this.el.attr("placeholder");this.el.attr("multiple")||(i.closeOnSelect=!0),i.width=this.el.data("width")||this.props.width||this.el.parent().width()||"100%",this.props.ajax&&"鏄�"==this.props.ajax&&(i.ajax={delay:500,url:"/?/api/get_options/&t="+(Math.random()+"").substr(2,8),dataType:"json",data:function(e){var t={conf:d.props,val:d.val,q:e.term,page:e.page};if(b2.arrayDefined(d,["props","payload"])){var i=d.el.closest(".layui-form");t.payload=b2.form_val(d.props.payload,i)}return t},processResults:function(o,e){e.term;var a=[],t=$.map(o.results,function(e,t){if("object"!=typeof e)return{id:t,text:e};for(var i=$.map(e,function(e,t){return{id:t,text:e}}),n=$(".select2-results__group:last"),s=n.html();""==s&&0!=(n=n.parent().prev(".select2-results__option").find(".select2-results__group")).length;)s=n.html();return s==t&&null!=o.page?{children:i}:(a.push(t),{text:t,children:i})});return o.results=t,o},transport:function(e,t,i){e.type="POST";var n=$.ajax(e);return n.then(t),n.fail(i),n}}),"鏄�"==this.props.tags&&("鏄�"==this.props.ajax&&"yaml"!=this.props.type?i.tags=!1:i.tags=!0,i.tokenSeparators=[","],i.placeholder="璇烽€夋嫨鎴栬緭鍏�, 鎸夐€楀彿纭",i.minimumResultsForSearch=0),t&&(i.placeholder=t),this.el.on("select2:select",function(e){this.dispatchEvent(new Event("change",{target:e.target}))}).on("change.select2",function(e){var s=$(this),o=s.next().find(".select2-selection__rendered");o.length&&setTimeout(function(){var e=s.val();if(e){var t=[];for(var i in e){var n=e[i];if(n)if(-1===$.inArray(n,t))t.push(n);else o.find(".select2-selection__choice[data-label-id="+n+"] .select2-selection__choice__remove").click()}}})}).on("change.select2",function(e){var i=$(this),n=i.siblings(f).find("ul"),s=i.data("ellipsis")||d.props.ellipsis||"off",t=i.find(":selected"),o=t.length||0,a="b2select_ph",l='<input class="'+a+'" type="hidden" name="'+i.attr("name")+'">',r=i.data("id"),c=r?l.replace("["+r,"["+r+"_label"):"";i.siblings("."+a).remove(),o?(n.find("."+v).hide(),t.each(function(e,t){i.before($(c).val($(t).text()))})):(i.before(l),c&&i.before(c)),"off"!=s&&setTimeout(function(){if("always"==s||-1==$.inArray(s,["auto","always","off"])&&s<=o||"auto"==s&&n.height()>n.find("."+v).height()){var e=n.find("."+h);if(n.find("."+u).remove(),o){var t="宸查€夋嫨 "+o+" 椤�";e.length?e.text(t):n.prepend('<li class="'+h+'">'+t+"</li>")}else e.remove()}},0)}).on("select2:open",function(e){var t=$(this).siblings(f).find("."+v);t.find("input").prop("placeholder",i.placeholder),t.show().find("input").focus(),setTimeout(function(){var e=$(".select2-dropdown").closest(".select2-container");if(e&&e.position()){var t=$(document.body).width()-e.position().left;e.css("cssText",e.attr("style")+"width:"+t+"px !important;")}},100)}).on("select2:open",function(e){var t=$(this).siblings(f);if($(this).is(".select-mu.select-multi,.select-mu-simple")){var i=t.find(".select2-search__field");(currentDropdown=$("#"+t.find("[aria-owns]").attr("aria-owns"))).parents(".select2-container").addClass("select-mu-offseted"),i.off("click").on("click",function(){$("body").click()}),i.parents("li.select2-search").hide();setTimeout(function(){if(0<=currentDropdown.find("li").length){$(".select2-dropdown").find(".select-mu-selector").each(function(){$(this).remove()}),currentDropdown.before('<div class="select-mu-selector"></div>'),$(".select-mu-selector").append('<input class="select2-search__field" type="search" tabindex="0" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" aria-autocomplete="list" placeholder="" style="display: inline-block;">');var e=$(".select-mu-selector").find(".select2-search__field");e.focus(),e.off("input propertychange").on("input propertychange",function(e){var t=$(this).val();i.trigger("input"),i.val(t),i.trigger("input")}).off("blur").on("blur",function(){setTimeout(function(){0==t.find("li.select2-selection__choice").length&&i.parents("li.select2-search").show()},100)})}})}}).on("select2:selecting",function(e){var c=$(this),p=$(this).siblings(f);setTimeout(function(){p.find("."+u+", ."+h).show(),p.find("."+h).length||p.find("."+u).length?p.find("."+v).hide():p.find("."+v).show();var e=c.select2("data");if(0!=e.length){var t=e.length-1;if("鏄�"==d.props.tags&&e.length&&"raw"!=d.props.type){if(""==$.trim(e[t].text))return;if("mod"==d.props.type){var s=id_v_s=e[t].id,o=e[t].text.replace(/\-\[.+?\]$/,"");if("_new"==s||s==o){var a=c.closest("[ftype=select_new]").find("select");return void("鏄�"!=d.props.ajax?(c.select2("close"),layer.open({content:"瀵硅薄涓嶅瓨鍦紝鏄惁鏂板缓锛�",btn:["鏄�","鍚�"],yes:function(e,t){var n={id:s,text:o};$.post("/?/api/save_options/",{data:n,conf:d.props},function(e){if(layer.msg(e.msg),a.find("[data-select2-tag]").remove(),1==e.ok){a.find("option[value='"+id_v_s+"']").remove();var t=e.uuid,i=n.text;a.append('<option value="'+t+'" selected="selected">'+i+"</option>")}})},btn2:function(e,t){a.find("option[value='"+id_v_s+"']").remove()},cancel:function(){a.find("option[value='"+id_v_s+"']").remove()}})):(c.select2("close"),layer.open({content:"瀵硅薄涓嶅瓨鍦紝鏄惁鏂板缓锛�",btn:["鏄�","鍚�"],yes:function(e,t){var n={id:s,text:o};$.post("/?/api/save_options/",{data:n,conf:d.props},function(e){if(layer.msg(e.msg),1==e.ok){var t=e.uuid,i=n.text;a.find("option[value='"+id_v_s+"']").remove(),a.append('<option value="'+t+'" selected="selected">'+i+"</option>"),a.trigger("change")}})},btn2:function(e,t){a.find("option[value='"+id_v_s+"']").remove()},cancel:function(){a.find("option[value='"+id_v_s+"']").remove()}})))}}else{if("mod_group"==d.props.type){if(s=(s=id_v_s=e[t].id).replace(/_new$/,""),""==(o=e[t].text))return;o=o.replace(/\-\[.+?\]$/,"");var i=(a=c.closest("[ftype=select_new]").find("select")).data("mods"),n=!1;for(var l in i)if(l==s){n=!0;break}return n?(c.select2("close"),void layer.open({content:"瀵硅薄涓嶅瓨鍦紝鏄惁鏂板缓锛�",btn:["鏄�","鍚�"],yes:function(e,t){var i={id:s,text:o};$.post("/?/api/save_options/",{data:i,conf:d.props},function(e){if(layer.msg(e.msg),1==e.ok){a.find("option[value='"+id_v_s+"']").remove();var t=e.uuid;a.append('<option value="'+t+'" selected="selected">'+o+"</option>"),a.parent().find(".b2select_ph").val(o),a.trigger("change")}})},btn2:function(e,t){a.find("option[value='"+id_v_s+"']").remove()},cancel:function(){a.find("option[value='"+id_v_s+"']").remove()}})):void 0}var r=$.map(e,function(e,t){return{id:e.id,text:e.text}});$.post("/?/api/save_options/",{data:r,conf:d.props})}}}},200)}),this.el.select2(i).promise().done(function(){var e=this.data("val");""!==e&&null!=e||(e=this.val());var s,o=this.data("val_label"),a=this;if(a.attr("multiple")||a.find('option[value=""]').length||(s=new Option("","",!0,!0),a.prepend(s).trigger("change.select2")),""!==e){if("object"==typeof e)$.each(e,function(e,t){if(t){var i='option[value="'+t+'"]';if(b2.isValidSelector(i)&&!a.find(i).length){var n="object"==typeof o&&o[e]?o[e]:t;s=new Option(n,t,!0,!0),a.append(s).trigger("change.select2")}}});else{var t=o||e,i='option[value="'+e+'"]';b2.isValidSelector(i)&&!a.find(i).length&&(s=new Option(t,e,!0,!0),a.append(s).trigger("change.select2"))}this.val(e)}a.trigger("change.select2")})};$("body").off("input propertychange").on("input propertychange",".select2-search__field:visible",function(){var i=$(this).val();if(""!=i){var l=$(".select2-container--open").closest("[ftype=select_new]").find("select"),n=l.data("props");if(null!=n&&"鏄�"==n.tags&&"mod_group"==n.type&&"鏄�"!=n.ajax&&"鏄�"!=n.multiple&&""==n.label){var r=l.data("data"),e={};for(var t in r){var s=r[t].text;if(""!=s){var o=r[t].children;if(null!=o)for(var a in o)if(o[a].text==i){e[s]=1;break}}}var c=l.data("mods");if(null!=c){for(var p in $(this).closest(".select2-container--open").find(".select2-results>ul").children("li[role=treeitem]").remove(),c){var d=c[p];if(1!=e[s]){var f=$(this).closest(".select2-container--open").find(".select2-results>ul");0==f.find("li[data-mod][role=treeitem]").length?f.prepend('<li class="select2-results__option2" data-mod="'+d+'" data-modname="'+p+'" role="treeitem" aria-selected="false">'+i+"-[鏂板缓 "+p+"]</li>"):f.find("li[data-mod][role=treeitem]:last").after('<li class="select2-results__option2" data-mod="'+d+'" data-modname="'+p+'" role="treeitem" aria-selected="false">'+i+"-[鏂板缓 "+p+"]</li>")}}$(this);return $(".select2-results__option2").on("mouseover",function(){$(".select2-results__option").removeClass("select2-results__option--highlighted"),$(this).addClass("select2-results__option--highlighted"),$(this).css("cursor","pointer")}).on("mouseout",function(){$(this).removeClass("select2-results__option--highlighted"),$(this).css("cursor","default")}).on("click",function(){$(this).data("mod");var o=$(this).data("modname"),a={tags:!0,tokenSeparators:[","," "],placeholder:"璇烽€夋嫨鎴栬緭鍏�, 鎸夌┖鏍兼垨閫楀彿纭",minimumResultsForSearch:0};l.select2("destroy").empty();var e=0;for(var t in r)null!=r[t].children&&r[t].text==o&&(r[t].children.push({id:i,text:i}),e=1);for(var t in 0==e&&r.push({text:o,children:[{id:i,text:i}]}),a.data=r,l.select2(a),l.val(i).trigger("change"),r)null!=r[t].children&&r[t].text==o&&r[t].children.pop();layer.open({content:"瀵硅薄涓嶅瓨鍦紝鏄惁鏂板缓锛�",btn:["鏄�","鍚�"],yes:function(e,t){var s={id:o,text:i};$.post("/?/api/save_options/",{data:s,conf:n},function(e){if(console.log(e),layer.msg(e.msg),1==e.ok){var t=e.uuid,i=s.text,n=l.find("optgroup");n.each(function(e){if(n.eq(e).attr("label")==o){for(var e in l.select2("destroy").empty(),r)null!=r[e].children&&r[e].text==o&&r[e].children.push({id:t,text:i});a.data=r,l.select2(a),l.val(t).trigger("change"),l.parent().find(".b2select_ph").val(i)}})}})},btn2:function(e,t){l.select2("destroy").empty(),a.data=r,l.select2(a),l.val("").trigger("change")},cancel:function(){l.select2("destroy").empty(),a.data=r,l.select2(a),l.val("").trigger("change")}})}),!1}}}}),$.fn.b2select=function(e){var n="b2select";return this.each(function(){var e=$(this),t=e.data(n),i="object"==typeof option&&option;t||e.data(n,t=new o(this,$.extend({},s,i)))}),this}});
$(function($){var layer=layui.layer,no_data='<div class="databox-nodata">'+lang.no_data+"</div>",loading_msg='<i class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop">&#xe63d;</i> 杞藉叆涓�...';function update(a,t,e){void 0===e&&(e=t),$(a).find(".label").val(e).trigger("change"),$(a).find(".val").val(t).trigger("change")}function make_item(a){if("object"==typeof a&&a.id&&a.text){var t='<div class="databox-item" data-id="{id}" data-text="{text}"';return a.pid&&(t+=' data-pid="{pid}"'),t+=">{text}</div>",b2.t(t,a)}}function make_list(a,e,o,t){var d="";return o=o||"",t=t||"","object"==typeof a&&Object.keys(a).length&&$.each(a,function(a,t){if(a&&t&&"string"==typeof a){if("object"==typeof t){if(child_str=make_list(t,e,a),!child_str)return;return d+=b2.t('<div class="databox-item databox-parent" data-id="{id}"><span class="ion ion-arrow-down-b"></span> {id}</div>',{id:a}),void(d+=child_str)}e&&(s=e.toLowerCase(),-1===(t+"").toLowerCase().indexOf(s)&&-1===(o+"").toLowerCase().indexOf(s))||(d+=make_item({id:a,text:t,pid:o}))}}),d}function single_select(a,t,e){if("鏄�"!=t.conf.multiple){var o=$(e).find(".val").val(),d=a.find(".databox-options");if(d.find(".selected").removeClass("selected"),o){var i=d.find("[data-id="+o+"]");i.length&&(i.addClass("selected"),d.animate({scrollTop:i.offset().top-d.offset().top},300))}}}function fetch(a,t,e){"object"==typeof t&&"object"==typeof t.conf&&("鏄�"!=t.conf.ajax?fetch_direct(a,t,e):fetch_ajax(a,t,e))}function setMobileScrollable(a){isMobile.any()&&(a?($("body").css({position:"initial",height:"auto"}),document.documentElement.scrollTop=window.scrollTop):(window.scrollTop=document.documentElement.scrollTop||document.body.scrollTop,$("body").css({position:"fixed",width:"100%"})))}function fetch_direct(a,t,e){var o=$(e).data("data"),d=a.find(".databox-options"),i="",n=t.q;if("鏄�"==t.conf.tags&&"鏄�"!=t.conf.multiple&&""==t.conf.label&&null!=n&&""!=n){if("mod"==t.conf.type){var l=!0;for(var s in o)if(o[s]==n){l=!1;break}var c={};l&&(c[n]=n),o=$.extend(c,o)}if("mod_group"==t.conf.type){var r=$(e).data("mods"),b={};for(var p in o)if(""!=p){c=o[p];for(var f in c)c[f]==n&&(b[p]=1)}c={};for(var p in r)1!=b[p]&&(c[p+"_new"]=n+"-[鏂板缓 "+p+"]");o=$.extend(c,o)}}d.html(""),(i+=make_list(o,t.q))?(d.html(i),"鏄�"===t.conf.multiple?(makeMultipleCheckbox(a),a.find(".databox-selected .databox-item").each(function(a,t){var e=$(t).data("id");d.find("[data-id="+e+"] .databox-multiple-check").addClass("checked"),checkGroupState()})):single_select(a,t,e),window.dispatchEvent(new Event("resize"))):$(no_data).text("鏃犲尮閰嶇粨鏋�").appendTo(d)}function fetch_ajax(o,d,i){var a="/?/api/get_options/&t="+(Math.random()+"").substr(2,8),n=o.find(".databox-options"),l="";if(0<n.find(".databox-parent:last").length&&(l=n.find(".databox-parent:last").data("id")),b2.arrayDefined(d,["conf","payload"])){var t=$(i).closest(".layui-form");d.payload=b2.form_val(d.conf.payload,t)}$.post(a,d,function(a){var t=make_list(a.results,d.q,"",l),e=a.page||1;a.pagination.more?t+='<div class="loadmore" data-page="'+e+'">鍔犺浇鏇村</div>':1<e&&(t+='<div class="loaded"><span class="ion ion-checkmark-round done"></span>宸插姞杞藉畬姣�</div>'),t?1==e?n.html(t):o.find(".loadmore").replaceWith(t):n.html(no_data),"鏄�"===d.conf.multiple?(makeMultipleCheckbox(o),o.find(".databox-selected .databox-item").each(function(a,t){var e=$(t).data("id");n.find("[data-id="+e+"] .databox-multiple-check").addClass("checked"),checkGroupState()})):single_select(o,d,i),window.dispatchEvent(new Event("resize"))},"json")}function search_selected(a,t){var e=a.find(".databox-selected"),o=e.find(".databox-nodata"),d=e.find(".databox-item");o.hide(),t?(s=t.toLowerCase(),$.each(d,function(a,t){var e=$(t);-1===(e.data("text")+"").toLowerCase().indexOf(s)?e.hide():e.show()}),e.find(".databox-item:visible").length||o.show()):d.show()}function makeMultipleCheckbox(a){a.find(".databox-options .databox-item").each(function(){0===$(this).find(".databox-multiple-check").length&&$(this).append('<div class="databox-multiple-check"></div>')})}function showDataBox(e){var a=$(e),o=a.data("props")||{};if(dlang=o.lang||{},dlang.options_title=dlang.options_title||lang.please_select,dlang.selected_title=dlang.selected_title||lang.selected,dlang.btn_confirm=dlang.btn_confirm||lang.choice,dlang.btn_other=dlang.btn_other||"",dlang.btn_clear=dlang.btn_clear||lang.options,dlang.databox_fn=dlang.databox_fn||[],!a.attr("readonly")){var t='<div class="databox-single"><table class="databox-wrap"><tbody><tr><td><div><input type="search" class="layui-input databox-search" data-type="options" placeholder="'+lang.type_keyword_to_search+'" /></div><div class="databox-list databox-options"><div class="databox-loading">'+loading_msg+'</div></div></td></tr></tbody></table><div class="databox-footer" ><button class="databox-clear layui-btn layui-btn-primary">'+dlang.btn_clear+"</button></div>";if("鏄�"==o.multiple){var d="";if(""!=dlang.btn_other&&"object"==typeof dlang.btn_other)for(var i in dlang.btn_other)d+='<button class="databox-'+i+' layui-btn">'+dlang.btn_other[i]+"</button>";t='<div class="databox-muti"><table class="databox-wrap"><tbody><tr class="databox-title"><td class="databox-list-title" width="150">'+dlang.options_title+'</td><td width="15"></td><td class="databox-selected-title" width="150">'+dlang.selected_title+'</td></tr><tr><td><div><input type="search" class="layui-input databox-search" data-type="options" placeholder="'+lang.type_keyword_to_search+'" /></div><div class="databox-list databox-options"><div class="databox-loading"><i class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop">&#xe63d;</i> 杞藉叆涓�...</div></div></td><td class="databox-bar"><span class="ion ion-arrow-right-a"></span></td><td><div><input type="search" class="layui-input databox-search" data-type="selected" placeholder="'+lang.type_keyword_to_search+'" /></div><div class="databox-list databox-selected">'+no_data+'</div></td></tr></tbody></table><div class="databox-footer" ><button class="databox-submit layui-btn">'+dlang.btn_confirm+"</button>"+d+'<button class="databox-clear layui-btn layui-btn-primary">'+dlang.btn_clear+"</button></div>"}var n=b2.mobilecheck()?["100%","100%"]:"520px";switch(o.mod){case"tree":l=layer.open({type:1,title:dlang.please_select,skin:"layui-layer-rim databox-layer",area:n,shadeClose:!0,content:'<div class="#databox-tree" ></div>'}),layui.tree({elem:"#databox-tree",nodes:o.data,click:function(a){update(e,a.name),layer.close(l)}});break;default:var l=layer.open({type:1,title:lang.msg,skin:"layui-layer-rim databox-layer",area:n,shadeClose:!0,content:t,success:function(a,t){init_dbox(t,a,e,dlang),fetch(a,{conf:o},e),$(a).find(".layui-layer-ico.layui-layer-close1.layui-layer-close").removeClass("layui-layer-ico").addClass("ion ion-close-round").css({"font-size":"18px",color:"#6f6f6f",top:"6px",left:"6px"}),setMobileScrollable(!1)},yes:function(a,t){setMobileScrollable(!0)},cancel:function(a,t){setMobileScrollable(!0)}})}}}function checkGroupState(){$(".databox-parent").each(function(){var a=$(this).data("id");$('.databox-options [data-pid="'+a+'"]').length===$('.databox-options [data-pid="'+a+'"] .checked').length?$('.databox-parent[data-id="'+a+'"]').find(".databox-multiple-check").addClass("checked"):$('.databox-parent[data-id="'+a+'"]').find(".databox-multiple-check").removeClass("checked")})}function init_dbox(li,lo,_obj,dlang){var $_obj=$(_obj),ext=$_obj.data("props")||{},item_sel=".databox-item",item_parent=".databox-parent",$options=lo.find(".databox-options"),val=$_obj.find(".val").val(),val_label=$_obj.find(".label").val();if("鏄�"==ext.multiple){var $selected=lo.find(".databox-selected"),$nodata=$selected.find(".databox-nodata"),close_dom='<span class="remove ion ion-ios-close"></span>',drag_dom="鏄�"!=ext.multiple||"鏄�"!=ext.dragable||b2.mobilecheck()?"":'<span class="dragbar ion ion-arrow-move"</span>',texts=parse_comma_data(val_label),ids=parse_comma_data(val);if(0<ids.length){$nodata.hide();for(var i=0;i<ids.length;i++)item_selected={id:ids[i],text:texts[i]},$selected.append($(make_item(item_selected)).prepend(drag_dom).append(close_dom))}$options.on("click",item_sel,function(){var a=$(this),t=a.data();if(t.text&&!(0===a.find(".checked").length&&0<$selected.find("[data-id="+t.id+"]").length)){if(a.find(".databox-multiple-check").hasClass("checked"))return $(".databox-selected").find("[data-id="+t.id+"]").remove(),$options.find("[data-id="+t.id+"] .databox-multiple-check").removeClass("checked"),void checkGroupState();$nodata.hide(),$selected.append($(make_item(t)).prepend(drag_dom).append(close_dom)),$options.find("[data-id="+t.id+"] .databox-multiple-check").addClass("checked"),checkGroupState()}}),$selected.on("click",item_sel,function(){var a=$(this),t=a.data("id");a.remove(),$selected.find(item_sel).length||$nodata.show(),$(".databox-options").find("[data-id="+t+"] .databox-multiple-check").removeClass("checked"),checkGroupState()}),lo.on("click",".databox-parent .databox-multiple-check",function(){$(this).toggleClass("checked");var a=$(this).hasClass("checked"),t=$(this).parent().data("id");$(".databox-options [data-pid="+t+"]").each(function(){!!$(this).find(".checked").length!==a&&$(this).click()})}),lo.find(".databox-submit").on("click",function(){var o=[],d=[];$selected.find(item_sel).each(function(a,t){var e=$(t).data();o.push(e.id),d.push(e.text)}),update(_obj,o.join(","),d.join("锛�")),layer.close(li),setMobileScrollable(!0);var a=dlang.databox_fn;-1!=$.inArray("submit",a)&&databox_fn(_obj,"submit")})}else $options.on("click",item_sel,function(){var data=$(this).data();if(data.text){if(update(_obj,data.id,data.text),layer.close(li),setMobileScrollable(!0),"mod"==ext.type){if(null!=ext.type_func){var func=ext.type_func;eval(func)(data.id)}data.id==data.text&&layer.open({content:"瀵硅薄涓嶅瓨鍦紝鏄惁鏂板缓锛�",btn:["鏄�","鍚�"],yes:function(a,t){var e={id:data.id,text:data.text};$.post("/?/api/save_options/",{data:e,conf:ext},function(a){if(layer.msg(a.msg),1==a.ok){var t=a.uuid,e=data.text,o=$(_obj).data("data"),d={};d[t]=e,$.extend(o,d),$_obj.data("data",o),update(_obj,t,e)}})},btn2:function(a,t){update(_obj,"","")},cancel:function(){update(_obj,"","")}})}if("mod_group"==ext.type){var mods=$_obj.data("mods");if("鏄�"!=ext.ajax)for(var modname in mods){var mod=mods[modname];if(data.id==modname+"_new"){var text=data.text.replace(/\-\[.+?\]$/,""),data3=$(_obj).data("data");null==data3[modname]&&(data3[modname]={}),data3[modname][modname]=text,$_obj.data("data",data3),update(_obj,data.id,text),layer.open({content:"瀵硅薄涓嶅瓨鍦紝鏄惁鏂板缓锛�",btn:["鏄�","鍚�"],yes:function(a,t){var e={id:modname,text:text};$.post("/?/api/save_options/",{data:e,conf:ext},function(a){if(layer.msg(a.msg),1==a.ok){var t=a.uuid,e=text,o=$(_obj).data("data");delete o[modname][modname],o[modname][t]=e,$_obj.data("data",o),update(_obj,t,e)}})},btn2:function(a,t){update(_obj,"","")},cancel:function(){update(_obj,"","")}});break}}else for(var modname in mods){var mod=mods[modname];if(data.id==modname+"_new"){var text=data.text.replace(/\-\[.+?\]$/,"");update(_obj,data.id,text),layer.open({content:"瀵硅薄涓嶅瓨鍦紝鏄惁鏂板缓锛�",btn:["鏄�","鍚�"],yes:function(a,t){var e={id:modname,text:text};$.post("/?/api/save_options/",{data:e,conf:ext},function(a){if(layer.msg(a.msg),1==a.ok){var t=a.uuid,e=text;fetch_ajax(lo,{conf:ext},_obj),update(_obj,t,e)}})},btn2:function(a,t){update(_obj,"","")},cancel:function(){update(_obj,"","")}});break}}}}});if(lo.find(".databox-clear").click(function(){update(_obj,"",""),layer.close(li),setMobileScrollable(!0);var a=dlang.databox_fn;-1!=$.inArray("clear",a)&&databox_fn(_obj,"clear")}),""!==dlang.btn_other&&"object"==typeof dlang.btn_other){var fns=dlang.databox_fn;for(var btn in dlang.btn_other)lo.find(".databox-"+btn).click(function(){-1!=$.inArray(btn,fns)&&databox_fn(_obj,btn,li)})}lo.on("click",".loadmore:not(.loading)",function(){var a=$(this).data("page")+1,t=lo.find(".databox-search[data-type=options]").val();$(this).addClass("loading").html(loading_msg),fetch(lo,{conf:ext,page:a,q:t})}),$options.on("click",item_parent,function(a){if($(a.target).hasClass("databox-multiple-check"))return!0;var t=$(this),e=t.data("id"),o=!t.data("isopen"),d=$options.find("[data-pid="+e+"]"),i=t.find(".ion"),n="ion-arrow-down-b",l="ion-arrow-up-b";t.data("isopen",o),o?(d.hide(),i.removeClass(n).addClass(l)):(d.show(),i.removeClass(l).addClass(n))}),lo.find(".databox-options").on("scroll",function(){var a=$(this).height();if($(this).get(0).scrollHeight-a<=$(this).scrollTop()){if(0==$(".loadmore:not(.loading)").length)return;var t=$(".loadmore:not(.loading)").data("page")+1,e=lo.find(".databox-search[data-type=options]").val();$(".loadmore:not(.loading)").addClass("loading").html(loading_msg),fetch(lo,{conf:ext,page:t,q:e})}});var search_delay="鏄�"==ext.ajax?500:0;lo.on("input",".databox-search",debounce(function(){var a=$(this),t=a.val();"options"!=a.data("type")?search_selected(lo,t):fetch(lo,{conf:ext,q:t},_obj)},search_delay)),"鏄�"!=ext.multiple||"鏄�"!=ext.dragable||b2.mobilecheck()||Sortable.create(lo.find(".databox-selected").get(0),{draggable:".databox-item",handle:".dragbar"})}$(document).on("click",".databox",function(){$(this).attr("disabled")||(isMobile.iOS()&&document.activeElement.blur(),showDataBox(this))})});
function win_tab_open(e){return!b2.mobilecheck()&&(EnterCtrl||EnterShift?(EnterShift?window.open("?/"+e,"_blank",!0):window.open("?/"+e,"_blank"),EnterShift=!1,!(EnterCtrl=!1)):(EnterShift=!1,EnterCtrl=!1))}function open_entity(e,n,i){if(valid_uuid(e)){var a="/view/about/"+e+"/";null==i&&(i="new"),n?v(n+a,i,{no_confirm:1}):$.get("?/entity/uuid/"+e,function(e){e?v(e+a,i,{no_confirm:1}):layer.msg("瀵硅薄涓嶅瓨鍦ㄦ垨琚垹闄�")})}}function v1(e,n,i){if(!win_tab_open(e)){n||(n="#canvas"),current_url=e||"",null==i&&(i={}),i.b2ajax=!0;var a=LoadingLayer.create(1).show();segs=current_url.split("/"),seg1=segs[0]?segs[0]:"home",seg2=segs[1]?segs[1]:"index",seg3=segs[2]?segs[2]:null,seg4=segs[3]?segs[3]:null,$(n).load("?/"+current_url,i,function(){if(form.render(),!(menu.length<1)){$("#menu2wrap").animate({left:"0px"},600),$("#menu2-0").empty(),null!=typeof menu[seg1].title&&$("#menu2-0").append('<li class="title" ><a>'+menu[seg1].title+"</a></li>");var e=menu[seg1].children;$.each(e,function(e,n){n.hidden||$("#menu2-0").append("<li id='menu-"+seg1+"-"+e+'\' class="layui-nav-item" ><a href="javascript:v(\''+seg1+"/"+e+"');\" ><span>"+n.title+"</span></a></li>")})}}),a.close()}}function v2(e,n,i){if(!win_tab_open(e)){n||(n="#canvas"),current_url=e||"",null==i&&(i={}),i.b2ajax=!0;var a=LoadingLayer.create(1).show();$(n).load("?/"+current_url,i,function(){form.render()}),a.close()}}function v(e,n,i){null==i&&(i={});var a=window.location.search,t=a.indexOf("&");0<t&&(a=a.slice(0,t));var s=0;null!=i&&1==i.popstate&&null!=i.url_search&&(a=i.url_search,s=1);var l=a.split("/")[2];if("view"==l&&(l=a.split("/")[5]),null==i&&(i={}),("add"==l||"edit"==l)&&0==$("[sub=1]").length&&!i.no_confirm){var o=$("form.ajax"),r=o.data("autosave"),d=check_update_value(o);if(!r&&d)return void layer.confirm(lang.no_save_confirm,{btn:[lang.ok,lang.cancle]},function(){v_jump(e,n,i)},function(){reset_menu(),1==s&&(history.pushState(null,null,document.URL.split("?")[0]+a),$("#layout").attr("data-s",a))})}v_jump(e,n,i)}var last_seg2;function v_jump(e,d,c){var n=!1;if(void 0===c&&(c={}),c.init||(window.lppHistory.getLast(2)==e&&(n=!0),window.lppHistory.historyPointer++,window.lppHistory.history.push(e)),!win_tab_open(e)){$("[sub]").removeAttr("sub"),record_menu_id();var u=d=d||"#canvas";$(d).closest("#canvas").length&&(u="#canvas"),"string"==typeof d&&0==d.indexOf("#layer_canvas")&&(u="#layer_canvas"),"#canvas-side"==d&&(u="#canvas-side"),hist_positon=hist_positon||2,current_url=e||hist[hist_positon-1]||"","/"==current_url&&(current_url=""),c.b2ajax=!0,c.reqSrc=d;var m="",i=current_url.indexOf("#");-1!=i&&(m=current_url.slice(i),current_url=current_url.slice(0,i)),segs=current_url.split("/"),seg_1=segs[0]?segs[0]:"home",seg_2=segs[1]?segs[1]:"index",seg_3=segs[2]?segs[2]:null,seg_4=segs[3]?segs[3]:null,seg_5=segs[4]?segs[4]:null,$("#openmenu").is(":visible")&&FixedMenu.close_menu(),$("script.remove").remove();var h=LoadingLayer.create(1),a=["#remodal","#small","#larget","new","#new","modal","win","#layer_canvas"],f=function(){return!(!isMobile.any()||isMobile.iPad()||"miniprogram"===window.__wxjs_environment||"#canvas"!=d&&(-1!=$.inArray(d,a)||-1!=d.indexOf("#form")||-1!=d.indexOf("#layer_canvas")))};f()?mobileSlideAnimation.start(u,n):window.firstLoading?h.show():window.firstLoading=!0,$.post("?/"+current_url,c,function(e){if(0==e.check_priv)return h.close(),void layer.msg(e.msg);if(1==e.is_deleted)return h.close(),void layer.msg(e.msg);if(e.rtu)v(e.rtu);else{var n="content-side-open";switch(weixin_title(seg_1,menu),!c.popstate&&"#canvas-side"!=d&&"open"!=seg_1&&push_state(current_url+m),hfbreadcrumb($(".horizontal #breadcrumb")),"#replace"==u&&0==$('.layui-layer[type="modalbox"]').length&&(u="#canvas"),u){case"#del":h.close();break;case"#canvas":if($("body").css("position","relative"),close_side(),$.fn.dataTable.tables({api:!0}).destroy(!0),"view"==seg_2&&(uuid=seg_4||seg_3),hist_positon=hist.push(current_url),seg_2&&!seg_3&&(last_seg2=seg_2),f()){mobileSlideAnimation.end(u,current_url,e);var i=$(u).find(".layui-tab-title>li.layui-this").index()}else{render_submenu(current_url),$(window).scrollTop(0);i=$(u).find(".layui-tab-title>li.layui-this").index();$(u).html(e)}c.init&&("starquest"!=b2conf.cid||isMobile.APP()?$("#loading_bg").remove():setTimeout(function(){$("#loading_bg").remove()},3e3)),render_canvas(),tab_this(u,i);break;case"#canvas-side":var a=$("#canvas");i=$(u).find(".layui-tab-title>li.layui-this").index();$(u).find(".content").html(e);var t=$.fn.dataTable.tables({api:!0});a.hasClass(n)||(a.addClass(n),t.columns(":not([data-name]), [data-name]:not(:first)").visible(!1,!1)),render_canvas(u),tab_this(u,i),render_submenu(current_url,u),b2.mobilecheck()||a.find(".content-wrap").slimScroll({height:"auto"}),side_format_search();case"#layer_canvas":i=$(u).find(".layui-tab-title>li.layui-this").index();$(d).html(e),layer_content_render(r=$(d).closest(".layui-layer"),u,h),tab_this(u,i);break;case"#replace":h.close();var s=$('.layui-layer[type="modalbox"]'),l=void 0;if(1==s.length)l=s;else{var o=0;$(s).each(function(){var e=$(this).attr("times");o<e&&(o=e)}),l=$('.layui-layer[type="modalbox"][times="'+o+'"] .layui-layer-content')}$(l).html(e);break;default:if($(u).length&&$(u).closest(".layui-layer").length){var r;(r=$(u).closest(".layui-layer")).children(".layui-layer-content").html(e),render_layer_menu(r),layer_content_render(r,u,h);break}indexw=layer.open({title:b2.lang("msg"),type:1,area:isMobile.any()?"100%":c.width?c.width:"70%",maxWidth:1e3,offset:isMobile.any()?0:50,shadeClose:!1,content:e,success:function(e,n){render_layer_menu(e),layer_content_render(e,u,h),$(e).prev(".layui-layer-shade").on("click",function(){push_state(hist[hist_positon-1]||hist[hist_positon-2]),cancel_form(n,e)}),c.mod1&&$(e).attr("data-mod1",c.mod1),c.mod2&&$(e).attr("data-mod2",c.mod2),$(e).find(".layui-layer-ico.layui-layer-close1.layui-layer-close").removeClass("layui-layer-ico").addClass("ion ion-close-round").css({"font-size":"18px",color:"#6f6f6f",top:"6px",left:"6px"})},cancel:function(e,n){return $("#canvas").css("padding-right",10),push_state(hist[hist_positon-1]||hist[hist_positon-2]),cancel_form(e,n)},end:function(){push_state(hist[hist_positon-1]||hist[hist_positon-2]),FixedMenu.render(u)}})}c.callback&&"function"==typeof c.callback&&c.callback(),document.dispatchEvent(new CustomEvent("v:done",{detail:{target:$(u)}}))}})}}function tab_this(e,n){if(!(n<0)){e=e||"#canvas",n=0<n?n:0;$(e).find(".layui-tab-title>li").eq(n).trigger("click")}}function render_canvas(e){0==$(".menu-mobile").length&&$(".mobile-menu").show();e=e||"#canvas";var n=function(){setTimeout(function(){$("select.select-mu:visible").b2select(),form.render()},0)};layer.closeAll(),element.on("inited",n).on("tab",n),form.render(),element.init(),FixedMenu.render(e),Comment.render(),$(e).find(".checklist").Checklist(),$(e).find("select.select-mu").b2select(),$("[autofocus]").focus(),scrollMenuh(),function(){if(isMobile.any()){var e=$("#menuh"),n=e.find("#menuh-0"),i=e.find("#menuh-1"),a=!!n.find("li").length,t=!!n.find("li").length;if(a||t){var s=a?n:i,l=s.closest(".layui-tab.layui-tab-brief"),o=s.find(".layui-this");l.scrollLeft(o.position().left)}}}()}function layer_content_render(e,n,i){var a=getScrollWidth()+10;$("#canvas").css("padding-right",a),form.render(),element.init(),$(e).find("select.select-mu").b2select(),isMobile.Android()&&$(e).closest(".layui-layer").css("height","100%"),isMobile.any()&&$(e).closest(".layui-layer-modal").length&&$(e).css("min-height","100vh").closest(".layui-layer-modal").css("padding","0"),FixedMenu.render(n),Comment.render(),$(e).find(".checklist").Checklist(),layer.check_layer($(e)),i.close()}function toggle_side(){if($("#canvas").hasClass("content-side-open")){$("#canvas").removeClass("content-side-open").addClass("content-side-close"),$(".content-main").hide(),$(".content-wrap.b2table").hide(),$(".content-wrap.b2table").parent().hide(),$(".side-toggle span").removeClass("ion-arrow-left-b").addClass("ion-arrow-right-b");var e=$(".entity_info.layui-col-sm12");$(e).hasClass("layui-col-lg8")&&$(".Comment.layui-col-sm12:not(.layui-col-lg4)").addClass("layui-col-lg4")}else{$("#canvas").removeClass("content-side-close").addClass("content-side-open"),$(".content-main").show(),$(".content-wrap.b2table").show(),$(".content-wrap.b2table").parent().show(),$(".side-toggle span").addClass("ion-arrow-left-b").removeClass("ion-arrow-right-b");e=$(".entity_info.layui-col-sm12");$(e).hasClass("layui-col-lg8")&&$(".Comment.layui-col-sm12.layui-col-lg4").removeClass("layui-col-lg4")}}function close_side(){if($("#canvas").hasClass("content-side-open")){$("#canvas").removeClass("content-side-open");var e=$.fn.dataTable.tables({api:!0});e.columns().visible(!0),e.columns.adjust().draw(!1)}}function side_format_search(){var e=$(".list-header-wrap");0!=e.length&&(e.find(".list-header-btns").hide(),e.find(".list-search-wrap.layui-row").find(".list-header-btn-primary").hide(),e.find(".list-search-wrap.layui-row").find(".list-header-search").removeClass("layui-col-md2").addClass("layui-col-md9"),e.find(".list-search-wrap.layui-row").find(".list-header-search-btn").removeClass("layui-col-md1").addClass("layui-col-md3"))}!function(){function e(e,n,i){e.addEventListener?e.addEventListener(n,i,!0):e.attachEvent?e.attachEvent("on"+n,i):e["on"+n]=i}EnterShift=!1,EnterCtrl=!1,e(window,"click",function(e){var n=e.ctrlKey||e.metaKey;shiftKey=e.shiftKey,n&&(EnterCtrl=!0),shiftKey&&(EnterShift=!0)}),e(window,"mouseup",function(){EnterShift=!1,EnterCtrl=!1})}();var mobileSlideAnimation={start:function(n,i){i||(i=!1),window.spaceInfo&&window.spaceInfo.sid==window.websid?mobileSlideAnimation.bare_start(n,i):$.post("?/space/info/"+window.websid,{},function(e){window.spaceInfo=e,mobileSlideAnimation.bare_start(n,i)})},end:function(n,i,a){setTimeout(function(){var e=$(".layui-body:not(#layui-body-placeholder)");$(e).removeClass("fixed-loading"),$("body,html").animate({scrollTop:0},"fast"),render_submenu(i),$(n).html(a),$(".m-menuh-loading-tmp").remove(),$(n).prev().removeClass("m-menuh-loading"),render_canvas()},700-Math.floor(200*Math.random()+100)),$(".mobile-menu.noprint").show()},bare_start:function(n,e){e||(e=!1),$("#layui-body-placeholder").remove();var i=$(".layui-body:not(#layui-body-placeholder)");$(n).parent(".layui-body:not(#layui-body-placeholder)").after('<div id="layui-body-placeholder" class="layui-body transition" style="left:0;"></div>'),$(i).find("#menuh,#canvas").clone(!1).appendTo("#layui-body-placeholder"),$("#layui-body-placeholder").css("z-index",e?"99999999":"unset"),e?setTimeout(function(){$("#layui-body-placeholder").addClass("slide-in").css("left","100%"),$(i).find("#menuh").addClass("m-menuh-loading").append("<div class='m-menuh-loading-tmp'></div>")}):($(i).removeClass("transition").removeClass("slide-in").css("left","100%"),setTimeout(function(){$(i).addClass("transition").addClass("slide-in").css("left","0"),$(i).find("#menuh").addClass("m-menuh-loading").append("<div class='m-menuh-loading-tmp'></div>")}));var a='<div class="slide-loading">';$("body.def-loading-anim").length?(window.spaceInfo.logo?a+='<div class="ph logo"><img src="'+window.spaceInfo.logo+'"/></div>':a+='<div class="ph name">'+window.spaceInfo.name+"</div>",a+='<div class="loading-ring"></div>'):a+=lang.pepm_loading,$(i).addClass("fixed-loading").find("#canvas").html(a),setTimeout(function(){var e=$(n).parent(".layui-body").next();$(e).remove()},400)}};function getScrollWidth(){var e,n,i=document.createElement("DIV");return i.style.cssText="position:absolute; top:-1000px; width:100px; height:100px; overflow:hidden;",e=document.body.appendChild(i).clientWidth,i.style.overflowY="scroll",n=i.clientWidth,document.body.removeChild(i),e-n}
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("layui"),require("underscore")):"function"==typeof define&&define.amd?define(["layui","underscore"],e):t.Excel=e(t.layui,t._)}(this,function(layui,_){"use strict";var $=layui.$,table=layui.table,warn=function(t){console.log("%cX [Excel.js error]: %c"+t,"color:red","color:#000")},tip=function(t){console.log("%c锛乕Excel.js warn]: %c"+t,"color:orange","color:#000")},t=function(t,e){for(var i in e)t=t.replace(new RegExp("{"+i+"}","g"),e[i]);return t},p=function(e,i){return parse_json(t(e,i))},rs=function(t){return $.trim(t).replace(/[&nbsp|&ensp|&emsp;|&thinsp]/gm,"")},isnull=function(t){return""==t||null==t||null==t};function Event(){}function MixinEvent(){var a=new Event;return{on:function(t,e){if(Array.isArray(e))for(var i=0;i<e.length;i++)a.on(t,e[i]);else a.on(t,e);return this},emit:function(){return a.emit.apply(a,arguments),this},off:function(t,e){if(Array.isArray(e))for(var i=0;i<e.length;i++)a.off(t,e[i]);else a.off(t,e);return this},clear:function(){a.clear()}}}function proxyFactory(a){var n={};return{create:function(t){return n[t]||(n[t]=((i=$("#"+(e=t))).length?i[0].addEventListener("DOMNodeRemovedFromDocument",function(){e in n&&delete n[e]}):tip("The element of `"+e+"` is not found."),a.apply(this,arguments)));var e,i}}}function TExcel(){return new ExcelTable(arguments[1])}function TEvent(){return new MixinEvent}function Form(t){var n=$("#"+t),l={};return n.length&&n.on("submit",function(){var t=!0,e=Number(n.find("input.cache[name=cache]").val());if(!e)for(var i in l){for(var a=1;l[i][a];)if(!l[i][a++]()){t=!1;break}if(!t)break}for(var i in l)if(!l[i][0]()&&!e){t=!1;break}return t}),{listen:function(t,e){l[t]||(l[t]=[]),e instanceof Function&&l[t].push(e)},clear:function(t){t?l[t]=[]:l={}}}}function Data(){var e={},i=0;return{set:function(){return e[1<arguments.length?arguments[0]:i]=1<arguments.length?arguments[1]:arguments[0]},get:function(t){return e[arguments.length?t:i]||{}},state:function(t){return arguments.length&&(i=t),i},clear:function(){i=0,e={}}}}Event.prototype={handers:{},on:function(t,e){return t in this.handers||(this.handers[t]=[[],[]]),this.handers[t][0].push(e),this},emit:function(t){var e=[].slice.call(arguments,1),i=this.handers[t];if(i)for(var a=i[i[0].length?0:1],n=i[i[0].length?1:0];a.length;){var l=a.shift();l.apply(this,e),n.push(l)}return this},off:function(t,e){var i=this.handers[t];if(i)if(e)for(var a=i[i[0].length?0:1],n=i[i[0].length?1:0],l=Math.max(a.length,n.length)-1;0<=l;l--)a[l]&&e===a[l]&&a.splice(l,1),n[l]&&e===n[l]&&n.splice(l,1);else this.handers[t]=[[],[]];return this},clear:function(){this.handers={}}};var proxyExcel=new proxyFactory(TExcel),proxyEvent=new proxyFactory(TEvent),proxyForm=new proxyFactory(Form),proxyData=new proxyFactory(Data),CO="[{x},{y}]",UNNAMED="鏈懡鍚�",ROW_INFO='{"type":"text","text":"{text}","default_value":"","required":false,"readonly":false}',ADD_COL_ROW='<div class="excel_handel_box">                <a href="javascript:;" class="excel_handler layui-btn layui-btn-small" data-action="addrow"><span class="ion-plus"></span> 娣诲姞琛�</a>                <a href="javascript:;" class="excel_handler layui-btn layui-btn-small"data-action="addcol"><span class="ion-plus"></span> 娣诲姞鍒�</a>              </div>',MOVE_DEL_ROW='<a class="excel_handler" style="background:#f2f2f2;position:absolute;right:35px;" href="javascript:;" data-action="uprow"><i class="layui-icon">&#xe619;</i></a>                <a class="excel_handler" style="background:#f2f2f2;position:absolute;right:20px;" href="javascript:;" data-action="downrow"><i class="layui-icon">&#xe61a;</i></a>                <a class="excel_handler" style="background:#f2f2f2;position:absolute;right:5px;" href="javascript:;" data-action="delrow"><i class="layui-icon">&#x1006;</i></a>',DEL_COL='<a class="excel_handler" style="position:absolute;right:10px;" href="javascript:;" data-action="delcol"><i class="layui-icon pull-right">&#x1006;</i></a>',TABLE_TITLE='<div class="layui-table-fixed layui-table-fixed-l" style="top:-39px;">                <div class="layui-table-title">                  <table cellspacing="0" cellpadding="0" border="0" class="layui-table" style="width:100%;">                    <thead><tr>                      <th data-field="title">                        <div class="layui-table-cell" style="text-align:center;">                          <span>{title}</span>                        </div>                      </th>                    </tr></thead>                  </table>                </div>              </div>',TABLE_ROW='<div class="tablerow"><span>{title}</span></div>',TABLE_COL='{"field":"f{col}","align":"center","title":"{title}"}',TABLE_COLF='{"field":"fixed_left","title":"{title}","fixed":"left"}',INPUT_CSS='{"width":"{width}px","background":"#f6f9ff","border-radius":0}',CELL_CSS={"word-wrap":"break-word","word-break":"break-all","text-overflow":"clip","white-space":"normal",height:"auto","line-height":"normal","text-align":"left","vertical-align":"middle",overflow:"auto","padding-left":"5px","padding-right":"5px"},WARN_CSS={background:"red",color:"#000"},WARN_VERIFY='<i class="layui-layer-ico layui-layer-ico5"></i><br>楠岃瘉閿欒!<br>浣嶇疆<span style="color:red;">{td_label}</span>鐨勫～鍐欏€间笌璁＄畻鍊间笉鐩哥瓑<br><pre class="layui-code">濉啓鍊硷細{num1}<br>璁＄畻鍊硷細{num2}</pre>璁＄畻鍏紡锛�<br><pre class="layui-code">{td_label}={calc_label}</pre>',WARN_REQUIRED='<i class="layui-layer-ico layui-layer-ico5"></i><br>蹇呭～閿欒!<br>{pos}<span style="color:red;">{label}</span>涓嶅緱涓虹┖<br>',WARN_TIME=3e3,Util={parseEquation:function(t){var e=t.split("=");return{target:e[0],calc:e[1]}},parseCalc:function(t){return t.match(/\[.*?\]/gi)},warn:function(t,e,i,a){var n=e.elem;"col"==i?n=t.find(".layui-table-main tbody tr td:nth-child("+(e.x+1)+")"):"row"==i&&(n=t.find(".layui-table-main tbody tr:eq("+e.row+")")),a&&n[0].scrollIntoView(),(n=n.find("input").length?n.find("input"):n).css(WARN_CSS),setTimeout(function(){n.removeAttr("style")},WARN_TIME)},get_label:function(t,e,i){var a=e.col[t.x-1],n=e.row[t.row].text;switch(i){case"col":return" [ "+a+" ] ";case"row":return" [ "+n+" ] ";case"cell":return" [ "+a+"锛�"+n+" ] "}},get_num:function(t){var e=t.elem,i=e.find(":input").length?e.find(":input").val():e.find("div").text();return isnull(i)&&(i=""),this.normal_value(t.info,i)},format_value:function(t,e){switch(t.type){case"amount":case"percent":case"yuan":case"wan":case"yi":case"dollar":case"currency":void 0!==e&&""!=e&&(e=parseFloat(String(e).replace(/,/g,"")),e=number_format(e,2,".",",")),t.unit&&(e+=" "+t.unit)}return e},normal_value:function(t,e,i){switch(t.type){case"amount":case"percent":case"yuan":case"wan":case"yi":case"dollar":case"currency":t.unit&&void 0!==e&&""!=e&&(e=e.replace(t.unit,"")),void 0!==e&&""!=e?(e=e.replace(/[\s|,]*/gm,""),e=Number(e)):i||(e=0)}return e},calc:function(ntable,calc,info){var pos=this.parseCalc(calc),pos2={},decimal_len=0;pos.forEach(function(t,e){var i=Table.co_info(info,t,ntable),a=this.get_num(i),n=String(a).split(".");decimal_len=Math.max(decimal_len,n[1]?n[1].length:0),pos2[t]=a}.bind(this));var multiple=Math.pow(10,decimal_len);for(var p in pos2)calc=calc.replace(p,"("+Math.round(pos2[p]*multiple)+")");return eval(calc)/multiple},get_calc_label:function(i,t,a){var e=this.parseCalc(t),n={};for(var l in e.forEach(function(t){var e=Table.co_info(a,t,i);n[t]=this.get_label(e,a,"cell")}.bind(this)),n)t=t.replace(l,n[l]);return t},verify:function(e,i,a,n){var l=Table.co_info(n,i,e),r=this.get_num(l),o=this.calc(e,a,n);if(r===o)return!0;var c=this.get_label(l,n,"cell"),s=this.get_calc_label(e,a,n);return layer.open({content:t(WARN_VERIFY,{td_label:c,num1:r,num2:o,calc_label:s}),shade:!1,title:"璀﹀憡"}),this.warn(e,l,"cell",!0),!1},required:function(e,i,a,n,l){var r=this.get_label(i,a,n);return layer.open({content:t(WARN_REQUIRED,{pos:{col:"鍒�",row:"琛�",cell:"浣嶇疆"}[n],label:r}),shade:!1,title:"璀﹀憡"}),this.warn(e,i,n,l),!0}},Render={render_table:function(i,l,r){if(i.length){var a=l.ndata,n=r.freeze.header,e=(e=l.height)||(20<a.data.length?"838":"auto"),o=l.left_width?l.left_width:150,c=(c=Math.floor((i.parent().width()-o-3)/(a.cols.length-1)))<120?120:c,s=$.extend(!0,[],a.cols),f=$.extend(!0,[],a.data);s.forEach(function(t,e){s[e].width=e?c:o}),f.forEach(function(e,i){f[i].fixed_left=t(TABLE_ROW,{title:f[i].fixed_left})}),i.empty(),l.edit&&(n?i.prevAll(".excel_handel_box").remove():i.prevAll(".excel_handel_box").length||i.before(ADD_COL_ROW)),table.render({elem:"#"+i.attr("id"),limit:100,height:e,cols:[s],data:f,done:function(){var e=i.next(".layui-table-view");a.title&&(e.append(t(TABLE_TITLE,{title:a.title})).css({"margin-top":"45px"}),e.find(".layui-table-title").parent().width("calc(100% + 1px)")),l.edit&&!n&&(e.find("thead>tr:first>th:gt(0) .layui-table-cell").append(DEL_COL),e.find("tbody>tr>td:nth-of-type(1) span").after(MOVE_DEL_ROW)),e.find("[data-field]").each(function(){var t=$(this).find($(this).find("span").length?"span":"div"),e=$(this).find(".tablerow"),i=t.html(),a=t.text(),n=Table.co_info(r,$(this));n.x&&n.y?(l.show_ellipsis||t.css(CELL_CSS),a=Util.format_value(n.info,a),t.text(a).attr("title",a)):e.length?(t.html(i),e.attr("title",a)):t.html(i).attr("title",a)}),e.find(".layui-table-main").scrollLeft(l.scroll.x).scrollTop(l.scroll.y)}})}},fresh_table:function(t,e,i,a){var n=t.next(".layui-table-view").children(".layui-table-main"),l=n.children("table");a=a||["x","y"];e.scroll={x:function(){switch(a[0]){case"0":return 0;case"x":return n.scrollLeft();case"max":return l.width()}}()||0,y:function(){switch(a[1]){case"0":return 0;case"y":return n.scrollTop();case"max":return l.height()}}()||0},this.render_table(t,e,i)},show_input:function(a,t){var n=a.elem,e={};if(!n.find(":input").length&&n.find("div,span").length){if(a.x&&a.y){var i=t.rowform,l=t.row[a.row].id;i&&(e.key=i),l&&(e.id=l),e.type=a.info.type}$.post("?/data/render_item",e,function(t){var e=n.outerWidth()-1,i=a.elem.find(a.elem.find("span").length?"span":"div").text();i=a.x&&a.y?Util.normal_value(a.info,i,!0):i;n.css({padding:"0px"}).find("div").hide(),n.append(t.html),n.find(":input").val(i).css(p(INPUT_CSS,{width:e})).focus()})}}},Table={get_data:function(t,r){var e=t.data("title"),i=t.find("thead").length,a=[],o=[];return i?(t.find("thead>tr:first>th").each(function(t){a.push(p(t?TABLE_COL:TABLE_COLF,{title:$(this).text(),col:t-1}))}),t.find("tbody>tr").each(function(a){var t=$(this).children("td"),n={},l=r.row[a]&&t.eq(0).text()==r.row[a].text;t.each(function(t){var e=t?"f"+(t-1):"fixed_left",i=$(this).text();n[e]=l&&isnull(i)?r.row[a].default_value:i}),o.push(n)})):(a.push(p(TABLE_COLF,{title:r.head})),r.col.forEach(function(t,e){a.push(p(TABLE_COL,{title:t,col:e}))}),r.row.forEach(function(t,n){var l={};a.forEach(function(t,e){var i=e?"f"+(e-1):"fixed_left",a="fixed_left"==i?r.row[n].text:"";l[i]=isnull(a)?r.row[n].default_value:a}),o.push(l)})),{title:e,cols:a,data:o}},save_cell:function(t,e){var i=t.closest(".layui-table-view");if(t.find("div").show(),t.find(":input").remove(),(t.find("span").length?t.find("span"):t.find("div")).html(e).attr("title",e),t.closest(".layui-table-fixed").length&&t.closest(".layui-table-header").length&&i.find(">.layui-table-header tr:eq(0) th:eq(0) span").text(e).attr("title",e),t.closest(".layui-table-fixed").length&&t.closest(".layui-table-body").length){var a=t.closest("tr").index();i.find(">.layui-table-main tr:eq("+a+") td:eq(0) span").text(e).attr("title",e)}t.removeAttr("style")},save_table:function(t,e){var i=t.data("kid"),a=t.data("fid"),n=Table.get_table_data(t,e);n.kid=i,n.fid=a,$.post("?/data/save",n,function(){})},get_table_data:function(t,l){for(var r=t.next(".layui-table-view"),o={data:[],key:l.info.rowform,title:l.title},e={name:l.cols[0].title,val:[]},c=l.cols.length,i=1;i<c;i++)e.val.push(l.cols[i].title);return o.data.push(e),l.data.forEach(function(t,e){var i=l.info.row[e],a={name:i.text,val:[]};i.id&&(a.id=i.id),i.unit&&(a.unit=i.unit);for(var n=0;n<c-1;n++)a.val.push(Util.normal_value(Table.co_info(l.info,[n,e+1],r),l.data[e]["f"+n],!0));o.data.push(a)}),o},co_info:function(e,i,a){if(i instanceof $)var n=(c=i.data("field")?i:i.closest("[data-field]")).closest(".layui-table-title").length,l=c.closest(".layui-table-header").length,r=n?0:c.index(),o=n?0:l?0:c.closest("tr").index()+1;if("string"==typeof i&&(i=i.replace(/\[|\]/gi,"").split(",")),Array.isArray(i)){r=i[0],o=i[1];var c=a.find(o?".layui-table-main tr:eq("+(o-1)+") td:eq("+r+")":".layui-table-box>.layui-table-header tr:eq(0) td:eq("+r+")")}var s=o-1,f=n?"title":r?"f"+(r-1):"fixed_left",d={x:r,y:o,p:[r,o],s:t(CO,{x:r,y:o}),row:s,field:f,elem:c},u=e.row[s];return d.info=u?$.extend(!0,{},u):{type:"text",text:UNNAMED,default_value:"",required:!1,readonly:!1},d.info.type=this.get_widget_type(d,e),d},get_widget_type:function(t,e){var i=e.widget,a=t.info.type;if(t.x&&t.y){var n;if(0<=(n=i.cell[0].indexOf(t.s)))return i.cell[1][n];if(0<=(n=i.col[0].indexOf(t.x)))return i.col[1][n];if(0<=(n=i.row[0].indexOf(t.y)))return i.row[1][n];if(e.row[t.row].id)return e.row[t.row].type}return a}},Handler={addrow:function(t){for(var e={},i=t.data.length,a=0;a<i;a++)0==a?e.fixed_left=UNNAMED:e["f"+(a-1)]="";return t.data.push(e),t.info.row.push(p(ROW_INFO,{text:UNNAMED})),{ndata:t,scroll:["x","max"]}},delrow:function(t,e){if(t.data.length<=1)return layer.msg("璇疯嚦灏戜繚鐣欎竴琛�"),!1;var i=e.closest("tr").index();return t.data.splice(i,1),t.info.row.splice(i,1),{ndata:t,scroll:["x","y"]}},uprow:function(t,e){var i=e.closest("tr").index();if(!i)return!1;var a=t.data[i-1];return t.data[i-1]=t.data[i],t.data[i]=a,a=t.info.row[i-1],t.info.row[i-1]=t.info.row[i],t.info.row[i]=a,{ndata:t,scroll:["x","y"]}},downrow:function(t,e){var i=e.closest("tr").index();if(e.closest("tr").nextAll("tr").length){var a=t.data[i+1];return t.data[i+1]=t.data[i],t.data[i]=a,a=t.info.row[i+1],t.info.row[i+1]=t.info.row[i],t.info.row[i]=a,{ndata:t,scroll:["x","y"]}}},addcol:function(t){var e=t.cols.length-1;for(var i in t.cols.push(p(TABLE_COL,{col:e,title:UNNAMED})),t.data)t.data[i]["f"+e]="";return t.info.col.push(UNNAMED),{ndata:t,scroll:["max","y"]}},delcol:function(t,e){if(t.cols.length<=2)return layer.msg("璇疯嚦灏戜繚鐣欎竴鍒�"),!1;var i=e.closest("th").index(),a=[],n=[];for(var l in t.cols)i!=l&&(t.cols[l].field=0==l?"fixed_left":"f"+(l-1-(i<l)),a.push(t.cols[l]));for(var l in t.data){var r=t.data[l],o={};for(var c in r)if("LAY_TABLE_INDEX"!=c)if("fixed_left"!=c){var s=Number(c.substr(1));s==i-1||(o["f"+(s-(i-1<s))]=r[c])}else o[c]=r[c];n.push(o)}return t.cols=a,t.data=n,t.info.col.splice(i-1,1),{ndata:t,scroll:["x","y"]}},leftcol:function(t,e){var i=e.closest("td").index(),a="f"+(i-1),n="f"+(i-2);if(e.closest("td").prevAll("td").length<=1)return!1;var l=t.cols[i].title;for(var r in t.cols[i].title=t.cols[i-1].title,t.cols[i-1].title=l,l=t.info.col[i-1],t.info.col[i-1]=t.info.col[i-2],t.info.col[i-2]=l,t.data){l=t.data[r][a];t.data[r][a]=t.data[r][n],t.data[r][n]=l}return{ndata:t,scroll:["x","y"]}},rightcol:function(t,e){var i=e.closest("td").index(),a="f"+(i-1),n="f"+i;if(!e.closest("td").nextAll("td").length)return!1;var l=t.cols[i].title;for(var r in t.cols[i].title=t.cols[i+1].title,t.cols[i+1].title=l,l=t.info.col[i-1],t.info.col[i-1]=t.info.col[i],t.info.col[i]=l,t.data){l=t.data[r][a];t.data[r][a]=t.data[r][n],t.data[r][n]=l}return{ndata:t,scroll:["x","y"]}}},Convert={init:function(t,e){for(var i=[],a=[],n=[],l=1;l<e.cols.length;l++)i.push(e.cols[l].title);for(l=0;l<t.row.length;l++)n.push(rs(t.row[l].text));for(l=0;l<e.data.length;l++){var r=rs(e.data[l].fixed_left),o=n.indexOf(r);a.push(0<=o?t.row[o]:p(ROW_INFO,{text:r}))}return t.col=i,t.row=a,t.head=e.cols[0].title,this.transform(t)},transform:function(t){t=$.extend(!0,{},t),this.xAxis=t.col?t.col:[],this.yAxis=t.row?t.row:[];var e=this,i=t.freeze,a=t.required,n=t.widget?t.widget:{},l=t.calculate,r=t.verify;Array.isArray(i.col)&&i.col&&(i.col=i.col.map(function(t){return e.x(t)})),Array.isArray(i.row)&&i.row&&(i.row=i.row.map(function(t){return e.y(t)})),Array.isArray(i.cell)&&i.cell&&(i.cell=i.cell.map(function(t){return e.co(Array.isArray(t)?t:e.t(t))})),Array.isArray(a.col)&&a.col&&(a.col=a.col.map(function(t){return e.x(t)})),Array.isArray(a.row)&&a.row&&(a.row=a.row.map(function(t){return e.y(t)})),Array.isArray(a.cell)&&a.cell&&(a.cell=a.cell.map(function(t){return e.co(Array.isArray(t)?t:e.t(t))})),Array.isArray(l)&&l&&(l=l.map(function(t){return e.tcalc(t)})),Array.isArray(r)&&r&&(r=r.map(function(t){return e.tcalc(t)}));for(var o=0;o<this.yAxis.length;o++)this.yAxis[o].readonly&&(Array.isArray(i.row)||(i.row=[]))&&i.row.push(o+1),this.yAxis[o].required&&(Array.isArray(a.row)||(a.row=[]))&&a.row.push(o+1);var c=[[],[]],s=[[],[]],f=[[],[]];for(var d in n.col)c[0].push(e.x(d)),c[1].push(n.col[d]);for(var d in n.row)s[0].push(e.y(d)),s[1].push(n.row[d]);for(var d in n.cell)f[0].push(e.co(e.t(d))),f[1].push(n.cell[d]);return t.widget={col:c,row:s,cell:f},i&&(t.freeze=i),a&&(t.required=a),l&&(t.calculate=l),r&&(t.verify=r),t},co:function(e){return t(CO,{x:this.x(e[0]),y:this.y(e[1])})},x:function(t){var e=this.xAxis.indexOf(t)+1;return e||tip("The X-Axis Point of `"+t+"` is not found."),e},y:function(t){for(var e=0;e<this.yAxis.length&&(this.yAxis[e].id!=t&&this.yAxis[e].text!=t);e++);return e=e>=this.yAxis.length?(tip("The Y-Axis Point of `"+t+"` is not found."),0):e+1},t:function(t){return t.replace(/\{|\}/gi,"").split(",")},tcalc:function(e){var l=this,r=!0,i=e.replace(/{(.*?)}/gi,function(e){var i=e.replace(/{|}/gi,"").split(","),a=l.x(i[0]),n=l.y(i[1]);return a&&n||(r=!1),t(CO,{x:a,y:n})}).replace(/\s+/g,"");return!!r&&i}};function ExcelTable(t){this.setting=t,this.elem=this.setting.elem instanceof $?this.setting.elem:$(this.setting.elem),this.init()}function Excel(){this instanceof Excel?this._options={elem:"#Excel",edit:!1,edittime:!1,show_ellipsis:!1,height:"auto",left_width:150,scroll:{x:0,y:0},title:"",info:{head:UNNAMED,col:[],row:[],freeze:{title:!1,header:!1,col:[],row:[],cell:[]},required:{col:[],row:[],cell:[]},calculate:[],verify:[]},dynamic:!1}:warn("Excel is a constructor and should be called with the `new` keyword.")}return ExcelTable.pt=ExcelTable.prototype,ExcelTable.pt.init=function(){this.data(),this.dynamic(),this.render()},ExcelTable.pt.data=function(){var t,e,i=this.setting,a=this.elem,n=a.attr("id"),l=i.dynamic,r=l.bind,o=l.info,c=l&&o?function(){var t=l.value;if(!isnull(t))return t;for(var t in l)return t;return 0}():0,s=a.closest(".layui-form").find("td[kid="+r+"]"),f=!!s.length&&s.find(":input").eq(0),d=f.length?(e=f.val(),isnull(e)?("SELECT"==f[0].nodeName&&("select"==s.attr("ftype")?e=f.find("option").eq(1).attr("value"):"select_new"==s.attr("ftype")&&(e=f.data("val"))),isnull(e)?c:e):e):s.length?(t=s.find(".data-wrap").text(),isnull(t)?c:t):(l&&tip("The element about `dynamic bind` of `"+r+"` is not found."),c),u=l&&o?o[d]:i.info,h=Table.get_data(a,u);h.title||(h.title=i.title),h.info=Convert.init(u,h),this.Data=proxyData.create(n),this.Data.set(d,h),this.Data.state(d),this.setting.ndata=h},ExcelTable.pt.info=function(){return this.Data.get().info},ExcelTable.pt.reinfo=function(){var t=this.setting,e=t.dynamic,i=this.Data.state(),a=e&&e.info?e.info[i]:t.info,n=this.Data.get();n.info.freeze=a.freeze,n.info.required=a.required,n.info.calculate=a.calculate,n.info.verify=a.verify,n.info=Convert.transform(n.info),this.Data.set(n),this.setting.ndata=n},ExcelTable.pt.dynamic=function(){var t=this.setting,e=this.elem,i=t.dynamic;if(i&&i.bind&&i.info){var a=this,n=i.bind,l=i.info,r=e.closest(".layui-form").find("td[kid="+n+"]"),o=!!r.length&&r.find(":input").eq(0),c=a.Data.state();if(r.length&&o.length){for(var s in l)if(s!=c){var f=[],d=l[s],u=d.head?d.head:"",h=[p(TABLE_COLF,{title:u})];d.col.forEach(function(t,e){h.push(p(TABLE_COL,{col:e,title:t}))}),d.row.forEach(function(t){var i={fixed_left:t.text};d.col.forEach(function(t,e){i["f"+e]=t.default_value}),f.push(i)}),a.Data.set(s,{title:t.title,cols:h,data:f,info:Convert.transform(d)})}o.on("change",function(){var t=$(this).val(),e=l[t],i=a.Data.state();e&&t!=i&&(a.setting.ndata=a.Data.get(t),a.Data.state(t),a.fresh([0,0]))})}else r.length||tip("The element about `dynamic bind` of `"+n+"` is not found.")}},ExcelTable.pt.render=function(){var t=this,e=this.setting,i=this.elem,a=this.info();if(Render.render_table(i,e,a),e.edit&&(t.listen(),t.register()),!navigator.userAgent.match(/mobile/i)){var n=_.throttle(function(){t.fresh()},100);$(window).on("resize",n),i[0].addEventListener("DOMNodeRemovedFromDocument",function(){$(window).off("resize",n),n.cancel()})}},ExcelTable.pt.fresh=function(t){var e=this.setting,i=this.elem,a=this.info();Render.fresh_table(i,e,a,t),e.edit&&(this.listen(),this.register())},ExcelTable.pt.listen=function(){var r=this,n=this.elem,l=this.setting,o=this.info(),i=o.freeze,c=o.required,t=n.parent(),s=n.next(".layui-table-view");t.off("click","[data-field]").on("click","[data-field]",function(t){var e=Table.co_info(o,$(this));"INPUT"==t.target.nodeName||i.title&&"title"==e.field||i.header&&(!e.x||!e.y)||i.col&&0<=i.col.indexOf(e.x)||i.row&&0<=i.row.indexOf(e.y)||i.cell&&0<=i.cell.indexOf(e.s)||Render.show_input(e,r.info())}),t.off("keydown",":input").on("keydown",":input",function(t){13==t.keyCode&&$(this).blur()}),t.off("blur",":input").on("blur",":input",function(){var t,e=$(this).val(),i=r.info(),a=Table.co_info(i,$(this));e=isnull(e)?i.row[a.row].default_value:e;(t=!1,isnull(e)&&a.x&&a.y&&(c.col&&0<=c.col.indexOf(a.x)&&Util.required(s,a,i,"col")||c.row&&0<=c.row.indexOf(a.y)&&Util.required(s,a,i,"row")||c.cell&&0<=c.cell.indexOf(a.s)&&Util.required(s,a,i,"cell"))&&(t=!0),t)||(r.save_cell(a,e),(!a.x&&a.y||a.x&&!a.y)&&(r.reinfo(),r.listen(),r.register()),l.edittime&&Table.save_table(n,r.Data.get()))}),i.header||t.off("click",".excel_handler").on("click",".excel_handler",function(t){t.preventDefault()||t.stopPropagation();var e=$(this).data("action"),i=r.Data.get(),a=!1;e&&Handler[e]instanceof Function&&(a=Handler[e](i,$(this)))&&(l.ndata=a.ndata,r.Data.set(a.ndata),r.reinfo(),r.fresh(a.scroll),l.edittime&&Table.save_table(n,r.Data.get()))});var e=n.attr("id"),a=n.closest("form").attr("id"),f=proxyForm.create(a);f.clear(e),f.listen(e,function(){return Table.save_table(n,r.Data.get()),!0}),c.col&&c.col.forEach(function(l){f.listen(e,function(){for(var t=!0,e=r.Data.get(),i=0;i<e.data.length;i++){var a=e.data[i]["f"+(l-1)];if(isnull(a)){var n=Table.co_info(o,[l,i+1],s);Util.required(s,n,r.info(),"col",!0),t=!1;break}}return t})}),c.row&&c.row.forEach(function(l){f.listen(e,function(){for(var t=!0,e=r.Data.get(),i=1;i<e.cols.length;i++){var a=e.data[l-1]["f"+(i-1)];if(isnull(a)){var n=Table.co_info(o,[i,l],s);Util.required(s,n,r.info(),"row",!0),t=!1;break}}return t})}),c.cell&&c.cell.forEach(function(a){f.listen(e,function(){var t=!0,e=Table.co_info(o,a,s),i=r.Data.get().data[e.row][e.field];return isnull(i)&&(Util.required(s,e,r.info(),"cell",!0),t=!1),t})})},ExcelTable.pt.save_cell=function(t,e){"string"==typeof e||(e=String(e));var i=this.setting,a=(this.info(),this.Data.get());"title"==t.field?a.title=e:t.x&&t.y?a.data[t.row][t.field]=e:t.x||t.y?t.x?(a.cols[t.x].title=e,a.info.col[t.x-1]=e):(a.data[t.row][t.field]=e,a.info.row[t.row].text=e):(a.cols[t.x].title=e,a.info.head=e),this.Data.set(a),i.ndata=a,Table.save_cell(t.elem,t.x&&t.y?Util.format_value(t.info,e):e),t.x&&t.y&&this.calcEvent&&this.calcEvent.emit(t.s)},ExcelTable.pt.register=function(){var n=this,l=this.info(),t=l.calculate,e=l.verify,i=this.elem,a=i.attr("id"),r=i.next(".layui-table-view");if(this.calcEvent=proxyEvent.create(a),this.calcEvent.clear(),t&&t.forEach(function(t){if(t){var i=Util.parseEquation(t),e=Util.parseCalc(i.calc),a=function(){var t=Util.calc(r,i.calc,n.info()),e=Table.co_info(l,i.target,r);n.save_cell(e,t)};n.calcEvent.on(i.target,a),e.forEach(function(t){n.calcEvent.on(t,a)})}}),e)for(var o=i.closest("form").attr("id"),c=proxyForm.create(o),s=0;s<e.length;s++)if(e[s]){var f=Util.parseEquation(e[s]);c.listen(a,function(){return Util.verify(r,f.target,f.calc,n.info())})}},Excel.prototype={init:function(t){if(t.info=this.info(t.info),t.dynamic&&t.dynamic.infos)for(var e in t.dynamic.infos)t.dynamic.infos[e]=this.info(t.dynamic.infos[e]);var i=$.extend(!0,{},this._options,t),a=i.elem instanceof $?i.elem:$(i.elem);a.length?1<a.length?a.each(function(){proxyExcel.create($(this).attr("id"),$.extend(!0,i,{elem:$(v)}))}):proxyExcel.create(a.attr("id"),i):warn("The element of `"+(i.elem instanceof $?i.elem.selector:i.elem)+"` is not found.")},info:function(t){return t.col&&!t.col.length&&(t.col=[UNNAMED,UNNAMED,UNNAMED]),t.row&&!t.row.length&&(t.row=function(){for(var t=0,e=[];t<3;t++)e.push(p(ROW_INFO,{text:UNNAMED}));return e}()),t}},new Excel});
function fixed_table(a,i,l){if(null!=a[0]){var t=layui.table;if(null==i.data)var e=get_tbody_data(a);else e=i.data;a.find("tbody").remove();var n=a.data("height"),r=a.attr("data-x");null==r&&(r=0);var o=a.attr("data-y");null==o&&(o=0);var d=a.attr("lay-filter"),s="auto",f=a.parent().width()-150;20<e.length&&(s="838");var h=a.find("thead>tr>th:gt(0)").length;(f=Math.floor(f/h))<120&&(f=120),a.find("thead>tr>th:gt(0)").each(function(t){$(this).attr("lay-data","{field:'f"+t+"',align:'center',width:"+f+"}")}),t.init(d,{height:n||s,data:e,done:function(){var t=a.parent().find(".layui-table-view"),e=t.find("thead>tr:first>th:gt(0)");l||e.each(function(t){if("layui-table-patch"==e.eq(t).attr("class"))return!0;e.eq(t).find("span").html();e.eq(t).find("span").parent().append('<a class="isview" style="position:absolute;right:10px;" href="javascript:;" data-remove data-delcol><i class="layui-icon pull-right">&#x1006;</i></a>')}),t.parent().find(".isview:not(a)").hide(),t.parent().find("a.isview").css("z-index",-1),"view"!=i.show&&(t.parent().find(".isview:not(a)").show(),t.children(".layui-table-header").find("a.isview").css("z-index",0));var n=t.find(".layui-table-fixed .layui-table-body tbody>tr"),d=t.closest(".div_tab").attr("data-ellipsis");null==d&&(d=1),t.find("[data-field]").each(function(){var t=$(this).attr("data-field");if("investor"==t){var e=$(this).find("span").html();return $(this).find("span").attr("title",e),void $(this).addClass("c_relative")}if("investor"!=t&&0<$(this).closest("thead").length){e=$(this).find("span").html();return $(this).find("span").attr("title",e),void $(this).addClass("c_relative")}e=$(this).find("div").html();if($(this).find("div").attr("title",e),0==d){cell_css($(this).find("div"));var a=$(this).closest("tr").index(),i=(n.eq(a).find("div"),$(this).height());Math.ceil((i-27)/2);0==a&&i++}format_table_td($(this),e)}),setTimeout(function(){t.find(".layui-table-main").scrollLeft(r).scrollTop(o)},0)}})}}function get_tbody_data(t){var n=[];if(0<t.closest(".layui-table-view").length){var d=(t=t.closest(".layui-table-view")).find(".layui-table-fixed").find(".layui-table-body").find("tbody>tr"),l=t.find(".layui-table-main").find("tbody>tr");if(0==d.length||0==l)return[];d.each(function(t){var e=d.eq(t).find("td").eq(0),a={};a.investor=e.find("div").html();var i=l.eq(t).find("td:gt(0)");i.each(function(t){a["f"+t]=i.eq(t).find("div").html()}),n.push(a)})}else{var i=t.find("tbody>tr");if(0==i.length)return[];n=[];i.each(function(t){var e=i.eq(t).find("td"),a={};a.investor=e.eq(0).html(),(e=i.eq(t).find("td:gt(0)")).each(function(t){a["f"+t]=e.eq(t).html()}),n.push(a)})}return n}function cell_css(t,e){var a={"word-wrap":"break-word","word-break":"break-all","text-overflow":"clip","white-space":"normal",height:"auto","line-height":"normal","text-align":"left","vertical-align":"middle",overflow:"auto","padding-left":"5px","padding-right":"5px"};a=$.extend(a,e),t.removeClass(".layui-table-cell"),t.css(a)}function fresh_optable(t,e,a,i,n){null!=a&&null!=a&&"object"==typeof a||(a=["x","y"]);var d={};"x"==a[0]&&(d.x=t.find(".layui-table-main").scrollLeft()),"0"==a[0]&&(d.x=0),"max"==a[0]&&(d.x=t.find(".layui-table-main").find("table").width()),"y"==a[1]&&(d.y=t.find(".layui-table-main").scrollTop()),"0"==a[1]&&(d.y=0),"max"==a[1]&&(d.y=t.find(".layui-table-main").find("table").height()),$pdiv=t.parent(),$nthis=$pdiv.find(".layui-table-view").find(".layui-table-main").find("table"),$othis=$pdiv.find("table:first"),$othis.show(),e.data=get_tbody_data($nthis),"function"==typeof i&&(e.data=i(e.data)),t.remove(),null!=d.x&&0!=d.x?$othis.attr("data-x",d.x):$othis.removeAttr("data-x"),null!=d.y&&0!=d.y?$othis.attr("data-y",d.y):$othis.removeAttr("data-y"),$othis.opTable(e),n||save_d2($othis)}function show_input(r,o){if(!(0<r.find(":input").length)&&0!=r.find("div,span").length){var t=r.closest(".layui-table-view").parent().attr("data-cf"),e=r.closest("tr").find(".tablerow").attr("data-id");null==e&&(e=r.closest(".layui-table-view").parent().attr("data-id"));var a={};0<r.index()&&(null!=t&&(a.key=t),null!=e&&(a.id=e)),$.post("?/data/render_item",a,function(t){var e=(r.width()+r.outerWidth())/2,a=0;if(r.css({padding:"0px"}),0<r.find("span").length){var i=r.find("span").html();a=r.height()}else{i=format_table_td_input(r);var n=r.closest(".layui-table-view").find(".layui-table-fixed .layui-table-body tbody>tr"),d=r.closest("tr").index();a=n.eq(d).find("td").height()}if(r.find("div").hide(),r.append(t.html),r.find(":input").val(i),0<a&&1!=r.closest(".div_tab").attr("data-ellipsis")&&0==r.closest(".layui-table-header").length&&(a+=10),r.find(":input").css({width:e+"px"}),"select"==t.type&&(form.render("select"),r.find("select").parent().find("input").css({width:e+"px"})),r.find("input").focus(),0<r.find("select").length&&form.on("select",function(t){save_d(r,t.value,o)}),0<r.find("[data-laydate]").length){var l=r.find("[data-laydate]").attr("data-laydate");laydate.render({elem:r.find("[data-laydate]")[0],type:l,trigger:"click",done:function(t,e){save_d(r,t)}})}})}}function format_table_td(t,e){var a=t.closest("tr").find(".tablerow").attr("data-type");if(0<t.find("span").length)t.find("span").html(e),t.find("span").attr("title",e);else{switch(a){case"amount":case"percent":case"yuan":case"wan":case"yi":case"dollar":case"currency":case"money":case"million2":void 0!==e&&""!=e&&(e=parseFloat(e.replace(/,/g,"")),e=number_format(e,2,".",","))}t.find("div").html(e),t.find("div").attr("title",e)}}function format_table_td_input(t){var e=t.closest("tr").find(".tablerow").attr("data-type"),a=t.find("div").html();switch(e){case"amount":case"percent":case"yuan":case"wan":case"yi":case"dollar":case"currency":case"money":case"million2":void 0!==a&&""!=a&&(a=a.replace(/,/g,""))}return a}function save_d(i,n,d){i.find("input").val(n);var l=i.closest(".layui-table-view"),t=i.closest(".layui-table-view").parent().find("[data-op]"),e=t.attr("data-kid"),a=t.attr("data-fid"),r=get_table_data(l);r.kid=e,r.fid=a;$.post("?/data/save",r,function(t){i.find("div").show(),i.find(":input").remove(),format_table_td(i,n);var e=l.find(".layui-table-fixed").find(".layui-table-header").find("th");l.parent().find("table").eq(0).find("thead th").eq(0).html(e.find("span").html());var a=l.children(".layui-table-header").find("th");if(l.parent().find("table").eq(0).find("thead th").each(function(t){$(this).find("span").html(a.eq(t).find("span").html())}),i.removeAttr("style"),"view"==d&&(l.parent().find(".isview:not(a)").hide(),l.parent().find("a.isview").css("z-index",-1)),0==i.find("span").length)l.find(".layui-table-fixed .layui-table-body tbody>tr"),i.closest("tr").index(),i.height()})}function save_d2(t,e){var a=t.parent().find(".layui-table-view"),i=t.attr("data-kid"),n=t.attr("data-fid"),d=get_table_data(a);d.kid=i,d.fid=n;$.post("?/data/save",d,function(t){"function"==typeof e&&e()})}function get_table_data(i){var n={data:[]};n.key=i.parent().attr("data-cf");var a={};return a.id=i.parent().attr("data-id"),a.name=get_v(i.find(".layui-table-fixed").find(".layui-table-header").find("tr:first>th:first")),null!=i.parent().attr("data-unit")&&(a.unit=i.parent().attr("data-unit")),a.val=[],i.children(".layui-table-header").find("th[data-field]:gt(0)").each(function(t){var e=get_v($(this));a.val.push(e)}),n.data.push(a),i.find(".layui-table-fixed").find("tbody>tr").each(function(t){var e={},a=get_v($(this).find("td").eq(0));"[鏈懡鍚峕"==a&&(a=""),e.name=a,e.id=$(this).find(".tablerow").attr("data-id"),null!=$(this).find(".tablerow").attr("data-unit")&&(e.unit=$(this).find(".tablerow").attr("data-unit")),e.val=[],i.find(".layui-table-main").find("tbody>tr").eq(t).find("td:gt(0)").each(function(){var t=get_v($(this));"&nbsp;"==t&&(t=""),e.val.push(t)}),n.data.push(e)}),n}function get_v(t){if(0<t.find("input").length)return $.trim(t.find("input").val());if(0<t.find("select").length)return $.trim(t.find("select").val());0<t.find("span").length?t=t.find("span"):0<t.find("div").length&&(t=t.find("div"));var e=$.trim(t.html());return null!=t.closest("layui-table-view").parent().attr("data-unit")&&(e=e.split(" ")[0]),e}function fixed_captable(t,e){"view"==e.show&&t.find(".isview").hide(),t.find("th,td").css({padding:"7px 9px"}),t.find(".isview th,.isview td,th.isview,td.isview").css({padding:"0px"});var a={bAutoWidth:!0,sDom:'<"top"i>rt<"bottom"flp><"clear">',bPaginate:!1,sPaginationType:"full_numbers",iDisplayLength:10,bSort:!1,bFilter:!1,bInfo:!1,bStateSave:!1,iCookieDuration:0,bScrollAutoCss:!0,bProcessing:!0,bJQueryUI:!1,sScrollY:"360px",sScrollX:"100%",bScrollCollapse:!0},i=80*t.find("thead>tr:last>[data-captable]").length+151;i<=Number(t.width())?a.sScrollXInner="100%":a.sScrollXInner=i+"px",a.fixedColumns={iLeftColumns:1,iRightColumns:4},t.DataTable(a);var n=t.closest(".DTFC_ScrollWrapper").find(".DTFC_RightFootWrapper").find("tr>td:first");n.css("width",Number(n.width())-1)}function remove_fixed_table(t,e){var a=t.closest(".dataTables_wrapper").prev();if(1==a.length)t.closest(".dataTables_wrapper").replaceWith(e),t=a.next("table");else{var i=t.closest(".dataTables_wrapper").parent();t.closest(".dataTables_wrapper").replaceWith(e),t=i.find("table:first")}return t}function get_captable_data(r,o,s){var t=r.closest(".DTFC_ScrollWrapper");null==o&&(o=""),$ths=t.find(".dataTables_scrollHead").find("tr:first>.th_col");var f={};$others=t.find(".DTFC_LeftWrapper,.dataTables_scrollHead").find("[data-captable]"),$others.each(function(){var t=$(this).attr("data-captable");if(null!=f[t])return!0;if(1==$(this).find("input").length)var e=$.trim($(this).find("input").val());else e=$(this).html();f[t]=e}),f.col=[],$ths.each(function(){if(1==$(this).find("input").length)var t=$.trim($(this).find("input").val());else t=$(this).find("span").html();"[鏈懡鍚峕"==t&&(t=""),f.col.push(t)});var e=t.find(".DTFC_LeftBodyWrapper").find("tbody>tr"),h=t.find(".dataTables_scrollBody").find("tbody>tr");return f.data=[],e.each(function(t){if(0==h.eq(t).find(".td_data").length)return!0;var e=$(this).attr("data-uuid"),a={};if(1==$(this).find(".th_row input").length)var i=$.trim($(this).find(".th_row input").val());else if(1==$(this).find(".th_row select").length){i=o;e=s}else i=$(this).find(".th_row span").html();"[鏈懡鍚峕"==i&&(i=""),a.name=i,a.uuid=e;var n=[];h.eq(t).find(".td_data").each(function(t){if(1==$(this).find("input").length)var e=$.trim($(this).find("input").val());else e=$.trim($(this).html());"&nbsp;"==e&&(e=""),-1!=e.indexOf("$")&&(e=e.substr(0,e.length-1)),t%2==0?n.push([e]):n[n.length-1].push(e)});var d=get_arr_total(a.val=n);0==d[0]&&(d[0]=""),0==d[1]&&(d[1]=""),a.total=d;var l=get_val_percent(r,d[0]);a.percent=0==l?"":l,f.data.push(a)}),f}function get_arr_total(t){var e=[0,0],a=t.length;if(0==a)return e;for(var i=0;i<a;i++)e[0]=FloatAdd(e[0],t[i][0]),e[1]=FloatAdd(e[1],t[i][1]);return e}function FloatAdd(t,e){var a,i,n,d;""!=t&&null!=t||(t=0),""!=e&&null!=e||(e=0);try{a=t.toString().split(".")[1].length}catch(t){a=0}try{i=e.toString().split(".")[1].length}catch(t){i=0}if(d=Math.abs(a-i),n=Math.pow(10,Math.max(a,i)),0<d){var l=Math.pow(10,d);e=i<a?(t=Number(t.toString().replace(".","")),Number(e.toString().replace(".",""))*l):(t=Number(t.toString().replace(".",""))*l,Number(e.toString().replace(".","")))}else t=Number(t.toString().replace(".","")),e=Number(e.toString().replace(".",""));return(t+e)/n}function get_val_percent(t,e){var a=0;if(t.find("tr:gt(1)").each(function(){if(0==$(this).find(".td_data").length)return!0;$(this).find(".td_data:even").each(function(){if(0<$(this).find("input").length)var t=$.trim($(this).find("input").val());else t=$(this).html();"&nbsp;"!=t&&""!=t||(t=0),-1!=t.toString().indexOf("$")&&(t=t.substr(0,t.length-1)),a=FloatAdd(a,t)})}),0==a)var i="";else i=(e/a*100).toFixed(2);return 1==isNaN(i)&&(i=""),i}function fresh_captable(e,a){get_tab_html(e,"captable",function(t){remove_fixed_table(e,t).opCapTable(a)})}function get_tab_html(t,e,a){var i={};i.fid=t.attr("data-fid"),i.kid=t.attr("data-kid"),i.type=e,$.post("?/entity/get_html/",i,function(t){"function"==typeof a&&a(t)},"html")}function drag_captable(o,s){o.closest(".DTFC_ScrollWrapper").find(".dataTables_scrollBody table>tbody").tableDnD({onDragStart:function(t,e){$(t).attr("data-rowindex",$(e).index())},onDragStop:function(t,e){var a=$(t).attr("data-rowindex"),i=$(e).index();if(a!=i){var n=(l=o.closest(".DTFC_ScrollWrapper").find(".DTFC_LeftBodyWrapper table>tbody>tr")).eq(a).prop("outerHTML"),d=l.eq(i).prop("outerHTML");l.eq(i).replaceWith(n),l.eq(a).replaceWith(d);var l;n=(l=o.closest(".DTFC_ScrollWrapper").find(".DTFC_RightBodyWrapper table>tbody>tr")).eq(a).prop("outerHTML"),d=l.eq(i).prop("outerHTML");l.eq(i).replaceWith(n),l.eq(a).replaceWith(d);var r=get_captable_data(o);r.kid=o.attr("data-kid"),r.fid=o.attr("data-fid");$.post("?/data/save_captable",r,function(t){fresh_captable(o,s)})}else $(t).removeAttr("data-rowindex")}}),o.closest(".DTFC_ScrollWrapper").find(".DTFC_LeftBodyWrapper table>tbody").tableDnD({onDragStart:function(t,e){$(t).attr("data-rowindex",$(e).index())},onDragStop:function(t,e){var a=$(t).attr("data-rowindex"),i=$(e).index();if(a!=i){var n=(l=o.closest(".DTFC_ScrollWrapper").find(".dataTables_scrollBody table>tbody>tr")).eq(a).prop("outerHTML"),d=l.eq(i).prop("outerHTML");l.eq(i).replaceWith(n),l.eq(a).replaceWith(d);var l;n=(l=o.closest(".DTFC_ScrollWrapper").find(".DTFC_RightBodyWrapper table>tbody>tr")).eq(a).prop("outerHTML"),d=l.eq(i).prop("outerHTML");l.eq(i).replaceWith(n),l.eq(a).replaceWith(d);var r=get_captable_data(o);r.kid=o.attr("data-kid"),r.fid=o.attr("data-fid");$.post("?/data/save_captable",r,function(t){fresh_captable(o,s)})}else $(t).removeAttr("data-rowindex")}})}function show_fixed_view_captable(t,a,l){var i=remove_fixed_table(t,a);i.find(".isview").hide(),fixed_captable(i,l),"iedit"==l.show&&(l.show="view"),i.closest(".dataTables_wrapper").off("click").on("click",function(t){if("view"==l.show&&1==l.editable){l.show="iedit";var e=remove_fixed_table(i,a);e.find(".isview").show();var n=e.attr("data-kid"),d=e.attr("data-fid");e.opCapTable(l),$("body").off("click").on("click",function(t){if(null!=l.show){var e=t||window.event,a=e.srcElement||e.target;if(!(0<$(a).closest(".dataTables_wrapper").length)){l.show="view";var i=$("table[data-kid="+n+"][data-fid="+d+"]").eq(0);get_tab_html(i,"captable",function(t){show_fixed_view_captable(i,t,l)})}}})}})}function fixed_caphd(d,l){if(null!=d[0]){var t=layui.table,e=get_tab_data(d);if(0!=e){d.find("tbody").remove();var r=d.attr("data-x");null==r&&(r=0);var o=d.attr("data-y");null==o&&(o=0),t.init("caphd",{height:"full-170",data:e,done:function(){var t=d.parent().find(".layui-table-view");if(0!=(a=t.find("thead>tr:eq(1)>th")).length){a.each(function(t){t%4!=0&&t%4!=3||$(this).removeAttr("colspan")});var e=t.find("thead>tr:eq(2)>th");if(0!=e.length){var a;e.each(function(t){t%4!=1&&t%4!=3||$(this).removeAttr("colspan")}),(a=t.find("thead>tr:first>th:gt(0)")).each(function(t){if("layui-table-patch"==a.eq(t).attr("class"))return!0;a.eq(t).find("span").html();"a"==a.eq(t).attr("data-field").split("_")[1][0]?$act_col=' data-delcol="add" ':$act_col=" data-delcol ",a.eq(t).find("span").parent().append('<a class="isview" href="javascript:;" data-remove'+$act_col+'><i class="layui-icon pull-right">&#x1006;</i></a>')});var i="#f8f8f8",n="#00DA48";t.find("thead").find("[data-field$=h0]").css({background:i}),t.find("tbody").find("[data-field$=b0]").css({background:i}),t.find("thead").find("[data-field$=h1]").css({background:"#fec"}),t.find("tbody").find("[data-field$=b1]").css({background:"#fec"}),t.find("[data-field]").each(function(){var t=$(this).attr("data-field"),e=t.substr(t.length-2,2);if("h0"!=e&&"h1"!=e&&"investor_b1"!=t){if("b0"==e||"b1"==e){i=$(this).find("div").html();$(this).find("div").attr("title",i)}}else{var a=90;"investor_b1"==t&&(a=100),$(this).find("span").css({display:"inline-block",width:a+"px","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"});var i=$(this).find("span").html();$(this).find("span").attr("title",i)}}),t.find("[data-deltotal]").closest("tr").find("td").css({background:n}),t.find("tbody").find("tr:last").find("td").css({background:n}),t.find(".layui-table-main").find("tbody>tr:last").addClass("nodrop nodrag"),t.find(".layui-table-fixed").find("tbody>tr:last").addClass("nodrop nodrag"),"view"==l.show&&t.parent().find(".isview").hide(),setTimeout(function(){t.find(".layui-table-main").scrollLeft(r).scrollTop(o)},0)}}}})}}}function get_tab_data(t){var e=t.find("tbody>tr");if(0==e.length)return!1;var a=[];return e.each(function(t){var n=e.eq(t).find("td"),d={};d.investor_b1=n.eq(0).html(),n=e.eq(t).find("td:gt(0)");var l=["investment","new_shrs","c","d","e","f"];n.each(function(t){var e=Math.floor(t/6),a=t%6,i=l[a]+e;d[i+=0==a||1==a&&0==e?"_b1":"_b0"]=n.eq(t).html()}),a.push(d)}),a}function get_name_from_f(t){var e=t.replace("_b0","");return e=(e=(e=(e=e.replace("_b1","")).replace("_h0","")).replace("_h1","")).replace("_ah1","")}function save_caphd(t,e){var a=t.parent().find(".layui-table-view"),n={},i=t.attr("data-kid"),d=t.attr("data-fid");n.kid=i,n.fid=d,n.investor=[],n.total_row={},a.find(".layui-table-fixed").find("[data-field^=investor]").each(function(){if(0==$(this).find("a").length&&0==$(this).find("input").length)return!0;var t=1;if(0==$(this).closest("tr").find("[data-delrow]").length&&(t=null!=$(this).attr("data-row")?$(this).attr("data-row"):0),1==t){if(0<$(this).find("input").length)var e=$.trim($(this).find("input").val());else"[鏈懡鍚峕"==(e=$(this).find("span").html())&&(e="");n.investor.push(e)}if((t=0)==$(this).closest("tr").find("[data-deltotal]").length&&(t=null!=$(this).attr("data-row")?$(this).attr("data-row"):1),0==t){if(0<$(this).find("input").length)e=$.trim($(this).find("input").val());else e=$(this).find("span").html();for(""==e&&(e="灏忚琛�"),$tr=$(this).closest("tr");0<$tr.find("[data-deltotal]").length||0<$tr.find("[data-row]").length;)$tr=$tr.prev("tr");var a=0;$tr.prevAll("tr").each(function(){0<$(this).find("[data-deltotal]").length&&a++});var i=$tr.index()-a;i++,null==n.total_row[i]&&(n.total_row[i]=[]),n.total_row[i].push(e)}}),n.new_shrs=[],a.find(".layui-table-main").find("[data-field^=new_shrs0]").each(function(){if(0==$(this).closest("tr").find("[data-delrow]").length)return!0;if(0<$(this).find("input").length)var t=$.trim($(this).find("input").val());else t=$(this).find("div").html();n.new_shrs.push(get_num(t))}),n.item=[];for(var l=a.children(".layui-table-header").find("tr:first").find("[data-field^=round]").length,r=0;r<l;r++){var o,s={};0<(o=a.children(".layui-table-header").find("[data-field^=round]").eq(r)).find("input").length?s.round=$.trim(o.find("input").val()):s.round=o.find("span").html(),0<(o=a.children(".layui-table-header").find("[data-field^=date]").eq(r)).find("input").length?s.date=$.trim(o.find("input").val()):s.date=o.find("span").html(),0<(o=a.children(".layui-table-header").find("[data-field^=pre_money]").eq(r)).find("input").length?s.pre_money=get_num($.trim(o.find("input").val())):s.pre_money=get_num(o.find("span").html()),0<(o=a.children(".layui-table-header").find("[data-field^=exrate]").eq(r)).find("input").length?s.exrate=get_num($.trim(o.find("input").val())):s.exrate=get_num(o.find("span").html()),s.investment=[];var f=a.find(".layui-table-main").find("tr");f.each(function(t){var e=f.eq(t);if(0==e.find("[data-delrow]").length)return!0;var a=e.find("[data-field^=investment]").eq(r);0<a.find("input").length?s.investment.push(get_num($.trim(a.find("input").val()))):s.investment.push(get_num(a.find("div").html()))}),n.item.push(s)}$.post("?/data/save_caphd",n,function(t){"function"==typeof e&&e()})}function get_num(t){return null==t?"":(t=t.toString().replace(/\,/g,""),t=Number(t))}function fresh_caphd(a,i){get_tab_html(a,"captable_hd",function(t){var e=remove_fixed_tab(a,t);e.opCapHd(e,i)})}function remove_fixed_tab(t,e){var a=t.parent(),i=a.find(".layui-table-main").scrollLeft(),n=a.find(".layui-table-main").scrollTop();return e=(e=e.replace(/^\<div.+?\>/,"")).replace(/\<\/div\>$/,""),a.html(e),(t=a.find("table")).attr({"data-x":i,"data-y":n}),t}function NumberToChinese(t){if(0==t)return"闆�";for(var e=["闆�","涓€","浜�","涓�","鍥�","浜�","鍏�","涓�","鍏�","涔�"],a=["","鍗�","鐧�","鍗�","涓�","浜�","鍏�"],i="",n=!1,d=0;d<t.toString().length;d++){if(0<d)var l=Math.floor(t%Math.pow(10,d+1)/Math.pow(10,d));else l=Math.floor(t%10);if(1!=n||0!=l)if(n=0==l){if(""==i)continue;i=e[l]+i}else i=e[l]+a[d]+i}return"涓€鍗�"==i&&(i="鍗�"),i}function drag_caphd(r,o,s){var f=r.parent().find(".layui-table-view"),h=function(){f.find(".layui-table-main").find("table>tbody").tableDnD({onDragStart:function(t,e){$(t).attr("data-rowindex",$(e).index())},onDragStop:function(t,e){var a=$(t).attr("data-rowindex"),i=$(e).index();if(a!=i){var n=f.find(".layui-table-fixed").find(".layui-table-body").find("table>tbody>tr"),d=n.eq(a).prop("outerHTML"),l=n.eq(i).prop("outerHTML");n.eq(i).replaceWith(d),n.eq(a).replaceWith(l),c(),"function"!=typeof s?save_caphd(r,function(){fresh_caphd(r,o)}):s(r,o)}else $(t).removeAttr("data-rowindex")}})},c=function(){f.find(".layui-table-fixed").find(".layui-table-body").find("table>tbody").tableDnD({onDragStart:function(t,e){$(t).attr("data-rowindex",$(e).index())},onDragStop:function(t,e){var a=$(t).attr("data-rowindex"),i=$(e).index();if(a!=i){var n=f.find(".layui-table-main").find("table>tbody>tr"),d=n.eq(a).prop("outerHTML"),l=n.eq(i).prop("outerHTML");n.eq(i).replaceWith(d),n.eq(a).replaceWith(l),h(),"function"!=typeof s?save_caphd(r,function(){fresh_caphd(r,o)}):s(r,o)}else $(t).removeAttr("data-rowindex")}})};h(),c()}$(function(f){f.fn.extend({opTable:function(s){return null==s&&(s={}),this.each(function(){var t=f(this),n=(t.data("kid"),t.data("fid"),t.parent().html(),t.data("freeze")),e=!!(e=!!(e=t.attr("freeze_col"))&&e.split(","))&&e.map(function(t){return parseInt(t)}),a=!!(a=!!(a=t.attr("freeze_row"))&&a.split(","))&&a.map(function(t){return parseInt(t)});JSON.parse(t.attr("express"));fixed_table(t,s,n);var o=t.parent().find(".layui-table-view");if(0!=t.height()){if(!navigator.userAgent.match(/mobile/i)){var i=null;f(window).off("resize").on("resize",function(){i&&clearTimeout(i),i=setTimeout(function(){fresh_optable(o,s,void 0,void 0,!0)},500)}),o.length&&o[0].addEventListener("DOMNodeRemovedFromDocument",function(){clearTimeout(i)})}o.off("click").on("click",function(t){"view"==s.show&&1==s.editable&&(s.show=0,o.parent().find(".isview:not(a)").show(),o.children(".layui-table-header").find("a.isview").css("z-index",0))}),f("body").off("click.ex").on("click.ex",function(t){f(".layui-table-tips").hide(),0==s.show&&1==s.editable&&(0<f(t.target).closest(".layui-table-view").length||"A"!=t.target.nodeName&&(s.show="view",o.parent().find(".isview:not(a)").hide(),o.parent().find("a.isview").css("z-index",-1)))});var d=0;o.on("click","[data-field]",function(t){if("view"!=s.show&&"INPUT"!=t.target.nodeName&&!(n&&(f(t.target).closest(".layui-table-header").length||f(t.target).closest(".layui-table-fixed").length)||e&&f(t.target).closest(".layui-table-main").length&&0<=e.indexOf(f(t.target).closest("td").index())||a&&f(t.target).closest(".layui-table-main").length&&0<=a.indexOf(f(t.target).closest("tr").data("index")))){if("-1"==f(t.target).closest("[data-field]").find("[data-delrow]").css("z-index"))return f(t.target).closest("[data-field]").find("a").css("z-index",0),void(d=0);if(1==d&&0<f(t.target).closest("[data-field]").find("[data-delrow]").length)return f(t.target).closest("[data-field]").find("a").css("z-index",0),void(d=0);d=0,show_input(f(t.target).closest("[data-field]"),s.show)}}),o.on("blur","input",function(){navigator.userAgent.match(/mobile/i)&&(d=1);var t=f(this),e=t.val();save_d(f(t).closest("[data-field]"),e,s.show)}),o.parent().find(".add_row").off("mousedown").on("mousedown",function(){fresh_optable(o,s,["x","max"],function(t){for(var e={},a=o.children(".layui-table-header").find("th[data-field]").length,i=0;i<a;i++)0==i?(rowhtml=n?"":'<a class="isview" style="background:#f2f2f2;position:absolute;right:35px;" href="javascript:;" data-uprow><i class="layui-icon">&#xe619;</i></a><a class="isview" style="background:#f2f2f2;position:absolute;right:20px;" href="javascript:;" data-downrow><i class="layui-icon">&#xe61a;</i></a><a class="isview" style="position: absolute; right: 5px; z-index: 1;" href="javascript:;" data-delrow=""><i class="layui-icon">&#x1006;</i></a>',e.investor='<div class="tablerow"><span>[鏈懡鍚峕</span>'+rowhtml+"</div>"):e["f"+(i-1)]="";return t.push(e),t})}),o.find("[data-delrow]").on("click",function(t){if(t.stopPropagation(),1!=o.find(".layui-table-fixed").find("[data-delrow]").length){var e=f(this).closest("tr").index();fresh_optable(o,s,["x","y"],function(t){return t.splice(e,1),t})}else layer.msg("璇疯嚦灏戜繚鐣欎竴琛�")}),o.parent().find(".add_col").off("mousedown").on("mousedown",function(){var t=o.parent();$othis=t.find("table:first");var a=$othis.find("tr:first>th").length-1;$othis.find("tr").eq(0).find("th:last").after("<th lay-data=\"{field:'f"+a+"',align:'center',width:120}\"><span style=\"display:inline-block;\">[鏈懡鍚峕</span></th>"),fresh_optable(o,s,["max","y"],function(t){if(0==t.length)return t;for(var e in t)t[e]["f"+a]="";return t})}),o.find("[data-delcol]").on("click",function(t){if(t.stopPropagation(),1!=o.children(".layui-table-header").find("[data-delcol]").length){var r=f(this).closest("[data-field]").index(),e=o.parent();$othis=e.find("table:first"),$othis.find("tr").eq(0).find("th").eq(r).remove(),r--;var a=$othis.find("tr:first>th:gt("+r+")");0<a.length&&a.each(function(t){var e=r+t;o.children(".layui-table-header").find("tr:first").find("[data-field]:gt(0)").eq(e).attr("data-field");f(this).attr("lay-data","{field:'f"+e+"',align:'center',width:120}")}),fresh_optable(o,s,["x","y"],function(t){for(var e in t){var a=t[e],i={};for(var n in a){var d=a[n];if("investor"!=n){var l=Number(n.substr(1));l<r?(i[n]=d,0):l!=r&&r<l&&(i["f"+(l-1)]=a["f"+l],0)}else i[n]=d}t[e]=i}return t})}else layer.msg("璇疯嚦灏戜繚鐣欎竴鍒�")}),o.find("[data-uprow]").on("click",function(t){t.stopPropagation();var e=o.find(".layui-table-fixed").find(".layui-table-body").find("table>tbody>tr"),a=f(this).closest("tr"),i=a.index();if(0!=i){var n=a.prev("tr"),d=a.prop("outerHTML"),l=n.prop("outerHTML");e.eq(i).replaceWith(l),e.eq(i-1).replaceWith(d);var r=o.find(".layui-table-main").find("table>tbody>tr");d=r.eq(i).prop("outerHTML"),l=r.eq(i-1).prop("outerHTML");r.eq(i-1).replaceWith(d),r.eq(i).replaceWith(l),fresh_optable(o,s)}}),o.find("[data-downrow]").on("click",function(t){t.stopPropagation();var e=o.find(".layui-table-fixed").find(".layui-table-body").find("table>tbody>tr"),a=f(this).closest("tr"),i=a.index();if(i!=e.length-1){var n=a.next("tr"),d=a.prop("outerHTML"),l=n.prop("outerHTML");e.eq(i).replaceWith(l),e.eq(i+1).replaceWith(d);var r=o.find(".layui-table-main").find("table>tbody>tr");d=r.eq(i).prop("outerHTML"),l=r.eq(i+1).prop("outerHTML");r.eq(i+1).replaceWith(d),r.eq(i).replaceWith(l),fresh_optable(o,s)}}),o.find("[data-delrow]").closest("tr").on("mouseover",function(){"view"!=s.show&&f(this).find("a.isview").css("z-index",0)}),o.find("[data-delrow]").closest("tr").on("mouseout",function(){"view"!=s.show&&f(this).find("a.isview").css("z-index",-1)})}else{var l=setInterval(function(){l&&0<t.height()&&(clearInterval(l),fresh_optable(o,s,void 0,void 0,!0))},100);o.length&&o[0].addEventListener("DOMNodeRemovedFromDocument",function(){clearInterval(l)})}})}})}),$(function(f){f.fn.extend({opExcel:function(s){return null==s&&(s={}),null==s.show&&(s.show=0),null==s.editable&&(s.editable=0),this.each(function(){var o=f(this);o.on("click","td",function(){if("view"==s.show&&0!=s.editable){var t=f(this),e=Number(t.index()),a=Number(t.closest("tr").index()),i=Number(o.attr("data-top-rows")),n=Number(o.attr("data-left-cols")),d=o.attr("data-kid"),l=o.attr("data-fid"),r="?/data/view/pm_"+d+"_"+l;o.parent().load(r,{row:a+i,col:e+n,kid:d,fid:l,show:s.show,editable:s.editable})}})})}})}),$(function(v){v.fn.extend({opCapTable:function(u){return null==u&&(u={}),this.each(function(){var c=v(this),t=c.attr("data-kid"),e=c.attr("data-fid"),p=c.prop("outerHTML");if(fixed_captable(c,u),0!=c.height()){var a=null;v(window).off("resize").on("resize",function(){a&&clearTimeout(a),a=setTimeout(function(){remove_fixed_table(v("table[data-kid="+t+"][data-fid="+e+"]").eq(0),p).opCapTable(u)},500)}),c.closest(".DTFC_ScrollWrapper").find(".DTFC_LeftFootWrapper").on("mousedown","[data-addrow]",function(){var t=remove_fixed_table(c,p),e=t.find("tr:first>th").length-4,a=(t.find("tr").length,"<tr>");if(a+='<td class="th_row" style="background:#f8f8f8;padding:10px;text-align:center;"><span>[鏈懡鍚峕</span><a class="pull-right isview" href="javascript:;" data-remove data-delrow="add"><i class="layui-icon">&#x1006;</i></a></td>',0<e)for(var i=0;i<2*e;i++)a+='<td class="td_data" style="padding:10px;">&nbsp;</td>';a+='<td style="padding:10px;background:#E5F2F9;" class="isview">&nbsp;</td>',a+='<td style="padding:10px;">&nbsp;</td>',a+='<td style="padding:10px;">&nbsp;</td>',a+='<td style="padding:10px;">&nbsp;</td>',a+="</tr>",t.find("tbody>tr:last").after(a),t.opCapTable(u)}),c.closest(".DTFC_ScrollWrapper").find(".DTFC_LeftBodyWrapper").on("mousedown","[data-delrow]",function(t){if(t.stopPropagation(),1!=c.closest(".DTFC_ScrollWrapper").find(".DTFC_LeftBodyWrapper").find("tbody>tr").length){var e=v(this).attr("data-delrow"),a=v(this).closest("tr").index(),i=remove_fixed_table(c,p);i.find("tbody>tr").eq(a).remove();var n=i.attr("data-kid"),d=i.attr("data-fid");if(i.opCapTable(u),"add"!=e){var l=v("table[data-kid="+n+"][data-fid="+d+"]").eq(0),r=get_captable_data(l);r.kid=n,r.fid=d;v.post("?/data/save_captable",r,function(t){fresh_captable(l,u)})}}else layer.msg("璇疯嚦灏戜繚鐣欎竴琛�")}),c.closest(".DTFC_ScrollWrapper").find(".DTFC_RightHeadWrapper").on("mousedown","[data-addcol]",function(){var t=remove_fixed_table(c,p),e=t.find("tr"),a=e.length;e.eq(0).find("th:last").prev("th").prev("th").before('<th colspan="2" style="background:#eee;" class="th_col"><span style="display:inline-block;">[鏈懡鍚峕</span><a class="pull-right isview" href="javascript:;" data-remove data-delcol="add"><i class="layui-icon">&#x1006;</i></a></th>');var i=e.eq(1).find("th:last").prev("th").prev("th").html(),n=e.eq(1).find("th:last").prev("th").html();if(e.eq(1).find("th:last").prev("th").prev("th").before('<th style="background:#eee;width:100px;" data-captable="amount">'+i+'</th><th style="background:#eee;width:100px;" data-captable="money">'+n+"</th>"),2<a)for(var d=2;d<a;d++)d==a-1?e.eq(d).find("td:last").prev("td").prev("td").prev("td").before('<td style="padding:10px;"></td><td style="padding:10px;"></td>'):d==a-2?e.eq(d).find("td:last").prev("td").prev("td").prev("td").before('<td style="padding:10px;background:#E5F2F9;" class="isview"></td><td style="padding:10px;background:#E5F2F9;" class="isview"></td>'):e.eq(d).find("td:last").prev("td").prev("td").prev("td").before('<td class="td_data" style="padding:10px;"></td><td class="td_data" style="padding:10px;"></td>');t.opCapTable(u)}),c.closest(".DTFC_ScrollWrapper").find(".dataTables_scrollHead").on("mousedown","[data-delcol]",function(t){if(t.stopPropagation(),1!=c.closest(".DTFC_ScrollWrapper").find(".dataTables_scrollHead").find(".th_col").length){var e=v(this).attr("data-delcol"),a=v(this).closest("th").index(),i=remove_fixed_table(c,p);i.find("tr:first>th").eq(a).remove();var n=v(this).parent().index(),d=i.find("tr"),l=d.length;if(d.eq(1).find("th").eq(2*n).remove(),d.eq(1).find("th").eq(2*n-1).remove(),2<l)for(var r=2;r<l;r++)d.eq(r).find("td").eq(2*n).remove(),d.eq(r).find("td").eq(2*n-1).remove();var o=i.attr("data-kid"),s=i.attr("data-fid");if(i.opCapTable(u),"add"!=e){var f=v("table[data-kid="+o+"][data-fid="+s+"]").eq(0),h=get_captable_data(f);h.kid=o,h.fid=s;v.post("?/data/save_captable",h,function(t){fresh_captable(f,u)})}}else layer.msg("璇疯嚦灏戜繚鐣欎袱鍒�")}),c.closest(".DTFC_ScrollWrapper").on("click",".th_col",function(t){var e=t||window.event,a=e.srcElement||e.target;if(!(0<v(a).closest("a").length))if(0<c.closest(".DTFC_ScrollWrapper").find(":input").length&&0==v(this).closest("td,th").find(":input").length){v(this);c.closest(".DTFC_ScrollWrapper").find(":input").eq(0).trigger("blur")}else if("view"!=u.show){var i=v(this);if(!(0<i.find("input").length)){i.find("a").hide(),i.css({padding:"0px"});var n=i.find("span").html(),d=i.height();"[鏈懡鍚峕"==n?i.find("span").html('<input type="text" class="layui-input" placeholder="'+n+'" style="height:'+d+'px;" />'):i.find("span").html('<input type="text" class="layui-input" value="'+n+'" style="height:'+d+'px;" />'),i.find("input").focus()}}}),c.closest(".DTFC_ScrollWrapper").on("click",".th_row",function(t){var e=t||window.event,a=e.srcElement||e.target;if(!(0<v(a).closest("a").length))if(0<c.closest(".DTFC_ScrollWrapper").find(":input").length&&0==v(this).closest("td,th").find(":input").length){v(this);c.closest(".DTFC_ScrollWrapper").find(":input").eq(0).trigger("blur")}else if("view"!=u.show){var s=v(this);if(!(0<s.find("input").length||0<s.find("select").length)){s.find("a").hide(),s.css({padding:"0px"});s.find("span").html(),s.height();var i={mod:"fund"},n=s.find("span").html(),d=s.closest("tr").attr("data-uuid");v.post("?/entity/data",i,function(t){t=JSON.parse(t);var e='<select lay-ignore style="width:100%;height:'+Math.floor(s.height())+'px;">';for(var a in null!=d&&-1!=d||(e+='<option value="-1" selected="selected">'+n+"</option>"),t)d==t[a].uuid?e+='<option value="'+t[a].uuid+'" selected="selected">'+t[a].name+"</option>":e+='<option value="'+t[a].uuid+'">'+t[a].name+"</option>";e+="</select>",s.find("span").css({width:"100%"}),s.find("span").html(e),s.find("select").select2({placeholder:lang.please_select,allowClear:!0}),s.find("select").on("select2:select",function(){var t=v(this).val(),e=v(this).find("option:selected").html(),a=c.attr("data-kid"),i=c.attr("data-fid"),n=get_captable_data(c,e,t);n.kid=a,n.fid=i;v.post("?/data/save_captable",n,function(t){fresh_captable(c,u)})}),v("body").off("click").on("click",function(t){var e=t||window.event,a=e.srcElement||e.target;if(0==v(a).closest("[data-op-captable]").length&&1==u.editable&&(u.show="view",c.find(".isview").hide()),1!=v(a).closest("th").find("select").length&&1!=v(a).closest(".select2-container").length&&0!=v(".select2-container").length){var i=s.closest("table"),n=s.find("select").val(),d=s.find("select").find("option:selected").html(),l=i.attr("data-kid"),r=i.attr("data-fid"),o=get_captable_data(i,d,n);o.kid=l,o.fid=r;v.post("?/data/save_captable",o,function(t){fresh_captable(i,u)})}}),v("body").off("input propertychange").on("input propertychange",".select2-search__field",function(){var e=v.trim(v(this).val());if(""!=e){var t=v(".select2-results__options").find("li"),a=-1;t.each(function(){if(v.trim(v(this).html())==e){var t=v(this).attr("id").split("-");return 1==(a=t[t.length-1])&&(a="-1"),!1}}),s.find("select").find("option[value=-1]").remove(),v(".select2-container").find("li[id$=-1]").remove(),-1==a&&""!=e&&s.find("select").prepend('<option value="-1" style="display:none;">'+e+"</option>"),s.find("select").val(a).trigger("change"),"view"==u.show&&c.find(".isview").hide()}else{var i=s.closest("tr").attr("data-uuid");s.find("select").val(i).trigger("change")}})})}}}),c.closest(".DTFC_ScrollWrapper").on("blur",".th_row input,.th_col input",function(){var t=v(this);if(!(0<t.closest("th").find("select").length)){v.trim(t.val());var e=t.closest("table"),a=e.attr("data-kid"),i=e.attr("data-fid"),n=get_captable_data(e);n.kid=a,n.fid=i;v.post("?/data/save_captable",n,function(t){fresh_captable(e,u)})}}),c.closest(".DTFC_ScrollWrapper").find(".dataTables_scrollBody").on("click",".td_data",function(){if(0<c.closest(".DTFC_ScrollWrapper").find(":input").length&&0==v(this).closest("td,th").find(":input").length){v(this);c.closest(".DTFC_ScrollWrapper").find(":input").eq(0).trigger("blur")}else if("view"!=u.show){var t=v(this);if(!(0<t.find("input").length)){var e=t.html();"&nbsp;"==e&&(e=""),-1!=e.indexOf("$")&&(e=e.substr(0,e.length-1)),t.css({padding:"0px"});var a=t.width(),i=t.height();t.html('<input type="text" class="layui-input" style="margin-right:-1px;width:'+a+"px;height:"+i+'px;" value="'+e+'" />'),t.find("input").focus()}}}),c.closest(".DTFC_ScrollWrapper").find(".dataTables_scrollBody").on("blur",".td_data input",function(){var t=v(this),e=t.closest("table"),a=(t.parent(),v.trim(t.val()),e.attr("data-kid")),i=e.attr("data-fid"),n=get_captable_data(e);n.kid=a,n.fid=i;v.post("?/data/save_captable",n,function(t){fresh_captable(e,u)})}),c.closest(".DTFC_ScrollWrapper").find(".dataTables_scrollBody").on("input propertychange",".td_data input",function(){var t=v(this),e=v.trim(t.val());1==isNaN(e)&&t.val("")}),c.on("click",function(t){"view"==u.show&&1==u.editable&&(u.show=0,c.find(".isview").show())}),drag_captable(c,u),"view"==u.show&&setTimeout(function(){show_fixed_view_captable(c,p,u)},0)}else setTimeout(function(){remove_fixed_table(c,p).opCapTable(u)},0)})}})}),$(function(g){g.fn.extend({opCapHd:function(b){return null==b&&(b={}),this.each(function(){var p=g(this),u=(p.attr("data-kid"),p.attr("data-fid"),p.find("tr:first").find("th").length,p.parent().html());fixed_caphd(p,b);var v=p.parent().find(".layui-table-view");v.off("click.edittd_hd").on("click.edittd_hd","[data-field]",function(t){if("view"!=b.show)if(0<v.find("input").length){if("INPUT"==t.target.nodeName)return;v.find("input").blur()}else{var e=t||window.event,a=e.srcElement||e.target,i=g(a).closest("[data-field]"),n=i.attr("data-field"),d=n.substr(n.length-1,1),l=n.substr(n.length-2,1);if(!(0<g(a).closest("thead").length&&(1!=d||"h"!=l)||0<g(a).closest("tbody").length&&(1!=d||"b"!=l))){var r=get_name_from_f(n);if("date"!=r)if("round"!=r&&"pre_money"!=r&&"exrate"!=r)if("investor"!=r)if("investment"!=r.substr(0,10)&&"new_shrs"!=r.substr(0,8));else{if(0==i.closest("tr").find("td:first").find("[data-delrow]").length)return;f=i.find("div").html();if(f=Number(f.toString().replace(/\,/g,"")),0==i.find("input").length){i.css("padding","0px");s=i.width();i.html('<input type="number" class="layui-input" style="width:'+s+'px" value="'+f+'" />'),i.find("input").focus()}}else{if(0==i.find("a").length)return!0;f=i.find("span").html();var o=0<i.find("[data-delrow]").length?1:0;if(i.attr("data-row",o),"[鏈懡鍚峕"==f&&(f=""),0==i.find("input").length){i.css("padding","0px");var s=i.width();i.html('<input type="text" class="layui-input" style="width:'+s+'px" value="'+f+'" />'),i.find("input").focus()}}else{var f=i.find("span").html(),s=i.width();0==i.find("input").length&&(i.css("padding","0px"),i.html('<input type="text" class="layui-input" style="width:'+s+'px" value="'+f+'" />'),i.find("input").focus())}else{var f=i.find("span").html();if(0==i.find("input").length){var h=guid("date");i.css("padding","0px"),i.html('<input type="text" class="layui-input" data-laydate="date" value="'+f+'" id="'+h+'" />');var c=setInterval(function(){g("#"+h)&&laydate.render({elem:"#"+h,type:"date",show:!0,ready:function(){clearInterval(c)},done:function(t,e){i.find("input").val(t),save_caphd(p,function(){fresh_caphd(p,b)})},cancel:function(t,e){i.find("input").val(t),save_caphd(p,function(){fresh_caphd(p,b)})}})},100)}}}}}),v.one("blur","input",function(){g(this);setTimeout(function(){save_caphd(p,function(){fresh_caphd(p,b)})},0)}),g("body").off("click.hd").on("click.hd",function(t){g(".layui-table-tips").hide();var e=t||window.event,a=e.srcElement||e.target,i=v.parent().attr("data-editable");if(b.editable=i,0==g(a).closest(".layui-table-view").length&&1==b.editable&&0==v.find("input").length){if("A"==a.nodeName)return;b.show="view",v.parent().find(".isview").hide()}}),v.on("click",function(t){"view"==b.show&&1==b.editable&&(b.show=0,v.parent().find(".isview").show())}),v.parent().find(".add_row").on("click",function(){var t=v.find(".layui-table-main").find("table").height(),e=remove_fixed_tab(p,u),a=e.find("tr:first").find("th").length-1,i="<tr>";i+='<td><span>[鏈懡鍚峕</span><a class="pull-right isview" href="javascript:;" data-delrow="add" data-remove><i class="layui-icon">&#x1006;</i></a></td>';for(var n=0;n<6*a;n++)i+="<td></td>";i+="</tr>",e.find("tbody>tr:last").prev("tr").after(i),e.attr("data-y",t),e.opCapHd(b)}),v.find("[data-delrow]").on("click",function(t){if(t.stopPropagation(),1!=v.find(".layui-table-fixed").find("[data-delrow]").length){var e=g(this).attr("data-delrow"),a=g(this).closest("tr").index(),i=remove_fixed_tab(p,u);i.find("tbody>tr").eq(a).remove();var n=i.attr("data-kid"),d=i.attr("data-fid");if(i.opCapHd(b),"add"!=e){var l=g("table[data-kid="+n+"][data-fid="+d+"]");save_caphd(l,function(){fresh_caphd(l,b)})}}else layer.msg("璇疯嚦灏戜繚鐣欎竴琛�")}),v.parent().find(".add_totalrow").on("click",function(){var t=v.find(".layui-table-main").find("table").height(),e=remove_fixed_tab(p,u),a=e.find("tr:first").find("th").length-1,i="<tr>";i+='<td><span>灏忚琛�</span><a class="pull-right isview" href="javascript:;" data-deltotal data-remove><i class="layui-icon">&#x1006;</i></a></td>';for(var n=0;n<6*a;n++)i+="<td></td>";i+="</tr>",e.find("tbody>tr:last").prev("tr").after(i);var d=e.attr("data-kid"),l=e.attr("data-fid");e.attr("data-y",t),e.opCapHd(b);var r=g("table[data-kid="+d+"][data-fid="+l+"]");save_caphd(r,function(){fresh_caphd(r,b)})}),v.find("[data-deltotal]").on("click",function(t){t.stopPropagation();var e=g(this).closest("tr").index(),a=remove_fixed_tab(p,u);a.find("tbody>tr").eq(e).remove();var i=a.attr("data-kid"),n=a.attr("data-fid");a.opCapHd(b);var d=g("table[data-kid="+i+"][data-fid="+n+"]");save_caphd(d,function(){fresh_caphd(d,b)})}),v.parent().find(".add_col").on("click",function(){var t=v.find(".layui-table-main").find("table").width(),e=remove_fixed_tab(p,u),a=e.find("tr:first").find("th").length-1;e.find("tr:first").find("th:last").after("<th lay-data=\"{field:'round_ah1',align:'center',width:720}\" colspan=\"6\"><span>绗�"+NumberToChinese(a)+"杞瀺璧�</span></th>");var i='<th lay-data="{align:\'center\',width:120}" colspan="2">鏃堕棿</th>';i+="<th lay-data=\"{field:'date_h1',align:'center',width:240}\" colspan=\"2\"></th>",i+='<th lay-data="{align:\'center\',width:240}" colspan="2">鎶曞墠浼板€�</th>',i+="<th lay-data=\"{field:'pre_money_h1',align:'right',width:120}\" colspan=\"2\"></th>",e.find("tr").eq(1).find("th:last").after(i);i='<th lay-data="{align:\'center\',width:240}" colspan="2">姣忚偂浠锋牸</th>';i+="<th lay-data=\"{field:'price_h0',align:'right',width:120}\" colspan=\"2\"></th>",i+='<th lay-data="{align:\'center\',width:240}" colspan="2">姹囩巼</th>',i+="<th lay-data=\"{field:'exrate_h1',align:'right',width:120}\" colspan=\"2\"></th>",e.find("tr").eq(2).find("th:last").after(i);i="<th lay-data=\"{field:'investment"+a+"_b1', width:120, align:'center', style:'text-align:right;'}\">鎶曡祫閲戦</th>";i+="<th lay-data=\"{field:'new_shrs"+a+"_b0', width:120, align:'center', style:'text-align:right;'}\">鏂板鑲℃暟</th>",i+="<th lay-data=\"{field:'c"+a+"_b0', width:120, align:'center', style:'text-align:right;'}\">绱鎸佽偂</th>",i+="<th lay-data=\"{field:'d"+a+"_b0', width:120, align:'center', style:'text-align:right;'}\">浠峰€�</th>",i+="<th lay-data=\"{field:'e"+a+"_b0', width:120, align:'center', style:'text-align:right;'}\">鏀剁泭</th>",i+="<th lay-data=\"{field:'f"+a+"_b0', width:120, align:'center', style:'text-align:right;'}\">鑲′唤姣斾緥</th>",e.find("tr").eq(3).find("th:last").after(i),e.find(".tr_row").each(function(){for(var t="",e=0;e<6;e++)t+="<td></td>";g(this).find("td:last").after(t)}),e.find(".tr_total").each(function(){for(var t="",e=0;e<6;e++)t+="<td></td>";g(this).find("td:last").after(t)});i="";for(var n=0;n<6;n++)i+="<td></td>";e.find("tr:last").find("td:last").after(i),e.attr("data-x",t),e.opCapHd(b)}),v.find("[data-delcol]").on("click",function(t){if(t.stopPropagation(),1!=v.children(".layui-table-header").find("[data-delcol]").length){var e=g(this).attr("data-delcol"),i=g(this).closest("th").index(),n=remove_fixed_tab(p,u);n.find("tr:first>th").eq(i).remove();var a=6*i,d=4*i;if(1==i)n.find("tr").eq(1).find("th:lt("+d+")").remove(),n.find("tr").eq(2).find("th:lt("+d+")").remove(),n.find("tr").eq(3).find("th:lt("+a+")").remove(),n.find(".tr_row").each(function(){g(this).find("td:lt("+(a+1)+"):gt(0)").remove()}),n.find(".tr_total").each(function(){g(this).find("td:lt("+(a+1)+"):gt(0)").remove()}),n.find("tr:last").find("td:lt("+a+")").remove();else{var l=6*(i-1)-1,r=4*(i-1)-1;n.find("tr").eq(1).find("th:lt("+d+"):gt("+r+")").remove(),n.find("tr").eq(2).find("th:lt("+d+"):gt("+r+")").remove(),n.find("tr").eq(3).find("th:lt("+a+"):gt("+l+")").remove(),n.find(".tr_row").each(function(){g(this).find("td:lt("+(a+1)+"):gt("+(l+1)+")").remove()}),n.find(".tr_total").each(function(){g(this).find("td:lt("+(a+1)+"):gt("+(l+1)+")").remove()}),n.find("tr:last").find("td:lt("+a+"):gt("+l+")").remove()}var o=n.find("tr:first>th:gt("+(i-1)+")"),s=["investment","new_shrs","c","d","e","f"];0<o.length&&o.each(function(t){var a=i+t-1;n.find("thead>tr").eq(3).find("th").each(function(t){if(Math.floor(t/6)<a)return!0;var e=t%6;0==e?g(this).attr("lay-data","{field:'investment"+a+"_b1', width:120, align:'center', style:'text-align:right;'}"):g(this).attr("lay-data","{field:'"+s[e]+a+"_b0', width:120, align:'center', style:'text-align:right;'}")})});var f=n.attr("data-kid"),h=n.attr("data-fid");if(n.opCapHd(b),"add"!=e){var c=g("table[data-kid="+f+"][data-fid="+h+"]");save_caphd(c,function(){fresh_caphd(c,b)})}}else layer.msg("璇疯嚦灏戜繚鐣欎竴杞�")}),drag_caphd(p,b)})}})});
var index,indexw,uuid,hist_positon=0;window.WX_JSSDK_INIT_URL=location.href.split("#")[0],layui.config({base:debug?"src/js/layui/":"static/modules/",version:ver}),function(){try{new window.CustomEvent("T")}catch(t){var e=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var a=document.createEvent("CustomEvent");return a.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),a};e.prototype=window.Event.prototype,window.CustomEvent=e}}(),window.addEventListener("popstate",function(t){if(history.state){var e=t.state;if(null===e)return;var a=$("#layout").attr("data-s");$("#layout").removeAttr("data-s"),v(e.url,"#canvas",{popstate:!0,url_search:a})}},!1),window.onload=function(){eit_init(),load_js(["js/handson/handsontable.js","neditor/neditor.config.js?v=9877","neditor/neditor.all.js?v=9877","neditor/lang/zh-cn/zh-cn.js?v=9876","editor.md/lib/marked.min.js","editor.md/lib/prettify.min.js","editor.md/editormd.min.js","js/echarts.min.js","js/extension/dataTool.js","js/biload.js","charts/highcharts/highcharts.js","charts/highcharts/funnel.js"])};var hist=[],Space={setStorage:function(t){return window.localStorage?(localStorage.setItem("sid",t),!0):(alert("鎮ㄧ殑娓歌鍣ㄧ増鏈緝浣庯紝璇锋洿鏂版父瑙堝櫒"),!1)},change:function(t){this.setStorage(t)&&(window.location.href="?/space/enter/"+t)},check:function(){var t=localStorage.getItem("sid",t);t!=websid&&(window.location.href="?/space/enter/"+t)},init:function(t){this.setStorage(t)&&(window.addEventListener?window.addEventListener("storage",this.check):window.attachEvent&&window.attachEvent("onstorage",this.check))}};function creat_name_by_sel(){0<$("[data-autoadd]").length&&$("[data-autoadd]").selAutoadd({fn:function(t){update_item(t.closest("td.editing")[0])}})}function init(){window.plus?plus.nativeUI.closeWaiting():document.addEventListener("plusready",function(){plus.nativeUI.closeWaiting()},!1),tablet_init(),v(location.search.substr(2)+location.hash,"",{init:1}),window.lppHistory={history:[],historyPointer:0,push:function(t){window.lppHistory.history.push(t),window.lppHistory.historyPointer++},getLast:function(t){return t||(t=1),window.lppHistory.history[window.lppHistory.historyPointer-t]}},window.lppHistory.push(location.search.substr(2)),window.UpdatingsAction="updatings-action",window.UpdatingsActionTo="updatings-comment-to",hist.push("home/"),Space.init(websid),layer=layui.layer,layeropen=layer.open,layer.open=function(t){return 1==t.type&&(t.type=t.model?5:isMobile.any()?1:5),layeropen(t)},upload=layui.upload,element=layui.element,form=layui.form,laydate=layui.laydate,FixedMenu.init(),$("#paginator").on("change",function(t){t.preventDefault(),window.location.href=$(this).val()}),form.on("checkbox",function(t){form.render("checkbox")}),$(document).on("click",".tb_checkall",function(){$(this).attr("checked")?$("checkbox").attr("checked",!0):$("checkbox").attr("checked",!1)}),$(document).on("change","select",function(){id=$(this).attr("id"),text=$("#"+id).find("option:selected").text(),$("#"+id+"_label").val(text)}),$(document).on("keydown","input[type=text]",function(t){if(13==t.keyCode)return!1}),$(document).on("change","[data-datetimepicker2]",function(t){var e=$(this),a=$("#"+e.attr("data-datetimepicker2-id"));if(""!==e.val()){var i=e.val().split("T");console.log(i.join(" ")),a.val(i.join(" "))}else a.val("")}),$(document).on("blur",".num[data-sep]",function(t){var e=$(this),a=e.val();if(e.attr("data-sep")&&a){var i=e.attr("decimals")||2,n=e.data("sep");e.val(number_format(a,i,".",n,e.attr("padding")))}}),$(document).on("v:done",function(t){var e=t.detail.target;e.find(".layui-tab").length&&e.find(".layui-tab .layui-tab-content [ftype=select_new]").length&&e.on("click",".layui-tab-title li:not(.layui-this,[class])",function(){var t=$(this);setTimeout(function(){t.closest(".layui-tab").find(".layui-tab-content .layui-tab-item").eq(t.index()).find("[ftype=select_new]").each(function(){$(this).find(".select2-container").width($(this).width())})})})}),$(document).on("submit","form.ajax",function(c){c.preventDefault()||c.stopPropagation();var f=$(this),u=$(this).attr("id")?"#"+$(this).attr("id"):void 0;if((f.closest(".content-side").length&&(u="#canvas-side"),$(".num").each(function(){var t=$(this),e=t.attr("decimals")||2;""===t.val()&&"amount"==t.closest("[ftype]").attr("ftype")||t.val(number_format(t.val(),e,".",""))}),f.find("select:not(.select-mu)").each(function(){var t=$(this).attr("id"),e="",a=$(this).find("option:selected");a.val()&&(e=a.text()),$(this).parent().find("#"+t+"_label").val(e)}),f.find("[ftype=select_new][readonly]").each(function(){var t=$(this),e=t.attr("fid"),a=$("#"+e).attr("data-val"),i=$("#"+e).attr("data-val_label");if(!a||!i||'[""]'==a)return!0;void 0!==$("#"+e).attr("multiple")&&a&&(a=parse_json(a),i=parse_json(i)),/\[".*"\]/.test(a)&&/\[".*"\]/.test(i)&&(a=parse_json(a),i=parse_json(i)),t.find("input[readonly]").each(function(){$(this).attr("id",e).attr("name","data["+e+"]").attr("value",a);var t=$(this).clone();$(t).addClass("hide").attr("id",e+"_label").attr("name","data["+e+"_label]").attr("value",i),$(this).after(t)})}),f.find("[ftype=rte]").each(function(){var t=$(this).attr("kid"),e=$('[name="data['+t+']"]'),a=e.val()||"";a=a.replace(/&quot;/g,"&apos;"),e.val(a)}),f.find("[ftype=datetimepicker2] input[type=datetime-local][data-datetimepicker2-id]").each(function(){var t=$(this),e=$("#"+t.attr("data-datetimepicker2-id"));""===t.val()&&e.val("")}),data=f.serialize(),data=trim_form_data(data),divid=$(this).find("input[name=divid]").val(),post_url=$(this).attr("action"),"undefined"!=typeof post_url)&&!(0<post_url.indexOf("/del"))){LoadingLayer.create(1).show().setTimeout(3e6,"璇锋眰瓒呮椂");var e=!0,a=c;void 0===$(c.currentTarget).attr("submited")&&($(c.currentTarget).attr("submited",""),e=!1),e||$.post(post_url,data,function(i){if($(c.currentTarget).removeAttr("submited"),f.find("[name=changed]").val(0),null!=LoadingLayer.getCurrent()){if(LoadingLayer.isCurrentTimeout())return void LoadingLayer.clear();LoadingLayer.isLoading()&&LoadingLayer.clear()}if(i.msg&&layer.msg(i.msg,{time:3e3}),i.download)DownLoadFile({url:post_url,data:{download:1,sid:i.sid}});else if(i.refresh)v();else if(divid){var t=f.closest(".layui-layer"),e=t.attr("id");e&&(i.html?(f.closest(".layui-layer-content").html(i.html),layer_content_render("#"+e)):layer.close(t.attr("times")));var a=parse_json($("#"+divid).attr("ext")),n=a.mod;$("[ext]").each(function(){var t=parse_json($(this).attr("ext"));(t.mod==n||a.rel_mod&&t.mod==a.rel_mod)&&$(this).b2data()})}else{if("check"==i.action){var l=new Date,r=l.getFullYear(),o=l.getMonth()+1,d=function(t,e){layer.close(e);var a=LoadingLayer.create(1).show().setTimeout(1e4,"蹇収灏嗗湪鍚庡彴缁х画鐢熸垚<br/>璇疯€愬績绛夊緟");$.post(post_url,t,function(t){a.isTimeouted()||layer.msg(t.msg,{time:3e3})})};o=o<10?"0"+o:o;var s=r.toString()+o.toString();i.editionTemplateLabel?layer.confirm('鎸夊揩鐓х増鏈�"'+i.editionTemplateLabel+'"鐢熸垚蹇収锛�',{},function(t){d({snapshot:1,sid:i.eids},t)}):layer.prompt({title:"璇疯緭鍏ュ揩鐓х増鏈�",formType:0,value:lang.snapshot+s,success:function(t){isMobile.any()||$(t).width("fit-content").css("marginLeft","auto").css("marginRight","auto")}},function(t,e,a){d({snapshot:1,sid:i.eids,edition:t},e)})}if(i.rtu)v(i.rtu,u,i.data),-1<i.rtu.indexOf("task_oriza")&&$("div").hasClass("block_box")&&$(".block_box .ajax_block").each(function(){var t=$(this).attr("url"),e=$(this).attr("param"),a=$(this);e=$.parseJSON(e),setTimeout(function(){$.ajax({type:"post",url:t,data:e,async:!1,success:function(t){a.html(t),Comment.render()}})},1e3)})}},"json").fail(function(t){layer.alert(t.responseText,{title:lang.submit_error,btn:[lang.ok]}),LoadingLayer.clear(),e=!0,$(a.currentTarget).removeAttr("submited")})}}),current_url=window.location.search.replace("?/","");var t=current_url.indexOf("&");0<t&&(current_url=current_url.slice(0,t)),current_url&&hist.push(current_url),menu_init(),render_submenu(current_url),setTimeout(function(){render_canvas()},0),layer.check_layer=function(t,e){if(t&&isMobile.any()){void 0!==e||(e=!1);var a=t.closest(".layui-layer"),i=t.hasClass("layui-layer")?t.children(".layui-layer-content"):t.closest(".layui-layer-content");if(a.length&&null!=a.offset()&&a.height()+a.offset().top>$(window).height()){var n=($(window).height()-a.height())/2;n=n<0?0:n,a.addClass("transition").css("top",n+"px"),n||i.addClass("transition").css("height",$(window).height()-63-51-(e?57:0)+"px"),setTimeout(function(){a.removeClass("transition"),i.removeClass("transition"),i.height(i.height())},1e3)}}},form.verify({required:function(t,e){var a=lang.necessary,i="",n=$(e),l=function(t){return(i=n.data("label")||n.closest("td").prev(".label").text())&&(a+=": "+i),!t&&a};if("select_new"==n.parents("td[readonly]").attr("ftype")){var r=n.attr("data-val"),o=(i=n.attr("data-val_label"),$(e).parent().next().attr("value"));return l(r&&i&&o)}"radio"==n.attr("type")&&(0==n.closest("td").find("input:radio:checked").length&&(t=""));"checkbox"==n.attr("type")&&(0==n.closest("td").find("input:checkbox:checked").length&&(t=""));if(n.hasClass("select-mu"))return l(!("object"!=typeof t||null===t)||"string"==typeof t&&""!=t);if(n.hasClass("rte")||n.hasClass("rte_min"))return l(n.attr("fillin"));if(n.hasClass("num")){var d=n.data("num_range"),s="",c={default:"瀹炴暟",positive_number:"姝ｆ暟",negative_number:"璐熸暟",nonzero_number:"闈為浂鏁�",nonpositive_number:"闈炴鏁�",nonnegative_number:"闈炶礋鏁�",integer:"鏁存暟",positive_integer:"姝ｆ暣鏁�",negative_integer:"璐熸暣鏁�",nonzero_integer:"闈為浂鏁存暟",nonpositive_integer:"闈炴鏁存暟",nonnegative_integer:"闈炶礋鏁存暟"};t=t.replace(/,/g,""),t=Number(t),null==d&&(d={}),d.range||(d.range="default"),d.contain||(d.contain="all");var f=0<=[void 0,""].indexOf(d.start)?void 0:Number(d.start),u=0<=[void 0,""].indexOf(d.end)?void 0:Number(d.end),h=new RegExp({default:"^[+-]?\\d+(.\\d+)?$",positive_number:"^[+]?([1-9]\\d*(.\\d*)?|0+.\\d*[1-9]\\d*)$",negative_number:"^-([1-9]\\d*(.\\d*)?|0+.\\d*[1-9]\\d*)$",nonzero_number:"^[+-]?(([1-9]\\d*(.\\d*)?)|(0.\\d*))$",nonpositive_number:"^((-\\d+(.\\d+)?)|(0+(.0+)?))$",nonnegative_number:"^[+]?\\d+(.\\d+)?$",integer:"^[+-]?\\d+$",positive_integer:"^[+]?\\d*[1-9]\\d*$",negative_integer:"^-\\d*[1-9]\\d*$",nonzero_integer:"^[+-]?\\d*[1-9]\\d*$",nonpositive_integer:"^((-\\d+)|(0+))$",nonnegative_integer:"^[+]?\\d+$"}[d.range]).test(t);return null!=f&&(0<=["all","start"].indexOf(d.contain)?(h&&(h=f<=t),s+="澶х瓑浜�"+f):(h&&(h=f<t),s+="澶т簬"+f)),null!=u&&(0<=["all","end"].indexOf(d.contain)?(h&&(h=t<=u),s+="灏忕瓑浜�"+u):(h&&(h=t<u),s+="灏忎簬"+u)),s=s?s+"鐨�"+c[d.range]:c[d.range],a=a+"锛屽彇鍊艰寖鍥翠负"+s,l(h)}return l(/[\S]+/.test(t))},date:function(t,e){return!1},min_selected:function(t,e){var a=$(e),i="鑷冲皯闇€瑕侀€夋嫨 {min_selected} 椤�",n=a.data("label")||$(e).closest("td").prev(".label").text()||"",l=a.data("verify");if(i=b2.t(i,l),n&&(i+=": "+n),!t)return i;if(a.is("select")){if("object"==typeof t&&t.length>=l.min_selected)return!1}else if("string"==typeof t&&(value_a=parse_comma_data(t),value_a.length>=l.min_selected))return!1;return i}}),$(document).on("focusin",function(){}),$(document).on("focusout",function(){}),isMobile.any()&&$(document).on("click",".select2",function(){$("html, body").animate({scrollTop:$(this).offset().top-.3*window.screen.height},{duration:300,easing:"swing"})}),isMobile.iOS()&&-1!=navigator.userAgent.indexOf("wxwork")&&$("#qywx-navigator").show(),b2.mobilecheck()||$(document).on("keydown",".desktop_search_box, #mb_search_box",function(t){if(13==t.keyCode){t.preventDefault();var e=$(this),a=e.val();e.blur(),v("search/index","",{key:a})}})}function tablet_init(){if(b2conf.isTablet){var t="tablet_p",e="onorientationchange"in window?"orientationchange":"resize",a=i();a&&"true"!==$.cookie(t)&&(LoadingLayer.create(0,.8).show(),location.reload()),$.cookie(t,a,{expires:10}),window.addEventListener(e,function(){a!==i()&&(a=i(),$.cookie(t,a,{expires:10}),LoadingLayer.create(0,.8).show(),location.reload())},!1)}function i(){return 0===window.orientation||180===window.orientation}}function editormd_init(e,a,i,t){var n=$("#editormd"+a);if("undefined"==typeof editormd)var l=setInterval(function(){"undefined"==typeof editormd||(r(n),clearInterval(l))},200);else r(n);function r(t){e?editormd("editormd"+a,{width:"100%",height:400,autoFocus:!1,readOnly:i,syncScrolling:"single",path:"/static/editor.md/lib/",saveHTMLToTextarea:!0,emoji:!0,watch:!1,placeholder:"杈撳叆 Markdown!",imageUpload:!0,imageUploadURL:"?/file/upload_img/true",toolbarAutoFixed:!1,toolbarIcons:function(){return["undo","redo","|","bold","del","italic","quote","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","image","code","preformatted-text","table","datetime","emoji","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search","|","help"]},onfullscreen:function(){t.css("z-index","999999999"),$(".layui-side").hide(),FixedMenu.render("hide")},onfullscreenExit:function(){t.css("z-index","0"),$(".layui-side").show(),FixedMenu.render()},onwatch:function(){o()},onpreviewing:function(){o()}}):editormd.markdownToHTML("editormd"+a,{htmlDecode:"style,script,iframe",emoji:!0}),setTimeout(function(){o(),t.removeAttr("id"),t.on("click","img:not(.emoji)",function(){t.closest(".list-table,.datatables").length||viewPhotos($(this),t)})})}function o(){$("[ftype=markdown] code").each(function(t,e){var a=$(e).children("img");$(a).after($(a).attr("title")),$(a).hide()})}}function layedit_init(t,r,s,c,f,u){t?layui.use("layedit",function(){var i=layui.layedit,n=i.build($("#"+r),{hideTool:["file"],height:200,uploadImage:{url:"?/file/upload_img/"}}),l=$("#"+r).next().find("iframe");l.load(function(){l.contents().find("head").append("<style>img{max-width:150px;}</style>");var t=l.contents().find("body"),e=function(){$("#"+r).attr("fillin",!!i.getContent(n)||"")};if(t.css({"word-wrap":"break-word","word-break":"break-all"}),u?t.html($("#"+r).val()):t.html(s),f&&e(),c&&$("#"+r).next().prepend('<div style="position:absolute;width:100%;z-index: 999999;height: 24px;"></div>').find(".layui-layedit-tool i").css("color","#ccc")&&t.prop("contenteditable",!1),!c){if(/rv:11/i.test(navigator.userAgent))new MutationObserver(e).observe(t[0],{childList:!0,subtree:!0});else t.on("input propertychange",e);t.on("click","img",function(){$("#"+r).closest(".list-table,.datatables").length||viewPhotos($(this),t,l)});var o=document.getElementById("LAY_layedit_"+n),d=o.contentDocument||o.contentWindow.document,a=$(d).find("body");ListenImageClip.init(a,function(t,e){var a=o.contentWindow,i=a.getSelection&&a.getSelection(),n=i.getRangeAt(0),l=d.createElement("img"),r="clipimage_"+o.getAttribute("id")+"_"+Math.floor(1e3*Math.random());l.setAttribute("id",r),l.setAttribute("src","/dist/css/modules/layer/default/loading-1.gif"),l.setAttribute("alt",e),l.classList.add("cliped-image"),n.insertNode(l),$.post("?/entity/convertImage",{base64:t},function(t){var e=t.img;i&&0<i.rangeCount&&d.getElementById(r).setAttribute("src","../?/file/img/"+e)})})}}),c&&(l.addClass("readonly-elem"),l.attr("style",l.attr("style")+" background:#eee;"))}):$("#"+r).on("click","img",function(){$("#"+r).closest(".list-table,.datatables").length||viewPhotos($(this),$("#"+r))})}function cancel_form(e,t){if($(".load_a:visible").length-$(t).find(".load_a:visible").length==0){var a=window.location.search,i=a.indexOf("&");0<i&&(a=a.slice(0,i));var n=a.split("/")[2];"view"==n&&(n=a.split("/")[5]),"add"!=n&&"edit"!=n||$(window).unbind("beforeunload").bind("beforeunload",function(t){var e=$("form.ajax"),a=form.data("autosave");if(r=check_update_value(e),!a&&r)return lang.no_save_confirm})}var l=$(t).find("form.ajax");if(0==l.length)return!0;var r=check_update_value(l);return!l.data("autosave")&&r?(layer.confirm(lang.no_save_confirm,{btn:[lang.ok,lang.cancle]},function(t){layer.close(e),layer.close(t)}),!1):(layer.close(e),!0)}function check_update_value(t){return 1==t.find("input[name=changed]").val()}function time_display(){$(".default_dtype").change(function(){var t=$(this).val();if("datetime-local"==$(this).attr("type")&&""!=t){var e=t.substr(0,16);$(this).val(e);t=t.replace("T"," ").substr(0,16)+":00"}$(this).prev(".hdate").val(t)})}function time_display_s(t,r){t.change(function(){var t=$(this).val();if("datetime-local"==$(this).attr("type")&&""!=t){var e=t.substr(0,16);$(this).val(e);t=t.replace("T"," ").substr(0,16)+":00"}if($(this).prev(".hdate").val(t),"function"==typeof r){var a=$(this).parent().find(".hdate");if(1==a.length)var i=t;if(2==a.length){var n=a.eq(0).val(),l=a.eq(1).val();""==n&&(n="0000-00-00"),""==l&&(l="9999-12-31");i=n+" - "+l}r(i)}})}$(function(){init()}),neditor={init:function(l,r,o,d,t,e){var a=!isMobile.any();if(console.log(e.view_maxcount_normalize),e.view_maxcount_normalize)var s={readonly:o,enableContextMenu:a,wordCount:!0,maximumWords:e.view_maxcount_normalize};else s={readonly:o,enableContextMenu:a};var c=$("#"+l+"_test").parents("[ftype=rte]");if(c.addClass("rte--loading").attr("data-loading-placeholder",lang.loading_widget),t&&(s.toolbars=[t.split(",")]),"undefined"==typeof UE)var i=setInterval(function(){"undefined"==typeof UE||(n(e),clearInterval(i))},200);else n(e);function n(i){var n=UE.getEditor(l,s);c.removeClass("rte--loading").removeAttr("data-loading-placeholder"),n.addListener("ready",function(){var t=function(){$("#"+l+"_test").attr("fillin",!!n.hasContents()||"")};o||d&&(t(),n.addListener("contentChange",t)),o&&setTimeout(function(){$("#"+l+"_test").parent().find("div div div iframe").addClass("readonly-elem")}),r=r.replace(/&amp;apos;|&apos;/g,"'"),n.setContent(r),n.focus(!0),_.each(i,function(t,e){n.execCommand(e,t)});var e=$("#"+l+"_test").parent().find("div div div iframe")[0],a=e.contentDocument||e.contentWindow.document;$(a).find("body").addClass("ios-rte-fix").addClass("needsclick").after("<style>.ios-rte-fix { user-select: text; -webkit-user-select: text; }</style>"),$(a).on("click",function(){$(document.body).trigger("mousedown.select2"),setTimeout(function(){$(a).find("body").focus()},100)});n.addListener("contentchange",function(){n.getContent()&&$(a).find("body").children().each(function(){var t,e,a=$(this).text();e=!1,e|=/(msonormal+[^{]+\{[^}]*)|@page+[^{]+\{[^}]*|(mso-(style|margin|page)-(.*):(.*);)/i.test(t=a),(e|=/(\[endif\])|(w:(WordDocument|LantentStyles|))|(<!--(.*)-->)/i.test(t))&&$(this).empty()})})})}},render:function(a,i){setTimeout(function(){var t=$("#iframe_"+a)[0];if(t){var e=t.contentDocument||t.contentWindow.document;t.attachEvent?t.attachEvent("onload",function(){neditor._render(t,a,i)}):t.onload=function(){neditor._render(t,a,i)},e.open(),e.write(""),e.close()}})},_render:function(rte_frame,rte_key,config){var rtedoc=rte_frame.contentDocument||rte_frame.contentWindow.document,$textarea=$("#"+rte_key);rtedoc.open(),rtedoc.write($textarea.val()),rtedoc.close(),rte_frame.style.height="0px",eval("window.IE9MoreRealHeightiframe_"+rte_key+"=0"),layer.check_layer($textarea),$(rtedoc).find("body a").attr("target","_blank"),$(window).resize(function(){eval("window.IE9MoreRealHeightiframe_"+rte_key+"=0"),b2.rteAdjustIframe("iframe_"+rte_key)}),setInterval(function(){b2.rteAdjustIframe("iframe_"+rte_key)},200),$(rtedoc).find("body").off("click").on("click",function(){$(rte_frame).closest(".list-table,.datatables").length&&$(rte_frame).trigger("click")}).off("click","img").on("click","img",function(){$(rte_frame).closest(".list-table,.datatables").length||viewPhotos($(this),$(rtedoc),$(rte_frame))}),config&&neditor.viewStyleNormalize(rte_frame,rtedoc,config),neditor.viewDefaultStyle(rte_frame,rtedoc)},viewDefaultStyle:function(t,e){var a="13px !important";$(e).find("head").append("<style id='view-wysiwyg'>body {font-family: 寰蒋闆呴粦;}body p {font-size:"+a+";}body p strong {font-size:"+a+";}</style>")},viewStyleNormalize:function(t,e,a){var i=$(e).find("head");if(a.view_fontcolor_normalize){var n=$(t).css("color")+" !important";i.append("<style id='view-fontcolor-normalize'>body { color:"+n+" }body p span{ color:"+n+" }body h1 { color:"+n+" }body h2 { color:"+n+" }body h3 { color:"+n+" }body h4 { color:"+n+" }body p span strong{font-size:"+o+"; color:"+n+" }</style>")}if(a.view_fontsize_normalize){var l=$(t).css("font-size").split("px")[0]-0,r=l+"px !important",o=l+1+"px !important",d=l+3+"px !important",s=l+2+"px !important",c=l+1+"px !important",f=l+0+"px !important";i.append("<style id='view-fontsize-normalize'>body {font-size:"+r+";}body p span{font-size:"+r+";}body h1 {font-size:"+d+";}body h2 {font-size:"+s+";}body h3 {font-size:"+c+";}body h4 {font-size:"+f+";}body p span strong{font-size:"+o+";}</style>")}}};var rdel=function(e,a){segs=e.split("/"),uuid=segs.pop();seg1;layer.confirm(lang.del_confirm,{title:lang.title_msg,btn:[lang.ok,lang.cancle],btn1:function(t){layer.close(t),LoadingLayer.create(1).show(),$.post("?/"+e,{},function(t){t.ok?(LoadingLayer.clear(),layer.msg(lang.del_success,{time:1e3}),a?"function"==typeof a.api?a.api().draw():a.del($("#item_"+uuid)):$("#item_"+uuid).fadeOut("slow",function(){this.remove()})):layer.msg("瀵逛笉璧�,鎮ㄦ病鏈夊垹闄よ鏁版嵁鐨勬潈闄�",{closeBtn:0})})}})},post=function(t,e,a,i){if(e)if(a||(a={}),t){var n="?/"+e;layer.confirm(t,{title:lang.msg,btn:[lang.ok]},function(e){$.post(n,a,function(t){i&&"function"==typeof i&&i(t),layer.close(e)})})}else $.post(n,a,function(t){i&&"function"==typeof i&&i(t)})},cdel=function(e,a,i){segs=e.split("/");var t="calendar/check_priv/"+(uuid=segs.pop())+"/delete";$.post("?/"+t,{},function(t){if(!1===t)return layer.alert("瀵逛笉璧�,鎮ㄦ病鏈夊垹闄よ鏁版嵁鐨勬潈闄�",{closeBtn:0}),!1;layer.confirm(lang.del_confirm,{btn:[lang.ok,lang.cancel],title:lang.msg},function(t){$.post("?/"+e,{param:a},function(){layer.msg(lang.del_success,{time:1e3}),layer.close(t),"week"==i?v("calendar/week/"):v("calendar/month/")})})})},trash_init=function(){var a=$(".datatables").dataTable({destroy:!0,language:{processing:lang.loading,sSearchPlaceholder:lang.search,lengthMenu:lang.dts_lengthMenu,zeroRecords:lang.no_result,info:lang.dts_info,infoEmpty:lang.dts_infoEmpty,infoFiltered:lang.dts_infoFiltered,infoPostFix:"",search:"",url:"",paginate:{first:lang.first,previous:lang.previous,next:lang.next,last:lang.last}},oClasses:{sFilterInput:"layui-input"},sPaginationType:"full_numbers",aoColumnDefs:[{bSortable:!1,aTargets:[0]}],paging:!0,lengthChange:!1,pageLength:30,drawCallback:function(){this.api().column(0).nodes().each(function(t,e){t.innerHTML=e+1})}});$(".revert").on("click",function(){var t=$(this).attr("type"),e=$(this).attr("uuid");$.post("?/trash/revert/"+t+"/"+e,function(){a.api().row($("#"+e).index()).remove().draw()})})},init_rel_data=function(t){$("#"+t+" .rel_data,#"+t+".rel_data").each(function(){var r=$(this),o=r.hasClass("editlist"),t=r.attr("ext"),d=parse_json(t),s=r.data("baseurl");if(!r.data("rel_inited")){if(r.data("rel_inited",1),r.hasClass("editable")&&r.data("add")){var e='<a href=\'javascript:;\' class="layui-btn layui-btn-small rel_add" ><span class="ion-plus"></span> '+lang.add+" </a>";0==r.find(".rel_data_btn").length?!0!==d.add_hidden&&r.prepend('<div class="rel_data_btn noprint" >'+e+"</div>"):r.find(".rel_data_btn").prepend(e).addClass("noprint")}if(1==r.find("table").attr("data-diycol")){r.find(".dt-buttons").hide();var a="<a href='javascript:;' class=\"databox layui-btn layui-btn-small rel_diycol\" > 涓€у寲 </a>";0==r.find(".rel_data_btn").length?r.prepend('<div class="rel_data_btn noprint" >'+a+"</div>"):r.find(".rel_data_btn").append(a).addClass("noprint"),$el=r.find("table");var i=$el.data("entity"),n=$el.closest("[data-baseurl]").find(".databox");n.data("seg1",seg(1)+"-"+i),n.attr("data-props",'{"type":"raw","multiple":"鏄�","dragable":"鏄�","lang":{"options_title":"闅愯棌鍒�","selected_title":"鏄剧ず鍒�","btn_confirm":"淇濆瓨","databox_fn":["submit","default"],"btn_other":{"default":"鎭㈠榛樿"},"btn_clear":"鍙栨秷"}}'),$.ajax({url:"?/"+i+"/diycol/data",async:!1,type:"post",data:{dkey:seg(1)+"-"+i},success:function(t){(t=parse_json(t)).show_key=t.show_key||[],t.show_val=t.show_val||[],n.attr("data-data",JSON.stringify(t.hide)),n.data("mod",i),n.find("input").remove(),n.prepend('<input type="hidden" class="val" name="diycol" value="'+t.show_key.join(",")+'"><input type="hidden" class="layui-input label" value="'+t.show_val.join(",")+'" readonly="" placeholder="閫夊彇">')}})}var l="td";"1"==r.find("table").attr("data-habit")&&(r.find("tbody tr").each(function(t){r.find("td:first-child .data-wrap").each(function(){""==$(this).html().trim()&&$(this).html("("+lang.empty+")")}),r.find("td:first-child .data-wrap").css({color:"#0f62ec","text-decoration":"underline",width:"auto"})}),l="td:first-child .data-wrap"),r.off("click","td,.rel_add,.rel_edit,.rel_del").on("click",l,function(t){if(d.mod1=window.location.search.split("/")[1],d.mod2=window.location.search.split("/")[3],"a"!=t.target.tagName.toLowerCase()&&"data_table"!=d.layout&&!$(t.target).hasClass("ion")){$(this).attr("sub",1);var e=$(this).closest(".rel_item").attr("uuid");e&&(r.hasClass("editable")?d.open?o||v(s+"/edit/"+e,"#remodal",d):o||v(s+"/view/about/"+e,"#remodal",d):v(s+"/view/about/"+e,"#remodal",d))}}).on("click",".rel_add",function(t){if($(this).attr("sub",1),d.mod1=window.location.search.split("/")[1],d.mod2=window.location.search.split("/")[3],o){var e=r.find("table"),a=[],i=!1,n='<span class="ion ion-edit rel_edit"></span> <span class="ion ion-trash-a rel_del"></span>';e.find("th").map(function(t,e){$(this).hasClass("noprint")&&(i=!0),a.push(i?n:'<div class="data"></div>')}),i||(e.find("thead tr").append('<th class="noprint" width="40" data-orderable="false"></th>'),a.push(n));var l=a.map(function(t,e){return"<td>"+t+"</td>"}).join("");e.find("tbody tr .dataTables_empty").length&&e.find("tbody").html(""),e.find("tbody").append('<tr class="rel_item" role="row">'+l+"</tr>"),e.find("tr:last-child td:last-child").addClass("noprint align-center")}else{null!=parse_json($(this).parent().parent().attr("ext")).base_add?v(s+"/edit/"+$(this).parent().parent().find("table > tbody tr:last").attr("uuid")+"&action=edit_for_add","#remodal",d):v(s+"/add/","#remodal",d)}}).on("click",".rel_edit",function(){$(this).attr("sub",1),d.mod1=window.location.search.split("/")[1],d.mod2=window.location.search.split("/")[3];var t=$(this).closest(".rel_item").attr("uuid");t&&v(s+"/edit/"+t,"#remodal",d),t||v(s+"/add/","#remodal",d)}).on("click",".rel_del",function(){var t=$(this).closest(".rel_item"),e=t.attr("uuid"),a=d.mod;if(o&&!e){var i=r.find("table");if(t.remove(),!i.find("tbody tr").length){var n=i.find("th").length;i.find("th.noprint").length&&(i.find("th.noprint").remove(),n--),i.find("tbody").html('<tr class="odd"><td valign="top" colspan="'+n+'" class="dataTables_empty">'+lang.no_result+"</td></tr>")}}else layer.confirm(lang.del_confirm,{title:lang.title_msg,btn:[lang.ok,lang.cancle]},function(t){$.post("?/"+s+"/del/"+e,{},function(){layer.msg(lang.del_success,{time:1e3}),$(".rel_data").each(function(){JSON.parse($(this).attr("ext")).mod==a&&$(this).b2data()}),layer.close(t)}),layer.close(t)})}).on("click",".rel_export",function(){v(s+"/export/","#remodal",d)}).on("click",".rel_import",function(){v(s+"/import/","#remodal",d)}).on("click",".rel_analysis",function(){0<!$("#mod_analysis").length?($(this).parent().next().hide(),$(this).parent().next().before("<div id='mod_analysis' class='mod_analysis'></div>"),$.post("?/charts/mod_analysis/"+d.mod,{data:d},function(t){$("#mod_analysis").html(t)})):void 0===$(".mod_analysis").attr("hidden")?($(".mod_analysis").attr("hidden",""),$(".mod_analysis").next().show()):($(".mod_analysis").removeAttr("hidden",""),$(".mod_analysis").next().hide())}),void 0!==d.default_view&&("both"==d.default_view?($(".rel_analysis").parent().next().before("<div id='mod_analysis' class='mod_analysis'></div>"),$.post("?/charts/mod_analysis/"+d.mod,{data:d},function(t){$("#mod_analysis").html(t)}),$(".rel_analysis").hide()):($(".rel_analysis").parent().next().hide(),$(".rel_analysis").parent().next().before("<div id='mod_analysis' class='mod_analysis'></div>"),$.post("?/charts/mod_analysis/"+d.mod,{data:d},function(t){$("#mod_analysis").html(t)})))}}),$(".select-pop").selectPop();var e=layui.form,a=layui.element;e.render(),a.init()},captable_init=function(t,n){$("#"+t+".captable_box").each(function(){var i=$(this),t=i.attr("ext"),l=jQuery.parseJSON(t),r=i.data("baseurl"),o=i.data("baseurl2"),d=i.data("swapurl");function e(e){switch(e){case"name":i.find("[filter=more]").hide();break;case"more":i.find("[filter=more]").show();break;case"all":i.find("[filter=change],[filter=total]").show();break;case"change":case"total":var t="change"==e?"total":"change";i.find("[filter="+e+"]").show(),i.find("[filter="+t+"]").hide()}if(i.find("[data-filter]").each(function(){var t=$(this).data("filter");t[e]&&$(this).attr("colspan",t[e])}),n){var a=i.find(".layui-table-body thead tr th:first").outerWidth()+1;i.find(".fixed").width(a)}}i.data("rel_inited")||(i.data("rel_inited",1),i.off("click",".rel_add,.rel_edit,.rel_del").on("click",".rel_add",function(t){var e=$(this).data("swap");v((e?o:r)+"/add/","#remodal",l)}).on("click",".rel_swap",function(t){v(d+"/add/","#remodal",l)}).on("click",".rel_edit",function(){var t=$(this).closest(".cap_item"),e=t.attr("uuid"),a=t.data("swap"),i=t.data("share"),n="";n=a?d:i?o:r,e&&v(n+"/edit/"+e,"#remodal",l)}).on("click",".rel_del",function(){var t=$(this).closest(".cap_item"),e=t.attr("uuid"),a=t.data("swap"),i=t.data("share"),n="";n=a?d:i?o:r,layer.confirm(lang.del_confirm,{title:lang.title_msg,btn:[lang.ok,lang.cancle]},function(t){$.post("?/"+n+"/del/"+e,{},function(){layer.msg(lang.del_success,{time:1e3}),v(),layer.close(t)}),layer.close(t)})}),form.on("select(investor)",function(t){e(t.value)}).on("select(capfilter)",function(t){e(t.value)}),e("name"))})};function checkall(){$("input[type=checkbox]:not([disabled])").prop("checked",$(".tb_checkall").prop("checked")),form.render()}$(function(a){a.fn.b2data=function(){return this.each(function(){var e=a(this).attr("id"),t=parse_json(a(this).attr("ext"));t.divid=e,"data_list_easy"!=t.layout?(0<a("[data-mod1]").length?t.pmod=a("[data-mod1]").data("mod1"):t.pmod=window.location.search.split("/")[1],0<a("[data-mod2]").length&&(t.mod2=a("[data-mod2]").data("mod2")),a(this).hasClass("editlist")&&(t.editlist=!0),qurl=t.open?"open/id/"+t.open+"/":"",a.post("?/"+qurl+"entity/b2data",t,function(t){a("#"+e).replaceWith(t),init_rel_data(e)})):a("#"+e+" .update").trigger("click")})}}),$(function(c){c.fn.extend({appTab:function(){return $this=c(this),"flat"==$this.data("mode")?this.each(function(){var e="";$this.children(".tab-item").each(function(){var t=c(this).children(".tab-title").text();c(this).attr("id","flat_"+t),c(this).find("h2").css("display","none"),e+='<li data-href="flat_'+t+'">'+t+"</li>"}),$this.prepend('<ul class="layui-tab-title">'+e+"</ul>"),$this.find("ul[class=layui-tab-title] li").each(function(){c(this).on("click",function(){c("#"+c(this).data("href"))[0].scrollIntoView()})})}):this.each(function(){var t=c(this),n="",l="",r=0;t.children(".tab-item").each(function(t){var e=c(this).children(".tab-title").text(),a=c(this).children(".tab-content"),i=c(this).children(".tab-content").html();a.data("checked")?(r=t,n+='<li class="layui-this">'+e+"</li>"):n+="<li>"+e+"</li>",l+='<div class="layui-tab-item">'+i+"</div>",c(this).remove()}),t.prepend('<ul class="layui-tab-title">'+n+'</ul><div class="layui-tab-content" >'+l+"</div>"),r||t.find(".layui-tab-title li:first").addClass("layui-this"),t.find(".layui-tab-item").eq(r).addClass("layui-show"),c(this).find(".layui-tab-title li").click(function(){if(c(".layui-form").find(".layui-btn.history").length){var o,d,s=!1;o=c(".layui-form").find(".layui-btn.history"),d=c(o).attr("href"),setTimeout(function(){var t=c(".layui-form").find(".layui-tab-content").find(".layui-show:first").find("div:first"),e=parse_json(c(t).attr("ext")).mod,i=0;if(c(t).children().each(function(t,e){var a=c(e).attr("id");if(null!=a&&-1!=a.indexOf("item"))return i=a.substr(4,a.length-4),void(s=!0)}),s){var a=d.indexOf('"')+1,n=d.indexOf('"',a),l=d.substr(a,n-a),r=e+"/history/"+i;d=d.replace(l,r),c(o).attr("href",d)}})}c(this);setTimeout(function(){c(".update").trigger("click")})}),element.init()})}})}),$(function(o){o.fn.extend({nextPage:function(){return this.each(function(){if(null==o(this).data("done")){o(this).data("done",1);var a=o(this).closest(".pepm-form").find(".notifybox").hide(),n=o(this).closest(".pepm-form").find(".pepm-action-btns").hide(),l=o(this).children(".nextpage-item");l.each(function(t,e){var a=t?o(this).prev().children(".pepm-title").text():"",i=t<l.length-1?o(this).next().children(".pepm-title").text():"";t&&(o(this).hide(),o(this).append('<button class="layui-btn prevpage" type="button"><i class="ion ion-ios-arrow-thin-left"" style="margin-right: 3px;font-size: 24px; vertical-align: middle;"></i>'+a+"</button>")),t<l.length-1&&o(this).append('<button class="layui-btn nextpage" type="button">'+i+'<i class="ion ion-ios-arrow-thin-right" style="margin-left: 3px;font-size: 24px; vertical-align: middle;"></i></button>')});var r=o(".nextpage-item").length;1==r?n.show():n.hide(),o(this).find(".nextpage-item .prevpage").click(function(){var t=o(this).closest(".nextpage-item").prev(".nextpage-item");t.siblings().hide(),t.show(),a.hide(),n.hide(),t.index()==r?n.show():n.hide()}),o(this).find(".nextpage-item .nextpage").click(function(){var t=o(this).closest(".nextpage-item").next(".nextpage-item");if(t.siblings().hide(),t.show(),t.next(".nextpage-item").length||(a.show(),n.show()),t.find("[ftype=select_new]").each(function(){o(this).find(".select2-container").width(o(this).width())}),"1"==t.attr("rel_data_refresh")){var i=t.find(".nextpage-content").attr("id"),e=window.location.href;o.get(e,function(t,e){var a=o(t).find("#"+i).html();o("#"+i).html(a),init_rel_data(i)})}t.index()==r?n.show():n.hide(),o(".update").trigger("click"),t.find("select.select-mu").b2select()})}})}})}),layui.use(["form","layer"],function(){layui.form.on("checkbox",function(t){form.render("checkbox")}),layui.form.on("checkbox(checkall)",function(t){var e="input[type=checkbox]",a=$(t.elem).data("target");$el=a?$(a).find(e):$(e),$el.prop("checked",t.elem.checked),form.render("checkbox")}),$(document).on("mouseenter","[data-b2tips]",function(){var a=$(this),t=a.data("b2tips")||a.attr("title");t&&layer.tips(t,a,{maxWidth:"500",tips:[1,"#3595CC"],time:0,success:function(t,e){a.attr("data-tipsI",e)}})}).on("mouseleave","[data-b2tips]",function(){var t=$(this).attr("data-tipsI");t&&($(this).removeAttr("data-tipsI"),layer.close(t))})});var render_info=function(t){for(var e in t)if("shareholders"==e){var a="",i=t.shareholders;for(var n in i)""==i[n].name&&""==i[n].type||(a+=i[n].name+","+i[n].type+";\n");$("#"+e).val(a)}else if("staffs"==e){var l="",r=t.staffs;for(var n in r)l+=r[n].name+","+r[n].position+";\n";$("#"+e).val(l)}else if("changeEvents"==e){var o="",d=t.changeEvents;for(var n in d)o+="鏃堕棿锛�"+d[n].date+"锛岄」鐩細"+d[n].item+"锛屽彉鏇村墠锛�"+d[n].before+"锛屽彉鏇村悗锛�"+d[n].after+"锛沑n";$("#"+e).val(o)}else if("branches"==e){var s="",c=t.branches;for(var n in c)s+="鍚嶇О锛�"+c[n].name+"锛岄摼鎺ワ細"+c[n].url+" 锛沑n";$("#"+e).val(s)}else if($(".layui-layer-modalbox:not(.loading-layer)").length){var f=$(".layui-layer-modalbox:not(.loading-layer)").length-1;$(".layui-layer-modalbox:not(.loading-layer)").eq(f).find("#"+e).val(t[e])}else 0<$("div[data-kid="+e+"]").length?$("div[data-kid="+e+"]").reldata({data:t[e]}):$("#"+e).length?$("#"+e).val(t[e]):$("[data-kid="+e+"]").val(t[e])};function handel_gongshang(o,d){var s;layui.use(["layer","form"],function(){s=LoadingLayer.create(1,0).show()}),$.get(o,function(t,e){var a=parse_json(t);if("2"==a.status){t=a.data;var i="nameAbbr";-1!=o.indexOf("getGongshang")&&("娉曚汉",i="legalRepresentative");var n='<table class="layui-table" lay-size="sm"><colgroup><col width="500"><col width="100"></colgroup><thead><tr><th>鍏徃鍚嶇О</th><th>娉曚汉</th></tr></thead><tbody>';for(var l in t){t[l].screenName;var r=t[l].remote_uuid?t[l].remote_uuid:"";n+='<tr><td><a href="javascript:;" data-sname="'+t[l].screenName+'" data-suuid="'+r+'" onclick="apiSearch(\''+d+"',this)\">"+t[l].screenName+"</a></td><td> "+t[l][i]+"</td></tr>"}n+="</tbody></table>";layer.open({title:lang.search_result,content:n,btn:[]})}else"1"==a.status?(a.data&&(a=a.data[0]),render_info(a),s.close(),layer.msg(lang.done)):layer.msg(lang.search_error);layui.use(["layer","form"],function(){layui.layer;s.close()})})}function apiSearch(t,e){var a=$(e).data("sname")?$(e).data("sname"):"";a=a||$(e).prev().val(),t&&"gs"!=t||(url="/?/api/getGongshang/"+a),"qingbao"==t&&(url="https://db.current.vc/?/api/searchCompany/"+a),"vc"==t&&(url="https://db.current.vc/?/api/searchVc/"+a,$(e).data.suuid&&(url+="/"+$(e).data.suuid)),handel_gongshang(url,t)}function system_fill(t,e){var o=t.closest("form"),d=o.find(":input"),a=t.find("optgroup"),s=0,i=0,c=o.find("div[data-baseurl]"),f=o.find("div[ftype=area_select]"),u=o.find("[ftype=select_new][readonly]"),h=parse_json(t.attr("autofill_param")),p=parse_json(t.attr("data-props")).type_label;if(0<a.length?(null!=e&&0<t.find("option[value="+e+"]").length&&(i=t.find("option[value="+e+"]").parent()),a.each(function(){if(1==$(this).attr("data-clear"))return!(s=1)})):s=1==h.clear?1:"",1==s&&d.each(function(){var t=$(this).attr("id");return null==t||(0<$("#"+t).closest(".databox").length||(0<$("#"+t+"_label").closest(".databox").length||("autofill"==$("#"+t).attr("lay-filter2")||("_rel"==t||"_rel_view"==t||void $(this).val("")))))}),form.render(),null!=e&&-1===e.indexOf("_new")){var n={};n.uuid=e,n.type=0==i?t.data("mod"):i.data("mod"),0==i&&null!=h.mod&&(n.fill_type=h.mod),0!=i&&null!=i.data("fill_mod")&&(n.fill_type=i.data("fill_mod"));var l=h.filter;null==l&&(l=t.attr("id")),null!=l&&(n.fill_key=l),$.post("?/entity/get_fill",n,function(a){if(0!=a.ok){if(null!=(a=a.data)){var t=a.type,e=h.fill_label;null!=e&&"妯″潡(鍒嗙粍)"==p&&(e=null==e[t]?void 0:e[t]);var i=h.filter_label;if(null!=i&&"妯″潡(鍒嗙粍)"==p&&(i=null==i[t]?void 0:i[t]),"string"==typeof e&&(e=[e]),null!=e)for(var n in e){var l=e[n],r=o.find("#"+n).data("kid");null!=r&&(n=r),null!=n&&null!=a[l]&&(0<$("#"+n).closest(".databox").length||0<$("#"+n+"_label").closest(".databox").length||"autofill"!=$("#"+n).attr("lay-filter2")&&(null!=i&&-1!=$.inArray(n,i)||(0<o.find("#"+n).length&&fill_input(o.find("#"+n),l,a,s),0<o.find("[data-kid="+n+"]").length&&fill_input(o.find("[data-kid="+n+"]"),l,a,s))))}else d.each(function(){var t=$(this).attr("id"),e=$(this).data("kid");return null!=e&&(t=e),null==t||(null==a[t]||(0<$("#"+t).closest(".databox").length||(0<$("#"+t+"_label").closest(".databox").length||("autofill"==$("#"+t).attr("lay-filter2")||(null!=i&&-1!=$.inArray(t,i)||void fill_input($(this),t,a,s))))))});c.each(function(){var t=$(this).attr("data-kid");return null!=e&&-1==$.inArray(t,e)||(null!=i&&-1!=$.inArray(t,i)||void(null!=a[t]&&$(this).reldata({data:a[t]})))}),f.each(function(){var t=$(this).attr("kid");return null!=e&&-1==$.inArray(t,e)||(null!=i&&-1!=$.inArray(t,i)||void(null!=a[t]&&$(this).areaSelect({value:a[t]})))}),u.each(function(){var t=$(this).attr("kid");return null!=e&&-1==$.inArray(t,e)||(null!=i&&-1!=$.inArray(t,i)||void(null!=a[t]&&$(this).find("input[readonly]").attr("value",a[t+"_label"])))}),form.render()}}else layer.msg(a.msg)})}}function fill_input(t,e,a,i){if("object"!=typeof a||"object"!=typeof t||!e||void 0===a[e])return!1;var n=a[e],l=a[e+"_label"]||n;if(i||null!=n&&"null"!=n&&n&&"0"!==n){if(t.hasClass("select-mu")&&t.data("props")&&!t.data("b2select"))return"object"==typeof n&&(n=JSON.stringify(n),l=JSON.stringify(l)),t.attr("data-val",n),t.attr("data-val_label",l),!0;if(t.hasClass("select-mu")&&t.hasClass("select-multi")){if("object"==typeof n){var r="";n.forEach(function(t,e){r+='<option value="'+t+'">'+l[e]+"</option>"}),t.html(r)}return t.val(n).trigger("change"),!0}""!=n&&0<t.closest("[ftype=select]").length&&0==t.find("select option[value="+n+"]").length&&t.append('<option value="'+n+'">'+l+"</option>"),t.val(n).trigger("change")}}function stepbar1(t,e){$("#"+e+" .entity_info").prepend('<div class="ystep1"></div>');var a={size:"large",color:"blue",steps:t.steps};if(null!=a.steps&&""!=a.steps)try{$(".ystep1").loadStep(a);var i=$(".entity_wrap .pepm-table [fid="+t.bind+"]").clone();i.find("i").remove();var n=i.text();$(".ystep1").setStepByVal(n),$(".ystep1").attr("data-id",t.bind)}catch(t){}}function stepbar(t,e,a,i){if($("#"+a).closest(".entity_info").prepend('<div class="ystep1"></div>'),null!=t.steps&&""!=t.steps)try{for(var n='<div class="step-container"><ul class="step">',l=[],r=0;r<t.steps.length;r++)if(t.steps[r].title&&t.steps[r].val)for(var o=0;o<t.steps[r].val.length;o++)l[t.steps[r].val[o]]=r;else l[t.steps[r]]=r;if($.inArray(e,l))var d=l[e];for(r=0;r<t.steps.length;r++){var s=r<d?"finished":r==d?"active":"",c=t.steps[r].title?t.steps[r].title:t.steps[r];n+="<li class='"+s+"' data-b2tips='"+(i&&i[c]?i[c]:"")+"'><a>"+c+"</a></li>"}n+="</ul></div>",$("#"+a).closest(".entity_info").find(".ystep1").prepend(n),$("#"+a).closest(".entity_info").find(".ystep1").attr("data-id",t.bind)}catch(t){}}function select_ml(){setTimeout(function(){var h="<option value=''>璇烽€夋嫨</option>";$("div[ftype=select_ml]").each(function(){for(var s=new Array,c=$(this),f=c.data("total"),u=c.data("data"),t=u,e=1;e<=f;e++){var a=c.children("[data-dim="+e+"]").val(),i=c.children("[data-dim="+(e+1)+"]"),n=h,l="",r=(t=t[a],c.children("[data-dim="+(e+1)+"]").val());if(t&&"object"==typeof t)for(d in t){l=d==r?"selected":"";n+="<option value='"+d+"' "+l+">"+d+"</option>"}if($("option",i).remove(),i.append(n),!a)break;s.push(a)}form.render(),$(this).find("select").each(function(){var t=$(this),e=t.attr("lay-filter"),o=t.data("dim"),d=t.data("kid");form.on("select("+e+")",function(t){if(!(f<o)){var e=c.children("select[lay-filter="+d+"-"+(o+1)+"]"),a=t.value,i=c.children("select[lay-filter="+d+"-"+(o+1)+"]").nextAll("select");a&&(s[o-1]=a),s=s.slice(0,o);for(var n=u,l=0;l<s.length;l++){n=n[s[l]]}var r=h;if(n&&"object"==typeof n)for(l in n)r+="<option value='"+l+"'>"+l+"</option>";$("option",e).remove(),$("option",i).remove(),i.append(h),e.append(r),form.render()}})})})},0)}function show_child_sel(t){var e=t.data("child"),a=$("select[lay-filter="+e+"]");if(0!=a.length){var i=a.data("parent");if(null!=i){var n=t.val();if(a.find("option:gt(0)").remove(),""!=n&&null!=i[n]&&"object"==typeof i[n]){for(var l in i[n])a.append('<option value="'+l+'">'+i[n][l]+"</option>");form.render()}else form.render()}}}function linkage_sel(){$("select[data-child]").on("change",function(){var t=$(this).attr("lay-filter");""!=$(this).val()&&show_child_sel($(this)),form.on("select("+t+")",function(t){show_child_sel($(t.elem))})}),$("select[data-child]").each(function(){var t=$(this).attr("lay-filter");""!=$(this).val()&&show_child_sel($(this)),form.on("select("+t+")",function(t){show_child_sel($(t.elem))})}),$("select[data-parent][data-v]").each(function(){var t=$(this).data("v"),e=$(this).data("parent");if(null!=e){$(this).find("option:gt(0)").remove();var a="";for(var i in e){for(var n in e[i])if(n==t){a=i;break}if(""!=a)break}for(var i in e[a])$(this).append('<option value="'+i+'">'+e[a][i]+"</option>");$(this).val(t),form.render()}})}function lis_switch(){form.on("switch",function(t){0==t.elem.checked?($(t.elem).val("鍚�"),$(t.elem).parent().find("input:hidden").val("鍚�")):($(t.elem).val("鏄�"),$(t.elem).parent().find("input:hidden").val("鏄�"))})}function clear_payload(t,e){}function change_payload(e,s,c,t){if(0!=e.length&&0!=s.length){null==c&&(c=1),null==t&&(t=1),1==c&&clear_payload(s);var f=s.data("payload").split(","),u="?/entity/item_editor/",a=e.find("select"),d=0;if(0<a.closest("form").length&&1==t)var h=setInterval(function(){if(5e3<=(d+=500))clearInterval(h);else{var t={};for(var e in f){var a=$("[fid="+f[e]+"]");if(0!=a.length){var i=a.find("select");if(0<i.length){if(null==i.val()||""==i.val())return;t[f[e]]=i.val()}}}var n=s.attr("eid"),l=s.attr("kid"),r=s.attr("view"),o={};o.uuid=n,o.field=l,o.type=r,o.filter_v=t,$.post(u,o,function(t){s.html(t),form.render(),s.find("select.select-mu").b2select();var e=s.height();s.find(".select2-container").css("height",e+"px");var a=s.attr("fid"),i=$("[data-payload="+a+"]");0<i.length&&change_payload(s,i,c)},"html"),clearInterval(h)}},500);h=setInterval(function(){if(5e3<=(d+=500))return d=0,void clearInterval(h);var t=e.find("select");0<t.length&&(t.on("change",function(){var t={};for(var e in f){var a=$("[fid="+f[e]+"]");if(0!=a.length){var i=a.find("select");0<i.length&&(t[f[e]]=i.val());var n=a.find(".data-wrap");0<n.length&&(t[f[e]]=n.html().replace(/\<.+?\>/g,""))}}s.find("select").html("");var l=s.attr("eid"),r=s.attr("kid"),o=s.attr("view"),d={};d.uuid=l,d.field=r,d.type=o,d.filter_v=t,$.post(u,d,function(t){s.html(t),form.render(),clear_payload(s);var e=s.height();s.find(".select2-container").css("height",e+"px");var a=s.attr("fid"),i=$("[data-payload="+a+"]");0<i.length&&change_payload(s,i,c,0)},"html")}),d=0,clearInterval(h))},500)}}function payload_sel(t){if(null==t)var e=$("[ftype=select_new][data-payload]");else e=t;if(0<e.length){e.each(function(){var t=$(this),e=t.data("payload").split(",");for(var a in e)change_payload($("[fid="+e[a]+"]"),t)})}}function eit_payload(n){if(0!=n.length){var t=n.data("payload");if(null!=t){var e=t.split(","),a={},l=[];for(var i in e){var r=$("[fid="+e[i]+"]");0<r.find("select").length&&(a[e[i]]=r.find("select").val(),l.push(r)),0<r.find(".data-wrap").length&&(a[e[i]]=r.find(".data-wrap").html().replace(/\<.+?\>/g,""),l.push(r))}var o=n.attr("eid"),d=n.attr("kid"),s=n.attr("view");$.post("?/entity/item_editor/",{uuid:o,field:d,type:s,filter_v:a},function(t){n.html(t),form.render(),n.find("select.select-mu").b2select();var e=n.height();for(var a in n.find(".select2-container").css("height",e+"px"),l)change_payload(l[a],n,0);var i=n.data("child");eit_payload($("[fid="+i+"]"))},"html")}}}function clear_payload2(t,e){null==e&&(e=0),1==e&&t.find(".databox").data("data",""),t.find(".databox input").val("");var a=t.data("child"),i=$("[fid="+a+"]");0<i.length&&clear_payload2(i,1)}function change_payload2(e,s,c,t){if(0!=e.length&&0!=s.length){null==c&&(c=1),null==t&&(t=1),1==c&&clear_payload2(s);var f=s.data("payload").split(","),u="?/entity/item_editor/",a=e.find(".databox .val"),d=0;if(0<a.closest("form").length&&1==t)var h=setInterval(function(){if(5e3<=(d+=500))clearInterval(h);else{var t={};for(var e in f){var a=$("[fid="+f[e]+"]");if(0!=a.length){var i=a.find(".databox .val");if(0<i.length){if(null==i.val()||""==i.val())return;t[f[e]]=i.val()}}}var n=s.attr("eid"),l=s.attr("kid"),r=s.attr("view"),o={};o.uuid=n,o.field=l,o.type=r,o.filter_v=t,$.post(u,o,function(t){s.html(t),form.render();var e=s.attr("fid"),a=$("[data-payload="+e+"]");0<a.length&&change_payload2(s,a,c)},"html"),clearInterval(h)}},500);h=setInterval(function(){if(5e3<=(d+=500))return d=0,void clearInterval(h);var t=e.find(".databox .val");0<t.length&&(t.on("change",function(){var t={};for(var e in f){var a=$("[fid="+f[e]+"]");if(0!=a.length){var i=a.find(".databox .val");0<i.length&&(t[f[e]]=i.val());var n=a.find(".data-wrap");0<n.length&&(t[f[e]]=n.html().replace(/\<.+?\>/g,""))}}var l=s.attr("eid"),r=s.attr("kid"),o=s.attr("view"),d={};d.uuid=l,d.field=r,d.type=o,d.filter_v=t,$.post(u,d,function(t){s.html(t),form.render(),clear_payload2(s);var e=s.attr("fid"),a=$("[data-payload="+e+"]");0<a.length&&change_payload2(s,a,c,0)},"html")}),d=0,clearInterval(h))},500)}}function payload_databox(){var t=$("[ftype=system][data-payload]");if(0<t.length){t.each(function(){var t=$(this),e=t.data("payload").split(",");for(var a in e)change_payload2($("[fid="+e[a]+"]"),t)})}}function eit_payload2(i){if(0!=i.length){var t=i.data("payload");if(null!=t){var e=t.split(","),a={},n=[];for(var l in e){var r=$("[fid="+e[l]+"]");0<r.find(".databox .val").length&&(a[e[l]]=r.find(".databox .val").val(),n.push(r)),0<r.find(".data-wrap").length&&(a[e[l]]=r.find(".data-wrap").html().replace(/\<.+?\>/g,""),n.push(r))}var o=i.attr("eid"),d=i.attr("kid"),s=i.attr("view");$.post("?/entity/item_editor/",{uuid:o,field:d,type:s,filter_v:a},function(t){for(var e in i.html(t),form.render(),n)change_payload2(n[e],i,0);var a=i.data("child");eit_payload2($("[fid="+a+"]"))},"html")}}}$(function(w){w.fn.extend({selAutoadd:function(b){return null==b&&(b={}),this.each(function(){var _=w(this);_.parent().on("click","input",function(){var t=_.parent().find("[select-index]").attr("select-index");dl=w(".layui-form-selectoption[select-index="+t+"]").find("dl"),dl.find(".new_dd").remove();var e=dl.find("dt");0<e.length&&e.each(function(t){e.eq(t).show()})}),_.parent().on("input propertychange","input",function(){var t=_.parent().find("[select-index]").attr("select-index");dl=w(".layui-form-selectoption[select-index="+t+"]").find("dl"),dl.find(".new_dd").remove();var s=w.trim(w(this).val()),c=dl.find("dt");if(""!=s){if(0==c.length){var e=_.attr("data-autoadd");if(null==e)return;var a=_.attr("data-parent"),i=0,n="";if(null!=a){var l=_.attr("lay-filter"),r=w("select[data-child="+l+"]").val();null==r&&(r=w("[data-child="+l+"]").find(".data").html());var o=e.split("|"),d=(i=0,[]);for(var f in o){var u=o[f].split("-");u[0]==r&&(n=u[i=1]),d.push(u[1])}if(e=d.join("|"),0==i)return}var h=0,p=dl.find("dd");return 0<p.length&&p.each(function(t){if(p.eq(t).html().toLowerCase()==s.toLowerCase())return!(h=1)}),void(0==h&&(dl.prepend('<dd class="new_dd">'+s+'<a href="javascript:;" data-v="'+s+'" data-mod="'+e+'" style="width:100%;height:30px;line-height:30px;display:inline-block;">'+lang.create+"</a></dd>"),dl.off("click",".new_dd").on("click",".new_dd",function(){var t=w(this).find("a"),a=t.attr("data-v"),e=t.attr("data-mod");""!=n&&(e=n);var i={};i.md=e,i.val=a,w.post("?/entity/autoadd",i,function(t){if(layer.msg(t.msg),0!=t.ok){dl.find(".new_dd").remove();var e=t.uuid;_.append('<option value="'+e+'">'+a+"</option>"),_.val(e),form.render(),"function"==typeof b.fn&&b.fn(_)}})})))}var m=_.find("optgroup[data-mod]"),v=[],g={};0<m.length&&m.each(function(t){var e=m.eq(t),a=e.attr("label");v.push(a),g[a]=e.attr("data-mod")});var y=_.attr("data-autoadd"),$=[];null!=y&&0!=y&&($=y.split("|")),c.each(function(t){var e=c.eq(t);e.show();var a=e.html(),i=g[a],n=0;if(0<$.length)for(var l=0;l<$.length;l++)if($[l]==i){n=1;break}var r=e.nextAll(),o=0,d=0;r.each(function(t){var e=r.eq(t);if("DD"!=e[0].nodeName)return!1;var a=e.html();a.toLowerCase()==s.toLowerCase()&&(o=1),-1!=a.toLowerCase().indexOf(s.toLowerCase())&&(d=1)}),0==o&&1==n&&(e.after('<dd class="new_dd">'+s+'<a style="width:100%;height:30px;line-height:30px;display:inline-block;" href="javascript:;" data-v="'+s+'" data-mod="'+i+'">'+lang.create+"</a></dd>"),dl.off("click",".new_dd").on("click",".new_dd",function(){var t=w(this).find("a"),a=t.attr("data-v"),i=t.attr("data-mod"),e={};e.md=i,e.val=a,w.post("?/entity/autoadd",e,function(t){if(layer.msg(t.msg),0!=t.ok){dl.find(".new_dd").remove();var e=t.uuid;_.find("optgroup[data-mod="+i+"]").append('<option value="'+e+'">'+a+"</option>"),_.val(e),form.render(),"function"==typeof b.fn&&b.fn(_)}})})),0==d&&0==n&&e.hide()})}else 0<c.length&&c.each(function(t){c.eq(t).show()})})})}})}),$(function($){$.fn.extend({selectPop:function(){return this.each(function(){var $this=$(this);$this.on("click",function(){var id=$this.find(".select-pop-content").attr("data-id"),dd2=$("[data-id="+id+"]").find("dd[data-name2]");dd2.each(function(t){var e=dd2.eq(t).attr("data-name2"),a=dd2.eq(t).find(".name").html();dd2.eq(t).attr("data-name",a),dd2.eq(t).find(".name").html(e),dd2.eq(t).removeAttr("data-name2")});var _html=$this.find("[data-id="+id+"]").html(),rect=$this[0].getBoundingClientRect(),top=rect.top,left=rect.left,h=Number($this.height());top+=h,layeropen({id:"select-pop-id",type:1,title:lang.please_select,content:_html,shade:[.1,"#fff"],shadeClose:!0,offset:[top+"px",left+"px"],success:function(layero,index){left+$(layero).outerWidth()>$(window).width()&&$(layero).css({left:"auto",right:0}),$("#select-pop-id").off("click").on("click","dd",function(){var opt=$(this).attr("data-opt"),v=$(this).attr("lay-value");if(null!=opt)for(var i in opt=eval("("+opt+")"),$this.find("[data-id="+id+"]").find("dd").addClass("layui-hide"),opt)opt[i]!=v&&$this.find("[data-id="+id+"]").find("dd[lay-value="+opt[i]+"]").removeClass("layui-hide");else $this.find("[data-id="+id+"]").find("dd").removeClass("layui-hide"),$this.find("[data-id="+id+"]").find("dd[lay-value="+v+"]").addClass("layui-hide");var name=$(this).html(),name2=$(this).find(".name").html();if("閲嶆柊鎵撳紑"==name2&&(name=name.replace(name2,"寰呭姙")),name.replace(),$this.parent().find(".select-pop>.select-pop-name").html(name),0<$this.parent().find("input").length)$this.parent().find("#"+id).val(v),null!=$(this).attr("data-name")?$this.parent().find("#"+id+"_label").val($(this).attr("data-name")):$this.parent().find("#"+id+"_label").val($(this).find(".name").html()),0<$this.parent().find("#"+id+"_icon").length&&$this.parent().find("#"+id+"_icon").val($(this).find(".icon").html());else{var params={};params.uuid=$this.attr("data-uuid"),params.field=id,params.val=v,null!=$(this).attr("data-name")?params.val_label=$(this).attr("data-name"):params.val_label=$(this).find(".name").html(),params.type="task",0<$this.parent().find("#"+id+"_icon").length&&(params.val_icon=$(this).find(".icon").html());var url="?/entity/item_editor/";$.post(url,params,function(t){},"html")}layer.close(index)})}})})})}})}),$(function(o){o.fn.Checklist=function(){return this.each(function(){var r=o(this);if(!r.attr("init")){r.attr("init",!0);var t=0==r.closest(".layui-form").length,e=!!r.parents(".flow").length,a=!t&&"FORM"==r.closest(".layui-form")[0].tagName;save=e?3:r.data("save"),edit_style=e?2:r.data("edit-style"),save=1==edit_style&&3==save?1:save,additem_enable=r.data("additem_enable"),edititem_enable=r.data("edititem_enable"),dragsort=r.data("dragsort"),show_progress=r.data("show_progress"),progress_text_style=r.data("progress_text_style"),eit=!!r.closest(".editintime").length,$td=r.closest("td"),r=r.clone(),$td.empty().append(r);var i={init:function(){e&&!a?i.all_disabled():i.listen()},render_progress:function(){if(show_progress){var t=r.find("input[name]:checkbox:checked").length,e=r.find("input[name]:checkbox").length,a=(t=Math.min(t,e),e?Math.round(t/e*100):0),i="",n=r.find(".layui-progress").attr("lay-filter");switch(Math.floor(a/25)){case 4:case 3:i="green";break;case 2:i="orange";break;case 1:i="blue";break;case 0:i="red"}a+="%",r.find("input[name]:checkbox").hide(),1<save&&element.progress(n,a),r.find(".layui-progress-bar").attr("class","layui-progress-bar layui-bg-"+i),this.show_per(t,e,a)}},show_per:function(t,e,a){if(show_progress&&1!=progress_text_style&&r.find(".layui-progress-text").length){switch(progress_text_style){case 2:progress_text=a;break;case 3:progress_text=t+"/"+e;break;case 4:progress_text=t;break;case 5:progress_text=t?r.find("input[name]:checkbox:checked").last().val():""}r.find(".layui-progress-text").html(progress_text)}},all_disabled:function(){r.find("input[name]:checkbox").each(function(){o(this).attr("disabled",!0),this.disabled=!0}),r.find(".layui-form-checkbox").addClass("layui-disabled"),r.find(".check_to_add,.check_to_save").hide()},listen:function(){var l=this;dragsort&&this.sorTable(),r.off("click",".check_to_save,.check_to_add,.check_to_edit,.check_cancel,.check_add,.check_save,.check_del").on("click",".layui-form-checkbox:not(.layui-disabled)",function(){o(this).prev()[0].checked?(o(this).prev()[0].checked=!1,o(this).removeClass("layui-form-checked")):(o(this).prev()[0].checked=!0,o(this).addClass("layui-form-checked")),l.update_item()}).on("click",".check_to_save",function(){o(this).hide().prevAll(".check_to_add").show(),eit||r.data("form",1),update_item(r.closest("td"))}).on("click",".check_to_add,.check_to_edit",function(){if(o(this).closest(".check_item").length){o(this).closest(".check_item").addClass("check_on_edit");var t=o(this).closest(".check_item").children("input").val();o(this).closest(".check_item").find(".check_edit").val(t),o(this).closest(".check_item").siblings().removeClass("check_on_edit").find(".check_edit").val(""),o(this).closest(".checklist").find(".check_to_add").show().nextAll(".addcheck").hide().children(".check_edit").val("")}else o(this).hide().nextAll(".addcheck").show().prevAll(".check_options").children().removeClass("check_on_edit").find(".check_edit").val("")}).on("click",".check_cancel",function(){o(this).closest(".check_item").length?(o(this).closest(".check_item").removeClass("check_on_edit"),o(this).parent().prev().val("")):o(this).parent().parent().hide().prevAll(".check_to_add").show()}).on("click",".check_add,.check_save,.check_del",function(){var t=o(this).attr("action"),e=o(this).closest(".checklist").parent().attr("kid"),a=o(this).parent().prev().val();if(""!=a||"del"==t){switch(t){case"add":l.additem(o(this),e,a);break;case"save":l.saveitem(o(this),a);break;case"del":l.delitem(o(this))}l.changeitem(o(this))}else layer.msg("璇峰～鍐欐湁鏁堥€夐」",{time:1e3})}).on("keyup",".check_edit",function(t){if(13==t.keyCode){var e=o(t.target),a=e.attr("action"),i=e.closest(".checklist").parent().attr("kid"),n=e.val();""!=n?("add"==a?l.additem(e,i,n):"save"==a&&l.saveitem(e,n),l.changeitem(o(this))):layer.msg("璇峰～鍐欐湁鏁堥€夐」",{time:1e3})}}),r.parent().off("click",".checklist").on("click",".checklist",function(t){("DIV"==t.target.nodeName||o(t.target).parents(".layui-progress").length)&&(o(this).find(".check_item").removeClass("check_on_edit").find(".check_edit").val(""),o(this).children(".check_to_add").show().nextAll(".addcheck").hide().children(".check_edit").val(""))})},additem:function(t,e,a){var i='<div class="check_item">            <input type="checkbox" name="data['+e+'][]" value="'+a+'" title="'+a+'" lay-skin="primary" lay-filter="checklist"/>            <div class="layui-unselect layui-form-checkbox" lay-skin="primary"><span>'+a+'</span><i class="layui-icon">&#xe605;</i></div>            <a class="check_to_edit" type="button">              <i class="layui-icon">&#xe642;</i>            </a>            <div class="addcheck">              <input class="check_edit" placeholder="娣诲姞涓€涓€夐」..." action="save">              <div class="addcheck-control">                <button class="layui-btn  layui-btn-primary layui-btn-small check_save" action="save" type="button">淇濆瓨</button>                <button class="layui-btn  layui-btn-primary layui-btn-small check_del" action="del" type="button">鍒犻櫎</button>                <button class="layui-btn  layui-btn-primary layui-btn-small check_cancel" type="button">鍙栨秷</button>              </div>            </div>          </div>';t.closest(".checklist").children(".check_options").append(i),t.closest(".checklist").children(".check_options").prev().append("<option selected>"+a+"</option>")},saveitem:function(t,e){t.closest(".check_item").children("input[type='checkbox']").val(e).attr("title",e),t.closest(".check_options").prev().children().eq(t.closest(".check_item").index()).val(e)},delitem:function(t){t.closest(".check_options").prev().children().eq(t.closest(".check_item").index()).remove(),t.closest(".check_item").remove()},changeitem:function(t){t.closest(".checklist").find(".check_item").removeClass("check_on_edit").find(".check_edit").val(""),t.closest(".checklist").children(".check_to_add").show().nextAll(".addcheck").hide().children(".check_edit").val(""),this.update_item()},update_item:function(){1<save?(2==save&&r.find(".check_to_save").show(),i.render_progress()):(r.data("form",1),e?i.render_progress():update_item(r.closest("td")))},sorTable:function(){var e=this;r.find(".check_options").each(function(){new Sortable(this,{animation:150,group:".layui-form-checkbox",handle:".layui-form-checkbox",onEnd:function(t){e.rebuildOptionsSort(t)}})})},rebuildOptionsSort:function(t){var e=o(t.item).parent().prev();o(t.item).parent().children().each(function(t){e.children().eq(t).text(o(this).children("input[type=checkbox]").val())}),this.update_item()}};i.init()}})}});var eit_init=function(){var g=null,y="?/entity/item_editor/",_=!1;function b(t){$(t).removeClass("editing");var e=$(t).attr("kid"),a=$(t).closest("[view]").attr("view");if(eid=$(t).attr("eid"),refresh=!!$(t).attr("refresh"),1==$(t).closest(".data-table").length&&(eid=$(t).closest(".data-table").attr("id").substr(4)),$(t).closest(".rel_data").length&&$(t).closest(".rel_data").hasClass("editlist")){var i=$(t).closest("table").find("thead tr th").eq($(t).index()),n=!0;e=i.attr("kid"),a=i.attr("view"),eid=$(t).parent("tr").attr("uuid")}if(null!=eid){var l={form:!1,eit:!0},r="",o=$(t).find(":input"),d=$(t).find(":input").eq(1).val();switch($(t).attr("ftype")){case"radio":r=o.eq(0).parent().find(":checked").val(),d=o.eq(0).parent().find(":checked").attr("title"),null==r&&(r=""),null==d&&(d="");break;case"check":case"switch":case"checkbox":if(0<o.eq(0).closest("td[ftype=check]").length||0<o.eq(0).closest("td[ftype=switch]").length){r=o.eq(0).closest("td").find("input:hidden").val();break}r=new Array,o.eq(0).closest("td").find(":input[name]:checked").each(function(){r.push($(this).val())}),0==r.length&&(r=""),d=[];e=(f=o.eq(0).closest("td")).attr("kid");f.find("#"+e+"_label").find("input").each(function(){d.push($(this).val())}),0==d.length&&(d="");break;case"tpl":case"quick_msg":case"select_mu":case"select_new":var s=o.eq(0).closest("td").find(".select-mu");s.attr("multiple")?(r=[],d=[],$.each(s.select2("data"),function(t,e){r.push(e.id),d.push(e.text)})):(d=r="",$.each(s.select2("data"),function(t,e){r=e.id,d=e.text}));break;case"checklist":r=[],d=[],$(t).find(":input[type=checkbox][name]").each(function(){$(this)[0].checked&&r.push($(this).val()),d.push($(this).val())}),0==r.length&&(r=""),0==d.length&&(d=""),l.form=!!$(t).find(".checklist").data("form"),l.eit=!!$(t).closest(".editintime").length;break;case"rte_min":r=o.eq(0).next().find("iframe").contents().find("body").html();break;case"rte":var c=UE.getEditor(o.eq(0).next().attr("id"));r=c.getContent();break;case"markdown":r=o.val(),d=o.parent().find(".editormd-html-textarea").text();break;case"area_select":r={},arr=[],o.eq(0).closest("td[ftype=area_select]").find("select,input").each(function(){arr.push($(this).attr("id"))}),o.eq(0).closest("td").find("select,input").each(function(t){r[arr[t]]=$(this).val()});break;case"datalist":e=(f=o.eq(0).closest("td")).attr("kid");var f,u=f.find("#"+e+"_label").find("input");r=u.eq(0).val(),d=u.eq(1).val();break;case"amount":case"percent":case"yuan":case"wan":case"yi":case"dollar":case"currency":case"money":case"million2":var h=o.attr("decimals")||2;r=number_format(o.val(),h,".","");break;default:r=o.val()}if(l.uuid=eid,l.field=e,l.val=r,l.val_label=d,l.type=a,$(t).closest(".rel_data").length){var p=$(t).closest(".rel_data").attr("ext"),m=jQuery.parseJSON(p);l.filter=m.filter}0<$(t).find("input.icon").length&&(l.val_icon=$(t).find("input.icon").val()),function d(s,c,f){var u=c.uuid;var h=s.find(".uploader").attr("data-id");var p=s.find("select").attr("data-child");"object"==typeof c.val&&0==c.val.length&&(c.val="");"object"==typeof c.val_label&&0==c.val_label.length&&(c.val_label="");$.ajax({url:y+(u?"":"add"),method:"POST",dataType:"JSON",data:c,success:function(t){refresh&&v(),s.html(t.html),s.children(".data").addClass("eit"),f&&void 0===s.parent("tr").attr("uuid")&&s.closest("tr").attr("uuid",t.eid).attr("id","item"+t.eid),form.render(),element.init(),s.find(".checklist").Checklist(),"checklist"==s.attr("ftype")&&1==s.attr("data-required")&&s.find(".check_item>input[name]").attr("lay-verify","required"),"state"==c.field&&($("#canvas").find(".pipeline").length&&w($("#canvas").find(".pipeline").parent()),$("#canvas").find(".mydeal").length&&w($("#canvas").find(".mydeal").parent())),0<$(".edui_rte_show").find("iframe").length&&$(".edui_rte_show").find("iframe").each(function(){var t=$(this),e=t.closest(".data");t.contents().find("html").on("click",function(){t.remove(),e.trigger("click")})});var e=s.attr("data-child");if(null!=e){var a=$("[fid="+e+"]");b(a)}if(h&&$("[kid="+h+"]").length){var i={};i.uuid=u,i.field=h;var n=[],l=$("[kid="+h+"]");l.find(":input[name]:checked").each(function(){n.push($(this).val())}),0==n.length&&(n="");var r=[],o=l.find("#"+h+"_label").find("input");o.each(function(){r.push($(this).val())}),0==r.length&&(r=""),i.val=n,i.val_label=r,i.type=c.type,d(l,i,!1)}if(p&&$("[fid="+p+"]").length){var l=$("[fid="+p+"]");if(0==l.length)return;var i={};i.uuid=u,i.field=l.attr("kid");var n=l.find("select").val(),r=l.find("select>option:selected").html();i.val=n,i.val_label=r,i.type=c.type,d(l,i,!1)}s.removeClass("eit-readonly"),s.removeClass("eit-editable"),s.find("input").removeClass("eit-readonly"),s.find("input").removeClass("eit-editable")}})}($(t),l,n)}}function w(t){t.load(t.attr("url"))}function k(){$("select[data-child]").each(function(){var t=$(this).attr("lay-filter");form.on("select("+t+")",function(t){var e=form.getSelect($(this)).closest("td").find("select").data("child"),a=$("select[lay-filter="+e+"]");if(0!=a.length){var i=a.data("parent");if(null!=i){var n=t.value;if(a.find("option:gt(0)").remove(),""!=n&&null!=i[n]&&"object"==typeof i[n]){for(var l in i[n])a.append('<option value="'+l+'">'+i[n][l]+"</option>");form.render()}else form.render()}}})}),$("select[data-parent]").each(function(){var t=$(this).data("v");null==t&&(t="");var e=$(this).data("parent");if(null!=e){$(this).find("option:gt(0)").remove();$(this).attr("lay-filter");$("td[data-child]").find("i").remove();var a=$("td[data-child]").find(".data").text();null!=a&&""!=a||(a=$("td[data-child]").find("select").val());var i={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};for(var n in e[a=a.replace(/&(lt|gt|nbsp|amp|quot);/gi,function(t,e){return i[e]})])$(this).append('<option value="'+n+'">'+e[a][n]+"</option>");$(this).val(t)}}),form.render()}$("html").on("click",function(e){if($(e.target).closest(".checklist").length){var a=$(e.target).closest(".checklist"),i=a.data("save");if(1==a.data("edit-style"))return;if($(e.target).parents(".flow").length)return;if(a.data("edit")){if($(e.target).closest(".layui-form-checkbox,.check_to_save,.check_to_add,.check_to_edit,.check_cancel,.check_add,.check_save,.check_del").length)return;a.data("form",0)}else{if(!$(e.target).parents().hasClass("editintime"))return;a.data("form",1)}g&&g.find(".checklist").length&&1<i&&(g=null)}if(0<$(e.target).closest("[ftype=rte] .data").length){if(!$(e.target).parents().hasClass("editintime"))return;$(e.target).closest("[ftype=rte]").find(".edui_rte_show iframe").remove()}if(g){if(_)return;if("INPUT"==e.target.nodeName||$(e.target).hasClass("btn-upload-file")||$(e.target).hasClass("btn-upload-select")||"TEXTAREA"==e.target.nodeName||"I"==e.target.nodeName||"BODY"==e.target.nodeName)return;if(0<$(e.target).closest(".select2-container").length)return;if(0<$(e.target).closest("select").length)return;if($(e.target).hasClass("select2-selection__choice__remove"))return;if("_switch"==$(e.target).attr("lay-skin"))return;if("A"==e.target.nodeName)return;if($(e.target).closest(".editormd").length)return;if($(e.target).closest("#edui_fixedlayer,.edui_rte").length)return;if($(e.target).closest(".layui-util-face").length)return;if($(document).find("#file-form:visible,.doc-tree:visible,.notifybox:visible").length&&$(e.target).closest("#file-form,.doc_choose,.notifybox,.layui-layer,.layui-layer-shade").length)return;if(0<$(e.target).closest(".select-pop").length)return;if(0<$(".databox-layer").length)return;b(g),g=null}if($(e.target).parents().hasClass("pepm-form")&&$(e.target).closest(".rel_data").length&&$(e.target).closest(".rel_data").hasClass("editlist")||$(e.target).closest(".checklist").length);else if(!$(e.target).parents().hasClass("editintime"))return;if($(e.target).hasClass("data")||$(e.target).parents().hasClass("data")||$(e.target).closest(".checklist").length){if(_)return void layer.msg(lang.loading_widget);var n;if(_=!0,setTimeout(function(){_=!1},5e3),0<$(e.target).closest("[ftype=select_new][data-child]").length&&0==$(e.target).closest("form").length)null!=(n=$(e.target).closest("[data-child]").data("child"))&&eit_payload($("[data-payload][fid="+n+"]"));if(0<$(e.target).closest("[ftype=system][data-child]").length&&0==$(e.target).closest("form").length)null!=(n=$(e.target).closest("[data-child]").data("child"))&&eit_payload2($("[data-payload][fid="+n+"]"));var l=e||window.event,r=l.srcElement||l.target;if("A"==r.nodeName)return;if($elem=$(e.target).hasClass("data")?$(r).parent():$(r).parents(".data").parent(),$elem=$(e.target).closest(".checklist").length?$(e.target).closest("td"):$elem,0<$elem.find("iframe").length||"_switch"==$(e.target).attr("lay-skin"))return;var o=$elem.attr("kid"),d=$elem.attr("fid"),s=$elem.attr("view"),c=$elem.attr("eid"),f=$elem.attr("ftype"),u=$elem.attr("readonly")?"readonly":"",h=$elem.attr("required")?"required":"";if(1==$elem.closest(".data-table").length&&(c=$elem.closest(".data-table").attr("id").substr(4)),$elem.closest(".rel_data").length&&$elem.closest(".rel_data").hasClass("editlist")){var p=$elem.closest("table").find("thead tr th").eq($elem.index());o=p.attr("kid"),d=p.attr("fid"),s=p.attr("view"),c=$elem.parent("tr").attr("uuid"),f=p.data("itype"),u=p.attr("readonly")?"readonly":"",h=p.attr("required")?"required":""}if(null==o)return;if(u)return void(_=!1);var m=function(){if("text"==f){t=$elem.find(".data-wrap").html(),$fhtml=$('<input type="text" class="layui-input" '+u+' id="'+o+'" name="data['+d+']" lay-verify="'+h+'" value="">'),$elem.html("").append($fhtml),$elem.addClass("eit-"+($elem.attr("readonly")?"readonly":"editable")),$elem.find("input").addClass("eit-"+($elem.attr("readonly")?"readonly":"editable"));var e=$elem.height();return $elem.find("input").css("height",e+"px"),_=!1,$fhtml.focus().val(t),$fhtml.on("blur keydown",function(t){13!=t.which&&0!=t.which||(b(g),g=null)}),void(g=$elem)}var a={uuid:c,field:o,type:s},i={},n=$elem.data("payload");if(null!=n){var l=n.split(",");for(var r in l)0<$("[fid="+l[r]+"]").find(".data-wrap").length&&(i[l[r]]=$("[fid="+l[r]+"]").find(".data-wrap").html().replace(/\<.+?\>/g,"")),0<$("[fid="+l[r]+"]").find("select").length&&(i[l[r]]=$("[fid="+l[r]+"]").find("select").val()),0<$("[fid="+l[r]+"]").find(".databox .val").length&&(i[l[r]]=$("[fid="+l[r]+"]").find(".databox .val").val());a.filter_v=i}$.post(y,a,function(t){$elem.html(t),g=$elem,form.render(),creat_name_by_sel(),element.init(),$elem.find(".btn-upload-file").uploader(),$elem.find(".checklist").Checklist(),$elem.find("select.select-mu").b2select();var e=$elem.attr("data-fid"),a=$elem.attr("data-child");if(null!=e&&k(),null!=a&&function i(t){var n=$("td[data-fid="+t+"]");if(0==n.length)return;var e=n.attr("eid");var a=n.attr("kid");var l=n.attr("view");$.post(y,{uuid:e,field:a,type:l},function(t){n.html(t),n.addClass("editing"),form.render(),creat_name_by_sel(),element.init();var e=n.attr("data-fid"),a=n.attr("data-child");null!=e&&k(),null!=a&&i(a)},"html");form.render()}(a),$elem.find(".select-pop").selectPop(),-1!=["operator","update_operator"].indexOf(f)?($elem.addClass("eit-readonly"),$elem.find("input").addClass("eit-readonly")):($elem.addClass("eit-"+($elem.attr("readonly")?"readonly":"editable")),$elem.find("input").addClass("eit-"+($elem.attr("readonly")?"readonly":"editable"))),0<$(".ystep1").length){var i=$(".ystep1").attr("data-id");0<$("select[lay-filter="+i+"]").length&&$("select[lay-filter="+i+"]").on("change",function(){$(".ystep1").setStepByVal($(this).val())})}$elem.find(".databox .val").change(function(){var t=$elem.find("[lay-filter2=autofill]");t.length&&system_fill(t,$(this).val())}),form.on("checkbox",function(t){if(0<$(t.elem).closest("td[ftype=checkbox]").length){var e=$(t.elem).closest("td[ftype=checkbox]").find("input:checkbox:checked"),a=$(t.elem).closest("td[ftype=checkbox]").attr("kid"),i="";return e.each(function(){var t=$(this).attr("data-label");i+='<input type="checkbox" name="data['+a+'_label][]" value="'+t+'">'}),void $("#"+a+"_label").html(i)}0<$(t.elem).closest("td[ftype=check]").length&&(0==t.elem.checked?($(t.elem).val("鍚�"),$(t.elem).parent().find("input:hidden").val("鍚�")):($(t.elem).val("鏄�"),$(t.elem).parent().find("input:hidden").val("鏄�")))}),form.on("radio",function(t){var e=$(t.elem).attr("title"),a=$(t.elem).closest("td[ftype=radio]").attr("kid"),i='<input type="text" name="data['+a+'_label]" value="'+e+'">';$("#"+a+"_label").html(i)}),lis_switch(),$("input[list]").on("input propertychange",function(){if(0!=$(this).closest("[ftype=datalist]").length){var t=$(this).val(),e="";if(""!=t){var a=$(this).closest("[ftype=datalist]").find("option[value="+t+"]");e=0<a.length?a.attr("data-id"):t}var i=$(this).closest("[ftype=datalist]").attr("kid"),n='<input type="text" name="data['+i+']" value="'+e+'">';n+='<input type="text" name="data['+i+'_label]" value="'+t+'">',$("#"+i+"_label").html(n)}}),form.on("select",function(t){if(0<$(t.elem).closest("[ftype=config]").length){var e=$(t.elem).closest("[ftype=config]").attr("kid"),a=$("#"+e).find("option:selected").text();$("#"+e+"_label").html('<input type="text" name="data['+e+'_label]" value="'+a+'">')}else;}),_=!1},"html")};if($(e.target).closest("#edui_fixedlayer,.edui_rte").length)return;if($(e.target).closest(".layui-util-face").length)return;if($(e.target).hasClass("edui_rte_show")||$(e.target).closest(".edui_rte_show").length||$(e.target).find(".edui_rte_show").length){var v=function(){$(".entity_info").find(".edui_rte").length?setTimeout(function(){v()},1):m()};return void v()}m()}}),window.update_item=b};function check_key_ajax(t,i){if("object"==typeof t&&t.val){var n=t.label||"椤圭洰";$.ajax({url:"?/entity/check_word",type:"post",data:t,success:function(t){if("object"!=typeof t||t.length<1)"function"==typeof i&&i();else{for(var e='<p class="tips-p1">'+n+' 宸插瓨鍦紝璇峰嬁閲嶅娣诲姞銆傜紪杈戝凡鏈夋暟鎹垨杩斿洖淇敼銆�</p><div style="padding:10px 15px"><ul>',a=0;a<t.length;a++)e+='<li><a class="repeat-name" href="/?/'+t[a].type+"/view/about/"+t[a].uuid+'/edit/">'+(t[a].name||"鐐瑰嚮缂栬緫")+"</a></li>";e+="</ul></div>",layer.open({title:lang.data_exist,type:0,content:e,btn:lang.edit})}}})}}function show_sign_qrcode(a){var i=layer.open({type:1,title:lang.scan_qrcode,content:'<div id="qrcode_area"></div>',anim:5,cancel:function(t,e){var a=layer.confirm(lang.confirm_cancel,{btn:[lang.ok,lang.cancel]},function(t,e){layer.close(i),layer.close(a),window.clearInterval(n)},function(t){});return!1}}),t="?/api/sign/&sign_session_id="+a,e=window.location.href.split("?")[0];e+=t;new QRCode(document.getElementById("qrcode_area"),{text:e,width:300,height:300,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}),this.check_sign=function(){$.post("?/api/sign",{check_success:"1",sign_session_id:a},function(t){var e=(t=JSON.parse(t)).filename;e&&($("#sign-input-"+a).val(e),$("#sign-image-"+a).attr("src",e),layer.close(i),window.clearInterval(n))})};var n=setInterval("check_sign()",2e3)}function show_sign_board(i){var n=layer.open({type:1,title:lang.sign_board,content:'<form class="drawing-form" action="" method="post"><div id="sign-board" style="height:200px;width:330px;"></div><button class="layui-btn layui-btn-sm">鎻愪氦</button></form>',anim:5}),l="",r=new DrawingBoard.Board("sign-board",{controls:["Navigation"],size:2,webStorage:!1,enlargeYourContainer:!0});$(".drawing-form").on("submit",function(t){t.preventDefault()||t.stopPropagation();var e=r.getImg(),a=r.blankCanvas==e?"":e;$.post("?/api/sign",{image:a,sign_session_id:i,direct_sign:1},function(t){t=JSON.parse(t);l=t.filename,$("#sign-input-"+i).val(l),$("#sign-image-"+i).attr("src",l),r.clearWebStorage(),layer.close(n)})})}function dynamicForm(t){for(var e in t)$("form table td[kid="+e+"]").dynamicForm(t[e])}function supportCSS3(t){var e,a,i=["webkit","ms","o","moz"],n=document.documentElement.style,l=[],r=function(t){return t.replace(/-(\w)/g,function(t,e){return e.toUpperCase()})};for(e in i)a=r(i[e]+"-"+t),l.push(a);for(e in a=r(t),l.push(a),l)if(l[e]in n)return!0;return!1}$(function($){$.fn.extend({dynamicForm:function(param){if(this.length){var $param=param,dparam=$param.default,$form=this.closest("form"),showcase=dparam&&dparam.showcase&&0<=["clear","default"].indexOf(dparam.showcase)?dparam.showcase:"null",hidecase=dparam&&dparam.hidecase&&0<=["clear","default"].indexOf(dparam.hidecase)?dparam.hidecase:"null",hidedel=!dparam||"boolean"!=typeof dparam.hidedel||dparam.hidedel,range=[],showclear=[],showdefault=[],shownull=[],hideclear=[],hidedefault=[],hidenull=[];if(["show","hide","toggle"].forEach(function(v){eval("dparam&&dparam."+v+"&&(typeof dparam."+v+"=='string'&&(dparam."+v+"=[dparam."+v+"]),true)&&range.push.apply(range,dparam."+v+");")}),dparam&&dparam.target)for(var i in dparam.target){var m=dparam.target[i].showcase,n=dparam.target[i].hidecase,m=null===m?"null":m,m=void 0===m?"1":m,n=null===n?"null":n,n=void 0===n?"1":n;0<=["clear","default","null"].indexOf(m)&&eval("show"+m+".push(i);"),0<=["clear","default","null"].indexOf(n)&&eval("hide"+n+".push(i);")}["range","showclear","showdefault","shownull","hideclear","hidedefault","hidenull"].map(function(v){eval(v+"=unique("+v+");")});var toggle=function(uuids,action){["show","hide"].indexOf(action)<0||("string"==typeof uuids&&(uuids=[uuids]),uuids.forEach(function(uuid){var td=$form.find("table td[kid="+uuid+"]"),flag=!0;eval("td."+action+'(),td.prev(".label").'+action+"();"),["clear","default","null"].forEach(function(v){flag&&eval(action+v+".indexOf(uuid)>=0&&(flag=false)||to_"+v+"(td)")}),flag&&eval("to_"+eval(action+"case")+"(td)")}))},show=function(t){toggle(t,"show")},hide=function(t){toggle(t,"hide")},target=function(t){for(var e in t)t[e].action&&toggle(e,t[e].action),t[e].change&&val.call(e,t[e].change.val,t[e].change.val_label)},val=function(t,e){var a="string"==typeof this?$form.find("table td[kid="+uuid+"]"):this;if(!a.length)return!1;switch(a.attr("ftype")){case"text":value=a.find("input").val(t)}return value},to_clear=function(t){var e=t;switch(e.attr("ftype")){case"text":e.find("input").val("")}},to_default=function(t){var e=t;switch(e.attr("ftype")){case"text":var a=e.find("input");a.val(a.attr("default"))}},to_null=function(){},flag_default=function(t){var e=$form.find("table td[kid="+t+"]");switch(e.attr("ftype")){case"text":var a=e.find("input");a.attr("default",a.val())}},calljs=function(jsnames){var dynamic=this;"string"==typeof jsnames&&(jsnames=[jsnames]),jsnames.forEach(function(name){var uuids=name.replace(/\{|\}/gim,"").split("|"),jsname=uuids.shift();if("function"==typeof eval(jsname)){var value=val.call(dynamic),param={value:value};uuids.forEach(function(t){param[t].push(val.call(t))}),eval(jsname+"(param)")}else console.error("function '"+jsname+"' is not exist!")})},search_case=function(t,e){for(var a in e){var i=val.call(t);if("object"==typeof i&&(i=i.val_label),"string"==typeof e[a].value?i==e[a].value:0<=e[a].value.indexOf(i))return a}return!1},lischange=function(t){switch(this.attr("ftype")){case"text":this.on("change","input",t)}};return this.each(function(){var a=$(this);if(!dparam)return!0;dparam.value&&val.call(a,dparam.value),dparam.show&&show(dparam.show),dparam.hide&&hide(dparam.hide),dparam.target&&target(dparam.target),dparam.defaultjs&&calljs.call(a,dparam.defaultjs),range.forEach(function(t){flag_default(t)}),delete $param.default;var t=$.isEmptyObject($param)?!(!dparam.toggle&&!dparam.js)&&function(){dparam.toggle&&toggle.call(dparam.toggle,val.call(a)?"show":"hide"),dparam.js&&calljs.call(a,dparam.js)}:function(){var t=search_case(a,$param);if(t){var e=$param[t];e.show&&show(e.show),e.hide&&hide(e.hide),e.target&&target(e.target),e.js&&calljs.call(a,e.js)}};t&&lischange.call(a,t)})}}})});var layoutHorizontalInit=function(){$(function(){$("body").css("background","#f3f3f3"),$("#hmenu1").width($("#menu1").width()-$(".logo").outerWidth(!0)-$(".hsysnav .sys-nav").width()-$("#menu1 .search-box").outerWidth()),$(".nav-more").hide();var i=0;$(".horizontal #hmenu1 li~li").each(function(t,e){(i+=$(e).outerWidth(!0))>=$("#hmenu1").width()&&($(".nav-more").show(),$(e).addClass("more-nav").hide())}),$(".horizontal #menu1 .nav-more").on("click",function(){var t=$(".horizontal #menu1"),e=Math.floor(i/$("#hmenu1").width());if($(t).hasClass("mored"))$(".horizontal #menu1 .nav-more a").addClass("ion-android-arrow-dropdown").removeClass("ion-android-arrow-dropup"),$(".horizontal #menu1 .nav-more").css("top","36px"),$(t).removeClass("mored").height(72),$(".horizontal #hmenu1 li.more-nav").each(function(t,e){$(e).hide()});else{var a=36+36*(e+1);$(t).addClass("mored").height(a),$(".horizontal #menu1 .nav-more a").addClass("ion-android-arrow-dropup").removeClass("ion-android-arrow-dropdown"),$(".horizontal #menu1 .nav-more").css("top",a-36+"px"),$(".horizontal #hmenu1 li.more-nav").each(function(t,e){$(e).show(),$(".horizontal li#account").hide(),$(".horizontal li#logout").hide()})}}),$(".horizontal #hmenu1 a").each(function(){($(this).next().hasClass("layui-nav-child")||$(this).next().hasClass("sub"))&&$(this).attr("href")&&$(this).attr("href","javascript:;")}),$(".horizontal #hmenu1 a[data-depth=1]").each(function(){$(this).next().hasClass("sub")&&$(this).append('<span class="icon ion-arrow-right-b" style="margin-left: 8px;margin-right: -10px;"></span>')}),$(".horizontal #hmenu1 a[data-depth=1]").on("mouseover",function(){if($(this).next().hasClass("sub")){var t=$(this).next();t.show(),$(t).css("left",$(this).outerWidth(!0))}else $(".horizontal #hmenu1 .sub").each(function(){$(this).hide()})}),$(".horizontal #hmenu1 .sub").on("mouseover",function(){}).on("mouseleave",function(){$(".horizontal #hmenu1 .sub").each(function(){$(this).hide()})}),scrollMenuh(),$(".horizontal li#account").hide(),$(".horizontal li#logout").hide();for(var t=window.location.search.split("/"),e="";"?"==(e=t.shift()););var a=$('[data-mod="'+e+'"]');0<a.length&&(2!=$(a).attr("data-depth")&&0!=$(a).attr("data-depth")||$(a).parent("li").addClass("layui-this"),$(a).parents("dd").addClass("layui-this")),hfbreadcrumb($(".horizontal #breadcrumb"))})},capaccount_init=function(t){layui.laydate.render({elem:".capaccount #date",showBottom:!1,done:function(t,e,a){}}),$(t).find(".portfolio-name span").on("click",function(){var t=$(this).parent().attr("data-portfolio-id");v("portfolio/view/about/"+t,"new")}),$(".capaccount .capaccount-table .end").on("click",function(){v("capaccount/add","new",{refresh:1,filter:{fund:$(this).attr("data-fund"),name:$(this).attr("data-company"),stage:$(this).attr("data-stage")}})}),$(".capaccount .capaccount-table [data-ca-id]").on("click",function(){v("capaccount/view/about/"+$(this).attr("data-ca-id"),"new",{refresh:1})}),$(t).find(".capaccount-table tbody tr td.data-cell ul").each(function(){var t=$(this).parents(".data-cell").height(),e=$(this).parents(".data-cell").outerHeight(!0);if(0==$(this).find("li:not(.end)").length){var a=$(this).find("li.end").outerHeight(!0);$(this).find("li.end").css("position","absolute").css("width","100%").css("top",t/2-a/2+"px")}else{var i=0;$(this).find("li:not(.end)").each(function(){i+=$(this).height()});a=$(this).find("li.end").outerHeight();$(this).find("li.end").prepend('<div style="height:'+((e-i)/2-20)+'px"></div>'),$(this).find("li.end").append('<div style="height:'+((e-i)/2-20)+'px"></div>'),$(this).find("li.end").css("width","100%").css("top","50%")}})};function hfbreadcrumb(t,e){if(0<$("#layout.horizontal").length){var a=$("#hmenu1 li:first"),i=$(".hmenu1 dl dd.layui-this"),n=$("dl dd ul li.layui-this.level3"),l=$("ul#hmenu1>li.layui-this:not(.level3)"),r=$(i).parents("li")[0],o="<div>褰撳墠浣嶇疆锛�";0<l.length?o+='<a class="breadcrumb-0" href="javascript:v(\''+$(l).attr("id")+"/')\">"+$(l).find("a:first").text()+"</a>":(o+='<a class="breadcrumb-0" href="javascript:v(\''+$(a).attr("id")+"/')\">"+$(a).find("a:first").text()+"</a> > ",0<n.length?(r=$(n).parents("li")[0],i=$(n).parents("dd"),o+='<a class="breadcrumb-1" href="javascript:;">'+$(r).find("a:first").text()+"</a> > ",o+='<a class="breadcrumb-2" href="javascript:;">'+$(i).find("a:first").text()+"</a> > ",o+='<a class="breadcrumb-3" href="javascript:v(\''+$(n).attr("id")+"/')\">"+$(n).find("a:first").text()+"</a>"):(o+='<a class="breadcrumb-1" href="javascript:;">'+$(r).find("a:first").text()+"</a> > ",o+='<a class="breadcrumb-2" href="javascript:v(\''+$(i).find("a:first").attr("data-mod")+"/')\">"+$(i).find("a:first").text()+"</a>")),o+="</div>",$(t).html(o)}}var LoadingLayer={create:function(t,e){e=e||.1;var a="";switch(t){case 1:a=lang.pepm_loading_2;break;default:a=lang.pepm_loading}$("body.def-loading-anim").length&&(a='<div class="loading-ring"></div>'),null!=window.loadingLayer&&LoadingLayer.clear();var i={index:0,notTimeout:!1,timeouted:!1,timeoutMsg:"",timeoutCallback:void 0,show:function(){var t=layer.msg("",{icon:0,anim:-1,type:1,time:-1,shade:e,content:a,isOutAnim:!1,success:function(t,e){$(t).addClass("loading-layer").parent().addClass("layui-layer-modal-open"),$(t).css("text-align","center").css({width:"auto",top:"-1000px",left:0,right:0,"margin-left":"auto","margin-right":"auto"}).css({background:"transparent",border:"0","box-shadow":"0 0 0 0 transparent"}),$(t).find(".layui-layer-content").css({background:"transparent",height:"100px",overflow:"hidden"}),window.dispatchEvent(new CustomEvent("resize"))}});return i.index=t,i.setTimeout(3e6),i},setTimeout:function(t,e,a){return i.onTimeout(e,a),setTimeout(function(){i.isTimeouted()||i.makeTimeout()},t),i},onTimeout:function(t,e){return i.timeoutMsg=t,i.timeoutMsgCallback=e,i},cancelTimeout:function(){i.notTimeout=!0},makeTimeout:function(){i.close(),i.timeoutCallback&&"function"==typeof i.timeoutCallback&&i.timeoutCallback(),i.timeoutMsg&&layer.msg(i.timeoutMsg),$(i.layer()).addClass("timeouted"),i.timeouted=!0},isTimeouted:function(){return i.timeouted||i.layer().hasClass("timeouted")},layer:function(){return $("#layui-layer"+i.index)},close:function(){layer.close(i.index),$("#layui-layer"+i.index).removeClass("layui-layer-modal-open")},clear:function(){i.index=void 0,i.notTimeout=!1,i.timeouted=!1,i.timeoutCallback=void 0,i.timeoutMsg=""}};return window.loadingLayer=i},clear:function(){var t=window.loadingLayer;null!=t&&(t.close(),t.clear()),window.loadingLayer=void 0},getCurrent:function(){return window.loadingLayer},closeCurrent:function(){var t=this.getCurrent();t&&t.close()},isCurrentTimeout:function(){return this.getCurrent().isTimeouted()},isLoading:function(){return null!=this.getCurrent()}},clip2board=function(){var i={trigger:void 0,success:void 0,failed:void 0,init:function(t,e,a){if(a||(a="click"),t&&(i.trigger=$(t),0!=$(i.trigger).length&&e))return $(i.trigger).on(a,function(){$(e).focus(),$(e).select();try{document.execCommand("copy",!1,null)?i.success&&(i.success(),window.getSelection?window.getSelection().removeAllRanges():document.selection.empty()):i.failed&&i.failed()}catch(t){i.failed&&i.failed()}}),this},onSuccess:function(t){return t&&"function"==typeof t&&(i.success=t),this},onFailed:function(t){return t&&"function"==typeof t&&(i.failed=t),this}};return i},ListenImageClip={init:function(t,l){$(t).on("paste",function(t){var e=(t.clipboardData||t.originalEvent.clipboardData).items;for(index in e){var a=e[index];if("file"===a.kind){var i=a.getAsFile(),n=new FileReader;return n.onload=function(t){l&&"function"==typeof l&&l(t.target.result,i.name)},n.readAsDataURL(i),!1}}return!0})}};
function slayer(i){var t="slayer"+Math.round(1e3*Math.random()),a=$(i).clone();$(i).wrap('<div id="'+t+'" style="display:none"></div>'),layer.open({type:1,content:"",shade:!1,area:"960px",btn:["OK"],success:function(e,n){e.children(".layui-layer-content").append($(i)),$(i).wrap('<div class="layui-form"></div>').show(),element.init(),form.render(),lis_switch(),window.dispatchEvent(new CustomEvent("resize")),layer.check_layer($(i),!0),$(e.find(".btn-upload-file")[0]).uploader()},yes:function(e,n){$("#"+t).append($(i)),$(i).unwrap(),$(i).hide(),layer.close(e)},cancel:function(e,n){$("#"+t).append(a),$(i).unwrap(),a.hide(),layer.close(e)}})}function process(){$(".dnd").tableDnD({dragHandle:".dragHandle",onDragStop:function(e,n){form.render()}}),$("#browse_list tr").hover(function(){$(this.cells[0]).addClass("showDragHandle")},function(){$(this.cells[0]).removeClass("showDragHandle")}),$(".once").one("focus",function(){$(this).val("")}),form.render(),element.init()}function additems(e){$.get(e,function(e){$("#end").before(e),form.render(),process()})}function config_init(e,s){process(),$("#"+e).on("click",".additems",function(){0<=["view","form"].indexOf(s)&&(s="mod"),s&&additems("?/config/additems/"+s)}).on("click",".flow-link-index",function(){var e=$(this).parent().parent().children("select").find("option:selected").attr("uuid"),n=$(this).attr("ftype");window.open("/?/config/"+n+"/"+e)}),resizeBrowseList(),$(window).resize(function(){resizeBrowseList()}),lis_switch(),$(".mod-table").off("click.form").on("click.form","[data-b2form]",function(e){e.preventDefault();var n=$(this).closest("tr"),i=n.data("id"),t="field_"+n.find('[name="data[item]['+i+'][type]"]').val(),a=n.find('[name="data[item]['+i+'][props]"]'),o=a.val();0<=["doc","structure","reply"].indexOf(s)&&(t=s);var r=LoadingLayer.create(1,0).show();$.post("?/api/form_render/",{form:t,data:o},function(i){r.close(),layer.open({title:"鎺т欢灞炴€�",content:"",area:"850px",shadeClose:!0,success:function(e,n){e.children(".layui-layer-content").append(i),layui.form.render(),layui.element.init(),window.dispatchEvent(new CustomEvent("resize"))},yes:function(e,n){var i=$(n).find("form").serializeJSON().data||[];_.each(i,function(e,n){i[n]=$.trim(e)}),a.val(JSON.stringify(i)),layer.close(e)},cancel:function(e,n){var i=$(n).find("form").serializeJSON().data||[];_.each(i,function(e,n){i[n]=$.trim(e)}),a.val(JSON.stringify(i)),layer.close(e)}})})})}function resizeBrowseList(){var e=$("#browse_list");e.width();$(window).width()<1366?e.attr("style","width:1180px;"):e.attr("style","")}
function unique(t){var e=[];return $.each(t,function(t,a){-1==$.inArray(a,e)&&e.push(a)}),e}function split_a(t){for(var a=t.split(","),e=[],n="",i=0;i<a.length;i++)"-1"==a[i].indexOf("<a")||"-1"!=a[i].indexOf("</a>")?""==n?e.push(a[i]):(n+=","+a[i],"-1"!=a[i].indexOf("</a>")&&(e.push(n),n="")):n=a[i];return e}function split_for_select_mu(t){var a=$(t).find("a");0==a.length&&(a=$(t).find("div"));var e=[];return $(a).each(function(t,a){a&&e.push(a.outerHTML)}),e}function rebuild_btn(a){a.data("colvis")&&a.data("diycol")&&setTimeout(function(){var t=a.DataTable();a.DataTable().buttons(0).remove(),a.DataTable().buttons(1).remove(),t.button().add(0,conf_btn)},100)}function format_number(t,a){null==a&&(a=2);var e=(t=((t=t.toFixed(a))||0).toString()).split("."),n=0;null!=e[1]&&(n=e[1].length),a<n&&(n=a),t=e[0];var i="";0<n&&(i="."+e[1].substr(0,n));for(var l="";3<t.length;)l=","+t.slice(-3)+l,t=t.slice(0,t.length-3);return t&&(l=t+l),l+i}jQuery.fn.dataTableExt.oSort["number-asc"]=function(t,a){return t-a},jQuery.fn.dataTableExt.oSort["number-desc"]=function(t,a){return a-t},jQuery.fn.dataTableExt.oSort["chinese-asc"]=function(t,a){return(""+t).localeCompare(a,"zh-CN")},jQuery.fn.dataTableExt.oSort["chinese-desc"]=function(t,a){return(""+a).localeCompare(t,"zh-CN")};var table={params:{},table:{},init:function(){null==this.params&&(this.params={}),null==this.params.showfilter&&(this.params.showfilter=!1),null==this.params.bInfo&&(this.params.bInfo=!0),null==this.params.bFilter&&(this.params.bFilter=!0),null==this.params.showbtn&&(this.params.showbtn=1);var $el=null==this.params.id?$(".datatables"):$("#"+this.params.id).find(".datatables"),aoColumnDefs=[];if($el.data("order")){var order=$el.data("order");order.map(function(t,a){var e=a+1<order.length?a+1:0;aoColumnDefs.push({sType:t[2],aTargets:[t[0]],orderData:[t[0],order[e][0]]})})}if($el.data("order2")){var order=$el.data("order2");order.map(function(t){aoColumnDefs.push({sType:t[1],aTargets:[t[0]]})})}if(this.params.aoColumnDefs=aoColumnDefs,!($el.data("b2table")||0<$el.closest(".b2table").length)&&0!=$el.find("th").length){var $this=this,submenu="about";try{submenu=Object.keys(menu[seg1].children.view.children)[0]}catch(t){}var habit=0;$el.hasClass("entitytable")&&("1"==$el.data("habit")&&(habit=1),$el.find("tbody tr").each(function(){var a=$(this).attr("uuid");$(this).find("td[class=nc]:first").append('<input type="checkbox" value="'+a+'" name="sid[]">'),$(this).find("td[class=nc]:first").click(function(){form.render()});var t=$(this).find("td[class!=nc]");habit&&((t=$(this).find("td:eq(1)").find(".data-wrap")).each(function(){""==$(this).html().trim()&&$(this).html("("+lang.empty+")")}),t.css({color:"#0f62ec","text-decoration":"underline",width:"auto"})),t.click(function(t){"a"!=t.target.tagName.toLowerCase()&&v(seg1+"/view/"+submenu+"/"+a)});var e=$(this).find("td[class=nc]:last");$el.data("edit")&&e.append('<span class="ion ion-edit"></span>'),$el.data("del")&&e.append('<span class="ion ion-trash-a"></span>'),$(this).find(".ion-edit").click(function(){$("body").off("click"),v(seg1+"/view/about/"+a+"/edit/")}),$(this).find(".ion-trash-a").click(function(){rdel(seg1+"/del/"+a)})})),$el.hasClass("flowtable")&&$el.find("tbody tr").each(function(){var a=$(this).attr("uuid");$(this).find("td[class=nc]:first").append('<input type="checkbox" value="'+a+'" name="sid[]">'),$(this).find("td[class=nc]:first").click(function(){form.render()}),$(this).find("td[class!=nc]").click(function(t){"a"!=t.target.tagName.toLowerCase()&&v(seg1+"/view/"+a)}),$(this).find("td[class=nc]:last").append('<span class="ion ion-edit"></span> <span class="ion ion-trash-a"></span>'),$(this).find(".ion-edit").click(function(){v(seg1+"/view/"+a+"/edit/")}),$(this).find(".ion-trash-a").click(function(){rdel(seg1+"/del/"+a)})}),form.render();var mod=$el.data("mod")||"dts",mod2=$el.data("entity")||mod,conf_btn_diycol={className:"databox layui-btn",text:lang.personal,action:function(){var e=$el.closest("form").find(".databox");mod2=e.data("seg1")||mod2,e.attr("data-props",'{"type":"raw","multiple":"鏄�","dragable":"鏄�","lang":{"options_title":"闅愯棌鍒�","selected_title":"鏄剧ず鍒�","btn_confirm":"淇濆瓨","databox_fn":["submit","default"],"btn_other":{"default":"鎭㈠榛樿"},"btn_clear":"鍙栨秷"}}'),$.ajax({url:"?/"+mod2+"/diycol/data",async:!1,success:function(t){var a=parse_json(t);a.show_key=a.show_key||[],a.show_val=a.show_val||[],e.attr("data-data",JSON.stringify(a.hide)),e.data("mod",mod2),e.find("input").remove(),e.prepend('<input type="hidden" class="val" name="diycol" value="'+a.show_key.join(",")+'"><input type="hidden" class="layui-input label" value="'+a.show_val.join(",")+'" readonly="" placeholder="閫夊彇">')}})}},list_order="yes"==$el.data("listorder"),conf={language:{processing:lang.loading,sSearchPlaceholder:lang.search,lengthMenu:lang.dts_lengthMenu,zeroRecords:lang.no_result,info:lang.dts_info,infoEmpty:lang.dts_infoEmpty,infoFiltered:lang.dts_infoFiltered,infoPostFix:"",search:"",url:"",paginate:{first:lang.first,previous:lang.previous,next:lang.next,last:lang.last}},oClass:{sFilterInput:"layui-input"},pagingType:"simple_numbers",order:[],aoColumnDefs:this.params.aoColumnDefs,bInfo:this.params.bInfo,bFilter:this.params.bFilter,searching:this.params.searching,autoWidth:!1,paging:!1,lengthChange:!1,pageLength:30,stateSave:!1,stateSaveCallback:function(t,a){a.mod=mod;JSON.stringify(a);var e=mod;localStorage.setItem(e,JSON.stringify(a))},stateLoadCallback:function(t){var a=mod;if(localStorage.getItem(a))var e=JSON.parse(localStorage.getItem(a));return"object"==typeof e&&null!=e&&e.mod==mod?(list_order&&(e.order=[]),e):null},drawCallback:function(){var k=table.params.showbtn,row_length=this.api().rows().cache().length;if(0<$el.find("th.th_order").length&&0<row_length){var index=1;$el.find("tbody>tr").each(function(){$(this).find("td").eq(k).html(index),index++})}if(0<$el.find("thead [data-count]").length&&0<row_length){var _html='<tr class="tr_count">',ths=$el.find("thead>tr:first>th"),c=$el.find("tbody>tr").length,trs=$el.find("tbody>tr"),l0=$el.find(".dataTables_empty").length;if(trs.length-l0==0)return void $el.find(".tr_count").remove();var cou_cal_arr=new Object,cou_cal_fmu_arr=new Object;ths.each(function(){var t="";if(null==$(this).attr("data-count"))_html+="<th></th>";else if("count"==$(this).attr("data-count"))_html+="<th>鍏�"+c+"椤�</th>",t=c;else{var a=$(this).attr("data-deci"),e=$(this).index(),n=0,i="",l=$(this).attr("kid"),r=$(this).attr("cou_cal_fmu");if(trs.each(function(){if(0<$(this).find("td").eq(e).find(".data").find("span").length)var t=$(this).find("td").eq(e).find(".data").find("span").html();else t=$(this).find("td").eq(e).find(".data").html();if("string"!=typeof t)return!0;t=strip_tags(t).split(" "),n+=Number(t[0].replace(/,/g,"")),i=t[1]}),null==i&&(i=""),""!=i&&(i=" "+i),"sum"==$(this).attr("data-count"))_html+="<th>"+format_number(n,a)+i+"</th>",t=format_number(n,a);else if("cou_cal"==$(this).attr("data-count"))cou_cal_fmu_arr[l]=new Array,cou_cal_fmu_arr[l]=cou_cal_fmu_arr[l].fmu=cou_cal_fmu_arr[l].unit=cou_cal_fmu_arr[l].deci=new Array,cou_cal_fmu_arr[l].index=e,cou_cal_fmu_arr[l].unit=i,cou_cal_fmu_arr[l].deci=a,cou_cal_fmu_arr[l].fmu=r;else if("average"==$(this).attr("data-count")){var s="";0<c&&(s=n/c),_html+="<th>"+format_number(s,a)+i+"</th>",t=format_number(s,a)}}""!=t&&(cou_cal_arr[l]=new Array,cou_cal_arr[l]=t)}),_html+="</tr>";var listcount=$el.attr("data-listcount");"bottom"==listcount?($el.find("tfoot").remove(),$el.append("<tfoot>"+_html+"</tfoot>")):($el.find("thead>.tr_count").remove(),$el.find("thead").append(_html));var comma=new RegExp(",","g");$.each(cou_cal_fmu_arr,function(n,value){if(cou_cal_fmu_arr[n]=new Array,cou_cal_fmu_arr[n]=value.fmu,""!=value.fmu){var cou_cal_fmu_html="",insert_index=0;$.each(cou_cal_arr,function(t,a){-1<value.fmu.indexOf(t)&&(re=new RegExp(t,"g"),cou_cal_fmu_arr[n]=cou_cal_fmu_arr[n].replace(re,a))})}var fmu_value=eval(cou_cal_fmu_arr[n].replace(comma,""));fmu_value!=1/0&&""!=value.fmu||(fmu_value=0),cou_cal_fmu_html="<th>"+format_number(fmu_value,value.deci)+value.unit+"</th>",insert_index=value.index-1,"bottom"==listcount?$el.find("tfoot>.tr_count").find("th").eq(insert_index).after(cou_cal_fmu_html):$el.find("thead>.tr_count").find("th").eq(insert_index).after(cou_cal_fmu_html)})}}};if($el.data("paging")&&(conf.paging=$el.data("paging")),$el.data("page_size")&&(conf.pageLength=$el.data("page_size")),$el.data("diycol")){var conf_btn=[];$el.data("diycol")&&conf_btn.push(conf_btn_diycol),$.extend(conf,{dom:"Bfrtip",buttons:conf_btn})}$el.data("b2table",$el),this.table[mod]=$el.dataTable(conf),this.table[mod].api().on("column-reorder",function(){rebuild_btn($el)}),1==this.params.bFilter&&(this.table[mod].initComplete=this.render_filter(this.params)),$el.wrap('<div class="table_canvas"></div>');var ojson=[];$el.find("thead th").each(function(){var t="";if($(this).hasClass("sorting_asc")&&(t="asc"),$(this).hasClass("sorting_desc")&&(t="desc"),""==t)return!0;var a=$(this).attr("data-id"),e=$(this).attr("data-itype"),n={};n.sort=t,n.key=a,n.type=e,ojson.push(n)}),localStorage.setItem("order_data",JSON.stringify(ojson))}},del:function(t){this.table.row(t).remove().draw()},render_filter:function(t){if(null==t.id)var a=$(".datatables");else a=$("#"+t.id).find(".datatables");var y=a.attr("data-mod"),w=this.table,x=w[y],e=a.closest("div[ext]");0==e.length&&(e=a.closest("form")),a.closest(".dataTables_wrapper").parent().find("button#btn_filter").remove(),(t.btn_filter||t.show_export||t.show_import||t.show_analysis)&&0==a.closest(".dataTables_wrapper").parent().find(".rel_data_btn").length&&a.closest(".dataTables_wrapper").before('<div class="rel_data_btn" ></div>'),t.btn_filter&&a.closest(".dataTables_wrapper").parent().find(".rel_data_btn").append('<a href="javascript:;" class="layui-btn layui-btn-small" id="btn_filter"><span class="ion-funnel" ></span> '+lang.filter+" </a>"),t.show_export&&"open"!=seg(1)&&a.closest(".dataTables_wrapper").parent().find(".rel_data_btn").append('<a href="javascript:;" class="layui-btn layui-btn-small rel_export"><span class="ion-arrow-down-c" ></span> '+lang.export+" </a>"),t.show_import&&a.closest(".dataTables_wrapper").parent().find(".rel_data_btn").append('<a href="javascript:;" class="layui-btn layui-btn-small rel_import"><span class="ion-arrow-up-c" ></span> '+lang.import+" </a>"),t.show_analysis&&a.closest(".dataTables_wrapper").parent().find(".rel_data_btn").append('<a href="javascript:;" class="layui-btn layui-btn-small rel_analysis"><span class="ion-ios-pulse" ></span> '+lang.analyze+" </a>");var n=e.find("#btn_filter");0<e.find("#btn_filter").closest("th").length&&(n=e.find("#btn_filter").closest("th")),n.off("click").on("click",function(){0!=e.find("tr.filter").length&&(1==e.find("tr.filter:hidden").length?e.find("tr.filter").show():e.find("tr.filter").hide())});var l=a.find("thead>tr:first>th");if(0!=l.length){if(1==this.params.showfilter)var r='<tr class="filter">';else r='<tr style="display:none;" class="filter">';var s=Number(this.params.showbtn);l.each(function(t){var a=l.eq(t),e=a.attr("data-type"),n=a.attr("data-itype"),i=a.attr("data-id");r+=0==t&&1==s?'<th class="cka" onclick="checkall()" style="text-align:center;"><input type="checkbox" class="tb_checkall"/></th>':"<td"+(i?' data-id="'+i+'" ':"")+(e?' data-type="'+e+'" ':"")+(n?' data-itype="'+n+'" ':"")+">&nbsp;</td>"}),r+="</tr>",a.find("thead>tr.filter").remove(),a.find("thead>tr:first").after(r),$.fn.dataTable.ext.search=[];var T=a.DataTable(),k="DataTables_"+location.search.replace(/\/index(\/)?$/,"").replace(/[?\/=]/g,""),S=a.find("thead>tr:eq(1)>td"),O=s,i=window.location.hash,N={};if(""!==i&&-1!=i.indexOf("=")){var o=i.substr(1).split("&");for(var d in o){var c=o[d].split("="),u=c[0],f=decodeURIComponent(c[1]);N[u]=f}}S.each(function(u){var f=k+"_"+u,n=x.api().column(u+O),p=S.eq(u);p.css({"white-space":"normal"});var l=p.attr("data-type"),t=p.attr("data-itype");if(null==t)return!0;""!=l&&0!=l&&null!=l||(l="text"==t||"textarea"==t?"input":$.inArray(t,["select","select_new","system","radio","checkbox"])?"select":in_array(t,["amount","percent","yuan","wan","yi","dollar","currency","million2"])?"range":"none");var a=p.data("id");if("range"!=l&&"daterange"!=l&&"timerange"!=l&&"selectmu"!=l){if(null!=a&&null!=N[a]){var e=N[a];n.search(N[a],!0,!1).draw()}null==e&&(e="")}if("input"==l&&(p.html('<input class="layui-input" value="'+e+'" />'),p.find("input").on("keyup change",function(){var t=p.find("input").val(),a=$(this).closest("table").attr("data-mod");w[a].api().column(u+O);n.search(t,!0,!1).draw()})),"select"==l){p.css("width","150px");var i=$('<select lay-ignore style="width:100%;height:30px;" lay-filter="sel-'+u+'"><option></option></select>').appendTo(p.empty()),r=n.data(),o=n.nodes(),d=[];r.each(function(t,a){var e=$(o[a]).children(0).data("filter");if(e)$.merge(d,e);else for(var n=split_a(t),i=0;i<n.length;i++)d.push(n[i].replace(/(<([^>]+)>)/gi,""))}),d=unique(d),$.each(d,function(t,a){a&&(""!=e&&a.match(e)?i.append('<option value="'+a+'" selected="selected">'+a+"</option>"):i.append('<option value="'+a+'">'+a+"</option>"))}),p.find("select").b2select(),p.find("select").on("change",function(){var t=$(this).val();null==t&&(t=""),t=""!=(t=$.fn.dataTable.util.escapeRegex(t))?"(([>,]"+t+"[<,])|(^"+t+",)|(,"+t+"$)|(,"+t+",)|(^"+t+"$))":"";var a=$(this).closest("table").attr("data-mod");w[a].api().column(u+O).search(t,!0,!1).draw()})}if("selectmu"==l){if(null!=a&&null!=N[a])e=(e=N[a]).split(",");else null==(e=localStorage.getItem(f))&&(e=""),""!=e&&(e=(e=JSON.parse(e))[y]);null!=e&&""!=e||(e=[]),p.css("width","150px");i=$('<select lay-ignore class="select-mu" data-props=\'{"ellipsis": "auto"}\' style="width:100%;height:30px;" multiple lay-filter="sel-'+u+'"></select>').appendTo(p.empty()),r=n.data(),o=n.nodes(),d=[];r.each(function(t,a){var e=$(o[a]).children(0).data("filter");if(e)$.merge(d,e);else for(var n=split_for_select_mu(t),i=0;i<n.length;i++){var l=n[i].replace(/(<([^>]+)>)/gi,""),r=[l];-1!=l.indexOf("锛�")&&(r=l.split("锛�")),-1!=l.indexOf(",")&&(r=l.split(","));for(var s=0;s<r.length;s++)d.push(r[s])}}),d=unique(d),$.each(d,function(t,a){a&&(""!=e&&in_array(a,e)?i.append('<option value="'+a+'" selected="selected">'+a+"</option>"):i.append('<option value="'+a+'">'+a+"</option>"))}),p.find("select.select-mu").b2select();var s="36";p.find("input").css("height",s+"px"),p.find(".select2").css({width:"100%",height:s+"px"});var c=function(t,a,e){null==a[u+O]&&(a[u+O]=""),a[u+O]=a[u+O].replace(/(<([^>]+)>)/gi,"");var n=a[u+O],i=$.trim(p.find("select").val()),l=[];""!=i&&(l=i.split(","));var r={};if(r[y]=l,localStorage.setItem(f,JSON.stringify(r)),""==i)return!0;if(-1==i.indexOf(",")&&-1==n.indexOf(","))return n==i;var s=i.split(","),o=!1;if(-1==n.indexOf(",")){for(var d=0;d<s.length;d++)if(""==s[d]||s[d]==n){o=!0;break}}else{var c=n.split(",");for(d=0;d<s.length;d++)if(-1!=$.inArray(s[d],c)){o=!0;break}}return o};setTimeout(function(){$.fn.dataTable.ext.search.push(c),T.draw()},0),p.find("select.select-mu").on("change",function(){$.fn.dataTable.ext.search.push(c),T.draw()})}if("date"==l)if(navigator.userAgent.match(/mobile/i)&&$(window).width()<769){var h='<input type="text" class="hdate iphone layui-input" id="'+f+'" style="pointer-events:none;" value=""><input type="date" style="color:transparent;" class="layui-input default_dtype_s">';p.html(h);s=p.find(".hdate").height();p.find(".hdate").css({"margin-top":1,"margin-left":1,width:"90%",height:s+"px",background:"#fff"}),p.find(".default_dtype_s").on("focus",function(){time_display_s($(this),function(t){n.search(t,!0,!1).draw()})})}else{$('<input type="text" id="'+f+'" data-laydate="date" class="layui-input" value="'+e+'">').appendTo(p.empty()),laydate.render({elem:"#"+f,done:function(t,a,e){n.search(t,!0,!1).draw()}})}if("daterange"==l||"timerange"==l){if(null!=a&&null!=N[a])var e=N[a];else null==(e=localStorage.getItem(f))&&(e=""),""!=e&&(e=(e=JSON.parse(e))[y]);var m=["",""];if(null!=e&&(-1!=e.indexOf(" - ")?(m[0]=e.split(" - ")[0],m[1]=e.split(" - ")[1]):m[0]=m[1]=e),"daterange"==l)var _="date",g=/^\d{4}(\-\d{1,2}){2}$/;if("timerange"==l)_="datetime",g=/^\d{4}(\-\d{1,2}){2}\s(\d{1,2}:){2}\d{1,2}$/;var b=function(t,a,e){null==a[u+O]&&(a[u+O]=""),a[u+O]=a[u+O].replace(/(<([^>]+)>)/gi,"");var n=a[u+O],i=$("#"+f),l=i.attr("min")?i.attr("min"):"",r=i.attr("max")?i.attr("max"):"",s=l&&r?l+" - "+r:"";if(!s)return localStorage.setItem(f,""),!0;var o={};if(o[y]=s,localStorage.setItem(f,JSON.stringify(o)),!l&&!r)return!0;l=""==l?"0000-00-00":l,r=""==r?"9999-12-31":r;var d=Date.parse(n);return!g.test(l)||!g.test(r)||d>=Date.parse(l)&&d<=Date.parse(r)};if(navigator.userAgent.match(/mobile/i)&&$(window).width()<769){h='<input type="text" class="hdate iphone layui-input" style="pointer-events:none;" value="'+m[0]+'"><input type="date" style="color:transparent;" class="layui-input default_dtype_s">',h+='<input type="text" class="hdate iphone layui-input" style="pointer-events:none;" value="'+m[1]+'"><input type="date" style="color:transparent;" class="layui-input default_dtype_s">',h+='<input type="hidden" id="'+f+'" />',p.html(h);s=p.find(".hdate").height();p.find(".hdate").css({"margin-top":1,"margin-left":1,width:"90%",height:s+"px",background:"#fff"}),setTimeout(function(){$.fn.dataTable.ext.search.push(b),T.draw()},0),p.find(".default_dtype_s").on("focus",function(){time_display_s($(this),function(t){var a=t.split(" - "),e=a[0],n=a[1];$("#"+f).val(t).attr("min",e).attr("max",n),$.fn.dataTable.ext.search.push(b),T.draw()})})}else{$('<input type="text" id="'+f+'" min="'+m[0]+'" max="'+m[1]+'" data-laydate="date" class="layui-input" value="'+e+'">').appendTo(p.empty()),setTimeout(function(){$.fn.dataTable.ext.search.push(b),T.draw()},0),laydate.render({elem:"#"+f,type:_,range:!0,done:function(t,a,e){a.month<10&&(a.month="0"+a.month),a.date<10&&(a.date="0"+a.date);var n=a.year+"-"+a.month+"-"+a.date;e.month<10&&(e.month="0"+e.month),e.date<10&&(e.date="0"+e.date);var i=e.year+"-"+e.month+"-"+e.date;"timerange"==l&&(n+=" "+a.hours+":"+a.minutes+":"+a.seconds,i+=" "+e.hours+":"+e.minutes+":"+e.seconds),""==t&&(n=i=""),$("#"+f).attr("min",n).attr("max",i),$.fn.dataTable.ext.search.push(b),T.draw()}})}}if("range"==l){if(null!=a&&null!=N[a])e=N[a];else null==(e=localStorage.getItem(f))&&(e=""),""!=e&&(e=(e=JSON.parse(e))[y]);m=["",""];null!=e&&(-1!=e.indexOf("-")?(m[0]=e.split("-")[0],m[1]=e.split("-")[1]):m[0]=m[1]=e),$('<input type="number" id="'+f+'_s" class="layui-input" value="'+m[0]+'" style="width:80px;display:inline-block;"> - <input type="number" id="'+f+'_e" class="layui-input" value="'+m[1]+'" style="width:80px;display:inline-block;">').appendTo(p.empty()),p.css({"white-space":"nowrap"});var v=function(t,a,e){null==a[u+O]&&(a[u+O]=""),a[u+O]=a[u+O].replace(/(<([^>]+)>)/gi,"");var n=a[u+O];n=(n=n.split(" ")[0]).replace(/,/g,""),n=Number(n);var i=$.trim(p.find("input").eq(0).val()),l=$.trim(p.find("input").eq(1).val()),r=!0;""==i||isNaN(i)||(r=(i=Number(i))<=n),""==l||isNaN(l)||(l=Number(l),r=r&&n<=l);var s=i+"-"+l,o={};return o[y]=s,localStorage.setItem(f,JSON.stringify(o)),r};setTimeout(function(){$.fn.dataTable.ext.search.push(v),T.draw()},0),p.find("input").on("input propertychange",function(){$.fn.dataTable.ext.search.push(v),T.draw()})}}),form.render()}}};
!function(window,document,$){jQuery.fn.dataTableExt.oSort["file-size-asc"]=function(e,t){return(e=FileSize.max(e))-(t=FileSize.max(t))},jQuery.fn.dataTableExt.oSort["file-size-desc"]=function(e,t){return e=FileSize.max(e),(t=FileSize.max(t))-e},Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},window.Doc={init:function(e){init.call(this,e,DocLib,"doc")},tree:function(e){init.call(this,e,DocTree.init,"tree")},list:function(e){init.call(this,e,DocList,"list")}};var options_doc={elem:".doc-admin",select:!1,show_doc_tree:!0,doc_tree_privilege:[],manage:!0,current_uid:"root",root_uid:"root",old_uid:"",eid:"system",doc_type:"doc",res:{files:[],breadcrumb:[],current_privilege:[]},order:{column:"3",by:"desc"},paging:!1,page_size:20,notify:!0,notify_t:[],notifybox:!1,path:"",refresh:!1,entity:{},is_mobile:!1,list_type:"list"},options_tree={elem:".doc-tree",root_uid:"root",hover:"root",manage:!0,doc_tree_privilege:[],toggle:null,hover_func:null},options_list={elem:".file-admin",uid:"root",eid:"system",doc_type:"doc",curr:1,count:0,limit:10,display:""},init=function(param,func,type){var param=param||{},options=eval("options_"+type);for(var i in options)"elem"==i?options.elem=param.elem||options.elem:null==param[i]||(options[i]=param[i]);var $elem="object"!=typeof options.elem?options.elem=$(options.elem):options.elem;$elem.length&&$.each($elem,function(e,t){func.call($(t),options)})},select_input_value=function(e){if(e){var t=e.value.length;if(e.setSelectionRange)e.setSelectionRange(0,t),e.focus();else if(e.createTextRange){var i=e.createTextRange();i.moveEnd("character",t),i.select()}}},check_priv=function(e,t){return!0===(e=e||[])[t]},NotifyBox=function(a,o,l,r,c,e,t){var s=this,d=[],u="";a=a;this.bindAction=$("<div></div>"),this.uploadFiles=[],this.uploadDirs=[],this.dirname,this.ask=function(n){e&&$.post("?/msg/notifybox/",{upload_notify:!0,notify_to:t},function(e){layer.open({type:1,title:lang.select_notified,maxWidth:1e3,shadeClose:!1,content:e,btn:[lang.ok,lang.cancel],yes:function(e,t){layer.close(e);var i=$(t);i.find("#userlist .notify-to input[type=checkbox]:checked").each(function(e){var t=$(this).val();$(this).attr("title");d.push(t)}).removeAttr("id"),u=i.find("#assign").val(),s.bindAction.trigger("click"),n&&n()}})})},this.notify=function(e,t,i){var n={eid:o,up_folder:l,path:c,view:r,notify_to:d,assign:u,action:a,files_count:t,dirs_count:i,uploadFiles:s.uploadFiles,uploadDirs:s.uploadDirs,dirname:s.dirname};$.post("?/msg/notify",n,function(e){})}},FileSize={min:function(e){for(var t=["B","KB","MB","GB","TB"],i=t.length+1,n="";i--;)if(e>Math.pow(1024,i-1)){n=parseFloat((e/Math.pow(1024,i-1)).toFixed(2))+t[i-1];break}return n},max:function(e){if(0==e.length)return 0;q=e.charAt(e.length-2);var t=["B","KB","MB","GB","TB"].indexOf(q+"B");-1==t&&(t=0);var i=e.replace("B","").replace("K","").replace("M","").replace("G","").replace("T","");return e=parseFloat(i)*Math.pow(1024,t)}},DocTree={doc_tree_privilege:{},init:function(options){var $this=this;for(var i in options)eval("var "+i+"=options."+i);$this.doc_tree_privilege=doc_tree_privilege;var hoverli=$this.find("li[uid="+hover+"]");if(hoverli=check_priv($this.doc_tree_privilege[root_uid],"view")?hoverli.length?hoverli:$this.find("li[uid="+root_uid+"]"):hover==root_uid?[]:hoverli.length?hoverli:[],hoverli.length){if(hoverli.addClass("hover"),hoverli.is(":hidden")){var showli=$.makeArray(hoverli.parentsUntil("li[uid="+root_uid+"]"));showli.reverse(),showli.push(hoverli[0]),$(showli).each(function(){if("UL"!=this.tagName){var e=$(this).parent().prev("span");DocTree.toggle.call(e,!1,!0)}})}hoverli[0].scrollIntoView()}$this.on("click",".dir",function(e){var t=$(this).attr("uid"),i=$(this).attr("doc");t&&(check_priv($this.doc_tree_privilege[t],"view")?(DocTree.toggle.call($(this),!1),$this.find(".hover").removeClass("hover"),check_priv($this.doc_tree_privilege[t],"upload")&&$(this).parent("li").addClass("hover"),hover_func&&hover_func(t,i)):layer.alert(lang.no_file_priv_view))}),manage&&$this.on("click",".manage button",function(){var e=$this.find(".hover").children("span"),t=e.nextAll("ul").children("li").length,i=e.attr("uid");e.attr("doc");switch($(this).attr("action")){case"add":if(!check_priv($this.doc_tree_privilege[i],"upload"))return void layer.alert(lang.no_file_priv_upload,{title:lang.msg,btn:[lang.ok]});e.children("i").hasClass("ion-android-folder")?(t&&DocTree.toggle.call(e,function(){DocTree.add_dir.call(e)}),t||(DocTree.add_dir.call(e),DocTree.toggle.call(e))):(DocTree.add_dir.call(e),DocTree.toggle.call(e,!1,!0));break;case"del":check_priv($this.doc_tree_privilege[i],"del")?DocTree.del.call(e.parent()):layer.alert(lang.no_file_priv_del)}}).on("click","i[action]",function(e){switch($(this).attr("action")){case"done":DocTree.add_dir_done.call($(this).parent(),$this);break;case"cancel":$(this).parent().remove()}})},toggle:function(func,open){var $dir=this,uuid=$dir.attr("uid"),i=$dir.children("i"),open=void 0===open?i.hasClass("ion-android-folder"):!!open,slide=open?"slideDown":"slideUp",length=$dir.nextAll("ul").children("li").length;i.removeAttr("class").addClass(open?"ion-android-folder-open":"ion-android-folder"),eval('length&&$dir.nextAll("ul").'+slide+"(function(){func&&func(uuid,open);});"),length||func&&func(uuid,open)},add_dir:function(){$li=$('<li uid="" name="" class="edit"><i class="ion-android-folder"></i><input type="text" placeHolder="杈撳叆鍚嶇О" autofocus><i class="ion-android-done" action="done" title="纭娣诲姞"></i><i class="ion-android-close" action="cancel" title="鍙栨秷娣诲姞"></i></li>'),this.nextAll("ul").append($li),select_input_value($li.children("input")[0])},add_dir_done:function(i){var n=this,e=n.closest("ul").parent().attr("uid"),t=n.closest(".doc-tree").attr("eid")?n.closest(".doc-tree").attr("eid"):"system",a=n.closest(".doc-tree").attr("doc_type"),o=n.children("input").val();o&&$.post("?/file/mkdir/",{eid:t,uid:e,doc_type:a,name:o},function(e){if(e.ok){var t='<li uid="'+e.uuid+'" name="'+e.name+'"><span class="dir able" doc="dir" uid="'+e.uuid+'"><i class="ion-android-folder"></i>'+e.name+"</span><ul></ul></li>";n.after(t).remove(),i.doc_tree_privilege[e.uuid]=e.privilege}else layer.alter(lang.action_failed)})},del:function(){var i=this,n=$(this).attr("uid");n&&layer.msg(lang.del_confirm,{btn:[lang.ok,lang.cancel],btn1:function(e,t){$.post("?/file/del/"+n+"/",function(e){layer.msg(e.msg),e.ok&&i.remove()},"json")}})}},DocLib=function(options){var $this=$doclib=this,fresh_lis=!1,$mobile_btn=[];for(var i in privilege_array={},options)eval("var "+i+"=options."+i);$doclib[0].addEventListener("DOMNodeRemovedFromDocument",function(){fresh_lis&&clearTimeout(fresh_lis),$mobile_btn.length&&$mobile_btn.remove()});var storage={set:function(e,t,i){var n=localStorage.getItem(e);(n=JSON.parse(n)||{})[websid]||(n[websid]={}),n[websid][t]=i,n=JSON.stringify(n),localStorage.setItem(e,n)},get:function(e,t){var i=localStorage.getItem(e);return(i=JSON.parse(i)||{})[websid]||(i[websid]={}),i[websid][t]||null}},DocLibTree={dirs:["root"],toggle:function(e,t){t?this.dirs.push(e):this.dirs.indexOf(e)&&this.dirs.splice(this.dirs.indexOf(e),1),storage.set("docTree",eid+doc_type,this.dirs),Scrollbar.reset()},reset:function(e){var t=this,i=storage.get("docTree",eid+doc_type)||this.dirs;this.dirs=i,e?t.render():$.post("?/doc/doc_tree",{doc_type:doc_type,eid:eid},function(e){$(".doc-side .layui-side-scroll").html(e.html),t.render()})},render:function(e){e||this.dirs&&this.dirs.forEach(function(e){e&&($(".doc-tree li[uid="+e+"]>span>i").removeAttr("class").addClass("ion-android-folder-open"),$(".doc-tree li[uid="+e+"]>ul").show())}),$(".doc-side").height($(".doc-body").height()),$(".doc-body").css("margin-left",$(".doc-side").width()+"px"),Scrollbar.reset()}},Scrollbar={init:function(){var i,n,a,o,l,r,c=this,t=$doclib.find(".doc-admin"),s=$doclib.find(".doc-scroll"),d=($doclib.find(".doc-tree"),$doclib.find(".doc-scrollbar"),$doclib.find(".doc-scrollbar-btn")),e=$doclib.find(".doc-resize"),u={mousedown:function(e){$(e.target).hasClass("doc-scrollbar-btn")||(i=$doclib.find(".doc-side").width(),n=e.x,t[0].addEventListener("mousemove",u.mousemove),t[0].addEventListener("mouseup",u.mouseup))},mousemove:function(e){a=e.x;var t=i+a-n;c.resize(t)},mouseup:function(e){t[0].removeEventListener("mousemove",u.mousemove),t[0].removeEventListener("mouseup",u.mouseup)}},f={mousedown:function(e){o=d.position().top,l=e.y,t[0].addEventListener("mousemove",f.mousemove),t[0].addEventListener("mouseup",f.mouseup),s[0].removeEventListener("scroll",c.reset)},mousemove:function(e){r=e.y;var t=o+r-l;c.scroll(t)},mouseup:function(e){t[0].removeEventListener("mousemove",f.mousemove),t[0].removeEventListener("mouseup",f.mouseup),s[0].addEventListener("scroll",c.reset)}};e[0].addEventListener("mousedown",u.mousedown),d[0].addEventListener("mousedown",f.mousedown),s[0].addEventListener("scroll",c.reset)},resize:function(e){var t;e=(t=(t=$this.find(".doc-body").parent().width()-635)<100?100:t)<(e=e<100?100:e)?t:e,$this.find(".doc-side").width(e),$this.find(".doc-body").css("margin-left",e+"px")},reset:function(){var e=$this.find(".doc-scroll"),t=$this.find(".doc-tree"),i=$this.find(".doc-scrollbar"),n=$this.find(".doc-scrollbar-btn"),a=e.height(),o=t[0].scrollHeight;if(a<o){var l=a/o,r=e.scrollTop()/(o-a),c=l*i.height(),s=r*(i.height()-n.height());n.height(c+"px").css("top",s+"px")}else n.height(0).css("top",0)},scroll:function(e){var t=$this.find(".doc-scroll"),i=$this.find(".doc-tree"),n=$this.find(".doc-scrollbar"),a=$this.find(".doc-scrollbar-btn"),o=t.height(),l=i[0].scrollHeight,r=n.height()-a.height(),c=(l-o)*((e=r<(e=e<0?0:e)?r:e)/r);a.css("top",e+"px"),t.scrollTop(c)}},DocPath={reset:function(e){storage.set("docPath",eid+doc_type,e);var t=$this.find(".doc-tree").find(".hover");"root"!=e&&t.length?(path=t.attr("name")+"/",t.parentsUntil("li[uid='root']","li").each(function(){path=$(this).attr("name")+"/"+path})):path=""},get:function(){return storage.get("docPath",eid+doc_type)}},data_to_html=function(e){var _=[];return $.each(e,function(e,t){var i=t.privilege,n="android-list",a="able";if(!1!==(privilege_array[t.uuid]=i).list){switch(t.type){case"config_dir":case"dir":!1===i.view&&(a="unable"),n="android-folder";break;case"png":case"jpg":case"gif":case"jpeg":n="android-image";break;case"xlsx":case"xls":n="ios-grid-view";break;case"doc":case"docx":case"txt":n="document-text";break;case"ppt":case"pptx":n="easel";break;case"mp3":case"mid":case"wav":n="music-note";break;case"mov":case"mp4":case"avi":n="android-film"}var o="",l="";if(t.size&&(o=FileSize.min(t.size)),t.update_date){var r=new Date;r.setTime(1e3*t.update_date),r.toLocaleString(),l=r.format("yyyy-MM-dd")}var c="",s="",d='<input data-fsize="{nsize}" data-uname="{people}" data-cdate="{ndate}" type="checkbox" name="s[{uuid}]" {disabled}/><span>{index}</span>',u='<span class="dir {powerable}" doc="{type}" uid="{uuid}" title="{name}"><i class="ion-{icon}" ></i>{name}</span>',f=i.flag?'<span class="flag"><i class="ion-ios-pricetag" fileid="{uuid}" flag="{flag}" title="'+lang.the_label+'"></i>&nbsp;{flag}</span>':"",p=['<span class="btn more-info ion-android-more-vertical" name="{name}" type="{type}" fileid="{uuid}"  title="'+lang.info+'" style="margin-left:0px;"></span>',(i.rename?'<span class="btn rename ion-edit" fileid="{uuid}" name="{name}" type="{type}" title="'+lang.rename+'"></span>':"")+(i.del?'<span class="btn del ion-trash-a" fileid="{uuid}" name="{name}" title="'+lang.del+'"></span>':"")+"{creat_by_file}"+(i.edit_priv?'<span class="btn privilege ion-locked" fileid="{uuid}" name="{name}" title="'+lang.set_per+'"></span>':"")],h=0<=["config_dir","dir"].indexOf(t.type)?(c=select?"disabled":"",[d,u+'<span class="tips">(&nbsp;<i class="icon ion-ios-folder-outline"></i>{dir_count}&nbsp;&nbsp;<i class="icon ion-ios-list-outline"></i>{file_count}&nbsp;)</span>'+("dir"==t.type?f:"")]):(s=entity.length?'<span class="btn create-entity ion-paper-airplane" fileid="'+t.uuid+'" name="'+t.name+'" title="鍒涘缓"></span>':"",[d,u+function(){var e="";if(!i.preview)return e;switch(parseInt(t.state)){case 1:refresh=!0,e='<span class="loading loading_ani"><i class="ion-load-a" title="'+lang.waiting_preview+'"></i></span>';break;case 4:refresh=!0,e='<span class="loading"><i class="ion-loop" title="'+lang.gen_pre+'"></i></span>';break;case 2:e='<span class="eye"><i class="ion-eye" ></i></span>';break;case 3:e='<span class="eye"><i class="ion-eye-disabled" title="'+lang.failed_pre+'" style="color:#FF0000;"></i></span>';break;case 5:e='<span class="eye"><i class="ion-locked" title="'+lang.encrypt+'" style="color:#fba74f;"></i></span>';break;case 6:e='<span class="eye"><i class="ion-alert-circled" title="'+lang.file_lose+'" style="color:#fba74f;"></i></span>'}return e}()+f]);is_mobile||(h=h.concat([o,l,"{people}"])),h.push(manage&&"config_dir"!=t.type?p[is_mobile?0:1]:"");var g=b2.arrayt(h,{index:function(){switch(t.type){case"config_dir":return-2;case"dir":return-1;default:return 0}}(),uuid:t.uuid,name:t.name,ndate:l,nsize:o,type:t.type,icon:n,flag:t.flag,powerable:a,dir_count:t.dir_count,file_count:t.file_count,people:t.create_people_name,disabled:c,creat_by_file:s});_.push(g)}}),_};docRender=function(e,n){privilege_array={},privilege_array[current_uid]=e.current_privilege;var t=e.files,i=e.breadcrumb,a="";if(old_uid){var o=$this.find(".layui-breadcrumb").last().children("a:last-child");$(".doc-bar .breadcrumb .back").show().children("a").attr("doc",o.attr("doc")).attr("uid",o.attr("uid")),$(".doc-body").attr("doc",o.attr("doc")).attr("uid",o.attr("uid"))}if(a="root"==root_uid?"<a doc='dir' uid='"+root_uid+"'>"+lang.total_file+"</a>":"",$.each(i,function(e,t){current_uid==t.uid||(privilege_array[t.uid]={list:!0,view:!0}),root_uid==t.uid?a="<a doc='"+t.type+"' uid='"+t.uid+"'>"+("root"==t.uid?lang.total_file:t.name)+"</a>":e<i.length-1?a+="<a doc='"+t.type+"' uid='"+t.uid+"'>"+t.name+"</a>":a+="<a doc='"+t.type+"' uid='"+t.uid+"'><cite>"+t.name+"</cite></a>"}),$(".doc-bar .breadcrumb>span:last-child").html(a),current_uid!=root_uid){var l=$this.find(".layui-breadcrumb").last().children("a:last-child").prev();$(".doc-bar .breadcrumb .parent").show().children("a").attr("doc",l.attr("doc")).attr("uid",l.attr("uid"))}else $(".doc-bar .breadcrumb .parent").hide();element.init();var r={destroy:!(refresh=!1),data:paging?"":data_to_html(t),bAutoWidth:!1,orderFixed:[0,"asc"],aaSorting:[[0,"desc"]],language:$.extend(!0,{},{processing:$("body.def-loading-anim").length?lang.pepm_loading_ring:lang.pepm_loading_2,sSearchPlaceholder:lang.search,lengthMenu:lang.dts_lengthMenu,zeroRecords:lang.no_result,infoFiltered:lang.dts_infoFiltered,infoPostFix:"",search:"",url:"",paginate:{first:lang.first,previous:lang.previous,next:lang.next,last:lang.last}},paging?{sEmptyTable:lang.no_result,info:lang.dts_info_async,infoEmpty:lang.no_result}:{info:lang.dts_info,infoEmpty:lang.dts_infoEmpty}),oClasses:{sFilterInput:"layui-input"},bPaginate:!1,initComplete:function(){select||manage_init(current_uid),top_btn_init(current_uid)}},c={pagingType:"simple_numbers",dom:"frtip",filter:!0,paging:!0,serverSide:!0,pageLength:page_size||20,ajax:_.throttle(function(e,t,i){e=$.extend(!0,{},e,n,{length:e.length||page_size||20}),$.post("?/file/list2/",e,function(e){privilege_array[current_uid]=e.current_privilege,t({draw:e.draw,recordsTotal:e.recordsTotal,recordsFiltered:e.recordsFiltered,data:data_to_html(e.files)})},"json")},500),drawCallback:function(){form.render();var e=this.api(),t=$(e.table().container()),i=t.find(".pager-wrap"),n=e.page.len(),a=e.page.info()||{};n?(i.show(),i.find(".pager").val(n)):i.hide(),1==a.pages?t.find(".dataTables_paginate").hide():t.find(".dataTables_paginate").show()},initComplete:function(){var i=this.api(),e=$(i.table().container());i.columns().visible(!0),e.on("change",".pager",function(e){e.preventDefault();var t=parseInt($(this).val())||20;i.page.len(t).draw()}),select||manage_init(current_uid),top_btn_init(current_uid)}};$(".file-table").dataTable($.extend(!0,{},r,paging?c:{})),refreshDoc()},refreshDoc=function(){show_doc_tree&&DocLibTree.render(!0),refresh&&(fresh_lis=setTimeout(function(){refresh&&docInit(current_uid)},6e4))},docInit=function(e,t,i){var n;$this.find(".tb_checkall").prop("checked",!1),$this.find(".hover").removeClass("hover");t=t||$this.find(".layui-breadcrumb").last().children("a:last-child[uid="+e+"]").attr("doc");var a={doc_type:doc_type,type:t,uid:e,eid:eid,list_type:list_type};DocPath.reset(e),current_uid=e,i?(docRender(i,a),i=null):(old_uid=current_uid,(n=LoadingLayer.create(1,0).show())&&$.post("?/file/list2/",a,function(e){docRender(e,a),n.close()},"json"))},manage_init=function(){var e,t={download:"ion-ios-cloud-download-outline",cut:"ion-scissors",copy:"ion-ios-copy-outline",paste:"ion-social-buffer-outline",del:"ion-trash-a"},i="";for(var n in t)check_priv(privilege_array[current_uid],n)&&(i+='<span class="layui-btn layui-btn-primary layui-btn-small" action="'+(e=n)+'"> <i class="'+t[n]+'"></i>'+lang[e]+"</span>");$this.find(".action-btn-box").html(i)},get_top_btn=function(e){var t="",i='<button type="button" class="layui-btn doc-tree-view" name="tree" ><i class="layui-icon">&#xe62e;</i><span >'+lang.folder_tree+"</span></button>",n='<button type="button" class="layui-btn create-dir" name="dir"><i class="layui-icon">&#xe61f;</i><span >'+lang.create_folder+"</span></button>"+(is_mobile?"":'<button type="button" class="layui-btn btn-upload-dir" name="file[]"><i class="layui-icon">&#xe67c;</i>'+lang.upload_folder+"</button>")+'<button type="button" class="layui-btn btn-upload-file" name="file[]"><i class="layui-icon">&#xe67c;</i><span >'+lang.upload_btn+"</span></button>",a='<button type="button" class="layui-btn cancel-btn" name="file[]"><span >'+lang.cancel+"</span></button>";return is_mobile||show_doc_tree&&(t+=i),e&&(t+=n),is_mobile&&(t+=a),'<div class="layui-btn-group top-btn-group">'+t+"</div>"},top_btn_init=function(i){var e=check_priv(privilege_array[current_uid],"upload"),t=get_top_btn(e);if(is_mobile?(mobile_check_toggle(),$mobile_btn.length&&$mobile_btn.remove(),$mobile_btn=$('<div id="doc_mobile_btn" class="mobile_a_btn mobile-doc-action-btns">'+t+"</div>"),$("body").append($mobile_btn),$mobile_btn.on("click",function(){mobile_action_toggle()}).on("click",".layui-btn-group.top-btn-group .cancel-btn",function(){mobile_action_toggle()}).on("click",".upload-group .layui-btn",function(e){e.preventDefault()||e.stopPropagation()}).on("click",".create-dir",function(){create_dir()})):($this.find(".top-btn-group").remove(),$this.find(".breadcrumb").before(t)),e){$this.find(".action-box i").show(),$(".btn-upload-dir").uploadDir({data:{eid:eid,uid:i,doc_type:doc_type},notify:notify,notifybox:new NotifyBox("uploadDir",eid,i,doc_type,path,notify,notify_t),complete:function(){mobile_action_toggle(),show_doc_tree&&DocLibTree.reset(),docInit(i)}});var n=$("<div></div>"),a="",o=new progressBar;upload.render({elem:(is_mobile?$mobile_btn:$this).find(".btn-upload-file"),url:"?/file/upload/",data:{eid:eid,uid:i,doc_type:doc_type},accept:"file",multiple:!0,auto:!notify,bindAction:n,beforeChoose:function(){notifybox=new NotifyBox("uploadFiles",eid,i,doc_type,path,notify,notify_t),notifybox.bindAction=n},choose:function(){notifybox.ask()},before:function(){o.init(lang.uploading),success=0,fail=0,failtypes=[],uploadFiles=[]},progress:function(e){o.onProgressChange(e)},done:function(e){e.ok?(success++,1==e.change_state&&(a=e.msg),notifybox.uploadFiles.push("<a href=\"javascript:viewfile('"+e.uuid+'\')" data-file-size="'+e.filesize+'">'+e.name+"</a>")):(fail++,failtypes.push(e.type))},allDone:function(e){if(o.close(),success){var t=b2.lang(notify?"success_upload_notify":"success_upload",{success:success});e.aborted&&(fail+=e.aborted),fail&&(t+=lang.file_have+fail+lang.file_failed),"object"==typeof failtypes&&failtypes.length&&(t+=lang.file_format+failtypes.join("銆�")),t+=a,show_doc_tree&&DocLibTree.reset(),docInit(i),layer.msg(t),notify&&notifybox.notify(t,e.successful),layer.msg(t)}else{t=fail+e.aborted+lang.file_failed+lang.file_format;"object"==typeof failtypes&&failtypes.length&&(t+=failtypes.join("銆�")),layer.msg(t)}mobile_action_toggle()},error:function(){mobile_action_toggle(),o.close(),layer.msg(lang.upload_failed)}})}else $this.find(".action-box i").hide()},mobile_action_toggle=function(e){e?$("#doc_mobile_btn").fadeIn(309).addClass("show"):$("#doc_mobile_btn").fadeOut(309).removeClass("show")},mobile_check_toggle=function(){$this.find(".doc-action .show-all-btn").hasClass("shown")?$this.find(".action-btn-box,thead tr th:first-child,tbody tr td:first-child:not(.dataTables_empty)").show():$this.find(".action-btn-box,thead tr th:first-child,tbody tr td:first-child:not(.dataTables_empty)").hide()},manage_lis=function(){$this.find(".file-table thead tr").append('<th class="'+(manage?"action-box":"")+'">'+lang.action+"</th>"),manage&&is_mobile&&($this.find(".action-box").html('<i class="icon ion-plus-round" style="font-size:1.5rem"></i>'),$this.on("click",".show-all-btn",function(){$(".doc-action .show-all-btn").toggleClass("shown"),$("#doc-next,#doc-previous").toggle(),mobile_check_toggle()}).on("click",".action-box",function(){check_priv(privilege_array[current_uid],"upload")?mobile_action_toggle(!0):layer.alert(lang.no_file_priv_upload,{title:lang.msg,btn:[lang.ok]})})),$this.find(".file-table").on("click",".flag>i",function(){flag=$(this).attr("flag"),fileid=$(this).attr("fileid"),check_priv(privilege_array[fileid],"flag")&&layer.prompt({area:"320",formType:2,value:flag,title:lang.label,maxlength:50,btn:[lang.ok,lang.cancel],success:function(e,t){is_mobile||$(e).width(360).css("marginLeft","auto").css("marginRight","auto")}},function(e,t,i){$.post("?/file/change_flag/"+fileid+"/",{flag:e,oldflag:flag},function(e){docInit(current_uid),layer.close(t),layer.msg(e.msg)},"json")})}).on("click",".rename",function(){rename_doc($(this))}).on("click",".more-info",function(){var i=$(this),e=$(this).attr("fileid"),t=$(this).parents("tr").find("td input").eq(0).data("fsize"),n=$(this).parents("tr").find("td input").eq(0).data("uname"),a=$(this).parents("tr").find("td input").eq(0).data("cdate"),o=b2.t("<p>涓婁紶鐢ㄦ埛锛歿uname}</p><p>鍒涘缓鏃堕棿锛歿cdate}</p><p>鏂囦欢澶у皬锛歿fsize}</p>",{uname:n,cdate:a,fsize:t||"鏈煡"}),l=[lang.ok];check_priv(privilege_array[e],"rename")&&l.push(lang.rename),check_priv(privilege_array[e],"del")&&l.push(lang.delete),layer.open({type:1,content:'<div style="padding: 20px 100px;">'+o+"</div>",btn:l,btnAlign:"c",shade:0,yes:function(e){layer.close(e)},btn2:function(e,t){rename_doc(i)},btn3:function(e,t){delete_doc(i)}})}).on("click",".del",function(){delete_doc($(this))}).on("click",".create-entity",function(){var param={name:$(this).attr("name"),fileid:$(this).attr("fileid"),doc_type:doc_type},entity=[];if(entity){var btn_text=btn_type="";$.each(entity.text,function(e,t){btn_text+="'"+t+"',",btn_type+=",btn"+(e+1)+": function(index,layero){add_by_file(index,'"+entity.type[e]+"');}"}),btn_text+="'鏀惧純'",eval("layer.msg('鎮ㄨ浠庢鏂囦欢鍒涘缓?', {btn: ["+btn_text+"]"+btn_type+"});")}function add_by_file(t,e){param.type=e,$.post("?/eitity/add_by_file/",param,function(e){layer.close(t),layer.msg(e.msg,{time:500},function(){v(e.url,"new")})},"json")}}).on("click",".privilege",function(){edit_priv($(this))}),$this.on("click",".create-dir",function(){create_dir()})},edit_priv=function(e){var t=e.attr("fileid"),i=e.attr("name"),n=function(e){1!=e.del||layer.msg("鈥�"+i+"鈥濆凡鍒犻櫎锛岃鍒锋柊椤甸潰锛�")};$.post("?/doc/edit_priv/",{uuid:t},function(e){n(e),layer.open({title:lang.doc_edit_priv,type:1,content:e,shade:!1,area:"960px",btn:[lang.submit,lang.cancel],success:function(){form.render()},yes:function(e,t){layer.close(e);var i=$(t).find("form").serialize();$.post("?/doc/edit_priv",i,function(e){n(e),1==e.ok?(docInit(current_uid),layer.msg(lang.permission_set)):layer.msg(lang.permission_fail)})},cancel:function(e,t){layer.close(e)}})})},create_dir=function(){check_priv(privilege_array[current_uid],"upload")&&layer.prompt({maxWidth:320,formType:0,value:lang.new_folder,title:lang.create_folder,btn:[lang.ok,lang.cancle],maxlength:50,success:function(e,t){select_input_value($(e).find("input")[0])}},function(t,i,e){var n=new NotifyBox("creatDir",eid,current_uid,doc_type,path,notify,notify_t);function a(){$.post("?/file/mkdir/",{eid:eid,uid:current_uid,doc_type:doc_type,name:t},function(){var e=lang.submit_success+"锛�"+t;n.uploadFiles.push(t),notify?n.notify(e,1):layer.msg(e),show_doc_tree&&DocLibTree.reset(),docInit(current_uid),layer.close(i),mobile_action_toggle()})}notify?n.ask(a):a()})},rename_doc=function(e){var n=e.attr("fileid"),t=e.attr("name"),i=t.split(".");1<i.length&&i.pop()==e.attr("type")&&(t=i.join(".")),layer.prompt({maxWidth:320,formType:0,value:t,title:lang.enter_new_name,btn:[lang.ok,lang.cancel],maxlength:50,success:function(e,t){select_input_value($(e).find("input")[0])}},function(e,t,i){$.post("?/file/rename/"+n+"/",{name:e},function(e){show_doc_tree&&DocLibTree.reset(),docInit(current_uid),layer.close(t),layer.msg(e.msg)},"json")})},delete_doc=function(e){var t=e.attr("fileid"),i=e.attr("name");layer.confirm(b2.t(lang.doc_del_confirm,{name:i}),{title:lang.msg,btn:[lang.ok,lang.cancel]},function(){$.post("?/file/del/"+t+"/",function(e){show_doc_tree&&DocLibTree.reset(),docInit(current_uid),layer.msg(e.msg)},"json")},function(){})},check_checked_priv=function(e,i){var n=!0;return e.forEach(function(e,t){uid=e.name.replace(/s\[/,"").replace(/\]/,""),check_priv(privilege_array[uid],i)||(n=!1)}),n},common_lis=function(){function i(e,t){if(e)switch(t){case"config_dir":case"dir":check_priv(privilege_array[e],"view")?docInit(e,t):layer.alert(lang.no_file_priv_view);break;default:viewfile(e)}}$this.on("click",".doc-action .action-btn-box span",function(){var t="fileStr",i="pasteAction",e=$(this).attr("action"),n=$this.find(".file-form").serialize(),a=$this.find(".file-form").serializeArray();if(""!=n||"paste"==e){switch(e){case"download":localStorage.removeItem(i),$.post("?/file/packup/",n+"&eid="+eid+"&uid="+current_uid+"&doc_type="+doc_type,function(e){e.ok&&DownLoadFile({url:e.url}),e.msg&&layer.alert(e.msg)},"json");break;case"cut":check_checked_priv(a,e)?(localStorage.setItem(t,n),localStorage.setItem(i,e),window.addEventListener("storage",function(e){docInit(current_uid)}),layer.msg(lang.cutted)):layer.msg(lang.no_file_priv_cut);break;case"copy":check_checked_priv(a,e)?(localStorage.setItem(t,n),localStorage.setItem(i,e),window.addEventListener("storage",function(e){docInit(current_uid)}),layer.msg(lang.copied)):layer.msg(lang.no_file_priv_copy);break;case"paste":n=localStorage.getItem(t);var o=localStorage.getItem(i);if(!n){layer.msg(lang.no_file_paste);break}if(!o){layer.msg(lang.select_action);break}check_priv(privilege_array[current_uid],e)?(clipboard=n+"&eid="+eid+"&doc_type="+doc_type,"load"==list_type&&(clipboard+="&list_type="+list_type),$.post("?/file/paste/"+current_uid+"/"+o,clipboard,function(e){e.msg&&layer.msg(e.msg),docInit(current_uid),show_doc_tree&&DocLibTree.reset(),localStorage.removeItem(t),localStorage.removeItem(i)})):layer.msg(lang.no_file_priv_paste);break;case"del":localStorage.removeItem(i),check_checked_priv(a,e)?layer.msg(lang.del_confirm,{btn:[lang.ok,lang.cancel],btn1:function(){$.post("?/file/del",n,function(e){layer.msg(e.msg),show_doc_tree&&DocLibTree.reset(),docInit(current_uid)},"json")}}):layer.msg(lang.no_file_priv_del)}$this.find(".tb_checkall").prop("checked",!1)}else layer.msg(lang.please_select)}).on("click",".doc-tree-view",function(){$(".doc-side").is(":visible")?($(".doc-side").hide(),$(".doc-body").addClass("transition").css({"margin-left":"0","padding-left":"0"})):($(".doc-body").addClass("transition").removeAttr("style"),$(".doc-side").fadeIn(500,show_doc_tree&&DocLibTree.render(!0))),setTimeout(function(){$(".doc-body").removeClass("transition")},500)}).on("click",".file-table .layui-disabled",function(){layer.msg(select?lang.cant_select_dir:lang.cant_select,{time:1e3})}).on("click",".file-table span.dir,.doc-bar .breadcrumb span a",function(e){var t=$(this);$(this).parents("tr").addClass("doc-highlight"),setTimeout(function(){t.parents("tr").removeClass("doc-highlight")},400),i($(this).attr("uid"),$(this).attr("doc"))}).on("click","#doc-previous",function(e){var t=$(".file-table span.dir,.doc-bar .breadcrumb span:nth-child(2) a")[0];null!=t&&$(t).trigger("click")}).on("click","#doc-next",function(e){i($(".doc-body").attr("uid"),$(".doc-body").attr("doc"))}).find(".file-table").one("draw.dt",function(){form.render(),layer.check_layer($(".doc-bar"))})},doclib_init=function(){show_doc_tree&&Doc.tree({elem:$this.find(".doc-tree"),manage:manage,doc_tree_privilege:doc_tree_privilege,toggle:function(e,t){DocLibTree.toggle(e,t)},hover_func:function(e,t){current_uid==e||docInit(e,t)}}),show_doc_tree&&DocLibTree.reset(!0),show_doc_tree&&Scrollbar.init(),common_lis(),manage_lis(),docInit(current_uid,!1,res)},doclib_init()},DocList=function(options){var $this=this;for(var i in options)eval("var "+i+"=options."+i);var display="newest"==display?"newest":"list2",laypage=layui.laypage;console.log(curr),laypage.render({elem:"laypage",curr:curr,count:count,limit:limit,first:"棣栭〉",last:"灏鹃〉",layout:["count","prev","page","next","limit","skip"],jump:function(e,t){t||$.post("?/doc/"+display+"/"+doc_type+"/"+eid+"/"+uid,{is_post:!0,page:e.curr,limit:e.limit},function(e){"newest"==display?$this.html(e):$this.find(".file_list").html(e)})}}),$this.on("click",".file-box .info .breadcrumb span",function(){var e=$(this).attr("eid"),t=$(this).attr("doc_type"),i=$(this).attr("uid");v("doc/view/"+t+"/"+e+"/"+i,"new")}).on("click",".file-box .info .name",function(){viewfile($(this).attr("uid"))})}}(window,document,jQuery),$(function(d){d.fn.extend({uploadDir:function(e){var s=e;return this.each(function(){var e=d(this),o=s.data,t=d('<input type="file" name="file" multiple directory webkitdirectory allowdirs>'),i=new Uppie,l=s.notifybox,r={},c=new progressBar;i(t[0],function(e,t,i){for(var n in i.forEach(function(e){t.append("paths[]",e)}),o)t.append(n,o[n]);function a(){d.ajax({type:"POST",url:"?/file/upload_dir/",data:t,dataType:"json",cache:!1,contentType:!1,processData:!1,xhr:c.xhr,beforeSend:function(){c.init(lang.uploading,!1,!0)},success:function(e){r=e},error:function(e){c.close(),msg=e},complete:function(){c.close(),d("form")[0].reset(),setTimeout(function(){var e=r.msg;r.ok&&s.notify?(l.dirname=r.dirname,r.dirs.forEach(function(e,t){l.uploadFiles.push(e.name)}),r.files.forEach(function(e,t){l.uploadFiles.push("<a href=\"javascript:viewfile('"+e.uuid+"')\">"+e.name+"</a>")}),l.notify(e,r.files.length,r.dirs.length)):layer.msg(e)},500),"function"==typeof s.complete&&s.complete()}})}s.notify?l.ask(a):a()}),e.off("click").on("click",function(){t.trigger("click")})})}})}),$(function(M){M.fn.extend({uploader:function(B){return this.each(function(){if(!M(this).attr("hasRender")){M(this).attr("hasRender",!0);var e=M(this).closest("td").attr("kid"),r="#"+M(this).attr("data"),c=M(r+"_file"),t=M(r).closest(".flow"),i=t.length?"flow":"doc",n=t.length?t:M(this).closest(".pepm-form"),a=(D=M.parseJSON(c.attr("ext"))).target,o=D.doc_type,s=D.up_folder||"root",d=M(r).find(".path").val(),u=D.choose,f=D.root_uid||"root",p=D.show_path,h=D.notify,l=D.select,g=D.select_root,_=D.formats?D.formats:"",m=D.del_list,v=D.widget,y="true"!=c.attr("single"),b=M(this).closest("td").attr("ftype");["_self","_parent","_system","_personal"].indexOf(a)<0&&(a="_self");var $="",w="",k="",x="";switch(a){case"_self":if($=M(r).closest("td").attr("eid"),w=o||M(r).closest("td").attr("view"),n.closest(".layui-layer").length)(S=n.find("#_rel")).length&&S.val()&&($=S.val()),(C=n.find("#_rel_view")).length&&C.val()&&(w=C.val());var T=M(r).closest(".rel_data");if(T.length&&T.attr("ext")){var D=M.parseJSON(T.attr("ext"));$=D.filter._rel,w=D.filter._rel_view}k=D.eid_link,w=w||i,x=function(){if(!k)return"";var e=n.find("#"+k);if(!e.length)return"";var t=e.closest("td").prev(".label");return t.length?t.text():""}();break;case"_parent":if($=seg4,w=seg1,n.closest(".layui-layer").length){var S=n.find("#_rel"),C=n.find("#_rel_view");S.length&&S.val()&&($=S.val()),C.length&&C.val()&&(w=C.val())}t.length&&t.attr("rel_eid")&&($=t.attr("rel_eid"));break;case"_system":w=o||i,$="system";break;case"_personal":w="personal"}var I=0,L=0,E=[],F=[],j=[],z={upload:null,showFileBox:function(){var o=this,l=M("<div></div>"),n=new progressBar,a="";function t(e){if(n.close(),I){var t=b2.lang(h?"success_upload_notify":"success_upload",{success:I});e.aborted&&(L+=e.aborted),L&&(t+=b2.lang("file_have_faild",{file:file})),"object"==typeof E&&E.length&&(t+=lang.file_format+E.join("銆�")),t+=a;var i=M(r).parents("#canvas,.layui-layer-content").find(".entity_wrap .Comment");i.length&&Comment.add_new_comment(i,"","upload_file",F,o.upload.config.data.path),o.upload.config.data.notify_to&&o.upload.config.data.notify_to.length?(o.upload.config.data.files_count=I,o.upload.config.data.uploadFiles=F,M.post("?/msg/notify",o.upload.config.data,function(e){layer.msg(t+lang.file_upload)})):(layer.msg(t),"function"==typeof B&&B(j))}else{t=L+e.aborted+lang.file_failed+lang.file_format;"object"==typeof E&&E.length&&(t+=E.join("銆�")),layer.msg(t)}}o.upload=upload.render({elem:r+"_file",url:"?/file/filebox/",accept:"file",multiple:y,auto:!h,bindAction:l,data:{eid:$,up_folder:s,path:d,view:w,notify:h,action:"uploadFiles",formats:_,kid:e,ftype:b},beforeChoose:function(){if("pic"==v)return!0;if("upload"==v&&!y&&M(r).find(".file-list").children("li").length)return layer.msg(lang.upload_file_single),!1;if(o.eid_link(),u)return o.choose_path(),!1;var e=o.check_upload_priv(),t=k&&!$&&x?b2.t(lang.please_put_value,{eid_link_label:x}):e.msg;return e.priv||layer.alert(t),e.priv},choose:function(e){h&&M.post("?/msg/notifybox/",{upload_notify:!0},function(e){layer.open({type:1,title:lang.select_notified,maxWidth:1e3,shadeClose:!1,content:e,btn:[lang.upload_btn,lang.cancel],yes:function(e,t){layer.close(e);var i=[],n=M(t);n.find("#userlist .notify-to input[type=checkbox]:checked").each(function(e){var t=M(this).val();M(this).attr("title");i.push(t)}).removeAttr("id");var a=n.find("#assign").val();o.upload.config.data.notify_to=i,o.upload.config.data.assign=a,l.trigger("click")}})})},before:function(){n.init(lang.uploading,!1,!0),L=I=0,E=[],F=[]},progress:function(e){n.onProgressChange(e)},done:function(i){if(0==i.code)I++,M(r).val(i.data.src),M(r+"_label").val(i.data.title),"logo_pic"===i.data.type?M(r+"_img").html('<a href="javascript:void(0);" onclick=\'change_log("'+i.data.src+'","'+r+'","'+i.data.title+'")\' ><img src="'+i.data.src+'" alt="'+i.data.title+'"></a>'):M(r+"_img").html('<img src="'+i.data.src+'" alt="'+i.data.title+'">'),M(r+"_del").show(),setTimeout(function(){var e=M(r+'_img [alt="'+i.data.title+'"]'),t=c;calcImgScale(e,t.attr("data-min-width"),t.attr("data-min-height"),t.attr("data-max-width"),t.attr("data-max-height")),M(e).show()}),layer.msg(i.msg),checked_checklist(M(r)),n.close();else if(1==i.ok){I++,j.push(i),1==i.change_state&&(a=i.msg);var e="<a href=\"javascript:viewfile('"+i.uuid+"')\">"+(p?i.path+i.name:i.name)+"</a>";M(r).find(".file-list").append('<li fileid="'+i.uuid+'">'+e+' <i class="layui-icon file-del">醼�</i></li>'),M(r).find(".data").append("<option selected >"+i.uuid+"</option>"),M(r).find(".data_label").append('<option fileid="'+i.uuid+'" selected >'+i.name+"</option>"),M(r).find(".data")[0].dispatchEvent(new Event("change")),M(r).find(".data_label")[0].dispatchEvent(new Event("change")),F.push("<a href=\"javascript:viewfile('"+i.uuid+"')\">"+i.name+"</a>"),F.push(e),M(r+"_del").show(),checked_checklist(M(r))}else L++,E.push(i.type);y||t({aborted:0})},allDone:function(e){t(e)},error:function(){n.close(),layer.msg(lang.action_failed)}})},check_upload_priv:function(){var t=!0,i="";return M.ajaxSettings.async=!1,M.post("?/file/upload_priv",{eid:$,up_folder:s,view:w},function(e){t=1==e.priv,i=e.msg}),M.ajaxSettings.async=!0,{priv:t,msg:i}},eid_link:function(){if(k){$eid_link=n.find("#"+k),$="",$eid_link.length&&("INPUT"==$eid_link[0].tagName?$=$eid_link.val().split(",")[0]:"SELECT"==$eid_link[0].tagName&&($=$eid_link.find("option:selected").val())),$=$||n.find("td[kid="+k+"] .link_style").eq(0).attr("uuid"),w=n.find("#"+k).find("option:selected").closest("optgroup").data("mod")||n.find("#"+k).attr("lay-filter")||w,w=($=$||"")?w:i;this.upload.config.data.eid=$,this.upload.config.data.view=w}},choose_path:function(){var l=this;M.post("?/doc/doc_tree/",{eid:$,doc_type:w,uid:f},function(i){$=i.eid,w=i.view,i.is_exist||(h=!1)||(l.upload.config.auto=!0),layer.open({title:lang.msg,type:1,model:!0,maxWidth:320,shadeClose:!1,content:i.html,btn:[lang.select_ok,lang.cancle],success:function(e,t){Doc.tree({elem:M(e).find(".doc-tree"),root_uid:f,hover:s||null,manage:i.manage,doc_tree_privilege:i.doc_tree_privilege}),FixedMenu.render()},yes:function(e,t){var i=M(t).find(".hover"),n=i.attr("uid"),a="";if("root"!=i.attr("uid")&&(a=i.attr("name")+"/",i.parentsUntil("li[uid='root']","li").each(function(){a=M(this).attr("name")+"/"+a})),n){s=n;var o=l.check_upload_priv();o.priv?(M(r).find(".up_folder").val(s),M(r).find(".path").val(a),l.upload.config.data.up_folder=s,l.upload.config.data.path=a,l.upload.config.data.eid=$,l.upload.config.data.view=w,layer.close(e),c.next().trigger("click")):layer.alert(o.msg)}else layer.msg("璇烽€夋嫨瑕佷笂浼犵殑鏂囦欢澶�")},end:function(){FixedMenu.render(500)}})})},select_file:function(){this.eid_link(),M.post("?/doc/select_file/",{eid:$,uid:g,doc_type:w},function(e){layer.open({type:1,title:lang.title_msg,maxWidth:1e3,shadeClose:!1,content:e.html,btn:[lang.select_ok,lang.cancle],success:function(e,t){FixedMenu.render()},yes:function(e,t){var a=j=data=data_label="";M(t).find(".breadcrumb span:nth-of-type(3) a:not([uid=root])").each(function(e,t){M(this).children("span").remove(),a+=M(this).text()+"/"}),M(t).find('.file-form input:not(".tb_checkall"):checked').parent().next().children("span.dir").each(function(e,t){var i=M(t).attr("uid"),n=M(t).attr("title");j+='<li fileid="'+i+'">'+(p?"鏂囨。/"+a+n:n)+' <i class="layui-icon file-del">醼�</i></li>',data+="<option selected >"+i+"</option>",data_label+='<option fileid="'+i+'" selected >'+n+"</option>"}),M(r).find(".file-list").append(j),M(r).find(".data").append(data),M(r).find(".data_label").append(data_label),j&&M(r+"_del").show(),layer.close(e)},end:function(){FixedMenu.render()}})})},fileDel:function(e){var t=e.parent(),i=t.attr("fileid");t.remove(),M(r).find(".data option").each(function(){M(this).text()==i&&M(this).remove()}),M(r).find(".data_label option").each(function(){M(this).attr("fileid")==i&&M(this).remove()}),1==M(r).find(".data option").length&&checked_checklist(M(r),!1)},del_one:function(i,n){var a=this,e=function(e,t){a.fileDel(i),M(r).find(".file-list li").length||M(r+"_del").hide(),e&&layer.close(e)},t=function(t,e){M.post("?/file/del/"+n,function(e){e.ok&&(a.fileDel(i),M(r).find(".file-list li").length||M(r+"_del").hide(),t&&layer.close(t)),layer.msg(e.msg)},"json")};switch(m){case"show_tip":layer.confirm(lang.file_del_one,{title:lang.alert,btn:[lang.option1,lang.option2,lang.cancel]},e,t);break;case"del_list":e();break;case"del_file":default:t()}},del_all:function(){var e=function(e,t){M(r+"_del").hide(),M(r).find("select option:not(:first-child)").remove(),M(r).find(".file-list").html(""),e&&layer.close(e)},t=function(t,e){var i=[];M(r).find("select.data option:not(:first-child)").each(function(){i.push(M(this).val())}),M.post("?/file/del",{list:i},function(e){e.ok&&(M(r+"_del").hide(),M(r).find("select option:not(:first-child)").remove(),M(r).find(".file-list").html(""),t&&layer.close(t)),layer.msg(e.msg)},"json")};switch(m){case"show_tip":layer.confirm(lang.file_del_all,{title:lang.alert,btn:[lang.option1,lang.option2,lang.cancel]},e,t);break;case"del_list":e();break;case"del_file":default:t()}},init:function(){var i=this;if("upload"==v&&!u&&!k){var e=i.check_upload_priv();if(!e.priv)return c.css("transition","none").on("click",function(){layer.alert(e.msg)}).addClass("layui-btn-disabled layui-bg-gray"),l&&M(r+"_select").css("transition","none").on("click",function(){layer.alert(e.msg)}).addClass("layui-btn-disabled layui-bg-gray"),void setTimeout(function(){c.css("transition",""),l&&M(r+"_select").css("transition","")},500)}i.showFileBox(),l&&M(r+"_select").click(function(){i.select_file()}),c.siblings(".uploader").on("click",".file-list .file-del",function(){var e=M(this),t=M(this).parent().attr("fileid");i.del_one(e,t)}),M(r+"_del").on("click",function(){"pic"==v?(M(this).hide(),M(r+","+r+"_label").val(""),M(r+"_img").html("")):i.del_all(),checked_checklist(M(r),!1)})}};setTimeout(function(){h&&$?M.post("?/entity/entity_exist/",{eid:$},function(e){h=e.is_exist,z.init()}):z.init()})}})}})});var progressBar=function(){var a={layuiID:0,tag:"pbar",autoClose:!1,test:!1,minSize:0,currentLoaded:0,totalSize:0,maxPercent:100,getRandom:function(e,t){return Math.floor(Math.random()*t+e)},init:function(e,t,i){t||(t=!1),i||(i=!1),a.minSize=0,a.currentLoaded=0,a.totalSize=0,a.autoClose=t,a.tag="pbar"+a.getRandom(1,100),a.test=i;var n='<div id="file_upload_progress">         <div lay-filter="progress_'+a.tag+'" class="layui-progress layui-progress-big" lay-showpercent="true">           <div id=progress_'+a.tag+' class="layui-progress-bar layui-bg-blue" lay-percent=""></div>         </div>       </div>';a.layuiID=layer.open({title:e,type:1,maxWidth:1e3,content:n,closeBtn:0,success:function(e,t){element.init()}})},setProgress:function(e){element.progress("progress_"+a.tag,e+"%"),a.autoClose&&(100<=e||e>=a.maxPercent)&&setTimeout(function(){a.close()},300)},close:function(){a.maxPercent<100&&this.setProgress(100),layer.close(a.layuiID)},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){a.onProgressChange(e)},e},onProgressChange:function(e){e.total>a.totalSize&&(a.totalSize=e.total),e.loaded>a.currentLoaded&&(a.currentLoaded=e.loaded),2097152<e.total&&(a.maxPercent=99);var t=Math.min(Math.floor(a.currentLoaded/a.totalSize*100),a.maxPercent);a.setProgress(t)}};return a};function checked_checklist(e,t){null==t&&(t=!0);var i=e.attr("data-id");if(i){var n=$("[kid="+i+"]");if(n.length){var a=e.closest("td").prev("td.label").html(),o=!1;if(0==n.find("input:checkbox[value="+a+"]:checked").length&&1==t&&(o=!0),0<n.find("input:checkbox[value="+a+"]:checked").length&&0==t&&(o=!0),o){var l=n.find("input:checkbox[value="+a+"]:disabled").length;l&&n.find("input:checkbox[value="+a+"]:disabled").removeAttr("disabled"),n.find("input:checkbox[value="+a+"]").trigger("click"),n.find("input:checkbox[value="+a+"]").closest(".checklist").Checklist(),l&&n.find("input:checkbox[value="+a+"]").prop("disabled",!0),form.render()}}}}function viewfile(i,e,t){e=e||"";t?DownLoadFile({url:"?/file/get/"+i}):$.post("?/file/prop/"+i+"/"+e,function(e){switch(e.code){case"error":layer.alert(e.msg,{title:lang.msg,btn:[lang.ok]});break;case"preview":if(isMobile.any()){var t="/?/file/view/"+i;t+="&from="+location.href+"&preview=1",window.open(t,"_self")}else v("file/view/"+i,"preview",{},"",!0);break;case"pic":viewPhotos("?/file/pic/"+i,e.name);break;case"download_excel":DownLoadFile({url:"?/file/get_excel/"+i});break;case"download":DownLoadFile({url:"?/file/get/"+i});break;default:layer.alert("...")}},"json")}$("#pswp_layer").length||$.post("static/photoswipe/photoswipe.html",function(e){$("body").append(e)});var viewPhotos=function(i,a,o){var t=$("#pswp_layer"),n=[],l={index:i instanceof $?function(){for(var e=a.find("img"),t=0;t<e.length;t++)if(e.eq(t).attr("src")==i.attr("src"))return t;return 0}():0,fullscreenEl:!1,shareEl:!1,bgOpacity:isMobile.any()?1:.6,history:!1,maxSpreadZoom:5,closeOnScroll:!1,getThumbBoundsFn:i instanceof $&&function(e){var t=a.find("img").eq(e)[0],i=window.pageYOffset||document.documentElement.scrollTop,n=t.getBoundingClientRect();return o?{x:n.left+o.offset().left,y:n.top+o.offset().top,w:n.width}:{x:n.left,y:n.top+i,w:n.width}}},r=function(){var e=new PhotoSwipe(t[0],PhotoSwipeUI_Default,n,l);e.listen("destroy",function(){t.data("show",!1)}),e.init()};if(!t.data("show")&&(i instanceof $||"string"==typeof i))if(t.data("show",!0),i instanceof $)a.find("img").each(function(){var e=$(this).attr("src"),t=Math.min($(this)[0].naturalWidth,$(window).width()),i=t*$(this)[0].height/$(this)[0].width;n.push({src:e,w:t,h:i,title:$(this).attr("alt")})}),r();else{var c=new Image,s=i,d=a,u=LoadingLayer.create(1,0).show();c.src=s,c.onload=function(){var e=Math.min(c.naturalWidth,$(window).width()),t=e*c.height/c.width;n=[{src:s,w:e,h:t,title:d}],r(),u.close()}}},DownLoadFile=function(e){var t=$.extend(!0,{method:"post"},e),i=$('<form target="_self" method="'+t.method+'" />');for(var n in i.attr("action",t.url),t.data)i.append('<input type="hidden" name="'+n+'" value="'+t.data[n]+'" />');$(document.body).append(i),i[0].submit(),i.remove()};function calcImgScale(e,t,i,n,a,o){!o&&(o=!1),-1==n&&-1==a||(o?scaleImg(e,t,i,n,a):$(e).load(function(){scaleImg(e,t,i,n,a)}))}function scaleImg(l,e,t,r,c){setTimeout(function(){var e=new Image;e.src=l.attr("src");for(var t=e.width,i=e.height,n=1,a=1,o=0;(0==i||0==t)&&o++<100;);0!=t&&0!=i&&(0<r&&r<t&&(n=r/t),0<c&&c<i&&(a=c/i),imgCalcHeight=n<a?(imgCalcWidth=n*t,n*i):(imgCalcWidth=a*t,a*i),0!=imgCalcWidth&&0!=imgCalcHeight||(imgCalcWidth=t,imgCalcHeight=i),$(l).attr("width",imgCalcWidth+"px"),$(l).attr("height",imgCalcHeight+"px"))})}function change_log(e,t,i,n){layer.open({type:1,title:!1,closeBtn:0,area:"auto",maxWidth:"10%",shadeClose:!0,offset:"100px",skin:"logo_pic_change",content:'<img src="'+e+'" id="cropbox"><div class="example"><input type="hidden" id="x"><input type="hidden" id="y"><input type="hidden" id="w"><input type="hidden" id="h"><input type="hidden" id="img_name" value="'+e+'"></div><div class="logo_change_btn"><a class="layui-btn " onclick=\'change_log_2("'+t+'","'+i+'","'+n+"\")'>瑁佸壀鍥惧儚</a></div><style>.layui-layer-modal .layui-layer{position: absolute;}.logo_pic_change{top:10% !important;}.jcrop-holder{background-color: #ffffff00 !important;}.logo_change_btn{padding-top:20px;    text-align: center;}</style>",success:function(e,t){$(document).on("mouseover","#cropbox",function(){$("#cropbox").Jcrop({bgOpacity:1,bgFade:!1,onSelect:updateCoords})})}})}function updateCoords(e){$("#x").val(e.x),$("#y").val(e.y),$("#w").val(e.w),$("#h").val(e.h)}function change_log_2(t,i,e){console.log(i);var n=document.getElementById("x").value,a=document.getElementById("y").value,o=document.getElementById("w").value,l=document.getElementById("h").value,r=document.getElementById("img_name").value;$.ajax({type:"POST",url:"?/api/change_log/",data:{x:n,y:a,w:o,h:l,img_name:r,uuid:"<?=$uuid?>",kid:e},success:function(e){e&&($(t+"_img").html('<a href="javascript:void(0);" onclick=\'change_log("'+e+'","'+t+'")\' ><img src="'+e+'" alt="'+i+'"></a>'),$(t).val(e),$(t+"_label").val(i),$(t+"_del").show(),layer.close(layer.index))}})}function no_change_logo(){layer.msg("姝や负鑷姩鐢熸垚锛岃閲嶆柊涓婁紶鍥剧墖銆�")}
!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.PhotoSwipe=t()}(this,function(){"use strict";return function(m,i,e,t){var f={features:null,bind:function(e,t,n,i){var o=(i?"remove":"add")+"EventListener";t=t.split(" ");for(var a=0;a<t.length;a++)t[a]&&e[o](t[a],n,!1)},isArray:function(e){return e instanceof Array},createEl:function(e,t){var n=document.createElement(t||"div");return e&&(n.className=e),n},getScrollY:function(){var e=window.pageYOffset;return void 0!==e?e:document.documentElement.scrollTop},unbind:function(e,t,n){f.bind(e,t,n,!0)},removeClass:function(e,t){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")},addClass:function(e,t){f.hasClass(e,t)||(e.className+=(e.className?" ":"")+t)},hasClass:function(e,t){return e.className&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},getChildByClass:function(e,t){for(var n=e.firstChild;n;){if(f.hasClass(n,t))return n;n=n.nextSibling}},arraySearch:function(e,t,n){for(var i=e.length;i--;)if(e[i][n]===t)return i;return-1},extend:function(e,t,n){for(var i in t)if(t.hasOwnProperty(i)){if(n&&e.hasOwnProperty(i))continue;e[i]=t[i]}},easing:{sine:{out:function(e){return Math.sin(e*(Math.PI/2))},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},cubic:{out:function(e){return--e*e*e+1}}},detectFeatures:function(){if(f.features)return f.features;var e=f.createEl().style,t="",n={};if(n.oldIE=document.all&&!document.addEventListener,n.touch="ontouchstart"in window,window.requestAnimationFrame&&(n.raf=window.requestAnimationFrame,n.caf=window.cancelAnimationFrame),n.pointerEvent=navigator.pointerEnabled||navigator.msPointerEnabled,!n.pointerEvent){var i=navigator.userAgent;if(/iP(hone|od)/.test(navigator.platform)){var o=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);o&&0<o.length&&1<=(o=parseInt(o[1],10))&&o<8&&(n.isOldIOSPhone=!0)}var a=i.match(/Android\s([0-9\.]*)/),r=a?a[1]:0;1<=(r=parseFloat(r))&&(r<4.4&&(n.isOldAndroid=!0),n.androidVersion=r),n.isMobileOpera=/opera mini|opera mobi/i.test(i)}for(var l,s,u=["transform","perspective","animationName"],c=["","webkit","Moz","ms","O"],d=0;d<4;d++){t=c[d];for(var p=0;p<3;p++)l=u[p],s=t+(t?l.charAt(0).toUpperCase()+l.slice(1):l),!n[l]&&s in e&&(n[l]=s);t&&!n.raf&&(t=t.toLowerCase(),n.raf=window[t+"RequestAnimationFrame"],n.raf&&(n.caf=window[t+"CancelAnimationFrame"]||window[t+"CancelRequestAnimationFrame"]))}if(!n.raf){var m=0;n.raf=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-m)),i=window.setTimeout(function(){e(t+n)},n);return m=t+n,i},n.caf=function(e){clearTimeout(e)}}return n.svg=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,f.features=n}};f.detectFeatures(),f.features.oldIE&&(f.bind=function(e,t,n,i){t=t.split(" ");for(var o,a=(i?"detach":"attach")+"Event",r=function(){n.handleEvent.call(n)},l=0;l<t.length;l++)if(o=t[l])if("object"==typeof n&&n.handleEvent){if(i){if(!n["oldIE"+o])return!1}else n["oldIE"+o]=r;e[a]("on"+o,n["oldIE"+o])}else e[a]("on"+o,n)});var h=this,y={allowPanToNext:!0,spacing:.12,bgOpacity:1,mouseUsed:!1,loop:!0,pinchToClose:!0,closeOnScroll:!0,closeOnVerticalDrag:!0,verticalDragRange:.75,hideAnimationDuration:333,showAnimationDuration:333,showHideOpacity:!1,focus:!0,escKey:!0,arrowKeys:!0,mainScrollEndFriction:.35,panEndFriction:.35,isClickableElement:function(e){return"A"===e.tagName},getDoubleTapZoom:function(e,t){return e?1:t.initialZoomLevel<.7?1:1.33},maxSpreadZoom:1.33,modal:!0,scaleMode:"fit"};f.extend(y,t);var s,o,a,x,r,l,u,c,d,v,p,g,w,b,I,C,D,T,M,S,A,E,O,k,R,Z,P,F,L,z,_,N,U,H,Y,W,B,G,X,V,K,q,n,$,j,J,Q,ee,te,ne,ie,oe,ae,re,le,se,ue={x:0,y:0},ce={x:0,y:0},de={x:0,y:0},pe={},me=0,fe={},he={x:0,y:0},ye=0,xe=!0,ve=[],ge={},we=!1,be=function(e,t){f.extend(h,t.publicMethods),ve.push(e)},Ie=function(e){var t=Ht();return t-1<e?e-t:e<0?t+e:e},Ce={},De=function(e,t){return Ce[e]||(Ce[e]=[]),Ce[e].push(t)},Te=function(e){var t=Ce[e];if(t){var n=Array.prototype.slice.call(arguments);n.shift();for(var i=0;i<t.length;i++)t[i].apply(h,n)}},Me=function(){return(new Date).getTime()},Se=function(e){re=e,h.bg.style.opacity=e*y.bgOpacity},Ae=function(e,t,n,i,o){(!we||o&&o!==h.currItem)&&(i/=o?o.fitRatio:h.currItem.fitRatio),e[E]=g+t+"px, "+n+"px"+w+" scale("+i+")"},Ee=function(e){te&&(e&&(v>h.currItem.fitRatio?we||($t(h.currItem,!1,!0),we=!0):we&&($t(h.currItem),we=!1)),Ae(te,de.x,de.y,v))},Oe=function(e){e.container&&Ae(e.container.style,e.initialPosition.x,e.initialPosition.y,e.initialZoomLevel,e)},ke=function(e,t){t[E]=g+e+"px, 0px"+w},Re=function(e,t){if(!y.loop&&t){var n=x+(he.x*me-e)/he.x,i=Math.round(e-ct.x);(n<0&&0<i||n>=Ht()-1&&i<0)&&(e=ct.x+i*y.mainScrollEndFriction)}ct.x=e,ke(e,r)},Ze=function(e,t){var n=dt[e]-fe[e];return ce[e]+ue[e]+n-n*(t/p)},Pe=function(e,t){e.x=t.x,e.y=t.y,t.id&&(e.id=t.id)},Fe=function(e){e.x=Math.round(e.x),e.y=Math.round(e.y)},Le=null,ze=function(){Le&&(f.unbind(document,"mousemove",ze),f.addClass(m,"pswp--has_mouse"),y.mouseUsed=!0,Te("mouseUsed")),Le=setTimeout(function(){Le=null},100)},_e=function(e,t){var n=Xt(h.currItem,pe,e);return t&&(ee=n),n},Ne=function(e){return e||(e=h.currItem),e.initialZoomLevel},Ue=function(e){return e||(e=h.currItem),0<e.w?y.maxSpreadZoom:1},He=function(e,t,n,i){return i===h.currItem.initialZoomLevel?(n[e]=h.currItem.initialPosition[e],!0):(n[e]=Ze(e,i),n[e]>t.min[e]?(n[e]=t.min[e],!0):n[e]<t.max[e]&&(n[e]=t.max[e],!0))},Ye=function(e){var t="";y.escKey&&27===e.keyCode?t="close":y.arrowKeys&&(37===e.keyCode?t="prev":39===e.keyCode&&(t="next")),t&&(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||(e.preventDefault?e.preventDefault():e.returnValue=!1,h[t]()))},We=function(e){e&&(q||K||ne||B)&&(e.preventDefault(),e.stopPropagation())},Be=function(){h.setScrollOffset(0,f.getScrollY())},Ge={},Xe=0,Ve=function(e){Ge[e]&&(Ge[e].raf&&Z(Ge[e].raf),Xe--,delete Ge[e])},Ke=function(e){Ge[e]&&Ve(e),Ge[e]||(Xe++,Ge[e]={})},qe=function(){for(var e in Ge)Ge.hasOwnProperty(e)&&Ve(e)},$e=function(e,t,n,i,o,a,r){var l,s=Me();Ke(e);var u=function(){if(Ge[e]){if(l=Me()-s,i<=l)return Ve(e),a(n),void(r&&r());a((n-t)*o(l/i)+t),Ge[e].raf=R(u)}};u()},je={shout:Te,listen:De,viewportSize:pe,options:y,isMainScrollAnimating:function(){return ne},getZoomLevel:function(){return v},getCurrentIndex:function(){return x},isDragging:function(){return X},isZooming:function(){return J},setScrollOffset:function(e,t){fe.x=e,z=fe.y=t,Te("updateScrollOffset",fe)},applyZoomPan:function(e,t,n,i){de.x=t,de.y=n,v=e,Ee(i)},init:function(){if(!s&&!o){var e;h.framework=f,h.template=m,h.bg=f.getChildByClass(m,"pswp__bg"),P=m.className,s=!0,_=f.detectFeatures(),R=_.raf,Z=_.caf,E=_.transform,L=_.oldIE,h.scrollWrap=f.getChildByClass(m,"pswp__scroll-wrap"),h.container=f.getChildByClass(h.scrollWrap,"pswp__container"),r=h.container.style,h.itemHolders=C=[{el:h.container.children[0],wrap:0,index:-1},{el:h.container.children[1],wrap:0,index:-1},{el:h.container.children[2],wrap:0,index:-1}],C[0].el.style.display=C[2].el.style.display="none",function(){if(E){var e=_.perspective&&!k;return g="translate"+(e?"3d(":"("),w=_.perspective?", 0px)":")"}E="left",f.addClass(m,"pswp--ie"),ke=function(e,t){t.left=e+"px"},Oe=function(e){var t=1<e.fitRatio?1:e.fitRatio,n=e.container.style,i=t*e.w,o=t*e.h;n.width=i+"px",n.height=o+"px",n.left=e.initialPosition.x+"px",n.top=e.initialPosition.y+"px"},Ee=function(){if(te){var e=te,t=h.currItem,n=1<t.fitRatio?1:t.fitRatio,i=n*t.w,o=n*t.h;e.width=i+"px",e.height=o+"px",e.left=de.x+"px",e.top=de.y+"px"}}}(),d={resize:h.updateSize,orientationchange:function(){clearTimeout(N),N=setTimeout(function(){pe.x!==h.scrollWrap.clientWidth&&h.updateSize()},500)},scroll:Be,keydown:Ye,click:We};var t=_.isOldIOSPhone||_.isOldAndroid||_.isMobileOpera;for(_.animationName&&_.transform&&!t||(y.showAnimationDuration=y.hideAnimationDuration=0),e=0;e<ve.length;e++)h["init"+ve[e]]();i&&(h.ui=new i(h,f)).init(),Te("firstUpdate"),x=x||y.index||0,(isNaN(x)||x<0||x>=Ht())&&(x=0),h.currItem=Ut(x),(_.isOldIOSPhone||_.isOldAndroid)&&(xe=!1),m.setAttribute("aria-hidden","false"),y.modal&&(xe?m.style.position="fixed":(m.style.position="absolute",m.style.top=f.getScrollY()+"px")),void 0===z&&(Te("initialLayout"),z=F=f.getScrollY());var n="pswp--open ";for(y.mainClass&&(n+=y.mainClass+" "),y.showHideOpacity&&(n+="pswp--animate_opacity "),n+=k?"pswp--touch":"pswp--notouch",n+=_.animationName?" pswp--css_animation":"",n+=_.svg?" pswp--svg":"",f.addClass(m,n),h.updateSize(),l=-1,ye=null,e=0;e<3;e++)ke((e+l)*he.x,C[e].el.style);L||f.bind(h.scrollWrap,c,h),De("initialZoomInEnd",function(){h.setContent(C[0],x-1),h.setContent(C[2],x+1),C[0].el.style.display=C[2].el.style.display="block",y.focus&&m.focus(),f.bind(document,"keydown",h),_.transform&&f.bind(h.scrollWrap,"click",h),y.mouseUsed||f.bind(document,"mousemove",ze),f.bind(window,"resize scroll orientationchange",h),Te("bindEvents")}),h.setContent(C[1],x),h.updateCurrItem(),Te("afterInit"),xe||(b=setInterval(function(){Xe||X||J||v!==h.currItem.initialZoomLevel||h.updateSize()},1e3)),f.addClass(m,"pswp--visible")}},close:function(){s&&(o=!(s=!1),Te("close"),f.unbind(window,"resize scroll orientationchange",h),f.unbind(window,"scroll",d.scroll),f.unbind(document,"keydown",h),f.unbind(document,"mousemove",ze),_.transform&&f.unbind(h.scrollWrap,"click",h),X&&f.unbind(window,u,h),clearTimeout(N),Te("unbindEvents"),Yt(h.currItem,null,!0,h.destroy))},destroy:function(){Te("destroy"),Lt&&clearTimeout(Lt),m.setAttribute("aria-hidden","true"),m.className=P,b&&clearInterval(b),f.unbind(h.scrollWrap,c,h),f.unbind(window,"scroll",h),ft(),qe(),Ce=null},panTo:function(e,t,n){n||(e>ee.min.x?e=ee.min.x:e<ee.max.x&&(e=ee.max.x),t>ee.min.y?t=ee.min.y:t<ee.max.y&&(t=ee.max.y)),de.x=e,de.y=t,Ee()},handleEvent:function(e){e=e||window.event,d[e.type]&&d[e.type](e)},goTo:function(e){var t=(e=Ie(e))-x;ye=t,x=e,h.currItem=Ut(x),me-=t,Re(he.x*me),qe(),ne=!1,h.updateCurrItem()},next:function(){h.goTo(x+1)},prev:function(){h.goTo(x-1)},updateCurrZoomItem:function(e){if(e&&Te("beforeChange",0),C[1].el.children.length){var t=C[1].el.children[0];te=f.hasClass(t,"pswp__zoom-wrap")?t.style:null}else te=null;ee=h.currItem.bounds,p=v=h.currItem.initialZoomLevel,de.x=ee.center.x,de.y=ee.center.y,e&&Te("afterChange")},invalidateCurrItems:function(){I=!0;for(var e=0;e<3;e++)C[e].item&&(C[e].item.needsUpdate=!0)},updateCurrItem:function(e){if(0!==ye){var t,n=Math.abs(ye);if(!(e&&n<2)){h.currItem=Ut(x),we=!1,Te("beforeChange",ye),3<=n&&(l+=ye+(0<ye?-3:3),n=3);for(var i=0;i<n;i++)0<ye?(t=C.shift(),C[2]=t,ke((++l+2)*he.x,t.el.style),h.setContent(t,x-n+i+1+1)):(t=C.pop(),C.unshift(t),ke(--l*he.x,t.el.style),h.setContent(t,x+n-i-1-1));if(te&&1===Math.abs(ye)){var o=Ut(D);o.initialZoomLevel!==v&&(Xt(o,pe),$t(o),Oe(o))}ye=0,h.updateCurrZoomItem(),D=x,Te("afterChange")}}},updateSize:function(e){if(!xe&&y.modal){var t=f.getScrollY();if(z!==t&&(m.style.top=t+"px",z=t),!e&&ge.x===window.innerWidth&&ge.y===window.innerHeight)return;ge.x=window.innerWidth,ge.y=window.innerHeight,m.style.height=ge.y+"px"}if(pe.x=h.scrollWrap.clientWidth,pe.y=h.scrollWrap.clientHeight,Be(),he.x=pe.x+Math.round(pe.x*y.spacing),he.y=pe.y,Re(he.x*me),Te("beforeResize"),void 0!==l){for(var n,i,o,a=0;a<3;a++)n=C[a],ke((a+l)*he.x,n.el.style),o=x+a-1,y.loop&&2<Ht()&&(o=Ie(o)),(i=Ut(o))&&(I||i.needsUpdate||!i.bounds)?(h.cleanSlide(i),h.setContent(n,o),1===a&&(h.currItem=i,h.updateCurrZoomItem(!0)),i.needsUpdate=!1):-1===n.index&&0<=o&&h.setContent(n,o),i&&i.container&&(Xt(i,pe),$t(i),Oe(i));I=!1}p=v=h.currItem.initialZoomLevel,(ee=h.currItem.bounds)&&(de.x=ee.center.x,de.y=ee.center.y,Ee(!0)),Te("resize")},zoomTo:function(t,e,n,i,o){e&&(p=v,dt.x=Math.abs(e.x)-de.x,dt.y=Math.abs(e.y)-de.y,Pe(ce,de));var a=_e(t,!1),r={};He("x",a,r,t),He("y",a,r,t);var l=v,s=de.x,u=de.y;Fe(r);var c=function(e){de.y=1===e?(v=t,de.x=r.x,r.y):(v=(t-l)*e+l,de.x=(r.x-s)*e+s,(r.y-u)*e+u),o&&o(e),Ee(1===e)};n?$e("customZoomTo",0,1,n,i||f.easing.sine.inOut,c):c(1)}},Je={},Qe={},et={},tt={},nt={},it=[],ot={},at=[],rt={},lt=0,st={x:0,y:0},ut=0,ct={x:0,y:0},dt={x:0,y:0},pt={x:0,y:0},mt=function(e,t){return rt.x=Math.abs(e.x-t.x),rt.y=Math.abs(e.y-t.y),Math.sqrt(rt.x*rt.x+rt.y*rt.y)},ft=function(){n&&(Z(n),n=null)},ht=function(){X&&(n=R(ht),Et())},yt=function(e,t){return!(!e||e===document)&&!(e.getAttribute("class")&&-1<e.getAttribute("class").indexOf("pswp__scroll-wrap"))&&(t(e)?e:yt(e.parentNode,t))},xt={},vt=function(e,t){return xt.prevent=!yt(e.target,y.isClickableElement),Te("preventDragEvent",e,t,xt),xt.prevent},gt=function(e,t){return t.x=e.pageX,t.y=e.pageY,t.id=e.identifier,t},wt=function(e,t,n){n.x=.5*(e.x+t.x),n.y=.5*(e.y+t.y)},bt=function(){var e=de.y-h.currItem.initialPosition.y;return 1-Math.abs(e/(pe.y/2))},It={},Ct={},Dt=[],Tt=function(e){for(;0<Dt.length;)Dt.pop();return O?(se=0,it.forEach(function(e){0===se?Dt[0]=e:1===se&&(Dt[1]=e),se++})):-1<e.type.indexOf("touch")?e.touches&&0<e.touches.length&&(Dt[0]=gt(e.touches[0],It),1<e.touches.length&&(Dt[1]=gt(e.touches[1],Ct))):(It.x=e.pageX,It.y=e.pageY,It.id="",Dt[0]=It),Dt},Mt=function(e,t){var n,i,o,a,r=de[e]+t[e],l=0<t[e],s=ct.x+t.x,u=ct.x-ot.x;return n=r>ee.min[e]||r<ee.max[e]?y.panEndFriction:1,r=de[e]+t[e]*n,!y.allowPanToNext&&v!==h.currItem.initialZoomLevel||(te?"h"!==ie||"x"!==e||K||(l?(r>ee.min[e]&&(n=y.panEndFriction,ee.min[e],i=ee.min[e]-ce[e]),(i<=0||u<0)&&1<Ht()?(a=s,u<0&&s>ot.x&&(a=ot.x)):ee.min.x!==ee.max.x&&(o=r)):(r<ee.max[e]&&(n=y.panEndFriction,ee.max[e],i=ce[e]-ee.max[e]),(i<=0||0<u)&&1<Ht()?(a=s,0<u&&s<ot.x&&(a=ot.x)):ee.min.x!==ee.max.x&&(o=r))):a=s,"x"!==e)?void(ne||$||v>h.currItem.fitRatio&&(de[e]+=t[e]*n)):(void 0!==a&&(Re(a,!0),$=a!==ot.x),ee.min.x!==ee.max.x&&(void 0!==o?de.x=o:$||(de.x+=t.x*n)),void 0!==a)},St=function(e){if(!("mousedown"===e.type&&0<e.button)){if(Nt)return void e.preventDefault();if(!G||"mousedown"!==e.type){if(vt(e,!0)&&e.preventDefault(),Te("pointerDown"),O){var t=f.arraySearch(it,e.pointerId,"id");t<0&&(t=it.length),it[t]={x:e.pageX,y:e.pageY,id:e.pointerId}}var n=Tt(e),i=n.length;j=null,qe(),X&&1!==i||(X=oe=!0,f.bind(window,u,h),W=le=ae=B=$=q=V=K=!1,ie=null,Te("firstTouchStart",n),Pe(ce,de),ue.x=ue.y=0,Pe(tt,n[0]),Pe(nt,tt),ot.x=he.x*me,at=[{x:tt.x,y:tt.y}],H=U=Me(),_e(v,!0),ft(),ht()),!J&&1<i&&!ne&&!$&&(p=v,J=V=!(K=!1),ue.y=ue.x=0,Pe(ce,de),Pe(Je,n[0]),Pe(Qe,n[1]),wt(Je,Qe,pt),dt.x=Math.abs(pt.x)-de.x,dt.y=Math.abs(pt.y)-de.y,Q=mt(Je,Qe))}}},At=function(e){if(e.preventDefault(),O){var t=f.arraySearch(it,e.pointerId,"id");if(-1<t){var n=it[t];n.x=e.pageX,n.y=e.pageY}}if(X){var i=Tt(e);if(ie||q||J)j=i;else if(ct.x!==he.x*me)ie="h";else{var o=Math.abs(i[0].x-tt.x)-Math.abs(i[0].y-tt.y);10<=Math.abs(o)&&(ie=0<o?"h":"v",j=i)}}},Et=function(){if(j){var e=j.length;if(0!==e)if(Pe(Je,j[0]),et.x=Je.x-tt.x,et.y=Je.y-tt.y,J&&1<e){if(tt.x=Je.x,tt.y=Je.y,!et.x&&!et.y&&(s=j[1],u=Qe,s.x===u.x&&s.y===u.y))return;Pe(Qe,j[1]),K||(K=!0,Te("zoomGestureStarted"));var t=mt(Je,Qe),n=Pt(t);n>h.currItem.initialZoomLevel+h.currItem.initialZoomLevel/15&&(le=!0);var i=1,o=Ne(),a=Ue();if(n<o)if(y.pinchToClose&&!le&&p<=h.currItem.initialZoomLevel){var r=1-(o-n)/(o/1.2);Se(r),Te("onPinchClose",r),ae=!0}else 1<(i=(o-n)/o)&&(i=1),n=o-i*(o/3);else a<n&&(1<(i=(n-a)/(6*o))&&(i=1),n=a+i*o);i<0&&(i=0),wt(Je,Qe,st),ue.x+=st.x-pt.x,ue.y+=st.y-pt.y,Pe(pt,st),de.x=Ze("x",n),de.y=Ze("y",n),W=v<n,v=n,Ee()}else{if(!ie)return;if(oe&&(oe=!1,10<=Math.abs(et.x)&&(et.x-=j[0].x-nt.x),10<=Math.abs(et.y)&&(et.y-=j[0].y-nt.y)),tt.x=Je.x,tt.y=Je.y,0===et.x&&0===et.y)return;if("v"===ie&&y.closeOnVerticalDrag&&"fit"===y.scaleMode&&v===h.currItem.initialZoomLevel){ue.y+=et.y,de.y+=et.y;var l=bt();return B=!0,Te("onVerticalDrag",l),Se(l),void Ee()}(function(e,t,n){if(50<e-H){var i=2<at.length?at.shift():{};i.x=t,i.y=n,at.push(i),H=e}})(Me(),Je.x,Je.y),q=!0,ee=h.currItem.bounds,Mt("x",et)||(Mt("y",et),Fe(de),Ee())}}var s,u},Ot=function(e){if(_.isOldAndroid){if(G&&"mouseup"===e.type)return;-1<e.type.indexOf("touch")&&(clearTimeout(G),G=setTimeout(function(){G=0},600))}var t;if(Te("pointerUp"),vt(e,!1)&&e.preventDefault(),O){var n=f.arraySearch(it,e.pointerId,"id");-1<n&&(t=it.splice(n,1)[0],navigator.pointerEnabled?t.type=e.pointerType||"mouse":(t.type={4:"mouse",2:"touch",3:"pen"}[e.pointerType],t.type||(t.type=e.pointerType||"mouse")))}var i,o=Tt(e),a=o.length;if("mouseup"===e.type&&(a=0),2===a)return!(j=null);1===a&&Pe(nt,o[0]),0!==a||ie||ne||(t||("mouseup"===e.type?t={x:e.pageX,y:e.pageY,type:"mouse"}:e.changedTouches&&e.changedTouches[0]&&(t={x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY,type:"touch"})),Te("touchRelease",e,t));var r=-1;if(0===a&&(X=!1,f.unbind(window,u,h),ft(),J?r=0:-1!==ut&&(r=Me()-ut)),ut=1===a?Me():-1,i=-1!==r&&r<150?"zoom":"swipe",J&&a<2&&(J=!1,1===a&&(i="zoomPointerUp"),Te("zoomGestureEnded")),j=null,q||K||ne||B)if(qe(),Y||(Y=kt()),Y.calculateSwipeSpeed("x"),B)if(bt()<y.verticalDragRange)h.close();else{var l=de.y,s=re;$e("verticalDrag",0,1,300,f.easing.cubic.out,function(e){de.y=(h.currItem.initialPosition.y-l)*e+l,Se((1-s)*e+s),Ee()}),Te("onVerticalDrag",1)}else{if(($||ne)&&0===a){if(Zt(i,Y))return;i="zoomPointerUp"}if(!ne)return"swipe"!==i?void Ft():void(!$&&v>h.currItem.fitRatio&&Rt(Y))}},kt=function(){var t,n,i={lastFlickOffset:{},lastFlickDist:{},lastFlickSpeed:{},slowDownRatio:{},slowDownRatioReverse:{},speedDecelerationRatio:{},speedDecelerationRatioAbs:{},distanceOffset:{},backAnimDestination:{},backAnimStarted:{},calculateSwipeSpeed:function(e){n=1<at.length?(t=Me()-H+50,at[at.length-2][e]):(t=Me()-U,nt[e]),i.lastFlickOffset[e]=tt[e]-n,i.lastFlickDist[e]=Math.abs(i.lastFlickOffset[e]),20<i.lastFlickDist[e]?i.lastFlickSpeed[e]=i.lastFlickOffset[e]/t:i.lastFlickSpeed[e]=0,Math.abs(i.lastFlickSpeed[e])<.1&&(i.lastFlickSpeed[e]=0),i.slowDownRatio[e]=.95,i.slowDownRatioReverse[e]=1-i.slowDownRatio[e],i.speedDecelerationRatio[e]=1},calculateOverBoundsAnimOffset:function(t,e){i.backAnimStarted[t]||(de[t]>ee.min[t]?i.backAnimDestination[t]=ee.min[t]:de[t]<ee.max[t]&&(i.backAnimDestination[t]=ee.max[t]),void 0!==i.backAnimDestination[t]&&(i.slowDownRatio[t]=.7,i.slowDownRatioReverse[t]=1-i.slowDownRatio[t],i.speedDecelerationRatioAbs[t]<.05&&(i.lastFlickSpeed[t]=0,i.backAnimStarted[t]=!0,$e("bounceZoomPan"+t,de[t],i.backAnimDestination[t],e||300,f.easing.sine.out,function(e){de[t]=e,Ee()}))))},calculateAnimOffset:function(e){i.backAnimStarted[e]||(i.speedDecelerationRatio[e]=i.speedDecelerationRatio[e]*(i.slowDownRatio[e]+i.slowDownRatioReverse[e]-i.slowDownRatioReverse[e]*i.timeDiff/10),i.speedDecelerationRatioAbs[e]=Math.abs(i.lastFlickSpeed[e]*i.speedDecelerationRatio[e]),i.distanceOffset[e]=i.lastFlickSpeed[e]*i.speedDecelerationRatio[e]*i.timeDiff,de[e]+=i.distanceOffset[e])},panAnimLoop:function(){if(Ge.zoomPan&&(Ge.zoomPan.raf=R(i.panAnimLoop),i.now=Me(),i.timeDiff=i.now-i.lastNow,i.lastNow=i.now,i.calculateAnimOffset("x"),i.calculateAnimOffset("y"),Ee(),i.calculateOverBoundsAnimOffset("x"),i.calculateOverBoundsAnimOffset("y"),i.speedDecelerationRatioAbs.x<.05&&i.speedDecelerationRatioAbs.y<.05))return de.x=Math.round(de.x),de.y=Math.round(de.y),Ee(),void Ve("zoomPan")}};return i},Rt=function(e){return e.calculateSwipeSpeed("y"),ee=h.currItem.bounds,e.backAnimDestination={},e.backAnimStarted={},Math.abs(e.lastFlickSpeed.x)<=.05&&Math.abs(e.lastFlickSpeed.y)<=.05?(e.speedDecelerationRatioAbs.x=e.speedDecelerationRatioAbs.y=0,e.calculateOverBoundsAnimOffset("x"),e.calculateOverBoundsAnimOffset("y"),!0):(Ke("zoomPan"),e.lastNow=Me(),void e.panAnimLoop())},Zt=function(e,t){var n,i,o;if(ne||(lt=x),"swipe"===e){var a=tt.x-nt.x,r=t.lastFlickDist.x<10;30<a&&(r||20<t.lastFlickOffset.x)?i=-1:a<-30&&(r||t.lastFlickOffset.x<-20)&&(i=1)}i&&((x+=i)<0?(x=y.loop?Ht()-1:0,o=!0):x>=Ht()&&(x=y.loop?0:Ht()-1,o=!0),o&&!y.loop||(ye+=i,me-=i,n=!0));var l,s=he.x*me,u=Math.abs(s-ct.x);return l=n||s>ct.x==0<t.lastFlickSpeed.x?(l=0<Math.abs(t.lastFlickSpeed.x)?u/Math.abs(t.lastFlickSpeed.x):333,l=Math.min(l,400),Math.max(l,250)):333,lt===x&&(n=!1),ne=!0,Te("mainScrollAnimStart"),$e("mainScroll",ct.x,s,l,f.easing.cubic.out,Re,function(){qe(),ne=!1,lt=-1,(n||lt!==x)&&h.updateCurrItem(),Te("mainScrollAnimComplete")}),n&&h.updateCurrItem(!0),n},Pt=function(e){return 1/Q*e*p},Ft=function(){var e=v,t=Ne(),n=Ue();v<t?e=t:n<v&&(e=n);var i,o=re;return ae&&!W&&!le&&v<t?h.close():(ae&&(i=function(e){Se((1-o)*e+o)}),h.zoomTo(e,0,200,f.easing.cubic.out,i)),!0};be("Gestures",{publicMethods:{initGestures:function(){var e=function(e,t,n,i,o){T=e+t,M=e+n,S=e+i,A=o?e+o:""};(O=_.pointerEvent)&&_.touch&&(_.touch=!1),O?navigator.pointerEnabled?e("pointer","down","move","up","cancel"):e("MSPointer","Down","Move","Up","Cancel"):_.touch?(e("touch","start","move","end","cancel"),k=!0):e("mouse","down","move","up"),u=M+" "+S+" "+A,c=T,O&&!k&&(k=1<navigator.maxTouchPoints||1<navigator.msMaxTouchPoints),h.likelyTouchDevice=k,d[T]=St,d[M]=At,d[S]=Ot,A&&(d[A]=d[S]),_.touch&&(c+=" mousedown",u+=" mousemove mouseup",d.mousedown=d[T],d.mousemove=d[M],d.mouseup=d[S]),k||(y.allowPanToNext=!1)}}});var Lt,zt,_t,Nt,Ut,Ht,Yt=function(r,e,l,t){var s;Lt&&clearTimeout(Lt),_t=Nt=!0,r.initialLayout?(s=r.initialLayout,r.initialLayout=null):s=y.getThumbBoundsFn&&y.getThumbBoundsFn(x);var u,c,d=l?y.hideAnimationDuration:y.showAnimationDuration,p=function(){Ve("initialZoom"),l?(h.template.removeAttribute("style"),h.bg.removeAttribute("style")):(Se(1),e&&(e.style.display="block"),f.addClass(m,"pswp--animated-in"),Te("initialZoom"+(l?"OutEnd":"InEnd"))),t&&t(),Nt=!1};if(!d||!s||void 0===s.x)return Te("initialZoom"+(l?"Out":"In")),v=r.initialZoomLevel,Pe(de,r.initialPosition),Ee(),m.style.opacity=l?0:1,Se(1),void(d?setTimeout(function(){p()},d):p());u=a,c=!h.currItem.src||h.currItem.loadError||y.showHideOpacity,r.miniImg&&(r.miniImg.style.webkitBackfaceVisibility="hidden"),l||(v=s.w/r.w,de.x=s.x,de.y=s.y-F,h[c?"template":"bg"].style.opacity=.001,Ee()),Ke("initialZoom"),l&&!u&&f.removeClass(m,"pswp--animated-in"),c&&(l?f[(u?"remove":"add")+"Class"](m,"pswp--animate_opacity"):setTimeout(function(){f.addClass(m,"pswp--animate_opacity")},30)),Lt=setTimeout(function(){if(Te("initialZoom"+(l?"Out":"In")),l){var t=s.w/r.w,n=de.x,i=de.y,o=v,a=re,e=function(e){de.y=1===e?(v=t,de.x=s.x,s.y-z):(v=(t-o)*e+o,de.x=(s.x-n)*e+n,(s.y-z-i)*e+i),Ee(),c?m.style.opacity=1-e:Se(a-e*a)};u?$e("initialZoom",0,1,d,f.easing.cubic.out,e,p):(e(1),Lt=setTimeout(p,d+20))}else v=r.initialZoomLevel,Pe(de,r.initialPosition),Ee(),Se(1),c?m.style.opacity=1:Se(1),Lt=setTimeout(p,d+20)},l?25:90)},Wt={},Bt=[],Gt={index:0,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">The image</a> could not be loaded.</div>',forceProgressiveLoading:!1,preload:[1,1],getNumItemsFn:function(){return zt.length}},Xt=function(e,t,n){if(!e.src||e.loadError)return e.w=e.h=0,e.initialZoomLevel=e.fitRatio=1,e.bounds={center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}},e.initialPosition=e.bounds.center,e.bounds;var i,o,a,r,l=!n;if(l&&(e.vGap||(e.vGap={top:0,bottom:0}),Te("parseVerticalMargin",e)),Wt.x=t.x,Wt.y=t.y-e.vGap.top-e.vGap.bottom,l){var s=Wt.x/e.w,u=Wt.y/e.h;e.fitRatio=s<u?s:u;var c=y.scaleMode;"orig"===c?n=1:"fit"===c&&(n=e.fitRatio),1<n&&(n=1),e.initialZoomLevel=n,e.bounds||(e.bounds={center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}})}return n?(o=(i=e).w*n,a=e.h*n,(r=i.bounds).center.x=Math.round((Wt.x-o)/2),r.center.y=Math.round((Wt.y-a)/2)+i.vGap.top,r.max.x=o>Wt.x?Math.round(Wt.x-o):r.center.x,r.max.y=a>Wt.y?Math.round(Wt.y-a)+i.vGap.top:r.center.y,r.min.x=o>Wt.x?0:r.center.x,r.min.y=a>Wt.y?i.vGap.top:r.center.y,l&&n===e.initialZoomLevel&&(e.initialPosition=e.bounds.center),e.bounds):void 0},Vt=function(e,t,n,i,o,a){t.loadError||i&&(t.imageAppended=!0,$t(t,i,t===h.currItem&&we),n.appendChild(i),a&&setTimeout(function(){t&&t.loaded&&t.placeholder&&(t.placeholder.style.display="none",t.placeholder=null)},500))},Kt=function(e){e.loading=!0,e.loaded=!1;var t=e.img=f.createEl("pswp__img","img"),n=function(){e.loading=!1,e.loaded=!0,e.loadComplete?e.loadComplete(e):e.img=null,t.onload=t.onerror=null,t=null};return t.onload=n,t.onerror=function(){e.loadError=!0,n()},t.src=e.src,t},qt=function(e,t){if(e.src&&e.loadError&&e.container)return t&&(e.container.innerHTML=""),e.container.innerHTML=y.errorMsg.replace("%url%",e.src),!0},$t=function(e,t,n){if(e.src){t||(t=e.container.lastChild);var i=n?e.w:Math.round(e.w*e.fitRatio),o=n?e.h:Math.round(e.h*e.fitRatio);e.placeholder&&!e.loaded&&(e.placeholder.style.width=i+"px",e.placeholder.style.height=o+"px"),t.style.width=i+"px",t.style.height=o+"px"}},jt=function(){if(Bt.length){for(var e,t=0;t<Bt.length;t++)(e=Bt[t]).holder.index===e.index&&Vt(e.index,e.item,e.baseDiv,e.img,0,e.clearPlaceholder);Bt=[]}};be("Controller",{publicMethods:{lazyLoadItem:function(e){e=Ie(e);var t=Ut(e);t&&(!t.loaded&&!t.loading||I)&&(Te("gettingData",e,t),t.src&&Kt(t))},initController:function(){f.extend(y,Gt,!0),h.items=zt=e,Ut=h.getItemAt,Ht=y.getNumItemsFn,y.loop,Ht()<3&&(y.loop=!1),De("beforeChange",function(e){var t,n=y.preload,i=null===e||0<=e,o=Math.min(n[0],Ht()),a=Math.min(n[1],Ht());for(t=1;t<=(i?a:o);t++)h.lazyLoadItem(x+t);for(t=1;t<=(i?o:a);t++)h.lazyLoadItem(x-t)}),De("initialLayout",function(){h.currItem.initialLayout=y.getThumbBoundsFn&&y.getThumbBoundsFn(x)}),De("mainScrollAnimComplete",jt),De("initialZoomInEnd",jt),De("destroy",function(){for(var e,t=0;t<zt.length;t++)(e=zt[t]).container&&(e.container=null),e.placeholder&&(e.placeholder=null),e.img&&(e.img=null),e.preloader&&(e.preloader=null),e.loadError&&(e.loaded=e.loadError=!1);Bt=null})},getItemAt:function(e){return 0<=e&&void 0!==zt[e]&&zt[e]},allowProgressiveImg:function(){return y.forceProgressiveLoading||!k||y.mouseUsed||1200<screen.width},setContent:function(t,n){y.loop&&(n=Ie(n));var e=h.getItemAt(t.index);e&&(e.container=null);var i,o=h.getItemAt(n);if(o){Te("gettingData",n,o),t.index=n;var a=(t.item=o).container=f.createEl("pswp__zoom-wrap");if(!o.src&&o.html&&(o.html.tagName?a.appendChild(o.html):a.innerHTML=o.html),qt(o),Xt(o,pe),!o.src||o.loadError||o.loaded)o.src&&!o.loadError&&((i=f.createEl("pswp__img","img")).style.opacity=1,i.src=o.src,$t(o,i),Vt(0,o,a,i));else{if(o.loadComplete=function(e){if(s){if(t&&t.index===n){if(qt(e,!0))return e.loadComplete=e.img=null,Xt(e,pe),Oe(e),void(t.index===x&&h.updateCurrZoomItem());e.imageAppended?!Nt&&e.placeholder&&(e.placeholder.style.display="none",e.placeholder=null):_.transform&&(ne||Nt)?Bt.push({item:e,baseDiv:a,img:e.img,index:n,holder:t,clearPlaceholder:!0}):Vt(0,e,a,e.img,0,!0)}e.loadComplete=null,e.img=null,Te("imageLoadComplete",n,e)}},f.features.transform){var r="pswp__img pswp__img--placeholder";r+=o.msrc?"":" pswp__img--placeholder--blank";var l=f.createEl(r,o.msrc?"img":"");o.msrc&&(l.src=o.msrc),$t(o,l),a.appendChild(l),o.placeholder=l}o.loading||Kt(o),h.allowProgressiveImg()&&(!_t&&_.transform?Bt.push({item:o,baseDiv:a,img:o.img,index:n,holder:t}):Vt(0,o,a,o.img,0,!0))}_t||n!==x?Oe(o):(te=a.style,Yt(o,i||o.img)),t.el.innerHTML="",t.el.appendChild(a)}else t.el.innerHTML=""},cleanSlide:function(e){e.img&&(e.img.onload=e.img.onerror=null),e.loaded=e.loading=e.img=e.imageAppended=!1}}});var Jt,Qt,en={},tn=function(e,t,n){var i=document.createEvent("CustomEvent"),o={origEvent:e,target:e.target,releasePoint:t,pointerType:n||"touch"};i.initCustomEvent("pswpTap",!0,!0,o),e.target.dispatchEvent(i)};be("Tap",{publicMethods:{initTap:function(){De("firstTouchStart",h.onTapStart),De("touchRelease",h.onTapRelease),De("destroy",function(){en={},Jt=null})},onTapStart:function(e){1<e.length&&(clearTimeout(Jt),Jt=null)},onTapRelease:function(e,t){if(t&&!q&&!V&&!Xe){var n=t;if(Jt&&(clearTimeout(Jt),Jt=null,i=n,o=en,Math.abs(i.x-o.x)<25&&Math.abs(i.y-o.y)<25))return void Te("doubleTap",n);if("mouse"===t.type)return void tn(e,t,"mouse");if("BUTTON"===e.target.tagName.toUpperCase()||f.hasClass(e.target,"pswp__single-tap"))return void tn(e,t);Pe(en,n),Jt=setTimeout(function(){tn(e,t),Jt=null},300)}var i,o}}}),be("DesktopZoom",{publicMethods:{initDesktopZoom:function(){L||(k?De("mouseUsed",function(){h.setupDesktopZoom()}):h.setupDesktopZoom(!0))},setupDesktopZoom:function(e){Qt={};var t="wheel mousewheel DOMMouseScroll";De("bindEvents",function(){f.bind(m,t,h.handleMouseWheel)}),De("unbindEvents",function(){Qt&&f.unbind(m,t,h.handleMouseWheel)}),h.mouseZoomedIn=!1;var n,i=function(){h.mouseZoomedIn&&(f.removeClass(m,"pswp--zoomed-in"),h.mouseZoomedIn=!1),v<1?f.addClass(m,"pswp--zoom-allowed"):f.removeClass(m,"pswp--zoom-allowed"),o()},o=function(){n&&(f.removeClass(m,"pswp--dragging"),n=!1)};De("resize",i),De("afterChange",i),De("pointerDown",function(){h.mouseZoomedIn&&(n=!0,f.addClass(m,"pswp--dragging"))}),De("pointerUp",o),e||i()},handleMouseWheel:function(e){if(v<=h.currItem.fitRatio)return y.modal&&(!y.closeOnScroll||Xe||X?e.preventDefault():E&&2<Math.abs(e.deltaY)&&(a=!0,h.close())),!0;if(e.stopPropagation(),Qt.x=0,"deltaX"in e)1===e.deltaMode?(Qt.x=18*e.deltaX,Qt.y=18*e.deltaY):(Qt.x=e.deltaX,Qt.y=e.deltaY);else if("wheelDelta"in e)e.wheelDeltaX&&(Qt.x=-.16*e.wheelDeltaX),e.wheelDeltaY?Qt.y=-.16*e.wheelDeltaY:Qt.y=-.16*e.wheelDelta;else{if(!("detail"in e))return;Qt.y=e.detail}_e(v,!0);var t=de.x-Qt.x,n=de.y-Qt.y;(y.modal||t<=ee.min.x&&t>=ee.max.x&&n<=ee.min.y&&n>=ee.max.y)&&e.preventDefault(),h.panTo(t,n)},toggleDesktopZoom:function(e){e=e||{x:pe.x/2+fe.x,y:pe.y/2+fe.y};var t=y.getDoubleTapZoom(!0,h.currItem),n=v===t;h.mouseZoomedIn=!n,h.zoomTo(n?h.currItem.initialZoomLevel:t,e,333),f[(n?"remove":"add")+"Class"](m,"pswp--zoomed-in")}}});var nn,on,an,rn,ln,sn,un,cn,dn,pn,mn,fn,hn={history:!0,galleryUID:1},yn=function(){return mn.hash.substring(1)},xn=function(){nn&&clearTimeout(nn),an&&clearTimeout(an)},vn=function(){var e=yn(),t={};if(e.length<5)return t;var n,i=e.split("&");for(n=0;n<i.length;n++)if(i[n]){var o=i[n].split("=");o.length<2||(t[o[0]]=o[1])}if(y.galleryPIDs){var a=t.pid;for(n=t.pid=0;n<zt.length;n++)if(zt[n].pid===a){t.pid=n;break}}else t.pid=parseInt(t.pid,10)-1;return t.pid<0&&(t.pid=0),t},gn=function(){if(an&&clearTimeout(an),Xe||X)an=setTimeout(gn,500);else{rn?clearTimeout(on):rn=!0;var e=x+1,t=Ut(x);t.hasOwnProperty("pid")&&(e=t.pid);var n=un+"&gid="+y.galleryUID+"&pid="+e;cn||-1===mn.hash.indexOf(n)&&(pn=!0);var i=mn.href.split("#")[0]+"#"+n;fn?"#"+n!==window.location.hash&&history[cn?"replaceState":"pushState"]("",document.title,i):cn?mn.replace(i):mn.hash=n,cn=!0,on=setTimeout(function(){rn=!1},60)}};be("History",{publicMethods:{initHistory:function(){if(f.extend(y,hn,!0),y.history){mn=window.location,cn=dn=pn=!1,un=yn(),fn="pushState"in history,-1<un.indexOf("gid=")&&(un=(un=un.split("&gid=")[0]).split("?gid=")[0]),De("afterChange",h.updateURL),De("unbindEvents",function(){f.unbind(window,"hashchange",h.onHashChange)});var e=function(){sn=!0,dn||(pn?history.back():un?mn.hash=un:fn?history.pushState("",document.title,mn.pathname+mn.search):mn.hash=""),xn()};De("unbindEvents",function(){a&&e()}),De("destroy",function(){sn||e()}),De("firstUpdate",function(){x=vn().pid});var t=un.indexOf("pid=");-1<t&&"&"===(un=un.substring(0,t)).slice(-1)&&(un=un.slice(0,-1)),setTimeout(function(){s&&f.bind(window,"hashchange",h.onHashChange)},40)}},onHashChange:function(){return yn()===un?(dn=!0,void h.close()):void(rn||(ln=!0,h.goTo(vn().pid),ln=!1))},updateURL:function(){xn(),ln||(cn?nn=setTimeout(gn,800):gn())}}}),f.extend(h,je)}});
!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.PhotoSwipeUI_Default=t()}(this,function(){"use strict";return function(l,s){var n,a,r,i,t,o,u,c,p,e,d,m,f,h,w,g,v,b,_=this,C=!1,T=!0,I=!0,E={barsSize:{top:44,bottom:"auto"},closeElClasses:["item","caption","zoom-wrap","ui","top-bar"],timeToIdle:4e3,timeToIdleOutside:1e3,loadingIndicatorDelay:1e3,addCaptionHTMLFn:function(e,t){return e.title?(t.children[0].innerHTML=e.title,!0):(t.children[0].innerHTML="",!1)},closeEl:!0,captionEl:!0,fullscreenEl:!0,zoomEl:!0,shareEl:!0,counterEl:!0,arrowEl:!0,preloaderEl:!0,tapToClose:!1,tapToToggleControls:!0,clickToCloseNonZoomable:!0,shareButtons:[{id:"facebook",label:"Share on Facebook",url:"https://www.facebook.com/sharer/sharer.php?u={{url}}"},{id:"twitter",label:"Tweet",url:"https://twitter.com/intent/tweet?text={{text}}&url={{url}}"},{id:"pinterest",label:"Pin it",url:"http://www.pinterest.com/pin/create/button/?url={{url}}&media={{image_url}}&description={{text}}"},{id:"download",label:"Download image",url:"{{raw_image_url}}",download:!0}],getImageURLForShare:function(){return l.currItem.src||""},getPageURLForShare:function(){return window.location.href},getTextForShare:function(){return l.currItem.title||""},indexIndicatorSep:" / ",fitControlsWidth:1200},F=function(e){if(g)return!0;e=e||window.event,w.timeToIdle&&w.mouseUsed&&!p&&z();for(var t,n,o=(e.target||e.srcElement).getAttribute("class")||"",l=0;l<P.length;l++)(t=P[l]).onTap&&-1<o.indexOf("pswp__"+t.name)&&(t.onTap(),n=!0);if(n){e.stopPropagation&&e.stopPropagation(),g=!0;var r=s.features.isOldAndroid?600:30;setTimeout(function(){g=!1},r)}},x=function(e,t,n){s[(n?"add":"remove")+"Class"](e,"pswp__"+t)},S=function(){var e=1===w.getNumItemsFn();e!==h&&(x(a,"ui--one-slide",e),h=e)},k=function(){x(u,"share-modal--hidden",I)},K=function(){return(I=!I)?(s.removeClass(u,"pswp__share-modal--fade-in"),setTimeout(function(){I&&k()},300)):(k(),setTimeout(function(){I||s.addClass(u,"pswp__share-modal--fade-in")},30)),I||O(),!1},L=function(e){var t=(e=e||window.event).target||e.srcElement;return l.shout("shareLinkClick",e,t),!(!t.href||!t.hasAttribute("download")&&(window.open(t.href,"pswp_share","scrollbars=yes,resizable=yes,toolbar=no,location=yes,width=550,height=420,top=100,left="+(window.screen?Math.round(screen.width/2-275):100)),I||K(),1))},O=function(){for(var e,t,n,o,l="",r=0;r<w.shareButtons.length;r++)e=w.shareButtons[r],t=w.getImageURLForShare(e),n=w.getPageURLForShare(e),o=w.getTextForShare(e),l+='<a href="'+e.url.replace("{{url}}",encodeURIComponent(n)).replace("{{image_url}}",encodeURIComponent(t)).replace("{{raw_image_url}}",t).replace("{{text}}",encodeURIComponent(o))+'" target="_blank" class="pswp__share--'+e.id+'"'+(e.download?"download":"")+">"+e.label+"</a>",w.parseShareButtonOut&&(l=w.parseShareButtonOut(e,l));u.children[0].innerHTML=l,u.children[0].onclick=L},R=function(e){for(var t=0;t<w.closeElClasses.length;t++)if(s.hasClass(e,"pswp__"+w.closeElClasses[t]))return!0},y=0,z=function(){clearTimeout(b),y=0,p&&_.setIdle(!1)},M=function(e){var t=(e=e||window.event).relatedTarget||e.toElement;t&&"HTML"!==t.nodeName||(clearTimeout(b),b=setTimeout(function(){_.setIdle(!0)},w.timeToIdleOutside))},D=function(e){m!==e&&(x(d,"preloader--active",!e),m=e)},A=function(e){var t=e.vGap;if(!l.likelyTouchDevice||w.mouseUsed||screen.width>w.fitControlsWidth){var n=w.barsSize;if(w.captionEl&&"auto"===n.bottom)if(i||((i=s.createEl("pswp__caption pswp__caption--fake")).appendChild(s.createEl("pswp__caption__center")),a.insertBefore(i,r),s.addClass(a,"pswp__ui--fit")),w.addCaptionHTMLFn(e,i,!0)){var o=i.clientHeight;t.bottom=parseInt(o,10)||44}else t.bottom=n.top;else t.bottom="auto"===n.bottom?0:n.bottom;t.top=n.top}else t.top=t.bottom=0},P=[{name:"caption",option:"captionEl",onInit:function(e){r=e}},{name:"share-modal",option:"shareEl",onInit:function(e){u=e},onTap:function(){K()}},{name:"button--share",option:"shareEl",onInit:function(e){o=e},onTap:function(){K()}},{name:"button--zoom",option:"zoomEl",onTap:l.toggleDesktopZoom},{name:"counter",option:"counterEl",onInit:function(e){t=e}},{name:"button--close",option:"closeEl",onTap:l.close},{name:"button--arrow--left",option:"arrowEl",onTap:l.prev},{name:"button--arrow--right",option:"arrowEl",onTap:l.next},{name:"button--fs",option:"fullscreenEl",onTap:function(){n.isFullscreen()?n.exit():n.enter()}},{name:"preloader",option:"preloaderEl",onInit:function(e){d=e}}];_.init=function(){var t;s.extend(l.options,E,!0),w=l.options,a=s.getChildByClass(l.scrollWrap,"pswp__ui"),(e=l.listen)("onVerticalDrag",function(e){T&&e<.95?_.hideControls():!T&&.95<=e&&_.showControls()}),e("onPinchClose",function(e){T&&e<.9?(_.hideControls(),t=!0):t&&!T&&.9<e&&_.showControls()}),e("zoomGestureEnded",function(){(t=!1)&&!T&&_.showControls()}),e("beforeChange",_.update),e("doubleTap",function(e){var t=l.currItem.initialZoomLevel;l.getZoomLevel()!==t?l.zoomTo(t,e,333):l.zoomTo(w.getDoubleTapZoom(!1,l.currItem),e,333)}),e("preventDragEvent",function(e,t,n){var o=e.target||e.srcElement;o&&o.getAttribute("class")&&-1<e.type.indexOf("mouse")&&(0<o.getAttribute("class").indexOf("__caption")||/(SMALL|STRONG|EM)/i.test(o.tagName))&&(n.prevent=!1)}),e("bindEvents",function(){s.bind(a,"pswpTap click",F),s.bind(l.scrollWrap,"pswpTap",_.onGlobalTap),l.likelyTouchDevice||s.bind(l.scrollWrap,"mouseover",_.onMouseOver)}),e("unbindEvents",function(){I||K(),v&&clearInterval(v),s.unbind(document,"mouseout",M),s.unbind(document,"mousemove",z),s.unbind(a,"pswpTap click",F),s.unbind(l.scrollWrap,"pswpTap",_.onGlobalTap),s.unbind(l.scrollWrap,"mouseover",_.onMouseOver),n&&(s.unbind(document,n.eventK,_.updateFullscreen),n.isFullscreen()&&(w.hideAnimationDuration=0,n.exit()),n=null)}),e("destroy",function(){w.captionEl&&(i&&a.removeChild(i),s.removeClass(r,"pswp__caption--empty")),u&&(u.children[0].onclick=null),s.removeClass(a,"pswp__ui--over-close"),s.addClass(a,"pswp__ui--hidden"),_.setIdle(!1)}),w.showAnimationDuration||s.removeClass(a,"pswp__ui--hidden"),e("initialZoomIn",function(){w.showAnimationDuration&&s.removeClass(a,"pswp__ui--hidden")}),e("initialZoomOut",function(){s.addClass(a,"pswp__ui--hidden")}),e("parseVerticalMargin",A),function(){var l,r,i,e=function(e){if(e)for(var t=e.length,n=0;n<t;n++){l=e[n],r=l.className;for(var o=0;o<P.length;o++)i=P[o],-1<r.indexOf("pswp__"+i.name)&&(w[i.option]?(s.removeClass(l,"pswp__element--disabled"),i.onInit&&i.onInit(l)):s.addClass(l,"pswp__element--disabled"))}};e(a.children);var t=s.getChildByClass(a,"pswp__top-bar");t&&e(t.children)}(),w.shareEl&&o&&u&&(I=!0),S(),w.timeToIdle&&e("mouseUsed",function(){s.bind(document,"mousemove",z),s.bind(document,"mouseout",M),v=setInterval(function(){2==++y&&_.setIdle(!0)},w.timeToIdle/2)}),w.fullscreenEl&&!s.features.isOldAndroid&&(n||(n=_.getFullscreenAPI()),n?(s.bind(document,n.eventK,_.updateFullscreen),_.updateFullscreen(),s.addClass(l.template,"pswp--supports-fs")):s.removeClass(l.template,"pswp--supports-fs")),w.preloaderEl&&(D(!0),e("beforeChange",function(){clearTimeout(f),f=setTimeout(function(){l.currItem&&l.currItem.loading?(!l.allowProgressiveImg()||l.currItem.img&&!l.currItem.img.naturalWidth)&&D(!1):D(!0)},w.loadingIndicatorDelay)}),e("imageLoadComplete",function(e,t){l.currItem===t&&D(!0)}))},_.setIdle=function(e){x(a,"ui--idle",p=e)},_.update=function(){C=!(!T||!l.currItem||(_.updateIndexIndicator(),w.captionEl&&(w.addCaptionHTMLFn(l.currItem,r),x(r,"caption--empty",!l.currItem.title)),0)),I||K(),S()},_.updateFullscreen=function(e){e&&setTimeout(function(){l.setScrollOffset(0,s.getScrollY())},50),s[(n.isFullscreen()?"add":"remove")+"Class"](l.template,"pswp--fs")},_.updateIndexIndicator=function(){w.counterEl&&(t.innerHTML=l.getCurrentIndex()+1+w.indexIndicatorSep+w.getNumItemsFn())},_.onGlobalTap=function(e){var t=(e=e||window.event).target||e.srcElement;if(!g)if(e.detail&&"mouse"===e.detail.pointerType){if(R(t))return void l.close();s.hasClass(t,"pswp__img")&&(1===l.getZoomLevel()&&l.getZoomLevel()<=l.currItem.fitRatio?w.clickToCloseNonZoomable&&l.close():l.toggleDesktopZoom(e.detail.releasePoint))}else if(w.tapToToggleControls&&(T?_.hideControls():_.showControls()),w.tapToClose&&(s.hasClass(t,"pswp__img")||R(t)))return void l.close()},_.onMouseOver=function(e){var t=(e=e||window.event).target||e.srcElement;x(a,"ui--over-close",R(t))},_.hideControls=function(){s.addClass(a,"pswp__ui--hidden"),T=!1},_.showControls=function(){T=!0,C||_.update(),s.removeClass(a,"pswp__ui--hidden")},_.supportsFullscreen=function(){var e=document;return!!(e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen)},_.getFullscreenAPI=function(){var e,t=document.documentElement,n="fullscreenchange";return t.requestFullscreen?e={enterK:"requestFullscreen",exitK:"exitFullscreen",elementK:"fullscreenElement",eventK:n}:t.mozRequestFullScreen?e={enterK:"mozRequestFullScreen",exitK:"mozCancelFullScreen",elementK:"mozFullScreenElement",eventK:"moz"+n}:t.webkitRequestFullscreen?e={enterK:"webkitRequestFullscreen",exitK:"webkitExitFullscreen",elementK:"webkitFullscreenElement",eventK:"webkit"+n}:t.msRequestFullscreen&&(e={enterK:"msRequestFullscreen",exitK:"msExitFullscreen",elementK:"msFullscreenElement",eventK:"MSFullscreenChange"}),e&&(e.enter=function(){return c=w.closeOnScroll,w.closeOnScroll=!1,"webkitRequestFullscreen"!==this.enterK?l.template[this.enterK]():void l.template[this.enterK](Element.ALLOW_KEYBOARD_INPUT)},e.exit=function(){return w.closeOnScroll=c,document[this.exitK]()},e.isFullscreen=function(){return document[this.elementK]}),e}}});
!function(l,f,g){l.Comment={render:function(){"open"!=seg1&&(g(".Comment").each(function(){g(this).attr("ignore")||t.render(g(this))}),g(".comment_container_init").each(function(){g(this).removeClass("comment_container_init"),g(this).parent().addClass("Comment"),t.init(g(this).parent())}))},add_new_comment:function(t,e,n,i,a){return t.each(function(){var t=g(this).find("#new-comment form");y.add_new_comment(t,e,n,i,a,!0)})}};var t={render:function(e){var n=this,t=e.attr("mod"),i=e.attr("eid"),a=e.attr("eview"),o=e.attr("lid"),r=e.attr("liaction"),s=e.attr("data-attached-mod");e.load("?/comment/view",{mod:t,eid:i,eview:a,lid:o,liaction:r,attached_mod:s},function(){i&&g.post("?/comment/read_msg/"+i,function(t){if(1==t.ok&&t.count){g("#menu-msg .badge,#gomsg .badge");var e=g("#menu-msg .badge.layui-badge,#gomsg .badge").data("num")-t.count;b2.toggle_badge(e)}}),n.init(e);var t=l.localStorage.getItem(l.UpdatingsAction);if(t)switch(l.localStorage.removeItem(l.UpdatingsAction),t){case"comment":g("html, body").animate({scrollTop:g(".Comment").offset().top-46},700),setTimeout(function(){var t=g(".Comment").find("#new-comment .comment-form .comment-box textarea");y.textarea_ins_text(t,!1,"@"+l.localStorage.getItem(l.UpdatingsActionTo)),l.localStorage.removeItem(l.UpdatingsActionTo)},800);break;case"more":g("html, body").animate({scrollTop:g("#entity-comment-content #list li:first").offset().top-46},700)}n.renderTags(e)})},renderTags:function(s){var t=g(s).attr("data-attached-mod"),e=s.find("#new-comment .comment-box"),c=s.find("#entity-comment-content"),l=function(t){return t.find(".comment-tag[data-tag-value].checked")},d=function(t,e,n){n||(n=null);var i=g("<div class='comment-tags-container--all'></div>");t.prepend(i),i.append("<span class='tlabel'>鏍囩锛�</span>"),_.each(e,function(t,e){if(!t||!e)return!0;var n=g("<div class='comment-tag' data-tag-value='"+e+"'>"+t+"<span class='icon ion-close-circled'></span></div>");n.on("click",function(){g(this).toggleClass("checked")}),i.append(n)})},f=function(n,i){i||(i=null);var a=g("<div class='comment-tags-container--attached'></div>");e.prepend(a),a.append("<span class='attached-label'>鏍囩锛�</span>");var t=g("<div class='comment-tag' data-type='add'>+</div>");a.append(t);if(t.on("click",function(){layer.open({success:function(t){var e=(t=g(t)).find(".layui-layer-content");d(e,n,i),setTimeout(function(){isMobile.any()?t.css({top:"50px",left:"0"}):(e.css({padding:0,maxWidth:"800px"}),elem.layui.makeCenter(t)),e.css({padding:0})}),a.find(".comment-tag[data-tag-value]").each(function(){if(g(this).hasClass("date-tag"))return!0;var t=g(this).attr("data-tag-value");e.find("[data-tag-value="+t+"]").addClass("checked")})},yes:function(t,e){layer.close(t);var n,i=l(e);e.find(".date-picker[data-target-key]");n=i,a.find("*:not(span,[data-type=add],.comment-tags-container--all__date,.comment-tags-container--all__date *)").remove(),n.each(function(){var t=g(this).clone();t.on("click",function(){g(this).remove()}),a.find("[data-type=add]").after(t)})}})}),i){var o=g("<div class='comment-tags-container--all__date'></div>");a.append(o),_.each(i,function(t,e){if(!e||!t)return!0;var n=function(t){switch(t){case"datetimepicker":case"datetimepicker2":case"systemdatetime":case"create_systemdatetime":return"datetime";case"datepicker":case"systemdate":return"date";case"monthpicker":return"month";case"calendartime":default:return"date"}return"date"},i="date-tag"+_.random(1e3,9999);o.append("<div class='date-picker-wrapper'><span class='date-picker-label'>"+t.name+"锛�</span><input id='"+i+"' class='date-picker' data-picker-type='"+n(t.type)+"' data-target-key='"+e+"' data-target-label='"+t.name+"' type='text'/></div>"),laydate.render({elem:"#"+i,type:n(t.type)})})}},m=function(t){var a;c.find("li").each(function(){var t=g(this).find(".quota");if(!(g(this).attr("tags")&&"null"!==g(this).attr("tags")||g(this).attr("date-tags")&&"null"!==g(this).attr("date-tags")))return!0;var e=g("<div class='comment-tags-container--comment'></div>");t.prev().hasClass("comment-tags-container--comment")&&t.prev().remove(),t.before(e)}),a=t,c.find("li").each(function(){g(this);var t=g(this).attr("tags"),e=parse_json(t);if(!e.length||!e||!Array.isArray(e))return!0;var i=g(this).find(".comment-tags-container--comment");_.each(e,function(t){var e=t,n=a.find("[data-tag-value="+e+"]").text();if(!e||!n)return!0;i.append("<div class='comment-tag' data-tag-value='"+e+"'>"+n+"</div>")})}),c.find("li").each(function(){var t=g(this).attr("date-tags"),e=parse_json(t);if(!e.length||!e||!Array.isArray(e))return!0;var s=g(this).find(".comment-tags-container--comment");s.append("<div></div>"),_.each(e,function(t){var e=t.val,n=t.raw_val,i=t.key,a=t.label,o=t.type;if(!(e&&n&&i&&a))return!0;o||(o="date");var r=g("<div class='comment-tag checked date-tag' data-picker-type='"+o+"' data-tag-raw-value='"+n+"' data-tag-value='"+e+"' data-tag-key='"+i+"' data-tag-label='"+a+"'>"+a+"锛�"+e+"</div>");s.append(r)})})};g.post("?/comment/get_attach_mod_tags",{attach_mod:t},function(t){if(t.code&&t.data){var e=parse_json(t.data);if(e){var n=e.date;e.date=null;var i,a,o,r=e;d(c,r),f(r,n),o=[],(i=c).find("li").each(function(){var t=g(this).attr("tags"),e=parse_json(t);if(!e.length||!e||!Array.isArray(e))return!0;o.push(e)}),a=_.union(_.flatten(o)),i.find(".comment-tag").each(function(){var t=g(this).attr("data-tag-value");-1===_.indexOf(a,t)&&g(this).remove()}),m(c.find(".comment-tags-container--all")),function(t){var a=g("<div class='comment-time-filter-wrapper'></div>");t.find(".comment-tags-container--all").after(a);var i={},e=g(".comment-tags-container--attached .comment-tags-container--all__date");if(e){e.find(".date-picker").each(function(){var t=g(this).attr("data-target-key"),e=g(this).attr("data-picker-type"),n=g(this).prev().text();if(!t||!n)return!0;e||(e="date"),i[t]={key:t,type:e,label:n}});var s=function(t,e){var n="data-not-ranged",i=(t=g(t)).attr(n),a=[];if(!i||(a=parse_json(i),-1===_.indexOf(a,e))){a.push(e);var o=JSON.stringify(a);t.attr(n,o)}},l=function(t,e){var n="data-not-ranged",i=(t=g(t)).attr(n),a=[];if(i){var o=(a=parse_json(i)).indexOf(e);if(-1<o&&a.splice(o,1),0!=a.length){var r=JSON.stringify(a);t.attr(n,r)}else t.removeAttr(n)}else t.removeAttr(n)};_.each(i,function(t){var e="date-picker"+_.random(1e3,9999),n=g("<div class='comment-time-filter'><div class='comment-time-filter__label'>"+t.label+"</div><input type='text' class='comment-time-selector' id='"+e+"'/></div>");a.append(n);var i=t.type,r=t.key;laydate.render({elem:"#"+e,type:i,range:!0,done:function(t){var e=t.split(" - "),a=new Date(e[0]).getTime()/1e3,o=new Date(e[1]).getTime()/1e3;c.find("ul li").each(function(){var n=g(this),t=g(this).attr("date-tags"),e=parse_json(t);if(!e.length||!e||!Array.isArray(e))return a&&o?s(n,r):l(n,r),!0;var i=!1;_.each(e,function(t){if(t.key===r)return!(i=!0)}),i||s(n,r),_.each(e,function(t){if(t.key!==r)return!0;if(a&&o){var e=t.raw_val;return e&&a<=e&&e<=o?l(n,r):s(n,r),!1}l(n,r)})})}})})}}(c),c.on("click",".comment-tag",function(){var n,t=l(c.find(".comment-tags-container--all"));0!==(n=t.map(function(){return g(this).attr("data-tag-value")}).get()).length?c.find("ul li").each(function(){var t=g(this).attr("tags"),e=parse_json(t);e.length&&e&&Array.isArray(e)||g(this).addClass("not-taged").removeClass("taged"),n.length!==_.intersection(e,n).length?g(this).addClass("not-taged").removeClass("taged"):g(this).addClass("taged").removeClass("not-taged")}):c.find("ul li").removeClass("taged not-taged")}),s.on("event:new_comment",function(){m(c.find(".comment-tags-container--all"))})}}})},init:function(t){t.attr("ignore",!0),y.init(t)}},m={Range:function(t){if(t.hasFocus()||g(t).find("body").focus(),t.selection)return t.selection.createRange();var e=t.getSelection();if(null==e.focusNode){var n=t.createRange();n.collapse(!1),e.removeAllRanges(),e.addRange(n)}return e.getRangeAt(0)},getContainer:function(t){return t.endContainer||t.parentElement().childNodes[0]},insertInline:function(t,e,n,i){var a=this.document,o=f.createElement(t);for(var r in e)o.setAttribute(r,e[r]);if(o.removeAttribute("text"),a.selection){i=i||n.text||e.text;if("A"===t&&!i)return;i&&(o.innerHTML=i),n.pasteHTML(g(o).prop("outerHTML")),n.collapse(!1),n.select()}else if(/rv:11/i.test(navigator.userAgent)){if("A"===t&&!i)return;i&&g(a).find("body").append(g("<"+t+">"+i+"</"+t+">"))}else{i=i||n.toString()||e.text;var s=a.selection?a.selection:a.getSelection();if("A"===t&&!i)return;i&&(o.innerHTML=i),n.deleteContents(),n.insertNode(o),n.collapse(!1),s.removeAllRanges(),s.addRange(n)}},setRange:function(t,e){var n=t.selection?t.selection:t.getSelection(),i=t.createRange();i.setStart(e.startContainer,e.startOffset),i.setEnd(e.endContainer,e.endOffset),i.collapse(!1),n.removeAllRanges(),n.addRange(i)}},y={textarea_ins_text:function(t,e,n,i){if("TEXTAREA"==t[0].nodeName){var s=t;if(!t.next().find("iframe").length)return;var a=t.next().find("iframe").contents().find("body")}else s=g("#entity-comment-container[eid="+t.attr("eid")+"]").find("textarea[index="+t.attr("index")+"]"),a=t;var l=s.next().find("iframe"),o=l.prop("contentWindow"),r=o.document,c=m.Range(r),d=m.getContainer(c);if(n&&n.length){if(i&&i.length){var f=0<(f=c.startOffset-i.length)?f:0;c.setStart(c.startContainer,f)}m.insertInline.call(o,"span",{text:n},c,n)}s.parents(".comment-frame").find(".comment-control input").prop("disabled",!(a.text().replace(/\s*/gi,"").length||a.find("img").length)),s.val(a.html()),e&&function(){var t=0,e=0;if(c.getClientRects){var n=c.getClientRects();n.length&&(t+=n[0].left,e+=n[0].y)}e+=l.offset().top+20,y.notifybox.position={x:t,y:e};var i=d.textContent,a=c.startOffset,o=i.lastIndexOf("@");if("@"==i.charAt(a-1))b2.mobilecheck()?y.notifybox.show(s).layershow():(y.notifybox.open=!0,y.notifybox.show(s).search());else if(i.length>o&&o<=a&&0<=o){var r=i.substring(o+1,i.length);y.notifybox.show(s).search(r)}else y.notifybox.show(s).hide()}()},add_new_comment:function(i,t,e,n,a,o){if(o){var r=i.attr("action"),s=i.closest("#entity-comment-container").attr("eid");e&&"object"==typeof n&&n.length&&(t=n.join("銆�"));var l={eid:s,comment:t,action:"add"},c=LoadingLayer.create(1,0).show();g.post(r,l,function(t){if(c.close(),1==t.ok){i.find("textarea").val("").height(""),i.find(".comment-control input").attr("disabled",""),i.parents("#entity-comment-container").find("#entity-comment-content ul");var e=i.parents("#entity-comment-container").find("#entity-comment-content"),n=e.children("ul");n.length?n.prepend(t.li):e.prepend('<ul class="comment-list">'+t.li+"</div>"),i.closest("#entity-comment-container").children(".nothing").hide()}else layer.msg(t.msg)})}else{var d="";"object"==typeof n&&n.length&&(d=n.join("銆�")),y.textarea_ins_text(i.find(".comment-box textarea"),!1,d)}},layedit_init:function(a,o,r){if(a.length){var c=layui.layedit.build(a,{height:200,uploadImage:{url:"?/file/upload_img/"},afterInsert:function(){a.parents(".comment-frame").find(".comment-control input").prop("disabled",!1);var t=d.prop("contentWindow").document;m.Range(t).collapse(!1)}}),d=a.attr("index",c).next().find("iframe");d.load(function(){var t=a.closest("#entity-comment-container"),e=t.children(".notifylist").clone().attr("id","notifylist"+Math.round(1e3*Math.random()));isMobile.any()||e.find("select").removeAttr("lay-ignore"),a.parent().children(".notifylist").remove(),a.parent().prepend(e),layer.check_layer(t),r&&r(),d.contents().find("head").append("<style>img{max-width:150px;}file{color:#01AAED;text-decoration:none;}</style>");var n=d.contents().find("body");n.attr("index",c).attr("eid",t.attr("eid")),o&&y.textarea_ins_text(a,!1,o),n.on("click","img",function(){viewPhotos(g(this),n,d)});n.off("input keyup keydown").on("input keyup",debounce(function(t){(!e.find(".layui-select-group:visible").length||t.originalEvent.data||t.originalEvent.inputType)&&y.textarea_ins_text(g(this),!0)},200)).on("keydown",function(t){13!=t.keyCode&&(y.notifybox.blur=!1)}),isMobile.any()||y.drop_upload_init(a.parent().children(".upload_drop"),a.next(),n,d);var s=f.getElementById("LAY_layedit_"+c),l=s.contentDocument||s.contentWindow.document,i=g(l).find("body");ListenImageClip.init(i,function(t,e){var n=s.contentWindow,i=n.getSelection&&n.getSelection(),a=i.getRangeAt(0),o=l.createElement("img"),r="clipimage_"+s.getAttribute("id")+"_"+Math.floor(1e3*Math.random());o.setAttribute("id",r),o.setAttribute("src","/dist/css/modules/layer/default/loading-1.gif"),o.setAttribute("alt",e),o.classList.add("cliped-image"),a.insertNode(o),g.post("?/entity/convertImage",{base64:t},function(t){var e=t.img;i&&0<i.rangeCount&&l.getElementById(r).setAttribute("src","../?/file/img/"+e)})})})}},Uploader:function(t,o){var e=t.attr("eid"),n=t.attr("eview"),i=g.parseJSON(t.attr("ext")),a=0<=["_self","_parent","_system","_personal"].indexOf(i.target)?i.target:"_self",r=!!i.choose,s=i.up_folder?i.up_folder:"root",l=i.root_uid?i.root_uid:"root",c="",d=i.formats?i.formats:"";switch(a){case"_self":if(!(c=i.eid_link?i.eid_link:""))break;$eid_link=g("#"+c),e="",$eid_link.length&&("INPUT"==$eid_link[0].tagName?e=$eid_link.val().split(",")[0]:"SELECT"==$eid_link[0].tagName&&(e=$eid_link.find("option:selected").val())),e=e||g("td[kid="+c+"] .link_style").eq(0).attr("uuid"),n=g("#"+c).find("option:selected").closest("optgroup").data("mod")||g("#"+c).attr("lay-filter"),n=(e=e||"")?n:"doc";break;case"_parent":e=seg4,n=i._rel_view?i._rel_view:seg1;break;case"_system":n=i.doctype?i.doctyp:"doc",e="system";break;case"_personal":n="personal"}var f={eid:e,up_folder:s,path:!1,view:n,formats:d},m=[],u=function(o){g.post("?/doc/doc_tree/",{eid:f.eid,doc_type:f.view,uid:l},function(n){indexw=layer.open({type:1,maxWidth:320,shadeClose:!1,content:n.html,btn:["閫夊畾","鍙栨秷"],success:function(t,e){Doc.tree({elem:g(t).find(".doc-tree"),root_uid:l,hover:s||null,manage:n.manage,doc_tree_privilege:n.doc_tree_privilege})},yes:function(t,e){var n=g(e).find(".hover"),i=n.attr("uid"),a="";"root"!=n.attr("uid")&&(a=n.attr("name")+"/",n.parentsUntil("li[uid='root']","li").each(function(){a=g(this).attr("name")+"/"+a})),i?(f.up_folder=i,f.path=a,layer.close(t),o&&o()):layer.msg("璇烽€夋嫨瑕佷笂浼犵殑鏂囦欢澶�")}})})},h=function(){g('<input type="file" name="file" class="file" multiple="">').change(function(){p(this.files),v()}).trigger("click")},p=function(t){m=t},v=function(){var t=new FormData,n=new Array,i=new progressBar;if(m.length){for(var a in m)t.append("file[]",m[a]);for(var a in f)t.append(a,f[a]);g.ajax({type:"POST",url:"?/file/filebox",data:t,processData:!1,contentType:!1,xhr:i.xhr,beforeSend:function(){i.init(lang.uploading)},success:function(t){if(i.close(),t.ok){if(layer.msg(t.msg),console.log(t),!o)return;var e=t.files;for(a in e)n.push("<file href=\"javascript:void(0);viewfile('"+e[a].uuid+'\')" data-file-size="'+e[a].size+'"> <span class="icon '+y.match_file_icon(e[a].type)+'" style="padding-right:2px;"></span>'+e[a].name+"."+e[a].type+"</file>");y.add_new_comment(o,"","upload_file",n,f.path)}else layer.msg(t.msg)},error:function(){i.close(),layer.msg(lang.upload_failed)}})}};return{init:function(t){g.isArray(t)&&t.length?(p(t),r?u(v):v()):r?u(h):h()}}},match_file_icon:function(t){switch(icon="ion-android-list",t){case"txt":case"doc":case"docx":icon="ion-document-text";break;case"png":case"jpg":case"jpeg":case"gif":icon="ion-android-image";break;case"xls":case"xlsx":icon="ion-ios-grid-view"}return icon},drop_upload_init:function(e,t,n,a){var i=function(t){t.preventDefault()||t.stopPropagation()},o=function(t){i(t),e.addClass("over").nextAll(".layui-layedit").css("pointer-events","none"),a.parent().css("pointer-events","none"),c(),lis2()},r=function(t){i(t),e.removeClass("over").nextAll(".layui-layedit").removeAttr("style"),a.parent().css("pointer-events","inherit"),rmlis2(),l()},s=function(t){r(t),rmlis2(),l();var e=[];[].forEach.call(t.dataTransfer.files,function(t){e.push(t)},!1);var n=a.closest(".Comment"),i=a.closest(".comment-form");new y.Uploader(n,i).init(e)},l=function(){t[0].addEventListener("dragenter",o),t[0].addEventListener("dragover",o),n[0].addEventListener("dragenter",o),n[0].addEventListener("dragover",o)},c=function(){t[0].removeEventListener("dragenter",o),t[0].removeEventListener("dragover",o),n[0].removeEventListener("dragenter",o),n[0].removeEventListener("dragover",o)};lis2=function(){e[0].addEventListener("drop",s),e[0].addEventListener("dragover",i),e[0].addEventListener("dragleave",r)},rmlis2=function(){e[0].removeEventListener("drop",s),e[0].removeEventListener("dragover",i),e[0].removeEventListener("dragleave",r)},l()},notifybox:{open:!1,blur:!1,search_key:"",position:{x:0,y:0},notify_list:{group:[],value:[],text:[]},init:function(t){this.notify_list={group:[],value:[],text:[]},t.find("#notifylist select optgroup").each(function(){g(this).children().length||g(this).remove()}),t.find("#notifylist select optgroup[value=users] option").each(function(){(new Image).src="face/"+g(this).val()+".jpg"})},show:function(d){var f=layui.form;$this=this,$comment=d.closest(".Comment"),$notifylist=d.parent().children(".notifylist"),select=$notifylist.children("select"),select.val(""),i||isMobile.any()||(select.removeAttr("lay-ignore").hide().parent().show(),f.render());var n=$notifylist.find(".layui-form-select"),t=n.attr("select-index"),e=n.find("input"),a=g(".layui-form-selectoption[select-index="+t+"] .layui-anim-upbit").removeClass("layui-anim"),i=a.is(":visible"),o=d.next().find("iframe").contents(),r={visible:i,position:function(){$comment.children("h5");var t=$this.position.x,e=$this.position.y-n.offset().top;return t+a.width()>o.width()+10&&(t-=a.width())&&t<0&&(t=30),{left:t,top:e}},layershow:function(){if($this.visible)return $this;var l=d.next().find("iframe").prop("contentWindow").document,c=m.Range(l);o.find("body").blur();var t='<div class="layui-form notifylist_layershow">'+select.parent().html()+"</div>";layer.open({type:1,title:"閫夋嫨鎻愰啋鐨勪汉",area:["100%","100%"],anim:2,content:t,success:function(t,i){$this.visible=!$this.visible,g(t).find("select").removeAttr("lay-ignore").hide(),f.render();var e=g(t).find(".notifylist_layershow .layui-form-select").addClass("layui-form-selectoption").css("position","relative"),n=e.attr("select-index"),a=g(".layui-form-selectoption[select-index="+n+"] .layui-anim-upbit").removeClass("layui-anim"),o=g(t).children(".layui-layer-content");e.append(a),a.find("dd").eq(0).remove(),a.find("dd[group-value=users]").each(function(){var t=select.find("option[value="+g(this).attr("lay-value")+"]").attr("head");g(this).prepend('<img src="'+t+'" title="'+g(this).text()+'">')});var r=o.find("dd,dt").length+1,s=10+r+40*r;o.height(s-g(".mobile-menu").outerHeight()).css("background","#fff"),a.find("dd").on("click",function(){layer.close(i);var t=g(this).attr("group-value"),e=g(this).attr("lay-value"),n=g(this).text()+"&nbsp;";m.setRange(l,c),y.textarea_ins_text(d,!1,n),$this.notify_list.group.push(t),$this.notify_list.value.push(e),$this.notify_list.text.push(n)})},cancel:function(){m.setRange(l,c)},end:function(){$this.visible=!$this.visible}})},show:function(){return this.visible||($this.blur?$this.blur=!1:$this.open&&((this.visible=!this.visible)&&e.click(),a.css(this.position()),a.find("dd[group-value=users]").each(function(){var t=select.find("option[value="+g(this).attr("lay-value")+"]").attr("head");g(this).prepend('<img src="'+t+'" title="'+g(this).text()+'">')}),a.find("dd").eq(0).remove(),a.find("dd").eq(0).addClass("layui-this"),function(){function i(){var t=a.find("dd.layui-this"),e=a.offset().top-t.offset().top+5,n=t.offset().top+t.height()-a.offset().top-a.height()-5;0<e&&(a[0].scrollTop-=e)||0<n&&(a[0].scrollTop+=n)}a.children("dd").off("click").on("click",function(){$this.open=!1,$this.blur=!1;var t=g(this).attr("group-value"),e=g(this).attr("lay-value"),n=g(this).text(),i=$this.search_key,a=g(this).text()+"&nbsp;";y.textarea_ins_text(d,!1,a,i),$this.notify_list.group.push(t),$this.notify_list.value.push(e),$this.notify_list.text.push(n),setTimeout(function(){o.off("keydown keypress blur click","body")})}),o.off("keypress keydown blur click","body").on("keypress","body",function(t){return 13!==t.keyCode}).on("keydown","body",function(t){var e=t.keyCode,n=a.find("dd.layui-this");13===e?$this.open&&n.click():38===e?(t.preventDefault()||t.stopPropagation(),n.removeClass("layui-this"),n.prev("dd").length?n.prev().addClass("layui-this"):n.prev("dt").length&&n.prev("dt").prev("dd").length?n.prev().prev().addClass("layui-this"):a.find("dd:last-child").addClass("layui-this"),i()):40===e&&(t.preventDefault()||t.stopPropagation(),n.removeClass("layui-this"),n.next("dd").length?n.next().addClass("layui-this"):n.next("dt").length&&n.next("dt").next("dd").length?n.next().next().addClass("layui-this"):a.find("dd").eq(0).addClass("layui-this"),i())}).on("blur","body",function(){o.off("keypress keydown blur click","body"),a.is(":visible")&&($this.blur=!0)}).on("click","body",function(){r.hide()})}())),this},hide:function(){if(this.visible)return(this.visible=!this.visible)||e.click(),o.off("keydown keypress blur click","body"),this},search:function(t){return $this.search_key=void 0===t?"":t,e.prop("jsinput",$this.search_key),a.find("dd:visible").length||this.hide(),a.find("dt").show(),a.find("dd.layui-this").removeClass("layui-this"),a.find("dd:visible").eq(0).addClass("layui-this"),a.find("dd[group-value=users]:visible").length||a.find("dt[group-value=users]").hide(),a.find("dd[group-value=structure]:visible").length||a.find("dt[group-value=structure]").hide(),this}};return r.show(),r},notify:function(t,n){var i=t.find("#new-comment .comment-frame .notifybox"),a=this.notify_list.group,o=this.notify_list.value,r=!1;return this.notify_list.text.forEach(function(t,e){-1!=n.indexOf("@"+t)&&("all"==o[e]?(i.find("#clickall .notify-to:not('.active')").click(),r=!0):"structure"==a[e]?(i.find("#structure #"+o[e]+":not('.active')").click(),r=!0):"users"==a[e]&&(i.find("#userlist .notify-to:not('.active') input[value="+o[e]+"]").click(),r=!0))}),this.notify_list={group:[],value:[],text:[]},r}},init:function(v){y.layedit_init(v.find("#new-comment textarea"),"",function(){var t=v.find("#entity-comment-content .comment-list li[reply]");if(t.length){var e="true"==t.find(".js-control .js-reply-to").attr("state");y.replyBox.open(t,e)}var n=v.find("#entity-comment-content .comment-list li[active]");n.length&&n[0].scrollIntoView()}),y.notifybox.init(v),v.find(".filter-comment").on("click","div",function(){g(this).hasClass("show")||(g(this).addClass("show").siblings().removeClass("show"),"all"==g(this).attr("data")?v.find("#entity-comment-content .index_list").children().show():v.find("#entity-comment-content .index_list").children("li:not([belong="+g(this).attr("data")+"])").hide(),v.find("#entity-comment-content .index_list").children(":visible").length&&v.find(".nothing").hide()||v.find(".nothing").show())}),v.find("#new-comment").on("submit","form",function(t){t.preventDefault()||t.stopPropagation();var s=g(this);if(g(this).find("textarea").next().find("iframe").length){var l=g(this).find("textarea").next().find("iframe").contents().find("body"),c=l.html(),e=g(this).attr("action"),n=v.find("#entity-comment-container"),i=n.attr("eid"),a=n.attr("eview"),o=y.notifybox.notify(v,l.text()),r=g(this).find(".notifybox #userlist .notify-to.active input").map(function(){return g(this).val()}).get(),d=g(this).find(".notifybox #assign").val(),f=g(this).find(".comment-tag[data-tag-value].checked:not(.date-tag)").map(function(){return g(this).attr("data-tag-value")}).get(),m=g(this).find(".date-picker-label+.date-picker").map(function(){var t=g(this).val(),e=g(this).attr("data-target-key"),n=g(this).attr("data-target-label"),i=g(this).attr("data-picker-type");return{val:t,raw_val:new Date(t).getTime()/1e3,key:e,label:n,type:i}}).get(),u={eid:i,eview:a,comment:c,notify_at:o,assign:d,notify_to:r,action:"add",tags:f,date_tags:m},h=LoadingLayer.create(1,0).show();g.post(e,u,function(t){if(h.close(),1==t.ok){l.html(""),s.find(".comment-control input").attr("disabled",""),s.parents("#entity-comment-container").find("#entity-comment-content ul");var e=s.parents("#entity-comment-container").find("#entity-comment-content"),n=e.children("ul");n.length?n.prepend(t.li):e.prepend('<ul class="comment-list">'+t.li+"</div>"),v.find(".nothing").hide(),v.attr("tile_file")&&y.update_new_comment(n,c),v.trigger("event:new_comment");var i="",a=0,o=[],r=s.find(".comment-control .notify_to");s.find("#userlist .notify-to.active input").each(function(t){var e=g(this).val(),n=g(this).attr("title");if(o.push(e),5<=t)return a++;i+='<label class="notify-to active">'+n+"</label>"}).removeAttr("id");s.find("#assign").val();a&&(i+='<span class="count layui-badge-rim">+'+a+"</span>"),s.find(".comment-control .userlist").html(i),o.length?r.hide():r.show()}else layer.msg(t.msg)})}}),v.find("#new-comment,#entity-comment-content").on("click",".layedit-tool-file",function(t){t.preventDefault()||t.stopPropagation();var e=g(this).closest(".comment-form");new y.Uploader(v,e).init()}).on("click",".comment-control .notify_to,.comment-control .userlist",function(t){t.preventDefault()||t.stopPropagation();var n=g(this).closest(".comment-frame").find(".comment-control .userlist");if(!n.attr("open")){var r=g(this).closest(".comment-frame").find(".comment-control .notify_to"),s=g(this).closest(".comment-frame").children(".notifybox"),e=(g(this).closest("#entity-comment-container").attr("eid"),s.clone()),l="notifybox"+Math.round(1e3*Math.random());s.wrap('<div id="'+l+'" style="display:none"></div>').remove(),layer.open({type:1,title:lang.select_notified,content:e.html(),shade:!1,btn:["OK"],success:function(t,e){n.attr("open",!0),layer.check_layer(g(t),!0)},yes:function(t,e){layer.close(t),n.attr("open",!1);var i="",a=0,o=[];g("#"+l).html(e.children(".layui-layer-content").html()).addClass("notifybox"),(s=g("#"+l)).find("#userlist .notify-to.active input").each(function(t){var e=g(this).val(),n=g(this).attr("title");if(o.push(e),5<=t)return a++;i+='<label class="notify-to active">'+n+"</label>"}).removeAttr("id");s.find("#assign").val();a&&(i+='<span class="count layui-badge-rim">+'+a+"</span>"),n.html(i),o.length?r.hide():r.show()},cancel:function(){layer.close(index),n.attr("open",!1),g("#"+l).html(e.html()).addClass("notifybox").removeAttr("id")}})}}),v.find("#entity-comment-content").on("submit",".content-box form",function(t){t.preventDefault()||t.stopPropagation();var i=g(this).closest("li").children(".quota"),a=g(this).closest("li").children(".ment"),o=g(this).parents(".content-box"),r=o.prev(),e=g(this).closest("li").attr("data"),n=v.find("#entity-comment-container").attr("eview"),s=g(this).find("textarea");if(s.next().find("iframe").length){var l=s.next().find("iframe").contents().find("body"),c=l.html(),d=g(this).attr("action"),f=g(this).attr("data"),m=(g(this).closest("li").children(".heads").attr("data"),y.notifybox.notify(v,l.text())),u=v.find("#new-comment .notifybox #userlist .notify-to.active input").map(function(){return g(this).val()}).get(),h={parent_id:e,eview:n,comment:c,notify_at:m,assign:v.find("#new-comment .notifybox #assign").val(),notify_to:u,action:f},p=LoadingLayer.create(1,0).show();g.post(d,h,function(t){if(p.close(),1==t.ok){if(s.text("").val(""),l.html(""),"edit"==f)i.find(".container").html(t.elem.comment),i.show(),a.show(),o.hide();else if("reply"==f){var e=r.children("ul");e.length?e.append(t.li):r.prepend('<ul class="comment-list">'+t.li+"</div>"),o.hide();var n=r.find("ul>li").length;a.find(".js-reply-to").attr("count",n)}}else layer.msg(t.msg)})}}).on("click",".js-control .js-edit",function(t){t.preventDefault()||t.stopPropagation(),g(this).closest("li").find(".children-box,.quota,.ment").hide();var e=g(this).closest("li").attr("data");g(this).closest("li").find(".reply-box,.content-box").show().children(".content-box").load("?/comment/edit/",{uid:e},function(){var t=g(this).closest("li").find(".content-box textarea"),e=t.val();t.html(""),y.layedit_init(t,e)})}).on("click",".comment-control .cancel_edit_commit",function(t){t.preventDefault()||t.stopPropagation();g(this).closest("li").find(".content-box textarea");var e=g(this).closest(".content-box");if(e.is(":visible")&&(e.slideUp("fast"),g(this).closest("li").find(".quota,.ment").show(),e.prev().children("ul").children().length<=0)){var n=e.parent().prev().find(".js-control .js-reply-to");n.attr("action","open").text("鍥炲"+(null==n.attr("count")?"0":"("+n.attr("count")+")"))}}).on("click",".js-control .js-delete",function(t){t.preventDefault()||t.stopPropagation();var e=g(this).closest("li"),n=g(this).closest("li").attr("data");g.post("?/comment/del/",{id:n},function(t){1==t.ok?e.empty().append('<div style="padding-bottom:5px;margin-top:-5px;text-align: center;"> <p> '+lang.comment_you+lang.comment_recall+" </p> </div>"):layer.msg(t.msg),v.find("#entity-comment-content .comment_list").children(":visible").length&&v.find(".nothing").hide()||v.find(".nothing").show()})}).on("click",".js-control .js-reply-to",function(t){t.preventDefault()||t.stopPropagation();var e=g(this).parents("li"),n=g(this).attr("action"),i="true"==g(this).attr("state");switch(n){case"open":g(this).attr("action","close").text(lang.retract_reply);case"reply":y.replyBox.open(e,i);break;case"close":g(this).attr("action","open").text("鍥炲"+(null==g(this).attr("count")?"0":"("+g(this).attr("count")+")"));case"link":y.replyBox.action(e,n,i,"reply")}}).on("click",".index_list li .ename,.index_list li .quota .container",function(t){""!=g(this).closest("li[data]").attr("eid")&&"global"!=g(this).closest("li[data]").attr("eid")&&("A"==t.target.tagName&&0==t.target.href.indexOf("javascript:")||"IMG"==t.target.tagName||(t.preventDefault()||t.stopPropagation(),y.replyBox.link(g(this).closest("li[data]"),"active",g(this).hasClass("ename"))))}).on("click",'li .quota .container p img:not(".face"), li .quota .container div img:not(".face")',function(){viewPhotos(g(this),g(this).closest(".container"))}).on("click",".click_to_show_files",function(n){g(n.target).parent().parent().addClass("shown-file"),g(n.target).parent().parent().removeClass("hide-file"),g(n.target).parent().parent().children(".quota .container .file_in_comment").each(function(t,e){g(e).parent().css("paddingBottom",1),g(e).show(),g(n.target).parent().remove(),g(n.target).remove()})}),y.resetCount(),y.hide_file(),l.addEventListener("resize",function(){y.resetCount(),y.hide_file()})},update_new_comment:function(t,e){if(t.find(".file_in_comment").length){var a=t.find("li:first .quota .container");a.append("<hr/>"),g(e).children("a").each(function(t,e){var n=g(e).attr("data-file-size");n=1e6<n?Math.round(n/1048576)+"MB":Math.round(n/1024)+"KB";var i='<div class="file_in_comment">';i+=e.outerHTML,i+='<div class="file_size">',i+="鏂囦欢澶у皬锛�"+n,i+="</div>",i+="</div>",a.append(i)}),a.append('<div class="slf_ph"></div>'),y.resetCount(),y.hide_file(),y.rebind_click_to_show_files()}},rebind_click_to_show_files:function(){g(".click_to_show_files").off("click").on("click",function(n){g(n.target).parent().parent().addClass("shown-file"),g(n.target).parent().parent().removeClass("hide-file"),g(n.target).parent().parent().children(".quota .container .file_in_comment").each(function(t,e){g(e).parent().css("paddingBottom",1),g(e).show(),g(n.target).parent().remove(),g(n.target).remove()})})},hide_file:function(){g(".quota .container").each(function(t,e){fileCount=g(e).children(".file_in_comment").length,shownFileMaxCount=g(e).attr("count"),finalFileCount=Math.max(Math.min(fileCount,shownFileMaxCount),1),width=(1==finalFileCount?100:100/finalFileCount-1)+"%",g(e).children(".file_in_comment").each(function(t,e){return 100<g(e).children("a").width()&&g(e).children("a").css("width","90%"),g(e).css("width",width),!!g(e).parent().hasClass("shown-file")||(t>g(e).parent().attr("count")-1?(g(e).hide(),g(e).parent().hasClass("hide-file")||(g(e).parent().addClass("hide-file"),g(e).parent().children(".slf_ph").after('<div><a href="javascript:void(0);" class="click_to_show_files">鏄剧ず鍏ㄩ儴闄勪欢</a></div>')),!0):void g(e).show())}),0<fileCount&&!g(e).hasClass("hide-file")&&g(e).css("paddingBottom",1)})},resetCount:function(){var n=y.isAtLeft()?2:5;isMobile.any()&&(n=2),g(".quota .container").each(function(t,e){g(e).attr("count",n)})},isAtLeft:function(){return"0px"!=g(".Comment.noprint").css("padding-left")},replyBox:{action:function(t,e,n,i){switch(e){case"open":this.open(t,n);break;case"close":this.close(t);break;case"link":this.link(t,i)}},open:function(t,e){var n=1==t.length&&0<t.find(".ment .js-reply-to").attr("count"),i=t.first().find(".heads").attr("data"),a=t.first().find(".heads").attr("title"),o=(t=t.last()).children(".reply-box");if(e){(r=t.children(".reply-box").find("textarea")).next().find("iframe").contents().find("body");o.find(".content-box form").attr("action","?/comment/reply").attr("data","reply")}else var r=t.closest("#entity-comment-container").find("#new-comment .comment-form .comment-box textarea");var s="@"+a+"&nbsp;";function l(){e?(o.children(".content-box").show().parent().slideDown("fast",function(){g(this)[0].scrollIntoView()}),y.layedit_init(r,s)):(t.closest("#entity-comment-container").find("#new-comment")[0].scrollIntoView(),y.textarea_ins_text(r,!1,s))}y.notifybox.notify_list.group.push("users"),y.notifybox.notify_list.value.push(i),y.notifybox.notify_list.text.push(a),n&&e?o.children(".children-box").load("?/comment/view",{eid:t.attr("eid"),parent_id:t.attr("data")},function(){l()}):l()},close:function(t){t.children(".reply-box").slideUp("fast",function(){g(this).children(".content-box").hide()})},link:function(t,e,n){var i=t.children(".ename").attr("type"),a=t.attr("eid"),o=t.attr("data");n?v(i+"/view/about/"+a,"new"):v(i+"/view/about/"+a+"/commentlid_"+o+"/"+e,"new")}}}}(window,document,jQuery);
$(function(){var last_msg_time,last_comment_time,msg_time,comment_time=Math.round((new Date).getTime()/1e3),lasted_msgs=[],page_size=10,pc_notify="undefined";function polling(data,mod){"object"==typeof data&&data&&!eval(mod+"_time>=data.time")&&(eval(mod+"_time=data.time"),eval("var param={last_"+mod+"_time:last_"+mod+"_time,cids:[],eids:[],mods:[]};"),"comment"==mod&&$(".comment #entity-comment-container").each(function(){param.cids.push($(this).attr("cid")),param.eids.push($(this).attr("eid")),param.mods.push($(this).attr("mod"))}),$.post("?/msg/polling",param,function(data){1==data.ok&&(eval("last_"+mod+"_time=data.time"),toggle_badge(data.msgs_length),null!=data.msgs&&data.msgs.length&&getmsg(data.msgs),null!=data.comments&&getcomment(data.comments))}))}function getcomment(t){$.each(t,function(t,n){if(!(0<=["",null].indexOf(n)||0<=["",null].indexOf(n.comments))){var i=$(".comment #entity-comment-container[cid="+t+"] #entity-comment-content .comment-list");$.each(n.uuids,function(t,e){i.children("#"+e).length&&(n.comments=$(n.comments).children("#"+e).remove())}),i.prepend(n.comments)}})}function getmsg(t){if($.cookie.json=!1,!$.cookie("auth"))return!1;$.cookie.json=!0;for(var e=[],n=void 0===$.cookie("notified")?[]:$.cookie("notified"),i=t.length-1;0<=i;i--)(void 0===t[i].link||0<=["undefined","",null].indexOf(t[i].link))&&(t[i].link="?/msg/index"),lasted_msgs.length>=page_size&&lasted_msgs.pop(),lasted_msgs.unshift(t[i]),-1==$.inArray(t[i].uuid,n)&&($(document).find("#msg").length?view_new_msg(t[i]):navigator.userAgent.match(/mobile/i)||notify(t[i].content.replace(/<[^>]*>/g,""),t[i].link)),e.push(t[i].uuid);$.cookie("notified",e,{expires:30,path:"/"})}function toggle_badge(t){var e=$("#menu-msg .badge,.msg-badge"),n=$("#menu-msg .badge.layui-badge,.msg-badge"),i=99<t?"99+":t;"string"==typeof t&&t<99&&(t=parseInt(t)),t&&0<t?(n.text(99<t?i:t),e.data("num",t).css("display","inline")):e.data("num",0).text(0).hide()}function view_new_msg(t){if(!$(".notice_list .view_content item[uuid="+t.uuid+"]").length){$(".notice_list .view_content .nodata").hide();var e=$("#tpl_msg_item").html();Mustache.parse(e);var n=Mustache.render(e,t);$(".notice_list .view_content").prepend(n),form.render()}}function notify(t,e){var n=$('[type="image/x-icon"]').attr("href")||"static/favicon.ico",i=function(){0!=pc_notify?new Notification("鎮ㄦ湁鏂伴€氱煡",{icon:n,body:t}).onclick=function(){window.open(e)}:console.log("pc閫氱煡宸插叧闂�")};"Notification"in window&&("granted"===Notification.permission?i():"denied"!==Notification.permission&&Notification.requestPermission(function(t){"granted"===t&&i()}))}$.post("?/msg/polling",{is_first:!0},function(t){"open"!=seg(1)&&1==t.ok&&(pc_notify=t.pc_notify,lasted_msgs=t.msgs||[],last_msg_time=last_comment_time=t.time,toggle_badge(t.msgs_length),setInterval(function(){$.getJSON("?/msg/polling/msg_"+t.uid+"&t="+(new Date).getTime(),function(t){polling(t,"msg")}),$(".comment #entity-comment-container[ishome=true]").length&&$.getJSON("?/msg/polling/comment_"+t.sid+"&t="+(new Date).getTime(),function(t){polling(t,"comment")})},17e3))}),b2.toggle_badge=toggle_badge});
$(function(){function r(t){switch(t){case"modal":return"modal";case"side":return"#canvas-side";default:return"#canvas"}}function w(t){return void 0===t||!t||""===t||'""'===t||"''"===t}function k(){var t="dts2_"+window.websid+"_"+seg(1);window.Storage&&window.localStorage&&window.localStorage instanceof Storage?window.localStorage.removeItem(t):$.cookie(t,"",{expires:-1})}function x(t){var a="dts2_"+window.websid+"_"+seg(1),c={};t.find("div.filter-wrap[data-ftype]").each(function(){var t=$(this),a=t.attr("data-ftype"),e=void 0,i="",n="",s="";switch(a){case"select":e=t.find(".layui-select-title input.layui-input"),s=e.attr("data-val_label")?e.attr("data-val_label"):e.val(),i=e.parents("div.filter-wrap[data-ftype=select]").find("select[lay-search][id]").attr("id");var l=$("#"+i);n=l.val(),c[i+"_label"]=s,c[i]=n;break;case"select_new":e=t.find(" .select-mu"),i=e.attr("id"),n=e.val(),s=e.parent().find("input").val(),e.hasClass("select-multi")&&(s=[],e.parent().find("input").each(function(){var t=$(this).val();w(t)||s.push(t)})),c[i]=n,c[i+"_label"]=s;break;case"range":t.find("input").each(function(){var t=$(this);i=t.attr("id"),n=t.val(),c[i]=n});break;case"area_select":var r=t.find("select");i=t.parents(".layui-row[data-key]").attr("data-key");var o={};r.each(function(){var t=$(this);if(w(n=t.val()))return!0;o[t.attr("data-area-key").split("-")[1]]=n}),c[i]={value:o};break;case"input":case"text":case"data":case"datarange":case"timerange":default:e=t.find("input"),i=e.attr("id"),n=e.val(),c[i]=n}}),c.keyword=$(".layui-input.list-search-input").val(),window.Storage&&window.localStorage&&window.localStorage instanceof Storage?window.localStorage.setItem(a,JSON.stringify(c)):$.cookie(a,JSON.stringify(c),{expires:365})}function l(t){if(0!==t.closest(".list-table").length){var a=t.closest(".list-table").siblings(".list-header-wrap");a.find(".list-filter-applied");a.find(".list-filter-wrap").html("");var e=t.closest("form"),i=window.location.hash;if(w(i)&&1!==e.data("s")&&function(t,a){var e,i="dts2_"+window.websid+"_"+seg(1);if(!w(e=window.Storage&&window.localStorage&&window.localStorage instanceof Storage?window.localStorage.getItem(i):$.cookie(i))){var v=parse_json(e,{});if(function(t){for(var a in t)if(t.hasOwnProperty(a)&&void 0!==t[a]&&null!==t[a]){var e=t[a];if("object"==typeof e&&e.hasOwnProperty("type")&&e.hasOwnProperty("value"))return!0}return!1}(v))return console.log("OLD"),k();a.find("div.filter-wrap[data-ftype]").each(function(){var t=$(this),a=t.attr("data-ftype"),e=void 0,i="",n="",s="";switch(a){case"select":var l=(e=t.find("input")).parents("div.filter-wrap[data-ftype=select]").find("select[lay-search][id]");if(i=l.attr("id"),n=v[i],s=v[i+"_label"],w(n))break;var r=setInterval(function(){var t=$("#"+i).next();if(t.attr("select-index")){clearInterval(r);var a=t.attr("select-index");$(".layui-form-selectoption[select-index="+a+"]").find("dd[lay-value="+n+"]").click()}});break;case"select_new":(e=t.find(" .select-mu")).b2select(),i=e.attr("id"),n=v[i],s=v[i+"_label"];var o=parse_json(e.attr("data-props"));if(w(n))break;if("鏄�"===o.ajax){Array.isArray(n)||(n=[n],s=[s]);for(var c=0;c<Math.min(n.length,s.length);c++){var d=n[c],f=s[c];e.find("option[value="+d+"]").remove(),e.append("<option value='"+d+"'>"+f+"</option>")}}e.val(n).trigger("change");break;case"range":t.find("input").each(function(){var t=$(this);i=t.attr("id"),w(n=v[i])||t.val(n)});break;case"area_select":var u=t.find("select");i=t.parents(".layui-row[data-key]").attr("data-key");var p=v[i];if(e=u.parents("[data-ftype]"),w(p))break;e.areaSelect(p);break;case"input":case"text":case"data":case"datarange":case"timerange":default:e=t.find("input"),i=e.attr("id"),w(n=v[i])||e.val(n)}}),setTimeout(function(){var t=v.keyword;w(t)||$(".layui-input.list-search-input").val(t)})}}(0,e),""!==i&&1!=e.data("s")&&-1!=i.indexOf("=")){var n=i.substr(1).split("&");for(var s in n){var l=(y=n[s].split("="))[0],r=decodeURIComponent(y[1]),o=e.find("#"+l).closest("[data-ftype]").data("ftype");switch(void 0===o&&(o=e.find("[aid="+l+"]").length?e.find("[aid="+l+"]").closest("[data-ftype]").data("ftype"):e.find("#"+l+"_s").closest("[data-ftype]").data("ftype")),o){case"select":var c=e.find("#"+l),d=setInterval(function(){var t=c.next();if(t.attr("select-index")){clearInterval(d);var a=t.attr("select-index");$(".layui-form-selectoption[select-index="+a+"]").find("dd[lay-value="+r+"]").click()}});break;case"selectmu":var f=r.split(","),u=[];for(var p in f)e.find("#"+l).find("option").each(function(){$(this).html()==f[p]&&u.push($(this).attr("value"))});e.find("#"+l).val(u);break;case"select_new":(c=e.find("#"+l)).b2select();var v=parse_json(c.attr("data-props"));f=r.split(",");if("鏄�"===v.ajax)$.post("?/api/get_options",{conf:v},function(t){for(var a in f)if(f.hasOwnProperty(a)){var e=f[a],i=t.results[e];console.log(i),c.find("option[value="+e+"]").remove(),c.append("<option value='"+e+"'>"+i+"</option>")}var n=JSON.stringify(f);c.val(f).attr("data-val",n).trigger("change")});else{u=JSON.stringify(f);if(c.val(f).attr("data-val",u).trigger("change"),"usr"===v.type){var g=c.find('option[value]:not(option[value=""])');_.each(g,function(t){var a=$(t).text(),e=$(t).val();if(1===f.length&&(console.log(f[0]),f[0]===a||f[0]===e))return c.val(e).trigger("change"),!1})}}break;case"daterange":if(-1!==r.indexOf(" - "))var h=r;else if(/^((([1-2][0-9])\d{2})-(0?[1-9]|1[012]))$/.test(r)){if(/^(((19|20)\d{2})-(0?([469]|11)))$/.test(r))h=r+"-01 - "+r+"-30";else if(/^(((19|20)\d{2})-(0?([13578]|1[02])))$/.test(r))h=r+"-01 - "+r+"-31";else if(/^(((19|20)\d{2})-(0?[2]))$/.test(r))h=r+"-01 - "+r+"-28"}else h=r+" - "+r;e.find("#"+l).val(h);break;case"range":var y=["",""];-1!==r.indexOf("-")?(y[0]=r.split("-")[0],y[1]=r.split("-")[1]):y[0]=y[1]=r,e.find("#"+l+"_s").val(y[0]),e.find("#"+l+"_e").val(y[1]);break;case"input":case"text":e.find("#"+l).val(r);break;case"area_select":var b=["province","city","district","street"],m=(f=r.split(","),{});for(s=0;s<Math.min(b.length,f.length);s++)m[b[s]]=f[s];$(".area-filter[aid="+l+"]").areaSelect({value:m});break;default:e.find("[data-kid="+l+"]").val(r)}}}setTimeout(function(){!function(t,n){var a=t.closest("form").serializeArray();n.removeAttr("data-s");var s=t.closest(".list-table").siblings(".list-header-wrap"),e=s.find(".list-filter-applied"),l=s.find(".list-filter-wrap");l.html(""),_.each(a,function(t){if("object"==typeof t&&t.value){var a=s.find('[name="'+t.name+'"]'),e=s.find(".list-filter-wrap").find('[filter-item="'+t.name+'"]');if(t.label="keywords"===t.name?lang.keyword:a.closest(".layui-row").find(".filter-label").text(),""===t.label)return!0;if("hidden"===a.attr("type")||"sid[]"===t.name)return;if(a.is("select")&&(t.value=a.find('option[value="'+t.value+'"]').text()),0<e.length)e.text(e.text()+", "+t.value);else{var i=$(b2.t('<span class="list-filter-item">{label}: <span filter-item="{name}">{value}</span></span>',t));$('<span class="ion-android-close list-filter-remove"></span>').click(function(){if(void 0!==a.attr("lay-search")){var t=a.next().attr("select-index");$(".layui-form-selectoption[select-index="+t+"]").find("dd:first-child").click()}else a.val("").trigger("change");x(n),s.siblings(".list-table").find(".datatables").DataTable().draw()}).appendTo(i),l.append(i)}}}),l.html()&&0<l.html().length?e.show():e.hide()}(t,e),w(i)&&x(e)})}}function n(t){$(t).closest("form").attr("data-s",1),$(t).closest(".list-header-wrap").siblings(".list-table").find(".datatables").DataTable().draw()}function o(t,a){var e=a[0],i=this.data("seg1");submenu="about",target=r(this.data("link_type")),active_css="active",habit=this.data("habit");try{submenu=Object.keys(menu[i].children.view.children)[0]}catch(t){}var n=$(t);"1"==habit&&((n=$(t).find("td:eq(1)").find(".data-wrap")).each(function(){""==$(this).html().trim()&&$(this).html("("+lang.empty+")")}),n.css({color:"#0f62ec","text-decoration":"underline",width:"auto"})),n.off("click").on("click",function(t){if(!$(t.target).hasClass("nc")&&!$(t.target).hasClass("layui-icon")&&"a"!=t.target.tagName.toLowerCase()&&(v(i+"/view/"+submenu+"/"+e,target),"#canvas-side"==target)){var a=$(this);if(a.hasClass(active_css))return;a.siblings("."+active_css).removeClass(active_css),a.addClass(active_css)}})}function c(t,a){$(t).addClass("nc").html('<input type="checkbox" value="'+a+'" name="sid[]">'),$(t).parent().find("td[class=nc]:first").click(function(){form.render()})}function d(t,a,e){var i=$(t),n=e[0],s=this,l=s.data("seg1");target=r(this.data("link_type")),i.closest("tr").attr("uuid",n),i.addClass("nc"),$("<span>").attr("class","layui-icon ion-edit").css("margin","0 2px").click(function(){v(l+"/view/about/"+n+"/edit/",target)}).appendTo(i),$("<span>").attr("class","layui-icon ion-trash-a").css("margin","0 2px").click(function(){rdel(l+"/del/"+n,s)}).appendTo(i)}$.fn.dataTableExt.sErrMode="throw";var t=lang.pepm_loading_2;$("body.def-loading-anim").length&&(t=lang.pepm_loading_ring),$.extend($.fn.dataTable.defaults,{language:{processing:t,sSearchPlaceholder:lang.search,lengthMenu:lang.dts_lengthMenu,zeroRecords:lang.no_result,sEmptyTable:lang.no_result,info:lang.dts_info_async,infoEmpty:lang.no_result,infoFiltered:lang.dts_infoFiltered,infoPostFix:"",search:"",url:"",paginate:{first:lang.first,previous:lang.previous,next:lang.next,last:lang.last}}}),$(document).on("keydown",".list-search-input",function(t){if(13==t.keyCode)return n(this),!1});var a=$("#canvas");a.off("click",".list-search-btn, .list-search-btn1").on("click",".list-search-btn, .list-search-btn1",function(t){t.preventDefault(),n(this)}),a.off("click",".list-search-clear, .list-filter-clear").on("click",".list-search-clear, .list-filter-clear",function(t){t.preventDefault(),window.location.hash="";var a=$(this).closest("form");a.attr("data-s",1);var e=a.find(".pager").val();a.get(0).reset(),a.find(".pager").val(e-0),a.find(".area[data-area-key]").val("").trigger("change"),a.find("select").trigger("change"),n(this),k()}),a.on("click",".list-search-full",function(t){t.preventDefault(),element.init(),$(this).closest(".list-search-wrap").siblings(".list-filter").toggle(),function(){if(0==$(".filter-wrap[data-ftype=select]").length)return;$(".list-table").find(".layui-table tr").each(function(){var t=$(this),a=t.css("background-color");if(t.find("td,th").css("background-color",a),0<t.closest("thead").length)return!0;t.on("mouseover",function(){t.find("td").css("background-color","#f2f2f2")}).on("mouseout",function(){t.find("td").css("background-color",a)})})}()}),a.on("reload.easy",".v-table-views",function(t){t.preventDefault(),l($(this))}),$.fn.b2table=function(t){return this.each(function(){$el=$(this),$el.data("b2table")||($el.data("b2table",this),function(t,n){var r=$(t),s=r.data("seg1")||"entity",a={oClass:{sFilterInput:"layui-input"},pagingType:"simple_numbers",info:!0,dom:"rtip",filter:!0,autoWidth:!1,stateSave:!1,serverSide:!0,processing:!0,paging:!0,searchDelay:1e3,lengthChange:!0,ajax:_.throttle(function(t,a,e){var i="?/"+s+"/index_ajax/";t.count_off=0<r.closest(".content-side-open").length?1:0,t.length=t.length||r.data("page_size")||20,t.state=n.state,l(r),t.search_all=r.closest("form").serialize()||[],$.post(i,t,function(t){a(t="object"==typeof t?t:{recordsTotal:0,recordsFiltered:0,data:[]})})},500),createdRow:o,columnDefs:[{targets:0,sortable:!1,createdCell:c},{targets:-1,sortable:!1,createdCell:d}],stateSaveCallback:function(t,a){a.mod=s,delete a.length,localStorage.setItem("dts",JSON.stringify(a))},stateLoadCallback:function(t){var a={};return localStorage.getItem("dts")&&(a=parse_json(localStorage.getItem("dts"))),"object"==typeof a&&null!=a&&a.mod==s?(a.columns=_.map(a.columns,function(t){return delete t.search,t}),a):null},drawCallback:function(){var t=this.api(),a=$(t.table().container()),e=a.find(".pager-wrap"),n=t.page.len(),s=t.page.info()||{};if(n?(e.show(),e.find(".pager").val(n)):e.hide(),1==s.pages?a.find(".dataTables_paginate").hide():a.find(".dataTables_paginate").show(),a.find(".checkall input").prop("checked",!1),count_val=new Array,r.find("tbody tr").last().children().each(function(){count_val.push($(this).first().html())}),0<count_val.length&&0<count_val[0].indexOf("counter")){r.find("tbody tr").last().remove(),count_val[count_val.length-1]=count_val[0]="";var l='<tr class="tr_count">';for(i=0;i<count_val.length;i++)l+="<th>"+count_val[i]+"</th>";l+="</tr>","bottom"==r.attr("data-listcount")?(r.find("tfoot").remove(),r.append("<tfoot>"+l+"</tfoot>")):(r.find("thead .tr_count").remove(),r.find("thead").first().append(l))}else r.find(".tr_count").remove();form.render()},initComplete:function(){var e=this.api(),t=(e.state(),$(e.table().container()));r.data("page_size"),e.columns().visible(!0),t.on("change",".pager",function(t){t.preventDefault();var a=parseInt($(this).val())||20;e.page.len(a).draw()});var l="en-us"==language?"en":"zh";t.closest(".list-table").siblings(".list-header-wrap").find("[data-laydate]").each(function(t,a){var e=$(this),i=e.attr("id"),n=e.data("range")||!1,s=e.data("laydate")||"date";laydate.render({elem:"#"+i,type:s,range:n,format:"yyyy-MM-dd",lang:l})}),$(".area-filter").areaSelect();var n=[];r.find("thead th").each(function(){var t="";if($(this).hasClass("sorting_asc")&&(t="asc"),$(this).hasClass("sorting_desc")&&(t="desc"),$(this).data("orderable")||(t=""),""==t)return!0;var a=$(this).attr("data-name"),e=$(this).attr("data-type"),i={};i.sort=t,i.key=a,i.type=e,n.push(i)}),localStorage.setItem("order_data",JSON.stringify(n)),linkage_sel()}};"object"!=typeof n&&(n={}),$.extend(a,n);var e=r.data("page_size");"side"==r.data("link_type")&&(e=0),e=e||20,(a.pageLength=e)||(a.paging=!1),r.dataTable(a),0<navigator.userAgent.indexOf("iPhone")?r.wrap('<div class="ios_handle table_canvas"></div>'):r.wrap('<div class="table_canvas"></div>')}($el,t))}),this}}),databox_fn=function(t,a,e){var i=$(t),n=i.data("mod"),s=(i.data("seg1"),seg(1)+"-"+n),l=seg(1);switch(a){case"submit":var r=i.find("[name=diycol]").val();$.ajax({url:"?/"+l+"/diycol/set",data:{diycol:r,dkey:s},dataType:"json",type:"post",async:!1,success:function(t){layer.msg(lang.config_success,{time:"2000"}),o(i)}});break;case"default":layer.close(e),$.ajax({url:"?/"+l+"/diycol/reset",data:{dkey:s},dataType:"json",type:"post",async:!1,success:function(t){layer.msg(lang.reset_success,{time:"2000"}),o(i)}})}function o(t){t.hasClass("rel_diycol")||location.reload();var a=parse_json(i.closest("[ext]").attr("ext")),e=a.mod;$("[ext]").each(function(){var t=parse_json($(this).attr("ext"));(t.mod==e||a.rel_mod&&t.mod==a.rel_mod)&&$(this).b2data()})}};
$(function(){$("body").on("change",'select[lay-filter2="autofill"]',function(t){var e=$(this).val();if(0<$(this).closest(".databox").length){var a=$(this).closest(".databox").data("data");for(var l in a)if(a[l]==e){e=l;break}}""===e?system_fill($(this)):system_fill($(this),e)}),$(".num").each(function(){var t=$(this),e=t.attr("decimals")||2,a=t.data("sep");null!=a&&""!=a&&t.change(function(){t.val(number_format(t.val(),e,".",a,t.attr("padding")))})}),form.on("select",function(t){if(0<$(t.elem).closest("[ftype=config]").length){var e=$(t.elem).closest("[ftype=config]").attr("kid"),a=$("#"+e).find("option:selected").text();$("#"+e+"_label").html('<input type="text" name="data['+e+'_label]" value="'+a+'">')}else"autofill"!=$(t.elem).attr("lay-filter2")||(""==t.value?system_fill($(t.elem)):system_fill($(t.elem),t.value))}),$("[lay-filter2=autofill]").on("change",function(){var t=$(this).val();if(0<$(this).closest(".databox").length){var e=$(this).closest(".databox").data("data");for(var a in e)if(e[a]==t){t=a;break}}""===t?system_fill($(this)):system_fill($(this),t)}),$(".puretext").on("click",".fw-export",function(t){var e=$(this).attr("eid"),a=$(this).closest("div").attr("fid");window.location.href="?/flow/fw_export/"+e+"/"+a})});var pepm_layout={form_init:function(t){$("#"+t+" .databox .val").change(function(){"autofill"==$(this).attr("lay-filter2")&&system_fill($el,$(this).val())}),$("#"+t).find("[lay-filter2=autofill]").each(function(t,e){var a=$(e),l=a.val();l?system_fill(a,l):system_fill(a)})}};function getNum(t){return $input=$("#"+t),$input.length||($input=$("[kid="+t+"]").find("input")),$input.data("laydate")?new Date($input.val()):(num=$input.val(),null==num?0:(result=parseFloat(num.split(",").join("")),isNaN(result)?0:result))}function date_judge(t){var e=new RegExp("-","g"),a=new RegExp(" ","g"),l=new RegExp(":","g"),i=$("#date_on"),n=$("#date_off");1==t&&(i=$("#date_on").next(".default_dtype"),n=$("#date_off").next(".default_dtype"));var f=i.val().replace(e,"").replace(a,"").replace(l,""),s=n.val().replace(e,"").replace(a,"").replace(l,"");s<f&&""!=s&&(layer.msg("缁撴潫鏃堕棿涓嶈兘灏忎簬寮€濮嬫椂闂�"),$("#date_off").val(""),1==t&&n.val(""))}
!function(M){jQuery.fn.extend({slimScrollH:function(C){var E=M.extend({width:"250px",height:"250px",size:"7px",color:"#000",position:"top",distance:"1px",start:"left",opacity:.4,alwaysVisible:!0,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:.2,railDraggable:!0,railClass:"slimScrollRailH",barClass:"slimScrollBarH",wrapperClass:"slimScrollDivH",allowPageScroll:!1,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px",responseWheelEvent:!0,hideWrapperScroll:!0},C);return this.each(function(){var r,e,s,i,a,l,o,n,d="<div></div>",c=30,h=!1,u=M(this);if(u.parent().hasClass(E.wrapperClass)){var p=u.scrollLeft();if(b=u.parent().find("."+E.barClass),v=u.parent().find("."+E.railClass),x(),M.isPlainObject(C)){if("height"in C&&"auto"==C.height){u.parent().css("height","auto"),u.css("height","auto");var f=u.parent().parent().height();u.parent().css("height",f),u.css("height",f)}if("scrollTo"in C)p=parseInt(E.scrollTo);else if("scrollBy"in C)p+=parseInt(E.scrollBy);else if("destroy"in C)return b.remove(),v.remove(),void u.unwrap();y(p,!1,!0)}}else{E.height="auto"==E.height?u.parent().height():E.height,E.width="auto"==E.width?u.parent().width():E.width;var g=M(d).addClass(E.wrapperClass).css({position:"relative",overflow:"hidden",width:E.width,height:E.height});u.css({overflow:E.hideWrapperScroll?"hidden":"auto",width:E.width,height:E.height});var v=M(d).addClass(E.railClass).css({width:"100%",height:E.size,position:"absolute",top:0,display:E.alwaysVisible&&E.railVisible?"block":"none","border-radius":E.railBorderRadius,background:E.railColor,opacity:E.railOpacity,zIndex:90}),b=M(d).addClass(E.barClass).css({background:E.color,height:E.size,position:"absolute",opacity:E.opacity,display:E.alwaysVisible?"block":"none","border-radius":E.borderRadius,BorderRadius:E.borderRadius,MozBorderRadius:E.borderRadius,WebkitBorderRadius:E.borderRadius,zIndex:99}),w="top"==E.position?{top:E.distance}:{bottom:E.distance};v.css(w),b.css(w),u.wrap(g),u.parent().append(b),u.parent().append(v),E.railDraggable&&b.bind("mousedown",function(e){var i=M(document);return s=!0,t=parseFloat(b.css("left")),pageY=e.pageX,i.bind("mousemove.slimscroll",function(e){currLeft=t+e.pageX-pageY,b.css("left",currLeft),y(0,b.position().left,!1)}),i.bind("mouseup.slimscroll",function(e){s=!1,S(),i.unbind(".slimscroll")}),!1}).bind("selectstart.slimscroll",function(e){return e.stopPropagation(),e.preventDefault(),!1}),v.hover(function(){W()},function(){S()}),b.hover(function(){e=!0},function(){e=!1}),u.hover(function(){r=!0,W(),S()},function(){r=!1,S()}),u.bind("touchstart",function(e,t){e.originalEvent.touches.length&&(a=e.originalEvent.touches[0].pageY)}),u.bind("touchmove",function(e){(h||e.originalEvent.preventDefault(),e.originalEvent.touches.length)&&(y((a-e.originalEvent.touches[0].pageY)/E.touchScrollStep,!0),a=e.originalEvent.touches[0].pageY)}),x(),"left"===E.start?(b.css({left:0}),y(0,!0)):"right"!==E.start&&(y(M(E.start).position().left,null,!0),E.alwaysVisible||b.hide()),function(){window.addEventListener?(this.addEventListener("DOMMouseScroll",m,!1),this.addEventListener("mousewheel",m,!1),this.addEventListener("MozMousePixelScroll",m,!1)):document.attachEvent("onmousewheel",m)}()}function m(e){if(r&&e&&0===e.deltaX&&-1===(e.deltaX+"0").indexOf(".")&&-1===(e.deltaY+"0").indexOf(".")&&(E.responseWheelEvent||e.shiftKey)){var t=0;(e=e||window.event).wheelDelta&&(t=-e.wheelDelta/120),e.detail&&(t=e.detail/3);var i=e.target||e.srcTarget||e.srcElement;M(i).closest("."+E.wrapperClass).is(u.parent())&&y(t,!0),e.preventDefault&&!h&&e.preventDefault(),h||(e.returnValue=!1)}}function y(e,t,i){h=!1;var r=e,s=u.outerWidth()-b.outerWidth();if(t&&(r=parseInt(b.css("left"))+e*parseInt(E.wheelStep)/100*b.outerWidth(),r=Math.min(Math.max(r,0),s),r=0<e?Math.ceil(r):Math.floor(r),b.css({left:r+"px"})),r=(o=parseInt(b.css("left"))/(u.outerWidth()-b.outerWidth()))*(u[0].scrollWidth-u.outerWidth()),i){var a=(r=e)/u[0].scrollWidth*u.outerWidth();a=Math.min(Math.max(a,0),s),b.css({left:a+"px"})}u.scrollLeft(r),u.trigger("slimscrolling",~~r),W(),S()}function x(){l=Math.max(u.outerWidth()/u[0].scrollWidth*u.outerWidth(),c),b.css({width:l+"px"});var e=l==u.outerWidth()?"none":"block";b.css({display:e})}function W(){if(x(),clearTimeout(i),o==~~o){if(h=E.allowPageScroll,n!=o){var e=0==~~o?"left":"right";u.trigger("slimscroll",e)}}else h=!1;n=o,l>=u.outerWidth()?h=!0:(b.stop(!0,!0).fadeIn("fast"),E.railVisible&&v.stop(!0,!0).fadeIn("fast"))}function S(){E.alwaysVisible||(i=setTimeout(function(){E.disableFadeOut&&r||e||s||(b.fadeOut("slow"),v.fadeOut("slow"))},1e3))}}),this}}),jQuery.fn.extend({slimscrollH:jQuery.fn.slimScrollH})}(jQuery);
!function(l,a,e,t){"use strict";l.fn.areaSelect=function(a){var c=l.extend({},l.fn.areaSelect.defaults,a);return this.each(function(){if(c.value){var t=c.value;l(this).find("select,input").each(function(){var a=l(this).attr("data-area-key"),e=(a.split("-")[0],a.split("-")[1]);l("option",this).remove(),"address"==e?l(this).val(t[e]):e in t&&l(this).html('<option value="'+t[e]+'" selected>'+t[e]+"</option>")})}l(this).each(function(){var s="",a=l(this).attr("kid"),e=l(this).find("select[data-area-key!="+a+"-nation]");setTimeout(function(){o(a)},100),e.each(function(){var t=l(this).attr("data-area-key"),n=(t.split("-")[0],t.split("-")[1]);if(l.ajax({url:c.url,data:{name:s,default:1},async:!1,success:function(a){var i="",e=JSON.parse(a),r=l("[data-area-key="+t+"]").val();r&&(sessionStorage.setItem(t,r),"province"==n&&(s+=r),"city"!=n&&"district"!=n||(s+=","+r)),l.each(e,function(a,e){var t="";r&&r==e&&(t="selected"),i+="<option value='"+a+"' "+t+">"+e+"</option>"}),l("[data-area-key="+t+"]").html(i)}}),""==s)return!1})}),l(this).find("select").bind("change",function(){var a=l(this).attr("data-area-key"),e=a.split("-")[0],t=a.split("-")[1],i=l(this).val(),r={};switch(t){case"nation":o(e);break;case"province":r={name:i};l.getJSON(c.url,r,function(a){n(a,e,"city")});break;case"city":r={name:l("[data-area-key="+e+"-province]").val()+","+i};l.getJSON(c.url,r,function(a){n(a,e,"district")});break;case"district":r={name:l("[data-area-key="+e+"-province]").val()+","+l("[data-area-key="+e+"-city]").val()+","+i};l.getJSON(c.url,r,function(a){n(a,e,"street")})}})});function n(i,a,e){var r="[data-area-key="+a+"-"+e+"]";l(":selected",r).val();switch(e){case"nation":o(a);break;case"city":l("option",r).remove(),l("option","[data-area-key="+a+"-district]").remove(),l("option","[data-area-key="+a+"-street]").remove();break;case"district":l("option",r).remove(),l("option","[data-area-key="+a+"-street]").remove();break;case"street":l("option",r).remove()}l.isArray(i)?l.each(i,function(a,e){l.each(e,function(a,e){if("selected"===a)e;else{var t=l("<option />").val(a).append(e);l(r).append(t)}})}):l.each(i,function(a,e){if(i.hasOwnProperty(a))if("selected"===a)e;else{var t=l("<option />").val(a).append(e);l(r).append(t)}})}function o(a){var e=l("[data-area-key="+a+"-nation]"),t=l("[data-area-key="+a+"-province],[data-area-key="+a+"-city],[data-area-key="+a+"-district],[data-area-key="+a+"-street]"),i="",r=t.attr("lay-verify");void 0!==r&&!1!==r&&(i=r),"涓浗"!=e.val()&&""!=e.val()&&e.val()?(t.val("").css("display","none"),i&&t.attr("lay-verify","required_")):(t.css("display","inline"),i&&t.attr("lay-verify","required"))}},l.fn.areaSelect.defaults={url:"?/api/area",value:null}}(window.jQuery||window.Zepto,window,document);
!function(u,t,a,e){"use strict";u.fn.reldata=function(t){var f=u.extend({},u.fn.reldata.defaults,t);return this.each(function(){var t=f.data,a=this,e=parse_json(u(a).attr("ext")),n=e.filter._rel,r=e.filter._rel_view,i=e.mod,d=[];u(a).find("table thead tr th[kid]").each(function(t,a){d.push(u(a).attr("kid"))});var l={_rel:n,_rel_view:r,mod:i};t?l.data=JSON.stringify(t):l.all=1,u.post(f.url,l,function(t){u(a).b2data()})})},u.fn.reldata.defaults={url:"?/entity/fill_rel_data",data:null}}(window.jQuery||window.Zepto,window,document);
var elem={requiredBtn:function(e,t){var a=function(){return _.each(t,function(e){$(e).each(function(){$(this).attr("data-required-pass",$(this).val()?1:0)})}),0===$("[data-required-pass=0]").length},i=function(){a()?$(e).removeAttr("disabled"):$(e).attr("disabled",1)};i(),_.each(t,function(e){$(e).each(function(){$(this).attr("data-required-pass",$(this).val()?1:0),$(this).on("input propertychange change",function(){i()})})})},canvas:function(e){e.css({marginTop:0,padding:0}).prev().hide(),e.addClass("elem-new"),this.pureClass.layui("#canvas"),this.ixHeight()},ixHeight:function(){var e=$("#canvas");if(e.length){var t=e.children().last();navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&812===screen.height&&375===screen.width&&t.after("<div class='elem-ix-padding' style='height: 70px;'></div>")}},form:function(e){e.addClass("elem-new__form"),e.find("table").addClass("form__table")},btnGroup:function(e){e.addClass("margin-top--lg"),this.btnConfirm(e.find(".elem-btn-confirm")),this.btnCancel(e.find(".elem-btn-cancel"))},btnConfirm:function(e){return e.addClass("button button--fulled bg-red color-white margin-bottom--md margin-lr--md"),e},btnCancel:function(e){return e.addClass("button button--fulled bg-white color-red margin-lr--md"),e},pureClass:{layui:function(e){$(e).find(".layui-btn").removeClass("layui-btn layui-btn-primary")}},switch:{initLayuiSwitch:function(e){$(e).addClass("elem__switch elem__switch--layui")}},imgUploadPreview:function(n){n.on("change",function(){var e=n.attr("data-thumbnail-target");if(e){var t=$(e).get(0),a=n.get(0).files[0],i=new FileReader;i.onloadend=function(){t.src=i.result},a?i.readAsDataURL(a):t.src=""}})},rotateIOSPhoto:function(t){var a=$(t).attr("id")+"-orientation",i="data-"+a;t.on("change",function(){var e=this.files[0];EXIF.getData(e,function(){var e=EXIF.getTag(this,"Orientation");void 0!==e?$(t).next().length&&$(this).next().attr(i)?$(t).next().attr(i,e).val(e):$(t).after($("<input type='hidden' name='"+a+"' "+i+"='"+e+"'>").val(e)):$(t).next().length&&$(t).next().attr(i)&&$(t).next().remove()})})},tableCtl:{row:{arrowed:function(e,t,a){!1!==a&&e.closest("td").children().hide(),e.addClass("elem-after elem-arrow").css({height:"16px"}).on("click",function(e){e.target===$(this)[0]&&t()}),a&&(a.on("click",function(){t()}),e.append(a.show().css({display:"inline-block",textAlign:"right",position:"relative",left:"calc(100% - (20px + 9px + 8px) - "+a.width()+"px)"})))}},radio:{init:function(e){(e=$(e)).addClass("elem__select--slided");var t=e.closest("tr");if(t.length){var a=this._createContainer(e),i=a.find(".elem-select-dropdown__container");t.after(a),this._appendRadios(e,i),this._init(e,i)}},_init:function(e,t){e.hide(),e.closest("td").addClass("elem-after elem-arrow").css({height:"16px"}).on("click",function(e){e.target===$(this)[0]&&($(this).toggleClass("elem-arrow--down"),t.slideToggle())}),t.slideUp(0)},_createContainer:function(e){var t="";return e.parents("tr").length&&(t="<tr class='elem-slided-tr'><td colspan='2'><div class='elem-select-dropdown__container'></div></td></tr>"),$(t)},_appendRadios:function(i,n){i.find("input[type=radio]").each(function(){var e=$(this).attr("value"),t=$(this).attr("title"),a=$("<div class='elem-select-dropdown__option' data-value="+e+">"+t+"</div>");n.append(a),a.on("click",function(){var e=$(this).attr("data-value");i.find("input[type=radio][value="+e+"]").click(),$(this).siblings().removeClass("elem-after elem-checked"),$(this).addClass("elem-after elem-checked")}),$(this).attr("checked")&&a.click()})}},select:{init:function(e,t){t||(t=!0),(e=$(e)).addClass("elem__select--slided");var a=e.closest("tr");if(a.length){var i=this._createContainer(e),n=i.find(".elem-select-dropdown__container");a.after(i),this._appendOption(e,n,t),this._init(e,n)}},_init:function(e,t){e.closest("td").addClass("elem-after elem-arrow").css({height:"16px"}).on("click",function(){$(this).toggleClass("elem-arrow--down"),t.slideToggle()}),t.slideUp(0)},_createContainer:function(e){var t="";return e.parents("tr").length&&(t="<tr class='elem-slided-tr'><td colspan='2'><div class='elem-select-dropdown__container'></div></td></tr>"),$(t)},_appendOption:function(i,n,l){i.find("option[value]:not([value=''])").each(function(){var e=$(this).attr("value"),t=$(this).text(),a=$("<div class='elem-select-dropdown__option' data-value="+e+">"+t+"</div>");n.append(a),a.on("click",function(){i.val(e),l&&$(this).siblings().removeClass("elem-after elem-checked"),$(this).addClass("elem-after elem-checked")}),i.val()===e&&a.click()})}},checkbox:{init:function(e){(e=$(e)).addClass("elem__select--slided");var t=e.closest("tr");if(t.length){var a=this._createContainer(e),i=a.find(".elem-select-dropdown__container");t.after(a),this._appendCheckbox(e,i),this._init(e,i)}},_init:function(e,t){e.hide(),e.closest("td").addClass("elem-after elem-arrow").css({height:"16px"}).on("click",function(e){e.target===$(this)[0]&&($(this).toggleClass("elem-arrow--down"),t.slideToggle())}),t.slideUp(0)},_createContainer:function(e){var t="";return e.parents("tr").length&&(t="<tr class='elem-slided-tr'><td colspan='2'><div class='elem-select-dropdown__container'></div></td></tr>"),$(t)},_appendCheckbox:function(n,l){n.find("input[type=checkbox]").each(function(){var e=$(this).attr("name"),t=$(this).attr("title"),a=$(this).attr("checked"),i=$("<div class='elem-select-dropdown__option' data-title="+t+" data-msg="+a+" data-name="+e+">"+t+"</div>");l.append(i),"checked"==i.attr("data-msg")?i.addClass("elem-after elem-checked"):i.removeClass("elem-after elem-checked"),i.on("click",function(){"checked"==$(this).attr("data-msg")?($(this).removeClass("elem-after elem-checked"),$(this).attr("data-msg","unchecked")):($(this).addClass("elem-after elem-checked"),$(this).attr("data-msg","checked")),n.find("input[title="+$(this).attr("data-title")+"]").click()})})}}},msg:function(e,t){if(isMobile.any()){t||(t=3e3);var a=this;layer.msg(e,{icon:1,time:t,success:function(e){e.addClass("elem-root elem--mobile elem__modal elem-bg--black elem__modal-msg elem__modal-msg--success"),a.layui.makeCenter(e);var t=e.find(".layui-layer-content").text();e.find(".layui-layer-ico").after("<div class='elem__modal-msg__content'>"+t+"</div>")}})}else layer.msg(e)},layui:{rerenderModal:function(e){e.addClass("elem-new elem--mobile elem__modal elem-bg--black");var t=e.width();e.css({left:"calc(50% - "+t+"px / 2)"})},rerenderPrompt:function(e){e.addClass("elem-new elem--mobile elem__modal elem-bg--black");var t=e.width();e.css({left:"calc(50% - "+t+"px / 2)"})},makeCenter:function(e){var t=e.width(),a=e.height();e.css({left:"calc(50% - "+t+"px / 2)",top:"calc(50% - "+a+"px / 2)"})},resize:function(e){var t=e.find(".layui-layer-content");isMobile.any()?e.css({top:"50px",left:"0"}):(t.css({padding:0,maxWidth:"800px"}),this.makeCenter(e)),t.css({padding:0})}}};
(function(){var d=!1,l=function(e){return e instanceof l?e:this instanceof l?void(this.EXIFwrapped=e):new l(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=l),exports.EXIF=l):this.EXIF=l;var u=l.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},c=l.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},f=l.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},g=l.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},m=l.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function i(e){return!!e.exifdata}function n(i,o){function t(e){var t=p(e);i.exifdata=t||{};var n=function(e){var t=new DataView(e);d&&console.log("Got file of length "+e.byteLength);if(255!=t.getUint8(0)||216!=t.getUint8(1))return d&&console.log("Not a valid JPEG"),!1;var n=2,r=e.byteLength;for(;n<r;){if(l=n,56===(s=t).getUint8(l)&&66===s.getUint8(l+1)&&73===s.getUint8(l+2)&&77===s.getUint8(l+3)&&4===s.getUint8(l+4)&&4===s.getUint8(l+5)){var i=t.getUint8(n+7);i%2!=0&&(i+=1),0===i&&(i=4);var o=n+8+i,a=t.getUint16(n+6+i);return S(e,o,a)}n++}var s,l}(e);if(i.iptcdata=n||{},l.isXmpEnabled){var r=function(e){if(!("DOMParser"in self))return;var t=new DataView(e);d&&console.log("Got file of length "+e.byteLength);if(255!=t.getUint8(0)||216!=t.getUint8(1))return d&&console.log("Not a valid JPEG"),!1;var n=2,r=e.byteLength,i=new DOMParser;for(;n<r-4;){if("http"==y(t,n,4)){var o=n-1,a=t.getUint16(n-2)-1,s=y(t,o,a),l=s.indexOf("xmpmeta>")+8,u=(s=s.substring(s.indexOf("<x:xmpmeta"),l)).indexOf("x:xmpmeta")+10;s=s.slice(0,u)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+s.slice(u);var c=i.parseFromString(s,"text/xml");return x(c)}n++}}(e);i.xmpdata=r||{}}o&&o.call(i)}var e,n,r;if(i.src)if(/^data\:/i.test(i.src))t(function(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var n=atob(e),r=n.length,i=new ArrayBuffer(r),o=new Uint8Array(i),a=0;a<r;a++)o[a]=n.charCodeAt(a);return i}(i.src));else if(/^blob\:/i.test(i.src)){(s=new FileReader).onload=function(e){t(e.target.result)},e=i.src,n=function(e){s.readAsArrayBuffer(e)},(r=new XMLHttpRequest).open("GET",e,!0),r.responseType="blob",r.onload=function(e){200!=this.status&&0!==this.status||n(this.response)},r.send()}else{var a=new XMLHttpRequest;a.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";t(a.response),a=null},a.open("GET",i.src,!0),a.responseType="arraybuffer",a.send(null)}else if(self.FileReader&&(i instanceof self.Blob||i instanceof self.File)){var s;(s=new FileReader).onload=function(e){d&&console.log("Got file of length "+e.target.result.byteLength),t(e.target.result)},s.readAsArrayBuffer(i)}}function p(e){var t=new DataView(e);if(d&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return d&&console.log("Not a valid JPEG"),!1;for(var n,r=2,i=e.byteLength;r<i;){if(255!=t.getUint8(r))return d&&console.log("Not a valid marker at offset "+r+", found: "+t.getUint8(r)),!1;if(n=t.getUint8(r+1),d&&console.log(n),225==n)return d&&console.log("Found 0xFFE1 marker"),o(t,r+4,t.getUint16(r+2));r+=2+t.getUint16(r+2)}}var h={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function S(e,t,n){for(var r,i,o,a,s=new DataView(e),l={},u=t;u<t+n;)28===s.getUint8(u)&&2===s.getUint8(u+1)&&(a=s.getUint8(u+2))in h&&((o=s.getInt16(u+3))+5,i=h[a],r=y(s,u+5,o),l.hasOwnProperty(i)?l[i]instanceof Array?l[i].push(r):l[i]=[l[i],r]:l[i]=r),u++;return l}function P(e,t,n,r,i){var o,a,s,l=e.getUint16(n,!i),u={};for(s=0;s<l;s++)o=n+12*s+2,!(a=r[e.getUint16(o,!i)])&&d&&console.log("Unknown tag: "+e.getUint16(o,!i)),u[a]=F(e,o,t,n,i);return u}function F(e,t,n,r,i){var o,a,s,l,u,c,d=e.getUint16(t+2,!i),f=e.getUint32(t+4,!i),g=e.getUint32(t+8,!i)+n;switch(d){case 1:case 7:if(1==f)return e.getUint8(t+8,!i);for(o=4<f?g:t+8,a=[],l=0;l<f;l++)a[l]=e.getUint8(o+l);return a;case 2:return y(e,o=4<f?g:t+8,f-1);case 3:if(1==f)return e.getUint16(t+8,!i);for(o=2<f?g:t+8,a=[],l=0;l<f;l++)a[l]=e.getUint16(o+2*l,!i);return a;case 4:if(1==f)return e.getUint32(t+8,!i);for(a=[],l=0;l<f;l++)a[l]=e.getUint32(g+4*l,!i);return a;case 5:if(1==f)return u=e.getUint32(g,!i),c=e.getUint32(g+4,!i),(s=new Number(u/c)).numerator=u,s.denominator=c,s;for(a=[],l=0;l<f;l++)u=e.getUint32(g+8*l,!i),c=e.getUint32(g+4+8*l,!i),a[l]=new Number(u/c),a[l].numerator=u,a[l].denominator=c;return a;case 9:if(1==f)return e.getInt32(t+8,!i);for(a=[],l=0;l<f;l++)a[l]=e.getInt32(g+4*l,!i);return a;case 10:if(1==f)return e.getInt32(g,!i)/e.getInt32(g+4,!i);for(a=[],l=0;l<f;l++)a[l]=e.getInt32(g+8*l,!i)/e.getInt32(g+4+8*l,!i);return a}}function y(e,t,n){for(var r="",i=t;i<t+n;i++)r+=String.fromCharCode(e.getUint8(i));return r}function o(e,t){if("Exif"!=y(e,t,4))return d&&console.log("Not valid EXIF data! "+y(e,t,4)),!1;var n,r,i,o,a,s=t+6;if(18761==e.getUint16(s))n=!1;else{if(19789!=e.getUint16(s))return d&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;n=!0}if(42!=e.getUint16(s+2,!n))return d&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var l=e.getUint32(s+4,!n);if(l<8)return d&&console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(s+4,!n)),!1;if((r=P(e,s,s+l,c,n)).ExifIFDPointer)for(i in o=P(e,s,s+r.ExifIFDPointer,u,n)){switch(i){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":o[i]=m[i][o[i]];break;case"ExifVersion":case"FlashpixVersion":o[i]=String.fromCharCode(o[i][0],o[i][1],o[i][2],o[i][3]);break;case"ComponentsConfiguration":o[i]=m.Components[o[i][0]]+m.Components[o[i][1]]+m.Components[o[i][2]]+m.Components[o[i][3]]}r[i]=o[i]}if(r.GPSInfoIFDPointer)for(i in a=P(e,s,s+r.GPSInfoIFDPointer,f,n)){switch(i){case"GPSVersionID":a[i]=a[i][0]+"."+a[i][1]+"."+a[i][2]+"."+a[i][3]}r[i]=a[i]}return r.thumbnail=function(e,t,n,r){var i,o,a,s,l=(o=t+n,a=r,s=(i=e).getUint16(o,!a),i.getUint32(o+2+12*s,!a));if(!l)return{};if(l>e.byteLength)return{};var u=P(e,t,t+l,g,r);if(u.Compression)switch(u.Compression){case 6:if(u.JpegIFOffset&&u.JpegIFByteCount){var c=t+u.JpegIFOffset,d=u.JpegIFByteCount;u.blob=new Blob([new Uint8Array(e.buffer,c,d)],{type:"image/jpeg"})}break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",u.Compression)}else 2==u.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");return u}(e,s,l,n),r}function b(e){var t={};if(1==e.nodeType){if(0<e.attributes.length){t["@attributes"]={};for(var n=0;n<e.attributes.length;n++){var r=e.attributes.item(n);t["@attributes"][r.nodeName]=r.nodeValue}}}else if(3==e.nodeType)return e.nodeValue;if(e.hasChildNodes())for(var i=0;i<e.childNodes.length;i++){var o=e.childNodes.item(i),a=o.nodeName;if(null==t[a])t[a]=b(o);else{if(null==t[a].push){var s=t[a];t[a]=[],t[a].push(s)}t[a].push(b(o))}}return t}function x(e){try{var t={};if(0<e.children.length)for(var n=0;n<e.children.length;n++){var r=e.children.item(n),i=r.attributes;for(var o in i){var a=i[o],s=a.nodeName,l=a.nodeValue;void 0!==s&&(t[s]=l)}var u=r.nodeName;if(void 0===t[u])t[u]=b(r);else{if(void 0===t[u].push){var c=t[u];t[u]=[],t[u].push(c)}t[u].push(b(r))}}else t=e.textContent;return t}catch(e){console.log(e.message)}}l.enableXmp=function(){l.isXmpEnabled=!0},l.disableXmp=function(){l.isXmpEnabled=!1},l.getData=function(e,t){return!((self.Image&&e instanceof self.Image||self.HTMLImageElement&&e instanceof self.HTMLImageElement)&&!e.complete)&&(i(e)?t&&t.call(e):n(e,t),!0)},l.getTag=function(e,t){if(i(e))return e.exifdata[t]},l.getIptcTag=function(e,t){if(i(e))return e.iptcdata[t]},l.getAllTags=function(e){if(!i(e))return{};var t,n=e.exifdata,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);return r},l.getAllIptcTags=function(e){if(!i(e))return{};var t,n=e.iptcdata,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);return r},l.pretty=function(e){if(!i(e))return"";var t,n=e.exifdata,r="";for(t in n)n.hasOwnProperty(t)&&("object"==typeof n[t]?n[t]instanceof Number?r+=t+" : "+n[t]+" ["+n[t].numerator+"/"+n[t].denominator+"]\r\n":r+=t+" : ["+n[t].length+" values]\r\n":r+=t+" : "+n[t]+"\r\n");return r},l.readFromBinaryFile=function(e){return p(e)},"function"==typeof define&&define.amd&&define("exif-js",[],function(){return l})}).call(this);